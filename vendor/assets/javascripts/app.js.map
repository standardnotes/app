{"version":3,"sources":["app.js"],"names":["Neeto","angular","module","config","configureAuth","RestangularProvider","apiControllerProvider","url","defaultServerURL","setBaseUrl","setFullRequestInterceptor","element","operation","route","headers","params","httpConfig","token","localStorage","getItem","_","extend","Authorization","$authProvider","configure","default","apiUrl","passwordResetSuccessUrl","window","location","protocol","host","$stateProvider","$urlRouterProvider","$locationProvider","state","abstract","parent","views","templateUrl","controller","resolve","presentation","getPresentation","$rootScope","$stateParams","resetData","reset_password_token","email","$on","event","toState","toParams","fromState","fromParams","options","$q","$state","Restangular","deferred","defer","restangularQuery","one","get","root_path","secondary_path","then","response","catch","go","promise","otherwise","$injector","$location","path","html5Mode","$scope","$auth","apiController","ev","reason","alert","resetPasswordSubmit","new_keys","crypto","generateEncryptionKeysForUser","password","data","clone","pw","password_confirmation","updatePassword","setGk","gk","directive","$timeout","restrict","scope","save","remove","note","user","replace","controllerAs","bindToController","link","elem","attrs","ctrl","handler","ctrlKey","metaKey","String","fromCharCode","which","toLowerCase","preventDefault","saveNote","clickedEditNote","toggleMarkdown","toggleFullScreen","addEventListener","removeEventListener","$watch","oldNote","setNote","$sce","markdownRenderer","demoNotes","title","content","showSampler","id","filteredNotes","length","demoNoteNames","map","currentDemoContent","text","prebeginFn","bind","callback","index","contentCallback","editorMode","focusTitle","hasChanges","dummy","onPreviewDoubleClick","focusEditor","delay","setTimeout","document","getElementById","focus","clickedTextArea","showMenu","renderedContent","renderHtml","renderedContentForText","statusTimeout","$event","success","clearDraft","cancel","noteStatus","saveTitle","target","blur","saveTimeout","changesMade","saveDraftToDisk","contentChanged","nameChanged","onNameFocus","editingName","onContentFocus","$broadcast","editingUrl","onNameBlur","fullscreen","selectedMenuItem","editUrlPressed","publicUrlForNote","base","saveUrl","original","relative_path","updatePresentation","shareNote","openInNewTab","a","createElement","href","click","shareItem","unshareNote","unshareItem","presentationURL","clickedMenu","locked","deleteNote","addNew","selectionMade","willSelect","groups","allGroup","updateNoteGroup","newGroups","setGroups","initialLoad","selectGroup","group","selectedGroup","clickedAddNewGroup","editingGroup","newGroup","Group","notes","uuid","generateRandomKey","originalGroupName","onGroupTitleFocus","name","groupTitleDidChange","saveGroup","savedGroup","merge","noteCount","validNotes","Note","filterDummyNotes","handleDrop","e","logout","serverSideValidation","changePasswordPressed","showNewPasswordForm","accountMenuPressed","serverData","getServer","showAccountMenu","showFaq","changeServer","setServer","signOutPressed","signout","reload","submitPasswordChange","passwordChangeData","status","changePassword","current_password","new_password","hasLocalData","mergeLocalChanged","shouldMerge","confirm","loginSubmitPressed","loginData","login","user_password","errors","onAuthSuccess","submitRegistrationForm","register","forgotPasswordSubmit","requestPasswordReset","resp","encryptionStatusForNotes","allNotes","countEncrypted","forEach","encryptionEnabled","downloadDataArchive","setAttribute","notesDataFile","importFileSelected","files","file","reader","FileReader","onload","importJSONData","result","console","log","readAsText","mergeLocalDataRemotely","showLogin","showRegistration","modelManager","bodyClass","description","onUserSet","all","verifyEncryptionStatusOfAllItems","defaultUser","getCurrentUser","User","items","localUser","updateAllGroup","groupsWillMakeSelection","groupsSelectionMade","groupsAddNew","addTag","groupsSave","saveItems","groupsUpdateNoteGroup","noteCopy","oldGroup","originalNote","find","removeTagFromNote","addTagToNote","saveDirtyItems","notesRemoveGroup","deleteItem","notesSelectionMade","selectedNote","notesAddNew","addNote","headerLogout","removeGroup","groupDidChange","ngDialog","isFirstLoad","noteFilter","setNotes","draft","getDraft","selectNote","createNewNote","selectedGroupDelete","selectedGroupShare","username","open","template","className","disableAnimation","selectedGroupUnshare","publicUrlForGroup","createNew","visible","decryptNotesWithLocalKey","selectFirstNote","visibleNotes","filter","newNote","filterNotes","includes","filterTextChanged","formData","saveUsername","setUsername","closeThisDialog","provider","domainName","domain_comps","hostname","split","domain","port","$get","ApiController","refresh","setItem","plain","keys","request","post","current_keys","_performPasswordChange","reencryptAllNotesAndSave","patch","notesNeedingUpdate","isPublic","isEncrypted","push","saveBatchNotes","dirtyItems","clearDirtyItems","item","createRequestParamsFromItem","savedItems","createRequestParamsForItem","itemCopy","cloneDeep","encryptSingleNote","retrieveGk","loc_eek","JSON","stringify","writeUserToLocalStorage","references","saveBatchItems","resource","error","nil","jsonString","parse","setContentRaw","encryptSingleNoteWithLocalKey","textFile","makeTextFile","Blob","type","URL","revokeObjectURL","createObjectURL","presentationParams","presentable_type","presentable_id","created_at","modified_at","group_id","group_name","removeItem","staticifyObject","object","saveUser","writeToLocalStorage","key","value","toJson","draftString","ek","decryptText","generateRandomEncryptionKey","encryptText","local_encryption_scheme","encryptNotes","encryptNotesWithLocalKey","encryptNonPublicNotesWithLocalKey","nonpublic","pending_share","decryptSingleNoteWithLocalKey","decryptSingleNote","local_eek","decryptNotes","newKey","oldKey","ItemManager","itemId","reference","referencesForItemId","contentType","content_type","referencedItem","removeReferencesBetweenItems","itemOne","itemTwo","resolveReferences","service","marked","setOptions","breaks","sanitize","html_code","trustAsHtml","ModelManager","self","concat","unshift","tag","tags","dirty","createReferencesBetweenItems","refreshRelationshipsForTag","refreshRelationshipsForNote","addDirtyItems","referencesMatchingContentType","sort","b","Date","itemsForContentType","json_obj","updateReferencesLocalMapping","showErrors","formErrors","form","$setDirty","$setValidity","$error","server","join","parseErrors","shouldFocus","$element","el","draggable","dataTransfer","effectAllowed","setData","classList","add","drop","bin","dropEffect","counter","stopPropagation","binId","getData","$apply","fn","on","require","modelCtrl","lowercase","inputValue","undefined","lowercased","$setViewValue","$render","$parsers","ngModel","$window","getSelection","toString","setSelectionRange","linkFunction","$attrs","timer","initialDelay","getTypeDelay","typeDelay","eraseDelay","blinkDelay","getAnimationDelay","cursor","blinkCursor","currentText","textArray","running","auxStyle","Array","start","typewrite","updateIt","charIndex","arrIndex","updateValue","substring","iterationCallback","cleanAndRestart","iterationDelay","callbackFn","blinkIt","slice","charAt","parseInt","prop","toUpperCase","val","html","newVal","oldVal","CryptoJS","lib","WordArray","random","encrypted_content","AES","decrypt","enc","Utf8","encrypt","salt","passphrase","PBKDF2","keySize","sha256","SHA256","generateAsymmetricKeyPair","input","output","hasher","algo","SHA512","iterations","firstHalf","secondHalf","sigBytes","outputLength","words"],"mappings":"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","file":"app.js","sourcesContent":["'use strict';\n\nvar Neeto = Neeto || {};\n\nangular\n  .module('app.frontend', [\n    'app.services',\n    'ui.router',\n    'ng-token-auth',\n    'restangular',\n    'ipCookie',\n    'oc.lazyLoad',\n    'angularLazyImg',\n    'ngDialog',\n  ])\n  .config(configureAuth);\n;'use strict';\n\nangular\n  .module('app.services', [\n    'restangular'\n  ])\n\n  // Configure path to API\n  .config(function (RestangularProvider, apiControllerProvider) {\n    var url = apiControllerProvider.defaultServerURL();\n    RestangularProvider.setBaseUrl(url);\n\n    RestangularProvider.setFullRequestInterceptor(function(element, operation, route, url, headers, params, httpConfig) {\n      var token = localStorage.getItem(\"jwt\");\n      if(token) {\n        headers = _.extend(headers, {Authorization: \"Bearer \" + localStorage.getItem(\"jwt\")});\n      }\n      \n      return {\n        element: element,\n        params: params,\n        headers: headers,\n        httpConfig: httpConfig\n      };\n    });\n  })\n\n  // Shared function for configure auth service. Can be overwritten.\n  function configureAuth ($authProvider, apiControllerProvider) {\n    var url = apiControllerProvider.defaultServerURL();\n    $authProvider.configure([{\n      default: {\n        apiUrl: url,\n        passwordResetSuccessUrl: window.location.protocol + '//' + window.location.host + '/auth/reset',\n      }\n    }]);\n  }\n;angular.module('app.frontend')\n  .config(function ($stateProvider, $urlRouterProvider, $locationProvider) {\n\n    $stateProvider\n      .state('base', {\n        abstract: true,\n      })\n\n      // Homepage\n      .state('home', {\n        url: '/',\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'frontend/home.html',\n            controller: 'HomeCtrl'\n          }\n        }\n      })\n\n      .state('presentation', {\n        url: '/:root_path',\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'frontend/presentation.html',\n            controller: \"PresentationCtrl\"\n          }\n        },\n        resolve: {\n          presentation: getPresentation\n        }\n      })\n\n      .state('group', {\n        url: '/:root_path/:secondary_path',\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'frontend/presentation.html',\n            controller: \"PresentationCtrl\"\n          }\n        },\n        resolve: {\n          presentation: getPresentation\n        }\n      })\n\n      // Auth routes\n      .state('auth', {\n          abstract: true,\n          url: '/auth',\n          parent: 'base',\n          views: {\n            'content@' : {\n              templateUrl: 'frontend/auth/wrapper.html',\n            }\n          }\n      })\n      .state('auth.login', {\n          url: '/login',\n          templateUrl: 'frontend/auth/login.html',\n      })\n      .state('auth.forgot', {\n          url: '/forgot',\n          templateUrl: 'frontend/auth/forgot.html',\n      })\n      .state('auth.reset', {\n          url: '/reset?reset_password_token&email',\n          templateUrl: 'frontend/auth/reset.html',\n          controller: function($rootScope, $stateParams) {\n            $rootScope.resetData = {reset_password_token: $stateParams.reset_password_token, email: $stateParams.email};\n\n            // Clear reset_password_token on change state\n            $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams, options) {\n              $rootScope.reset_password_token = null;\n            });\n          },\n      })\n\n\n      // 404 Error\n      .state('404', {\n        parent: 'base',\n        views: {\n          'content@' : {\n            templateUrl: 'frontend/errors/404.html'\n          }\n        }\n      });\n\n      function getPresentation ($q, $state, $stateParams, Restangular) {\n        var deferred = $q.defer();\n        var restangularQuery = Restangular.one('presentations', 'show_by_path');\n        restangularQuery.get({root_path: $stateParams.root_path, secondary_path: $stateParams.secondary_path})\n        .then(function(response) {\n          deferred.resolve(response);\n        })\n        .catch(function(response) {\n          $state.go('404');\n        });\n\n        return deferred.promise;\n      }\n\n      // Default fall back route\n      $urlRouterProvider.otherwise(function($injector, $location){\n         var state = $injector.get('$state');\n         state.go('404');\n         return $location.path();\n      });\n\n      // enable HTML5 Mode for SEO\n      $locationProvider.html5Mode(true);\n\n  });\n;angular.module('app.frontend')\n  .controller('BaseCtrl', function ($rootScope, $scope, $state, $auth, apiController) {\n    $rootScope.$on('auth:password-change-success', function(ev) {\n      $state.go(\"home\");\n    });\n\n    $rootScope.$on('auth:password-change-error', function(ev, reason) {\n      alert(\"Error: \" + reason);\n    });\n\n    $rootScope.resetPasswordSubmit = function() {\n      var new_keys = Neeto.crypto.generateEncryptionKeysForUser($rootScope.resetData.password, $rootScope.resetData.email);\n      var data = _.clone($rootScope.resetData);\n      data.password = new_keys.pw;\n      data.password_confirmation = new_keys.pw;\n      $auth.updatePassword(data);\n      apiController.setGk(new_keys.gk);\n    }\n\n    // var note = new Note();\n    // note.content = {title: \"hello\", text: \"world\"};\n    // console.log(\"note content\", note.content);\n    // console.log(\"note title\", note.title);\n    // console.log(\"note json\", JSON.stringify(note));\n    //\n    // console.log(\"Copy\", _.cloneDeep(note));\n\n  });\n;angular.module('app.frontend')\n  .directive(\"editorSection\", function($timeout){\n    return {\n      restrict: 'E',\n      scope: {\n        save: \"&\",\n        remove: \"&\",\n        note: \"=\",\n        user: \"=\"\n      },\n      templateUrl: 'frontend/editor.html',\n      replace: true,\n      controller: 'EditorCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n\n        var handler = function(event) {\n          if (event.ctrlKey || event.metaKey) {\n              switch (String.fromCharCode(event.which).toLowerCase()) {\n              case 's':\n                  event.preventDefault();\n                  $timeout(function(){\n                    ctrl.saveNote(event);\n                  });\n                  break;\n              case 'e':\n                  event.preventDefault();\n                  $timeout(function(){\n                    ctrl.clickedEditNote();\n                  })\n                  break;\n              case 'm':\n                  event.preventDefault();\n                  $timeout(function(){\n                    ctrl.toggleMarkdown();\n                  })\n                  break;\n              case 'o':\n                  event.preventDefault();\n                  $timeout(function(){\n                    ctrl.toggleFullScreen();\n                  })\n                  break;\n              }\n          }\n        };\n\n        window.addEventListener('keydown', handler);\n\n        scope.$on('$destroy', function(){\n          window.removeEventListener('keydown', handler);\n        })\n\n        scope.$watch('ctrl.note', function(note, oldNote){\n          if(note) {\n            ctrl.setNote(note, oldNote);\n          } else {\n            ctrl.note = {};\n          }\n        });\n      }\n    }\n  })\n  .controller('EditorCtrl', function ($sce, $timeout, apiController, markdownRenderer, $rootScope) {\n\n    this.demoNotes = [\n      {title: \"Live print a file with tail\", content: \"tail -f log/production.log\"},\n      {title: \"Create SSH tunnel\", content: \"ssh -i .ssh/key.pem -N -L 3306:example.com:3306 ec2-user@example.com\"},\n      {title: \"List of processes running on port\", content: \"lsof -i:8080\"},\n      {title: \"Set ENV from file\", content: \"export $(cat .envfile | xargs)\"},\n      {title: \"Find process by name\", content: \"ps -ax | grep <application name>\"},\n      {title: \"NPM install without sudo\", content: \"sudo chown -R $(whoami) ~/.npm\"},\n      {title: \"Email validation regex\", content: \"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\\.[a-zA-Z0-9-.]+$\"},\n      {title: \"Ruby generate 256 bit key\", content: \"Digest::SHA256.hexdigest(SecureRandom.random_bytes(32))\"},\n      {title: \"Mac add user to user group\", content: \"sudo dseditgroup -o edit -a USERNAME -t user GROUPNAME\"},\n      {title: \"Kill Mac OS System Apache\", content: \"sudo launchctl unload -w /System/Library/LaunchDaemons/org.apache.httpd.plist\"},\n      {title: \"Docker run with mount binding and port\", content: \"docker run -v /home/vagrant/www/app:/var/www/app -p 8080:80 -d kpi/s3\"},\n      {title: \"MySQL grant privileges\", content: \"GRANT [type of permission] ON [database name].[table name] TO [username]@'%;\"},\n      {title: \"MySQL list users\", content: \"SELECT User FROM mysql.user;\"},\n    ];\n\n    this.showSampler = !this.user.id && this.user.filteredNotes().length == 0;\n\n    this.demoNoteNames = _.map(this.demoNotes, function(note){\n      return note.title;\n    });\n\n    this.currentDemoContent = {text: null};\n\n    this.prebeginFn = function() {\n        this.currentDemoContent.text = null;\n    }.bind(this)\n\n    this.callback = function(index) {\n      this.currentDemoContent.text = this.demoNotes[index].text;\n    }.bind(this)\n\n    this.contentCallback = function(index) {\n    }\n\n    this.setNote = function(note, oldNote) {\n      this.editorMode = 'edit';\n      if(note.content.text.length == 0) {\n        this.focusTitle(100);\n      }\n\n      if(oldNote && oldNote != note) {\n        if(oldNote.hasChanges) {\n          this.save()(oldNote, null);\n        } else if(oldNote.dummy) {\n          this.remove()(oldNote);\n        }\n      }\n    }\n\n    this.onPreviewDoubleClick = function() {\n      this.editorMode = 'edit';\n      this.focusEditor(100);\n    }\n\n    this.focusEditor = function(delay) {\n      setTimeout(function(){\n        var element = document.getElementById(\"note-text-editor\");\n        element.focus();\n      }, delay)\n    }\n\n    this.focusTitle = function(delay) {\n      setTimeout(function(){\n        document.getElementById(\"note-title-editor\").focus();\n      }, delay)\n    }\n\n    this.clickedTextArea = function() {\n      this.showMenu = false;\n    }\n\n    this.renderedContent = function() {\n      return markdownRenderer.renderHtml(markdownRenderer.renderedContentForText(this.note.content.text));\n    }\n\n    var statusTimeout;\n\n    this.saveNote = function($event) {\n      var note = this.note;\n      note.dummy = false;\n      this.save()(note, function(success){\n        if(success) {\n          apiController.clearDraft();\n\n          if(statusTimeout) $timeout.cancel(statusTimeout);\n          statusTimeout = $timeout(function(){\n            this.noteStatus = \"All changes saved\"\n          }.bind(this), 200)\n        }\n      }.bind(this));\n    }\n\n    this.saveTitle = function($event) {\n      $event.target.blur();\n      this.saveNote($event);\n      this.focusEditor();\n    }\n\n    var saveTimeout;\n    this.changesMade = function() {\n      this.note.hasChanges = true;\n      this.note.dummy = false;\n      apiController.saveDraftToDisk(this.note);\n\n      if(saveTimeout) $timeout.cancel(saveTimeout);\n      if(statusTimeout) $timeout.cancel(statusTimeout);\n      saveTimeout = $timeout(function(){\n        this.noteStatus = \"Saving...\";\n        this.saveNote();\n      }.bind(this), 150)\n    }\n\n\n    this.contentChanged = function() {\n      this.changesMade();\n    }\n\n    this.nameChanged = function() {\n      this.changesMade();\n    }\n\n    this.onNameFocus = function() {\n      this.editingName = true;\n    }\n\n    this.onContentFocus = function() {\n      this.showSampler = false;\n      $rootScope.$broadcast(\"editorFocused\");\n      this.editingUrl = false;\n    }\n\n    this.onNameBlur = function() {\n      this.editingName = false;\n    }\n\n    this.toggleFullScreen = function() {\n      this.fullscreen = !this.fullscreen;\n      if(this.fullscreen) {\n        if(this.editorMode == 'edit') {\n          // refocus\n          this.focusEditor(0);\n        }\n      } else {\n\n      }\n    }\n\n    this.selectedMenuItem = function() {\n      this.showMenu = false;\n    }\n\n    this.toggleMarkdown = function() {\n      if(this.editorMode == 'preview') {\n        this.editorMode = 'edit';\n      } else {\n        this.editorMode = 'preview';\n      }\n    }\n\n    this.editUrlPressed = function() {\n      this.showMenu = false;\n      var url = this.publicUrlForNote(this.note);\n      url = url.replace(this.note.presentation.root_path, \"\");\n      this.url = {base: url, token : this.note.presentation.root_path};\n      this.editingUrl = true;\n    }\n\n    this.saveUrl = function($event) {\n      $event.target.blur();\n\n      var original = this.note.presentation.relative_path;\n      this.note.presentation.relative_path = this.url.token;\n\n      apiController.updatePresentation(this.note, this.note.presentation, function(response){\n        if(!response) {\n          this.note.presentation.relative_path = original;\n          this.url.token = original;\n          alert(\"This URL is not available.\");\n        } else {\n          this.editingUrl = false;\n        }\n      }.bind(this))\n    }\n\n    this.shareNote = function() {\n\n      function openInNewTab(url) {\n        var a = document.createElement(\"a\");\n        a.target = \"_blank\";\n        a.href = url;\n        a.click();\n    }\n\n      apiController.shareItem(this.user, this.note, function(note){\n        openInNewTab(this.publicUrlForNote(note));\n      }.bind(this))\n      this.showMenu = false;\n    }\n\n    this.unshareNote = function() {\n      apiController.unshareItem(this.user, this.note, function(note){\n\n      })\n      this.showMenu = false;\n    }\n\n    this.publicUrlForNote = function() {\n      return this.note.presentationURL();\n    }\n\n    this.clickedMenu = function() {\n      if(this.note.locked) {\n        alert(\"This note has been shared without an account, and can therefore not be changed.\")\n      } else {\n        this.showMenu = !this.showMenu;\n      }\n    }\n\n    this.deleteNote = function() {\n      apiController.clearDraft();\n      this.remove()(this.note);\n      this.showMenu = false;\n    }\n\n    this.clickedEditNote = function() {\n      this.editorMode = 'edit';\n      this.focusEditor(100);\n    }\n\n  });\n;angular.module('app.frontend')\n  .directive(\"groupsSection\", function(){\n    return {\n      restrict: 'E',\n      scope: {\n        addNew: \"&\",\n        selectionMade: \"&\",\n        willSelect: \"&\",\n        save: \"&\",\n        groups: \"=\",\n        allGroup: \"=\",\n        user: \"=\",\n        updateNoteGroup: \"&\"\n      },\n      templateUrl: 'frontend/groups.html',\n      replace: true,\n      controller: 'GroupsCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n        scope.$watch('ctrl.groups', function(newGroups){\n          if(newGroups) {\n            ctrl.setGroups(newGroups);\n          }\n        });\n      }\n    }\n  })\n  .controller('GroupsCtrl', function () {\n\n    var initialLoad = true;\n\n    this.setGroups = function(groups) {\n      if(initialLoad) {\n          initialLoad = false;\n          this.selectGroup(this.allGroup);\n      } else {\n        if(groups && groups.length > 0) {\n          this.selectGroup(groups[0]);\n        }\n      }\n    }\n\n    this.selectGroup = function(group) {\n      this.willSelect()(group);\n      this.selectedGroup = group;\n      this.selectionMade()(group);\n    }\n\n    this.clickedAddNewGroup = function() {\n      if(this.editingGroup) {\n        return;\n      }\n\n      this.newGroup = new Group({notes : []});\n      if(!this.user.uuid) {\n        this.newGroup.uuid = Neeto.crypto.generateRandomKey()\n      }\n      this.selectedGroup = this.newGroup;\n      this.editingGroup = this.newGroup;\n      this.addNew()(this.newGroup);\n    }\n\n    var originalGroupName = \"\";\n    this.onGroupTitleFocus = function(group) {\n      originalGroupName = group.name;\n    }\n\n    this.groupTitleDidChange = function(group) {\n      this.editingGroup = group;\n    }\n\n    this.saveGroup = function($event, group) {\n      this.editingGroup = null;\n      if(group.name.length == 0) {\n        group.name = originalGroupName;\n        originalGroupName = \"\";\n        return;\n      }\n\n      $event.target.blur();\n      if(!group.name || group.name.length == 0) {\n          return;\n      }\n\n      this.save()(group, function(savedGroup){\n        _.merge(group, savedGroup);\n        this.selectGroup(group);\n        this.newGroup = null;\n      }.bind(this));\n    }\n\n    this.noteCount = function(group) {\n      var validNotes = Note.filterDummyNotes(group.notes);\n      return validNotes.length;\n    }\n\n    this.handleDrop = function(e, newGroup, note) {\n      this.updateNoteGroup()(note, newGroup, this.selectedGroup);\n    }.bind(this)\n\n\n  });\n;angular.module('app.frontend')\n  .directive(\"header\", function(){\n    return {\n      restrict: 'E',\n      scope: {\n        user: \"=\",\n        logout: \"&\"\n      },\n      templateUrl: 'frontend/header.html',\n      replace: true,\n      controller: 'HeaderCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n\n      }\n    }\n  })\n  .controller('HeaderCtrl', function ($auth, $state, apiController, serverSideValidation, $timeout) {\n\n    this.changePasswordPressed = function() {\n      this.showNewPasswordForm = !this.showNewPasswordForm;\n    }\n\n    this.accountMenuPressed = function() {\n      this.serverData = {url: apiController.getServer()};\n      this.showAccountMenu = !this.showAccountMenu;\n      this.showFaq = false;\n      this.showNewPasswordForm = false;\n    }\n\n    this.changeServer = function() {\n      apiController.setServer(this.serverData.url, true);\n    }\n\n    this.signOutPressed = function() {\n      this.showAccountMenu = false;\n      this.logout()();\n      apiController.signout();\n      window.location.reload();\n    }\n\n    this.submitPasswordChange = function() {\n      this.passwordChangeData.status = \"Generating New Keys...\";\n\n      $timeout(function(){\n        if(data.password != data.password_confirmation) {\n          alert(\"Your new password does not match its confirmation.\");\n          return;\n        }\n\n        apiController.changePassword(this.user, this.passwordChangeData.current_password, this.passwordChangeData.new_password, function(response){\n\n        })\n\n      }.bind(this))\n    }\n\n    this.hasLocalData = function() {\n      return this.user.filteredNotes().length > 0;\n    }\n\n    this.mergeLocalChanged = function() {\n      if(!this.user.shouldMerge) {\n        if(!confirm(\"Unchecking this option means any locally stored groups and notes you have now will be deleted. Are you sure you want to continue?\")) {\n          this.user.shouldMerge = true;\n        }\n      }\n    }\n\n    this.loginSubmitPressed = function() {\n      this.loginData.status = \"Generating Login Keys...\";\n      $timeout(function(){\n        apiController.login(this.loginData.email, this.loginData.user_password, function(response){\n          if(response.errors) {\n            this.loginData.status = response.errors[0];\n          } else {\n            this.onAuthSuccess(response.user);\n          }\n        }.bind(this));\n      }.bind(this))\n    }\n\n    this.submitRegistrationForm = function() {\n      this.loginData.status = \"Generating Account Keys...\";\n\n      $timeout(function(){\n        apiController.register(this.loginData.email, this.loginData.user_password, function(response){\n          if(response.errors) {\n            this.loginData.status = response.errors[0];\n          } else {\n            this.onAuthSuccess(response.user);\n          }\n        }.bind(this));\n      }.bind(this))\n    }\n\n    this.forgotPasswordSubmit = function() {\n      $auth.requestPasswordReset(this.resetData)\n        .then(function(resp) {\n          this.resetData.response = \"Success\";\n          // handle success response\n        }.bind(this))\n        .catch(function(resp) {\n          // handle error response\n          this.resetData.response = \"Error\";\n        }.bind(this));\n    }\n\n    this.encryptionStatusForNotes = function() {\n      var allNotes = this.user.filteredNotes();\n      var countEncrypted = 0;\n      allNotes.forEach(function(note){\n        if(note.encryptionEnabled()) {\n          countEncrypted++;\n        }\n      }.bind(this))\n\n      return countEncrypted + \"/\" + allNotes.length + \" notes encrypted\";\n    }\n\n    this.downloadDataArchive = function() {\n      var link = document.createElement('a');\n      link.setAttribute('download', 'neeto.json');\n      link.href = apiController.notesDataFile(this.user);\n      link.click();\n    }\n\n    this.importFileSelected = function(files) {\n      var file = files[0];\n      var reader = new FileReader();\n      reader.onload = function(e) {\n        apiController.importJSONData(e.target.result, function(success, response){\n          console.log(\"import response\", success, response);\n          if(success) {\n            // window.location.reload();\n          } else {\n            alert(\"There was an error importing your data. Please try again.\");\n          }\n        })\n      }\n      reader.readAsText(file);\n    }\n\n    this.onAuthSuccess = function(user) {\n      this.user.id = user.id;\n\n      if(this.user.shouldMerge && this.hasLocalData()) {\n        apiController.mergeLocalDataRemotely(this.user, function(){\n          window.location.reload();\n        });\n      } else {\n        window.location.reload();\n      }\n\n      this.showLogin = false;\n      this.showRegistration = false;\n    }\n\n  });\n;angular.module('app.frontend')\n.controller('HomeCtrl', function ($scope, $rootScope, $timeout, apiController, modelManager) {\n    $rootScope.bodyClass = \"app-body-class\";\n    $rootScope.title = \"Notes Neeto, a secure code box for developers\";\n    $rootScope.description = \"A secure code box for developers to store common commands and useful notes.\";\n\n    var onUserSet = function() {\n\n      $scope.allGroup = new Group({name: \"All\", all: true});\n      $scope.groups = modelManager.groups;\n\n      apiController.verifyEncryptionStatusOfAllItems($scope.defaultUser, function(success){\n\n      });\n    }\n\n    apiController.getCurrentUser(function(response){\n      if(response && !response.errors) {\n        $scope.defaultUser = new User(response);\n        modelManager.items = response.items;\n        $rootScope.title = \"Notes Neeto\";\n        onUserSet();\n      } else {\n        $scope.defaultUser = new User(apiController.localUser());\n        onUserSet();\n      }\n    });\n\n    /*\n    Groups Ctrl Callbacks\n    */\n\n    $scope.updateAllGroup = function() {\n      $scope.allGroup.notes = modelManager.filteredNotes;\n    }\n\n    $scope.groupsWillMakeSelection = function(group) {\n      if(group.all) {\n        $scope.updateAllGroup();\n      }\n    }\n\n    $scope.groupsSelectionMade = function(group) {\n      if(!group.notes) {\n        group.notes = [];\n      }\n      $scope.selectedGroup = group;\n    }\n\n    $scope.groupsAddNew = function(group) {\n      modelManager.addTag(group);\n    }\n\n    $scope.groupsSave = function(group, callback) {\n      apiController.saveItems([group], callback);\n    }\n\n    /*\n    Called to update the group of a note after drag and drop change\n    The note object is a copy of the original\n    */\n    $scope.groupsUpdateNoteGroup = function(noteCopy, newGroup, oldGroup) {\n\n      var originalNote = _.find($scope.defaultUser.notes, {uuid: noteCopy.uuid});\n      modelManager.removeTagFromNote(oldGroup, originalNote);\n      if(!newGroup.all) {\n        modelManager.addTagToNote(newGroup, originalNote);\n      }\n\n      apiController.saveDirtyItems(function(){});\n    }\n\n    /*\n    Notes Ctrl Callbacks\n    */\n\n    $scope.notesRemoveGroup = function(group) {\n      var validNotes = Note.filterDummyNotes(group.notes);\n      if(validNotes == 0) {\n        // if no more notes, delete group\n        apiController.deleteItem($scope.defaultUser, group, function(){\n          // force scope groups to update on sub directives\n          $scope.groups = [];\n          $timeout(function(){\n            $scope.groups = modelManager.groups;\n          })\n        });\n      } else {\n        alert(\"To delete this group, remove all its notes first.\");\n      }\n    }\n\n    $scope.notesSelectionMade = function(note) {\n      $scope.selectedNote = note;\n    }\n\n    $scope.notesAddNew = function(note) {\n      if(!$scope.defaultUser.id) {\n        // generate local id for note\n        note.id = Neeto.crypto.generateRandomKey();\n      }\n\n      modelManager.addNote(note);\n\n      if(!$scope.selectedGroup.all) {\n        modelManager.addTagToNote($scope.selectedGroup, note);\n      }\n    }\n\n    /*\n    Shared Callbacks\n    */\n\n    $scope.saveNote = function(note, callback) {\n      apiController.saveItems([note], function(){\n        modelManager.addNote(note);\n        note.hasChanges = false;\n\n        if(callback) {\n          callback(true);\n        }\n      })\n    }\n\n    $scope.deleteNote = function(note) {\n\n      modelManager.deleteNote(note);\n\n      if(note == $scope.selectedNote) {\n        $scope.selectedNote = null;\n      }\n\n      if(note.dummy) {\n        return;\n      }\n\n      apiController.deleteItem($scope.defaultUser, note, function(success){})\n      apiController.saveDirtyItems(function(){});\n    }\n\n    /*\n    Header Ctrl Callbacks\n    */\n\n    $scope.headerLogout = function() {\n      $scope.defaultUser = apiController.localUser();\n      $scope.groups = $scope.defaultUser.groups;\n    }\n\n\n});\n;angular.module('app.frontend')\n  .directive(\"notesSection\", function(){\n    return {\n      scope: {\n        addNew: \"&\",\n        selectionMade: \"&\",\n        remove: \"&\",\n        group: \"=\",\n        user: \"=\",\n        removeGroup: \"&\"\n      },\n      templateUrl: 'frontend/notes.html',\n      replace: true,\n      controller: 'NotesCtrl',\n      controllerAs: 'ctrl',\n      bindToController: true,\n\n      link:function(scope, elem, attrs, ctrl) {\n        scope.$watch('ctrl.group', function(group, oldGroup){\n          if(group) {\n            ctrl.groupDidChange(group, oldGroup);\n          }\n        });\n      }\n    }\n  })\n  .controller('NotesCtrl', function (apiController, $timeout, ngDialog, $rootScope) {\n\n    $rootScope.$on(\"editorFocused\", function(){\n      this.showMenu = false;\n    }.bind(this))\n\n    var isFirstLoad = true;\n\n    this.groupDidChange = function(group, oldGroup) {\n      this.showMenu = false;\n\n      if(this.selectedNote && this.selectedNote.dummy) {\n        _.remove(oldGroup.notes, this.selectedNote);\n      }\n\n      this.noteFilter.text = \"\";\n      this.setNotes(group.notes, false);\n\n      if(isFirstLoad) {\n        $timeout(function(){\n          var draft = apiController.getDraft();\n          if(draft) {\n            var note = draft;\n            this.selectNote(note);\n          } else {\n            this.createNewNote();\n            isFirstLoad = false;\n          }\n        }.bind(this))\n      } else if(group.notes.length == 0) {\n          this.createNewNote();\n      }\n    }\n\n    this.selectedGroupDelete = function() {\n      this.showMenu = false;\n      this.removeGroup()(this.group);\n    }\n\n    this.selectedGroupShare = function() {\n      this.showMenu = false;\n\n      if(!this.user.id) {\n        alert(\"You must be signed in to share a group.\");\n        return;\n      }\n\n      if(this.group.all) {\n        alert(\"You cannot share the 'All' group.\");\n        return;\n      }\n\n      var callback = function(username) {\n        apiController.shareItem(this.user, this.group, function(response){\n        })\n      }.bind(this);\n\n      if(!this.user.username) {\n        ngDialog.open({\n          template: 'frontend/modals/username.html',\n          controller: 'UsernameModalCtrl',\n          resolve: {\n            user: function() {return this.user}.bind(this),\n            callback: function() {return callback}\n          },\n          className: 'ngdialog-theme-default',\n          disableAnimation: true\n        });\n      } else {\n        callback(this.user.username);\n      }\n    }\n\n    this.selectedGroupUnshare = function() {\n      this.showMenu = false;\n      apiController.unshareItem(this.user, this.group, function(response){\n\n      })\n    }\n\n    this.publicUrlForGroup = function() {\n      return this.group.presentation.url;\n    }\n\n    this.setNotes = function(notes, createNew) {\n      this.notes = notes;\n      notes.forEach(function(note){\n        note.visible = true;\n      })\n      apiController.decryptNotesWithLocalKey(notes);\n      this.selectFirstNote(createNew);\n    }\n\n    this.selectFirstNote = function(createNew) {\n      var visibleNotes = this.notes.filter(function(note){\n        return note.visible;\n      });\n\n      if(visibleNotes.length > 0) {\n        this.selectNote(visibleNotes[0]);\n      } else if(createNew) {\n        this.createNewNote();\n      }\n    }\n\n    this.selectNote = function(note) {\n      this.selectedNote = note;\n      this.selectionMade()(note);\n    }\n\n    this.createNewNote = function() {\n      var title = \"New Note\" + (this.notes ? (\" \" + (this.notes.length + 1)) : \"\");\n      this.newNote = new Note({dummy: true});\n      this.newNote.content.title = title;\n      modelManager.addTagToNote(this.group, this.newNote);\n      this.selectNote(this.newNote);\n      this.addNew()(this.newNote);\n    }\n\n    this.noteFilter = {text : ''};\n\n    this.filterNotes = function(note) {\n      if(this.noteFilter.text.length == 0) {\n        note.visible = true;\n      } else {\n        note.visible = note.title.toLowerCase().includes(this.noteFilter.text) || note.text.toLowerCase().includes(this.noteFilter.text);\n      }\n      return note.visible;\n    }.bind(this)\n\n    this.filterTextChanged = function() {\n      $timeout(function(){\n        if(!this.selectedNote.visible) {\n          this.selectFirstNote(false);\n        }\n      }.bind(this), 100)\n    }\n  });\n;angular.module('app.frontend')\n.controller('UsernameModalCtrl', function ($scope, apiController, Restangular, user, callback, $timeout) {\n  $scope.formData = {};\n\n  $scope.saveUsername = function() {\n    apiController.setUsername(user, $scope.formData.username, function(response){\n      var username = response.root_path;\n      user.presentation = response;\n      callback(username);\n      $scope.closeThisDialog();\n    })\n  }\n});\n;angular.module('app.services')\n  .provider('apiController', function () {\n\n    function domainName()  {\n      var domain_comps = location.hostname.split(\".\");\n      var domain = domain_comps[domain_comps.length - 2] + \".\" + domain_comps[domain_comps.length - 1];\n      return domain;\n    }\n\n    var url;\n\n    this.defaultServerURL = function() {\n      if(!url) {\n        url = localStorage.getItem(\"server\");\n        if(!url) {\n          url = location.protocol + \"//\" + domainName() + (location.port ? ':' + location.port: '');\n        }\n      }\n      return url;\n    }\n\n\n    this.$get = function(Restangular, modelManager) {\n        return new ApiController(Restangular, modelManager);\n    }\n\n    function ApiController(Restangular, modelManager) {\n\n      /*\n      Config\n      */\n\n      this.getServer = function() {\n        if(!url) {\n          url = localStorage.getItem(\"server\");\n          if(!url) {\n            url = location.protocol + \"//\" + domainName() + (location.port ? ':' + location.port: '');\n            this.setServer(url);\n          }\n        }\n        return url;\n      }\n\n      this.setServer = function(url, refresh) {\n        localStorage.setItem(\"server\", url);\n        if(refresh) {\n          window.location.reload();\n        }\n      }\n\n\n      /*\n      Auth\n      */\n\n      this.getCurrentUser = function(callback) {\n        if(!localStorage.getItem(\"jwt\")) {\n          callback(null);\n          return;\n        }\n        Restangular.one(\"users/current\").get().then(function(response){\n          callback(response.plain());\n        })\n      }\n\n      this.login = function(email, password, callback) {\n        var keys = Neeto.crypto.generateEncryptionKeysForUser(password, email);\n        this.setGk(keys.gk);\n        var request = Restangular.one(\"auth/sign_in.json\");\n        request.user = {password: keys.pw, email: email};\n        request.post().then(function(response){\n          localStorage.setItem(\"jwt\", response.token);\n          callback(response);\n        })\n      }\n\n      this.register = function(email, password, callback) {\n        var keys = Neeto.crypto.generateEncryptionKeysForUser(password, email);\n        this.setGk(keys.gk);\n        var request = Restangular.one(\"auth.json\");\n        request.user = {password: keys.pw, email: email};\n        request.post().then(function(response){\n          localStorage.setItem(\"jwt\", response.token);\n          callback(response);\n        })\n      }\n\n      this.changePassword = function(user, current_password, new_password) {\n        var current_keys = Neeto.crypto.generateEncryptionKeysForUser(current_password, user.email);\n        var new_keys = Neeto.crypto.generateEncryptionKeysForUser(new_password, user.email);\n\n        var data = {};\n        data.current_password = current_keys.pw;\n        data.password = new_keys.pw;\n        data.password_confirmation = new_keys.pw;\n\n        var user = this.user;\n\n        this._performPasswordChange(current_keys, new_keys, function(response){\n          if(response && !response.errors) {\n            // this.showNewPasswordForm = false;\n            // reencrypt data with new gk\n            this.reencryptAllNotesAndSave(user, new_keys.gk, current_keys.gk, function(success){\n              if(success) {\n                this.setGk(new_keys.gk);\n                alert(\"Your password has been changed and your data re-encrypted.\");\n              } else {\n                // rollback password\n                this._performPasswordChange(new_keys, current_keys, function(response){\n                  alert(\"There was an error changing your password. Your password has been rolled back.\");\n                  window.location.reload();\n                })\n              }\n            }.bind(this));\n          } else {\n            // this.showNewPasswordForm = false;\n            alert(\"There was an error changing your password. Please try again.\");\n          }\n        })\n      }\n\n      this._performPasswordChange = function(email, current_keys, new_keys, callback) {\n        var request = Restangular.one(\"auth\");\n        request.user = {password: new_keys.pw, password_confirmation: new_keys.pw, current_password: current_keys.pw, email: email};\n        request.patch().then(function(response){\n          callback(response);\n        })\n      }\n\n\n      /*\n      User\n      */\n\n      this.setUsername = function(user, username, callback) {\n        var request = Restangular.one(\"users\", user.id).one(\"set_username\");\n        request.username = username;\n        request.post().then(function(response){\n          callback(response.plain());\n        })\n      }\n\n      /*\n      Ensures that if encryption is disabled, all local notes are uncrypted,\n      and that if it's enabled, that all local notes are encrypted\n      */\n      this.verifyEncryptionStatusOfAllItems = function(user, callback) {\n        var allNotes = user.filteredNotes();\n        var notesNeedingUpdate = [];\n        allNotes.forEach(function(note){\n          if(!note.isPublic()) {\n            if(note.encryptionEnabled() && !note.isEncrypted()) {\n              notesNeedingUpdate.push(note);\n            }\n          } else {\n            if(note.isEncrypted()) {\n              notesNeedingUpdate.push(note);\n            }\n          }\n        }.bind(this))\n\n        if(notesNeedingUpdate.length > 0) {\n          console.log(\"verifying encryption, notes need updating\", notesNeedingUpdate);\n          this.saveBatchNotes(user, notesNeedingUpdate, callback)\n        }\n      }\n\n\n\n      /*\n      Items\n      */\n\n      this.saveDirtyItems = function(callback) {\n        var dirtyItems = modelManager.dirtyItems;\n\n        this.saveItems(dirtyItems, function(response){\n          modelManager.clearDirtyItems();\n        })\n      }\n\n      this.saveItems = function(items, callback) {\n        var request = Restangular.one(\"users\", user.uuid).one(\"items\");\n        request.items = _.map(items, function(item){\n          return this.createRequestParamsFromItem(item, user);\n        }.bind(this));\n\n        request.post().then(function(response) {\n          var savedItems = response.items;\n          items.forEach(function(item){\n            _.merge(item, _.find(savedItems, {uuid: item.uuid}));\n          })\n          callback(response);\n        })\n      }\n\n      this.createRequestParamsForItem = function(item, user) {\n        var params = {uuid: item.uuid};\n\n        if(!item.isPublic()) {\n          // encrypted\n          var itemCopy = _.cloneDeep(item);\n          this.encryptSingleNote(itemCopy, this.retrieveGk());\n          params.content = itemCopy.content;\n          params.loc_eek = itemCopy.loc_eek;\n        }\n        else {\n          // decrypted\n          params.content = JSON.stringify(item.content);\n          params.loc_eek = null;\n        }\n        return params;\n      }\n\n\n      this.deleteItem = function(user, item, callback) {\n        if(!user.id) {\n          this.writeUserToLocalStorage(user);\n          callback(true);\n        } else {\n          Restangular.one(\"users\", user.uuid).one(\"items\", item.uuid).remove()\n          .then(function(response) {\n            callback(true);\n          })\n        }\n      }\n\n      this.shareItem = function(user, item, callback) {\n        if(!user.id) {\n          alert(\"You must be signed in to share.\");\n        } else {\n          Restangular.one(\"users\", user.uuid).one(\"items\", item.uuid).one(\"presentations\").post()\n          .then(function(response){\n            var presentation = response.plain();\n            _.merge(item, {presentation: presentation});\n            callback(item);\n\n            // decrypt references\n            if(item.references.length > 0) {\n              this.saveBatchItems(user, item.references, function(success){})\n            }\n          })\n        }\n      }\n\n      this.unshareItem = function(user, item, callback) {\n        var request = Restangular.one(\"users\", user.uuid).one(\"notes\", item.uuid).one(\"presentations\", item.presentation.uuid);\n        request.remove().then(function(response){\n          item.presentation = null;\n          callback(null);\n\n          // encrypt references\n          if(item.references.length > 0) {\n            this.saveBatchItems(user, item.references, function(success){})\n          }\n        })\n      }\n\n\n      /*\n      Presentations\n      */\n\n      this.updatePresentation = function(resource, presentation, callback) {\n        var request = Restangular.one(\"users\", user.id)\n        .one(\"items\", resource.id)\n        .one(\"presentations\", resource.presentation.id);\n        _.merge(request, presentation);\n        request.patch().then(function(response){\n          callback(response.plain());\n        })\n        .catch(function(error){\n          callback(nil);\n        })\n      }\n\n\n      /*\n      Import\n      */\n\n      this.importJSONData = function(jsonString, callback) {\n        var data = JSON.parse(jsonString);\n        var user = new User(data);\n        console.log(\"importing data\", JSON.parse(jsonString));\n        user.notes.forEach(function(note) {\n          if(note.isPublic()) {\n            note.setContentRaw(JSON.stringify(note.content));\n          } else {\n            this.encryptSingleNoteWithLocalKey(note);\n          }\n\n          // prevent circular links\n          note.group = null;\n        }.bind(this))\n\n        user.groups.forEach(function(group){\n          // prevent circular links\n          group.notes = null;\n        })\n\n        var request = Restangular.one(\"import\");\n        request.data = {notes: user.notes, groups: user.groups};\n        request.post().then(function(response){\n          callback(true, response);\n        })\n        .catch(function(error){\n          callback(false, error);\n        })\n      }\n\n      /*\n      Export\n      */\n\n      this.notesDataFile = function(user) {\n        var textFile = null;\n        var makeTextFile = function (text) {\n          var data = new Blob([text], {type: 'text/json'});\n\n          // If we are replacing a previously generated file we need to\n          // manually revoke the object URL to avoid memory leaks.\n          if (textFile !== null) {\n            window.URL.revokeObjectURL(textFile);\n          }\n\n          textFile = window.URL.createObjectURL(data);\n\n          // returns a URL you can use as a href\n          return textFile;\n        }.bind(this);\n\n        var presentationParams = function(presentation) {\n          if(!presentation) {\n            return null;\n          }\n\n          return {\n            id: presentation.id,\n            uuid: presentation.uuid,\n            root_path: presentation.root_path,\n            relative_path: presentation.relative_path,\n            presentable_type: presentation.presentable_type,\n            presentable_id: presentation.presentable_id,\n            created_at: presentation.created_at,\n            modified_at: presentation.modified_at,\n          }\n        }\n\n        var notes = _.map(user.filteredNotes(), function(note){\n          return {\n            id: note.id,\n            uuid: note.uuid,\n            content: note.content,\n            group_id: note.group_id,\n            created_at: note.created_at,\n            modified_at: note.modified_at,\n            presentation: presentationParams(note.presentation)\n          }\n        });\n\n        var groups = _.map(user.groups, function(group){\n          return {\n            id: group.id,\n            uuid: group.uuid,\n            name: group.name,\n            created_at: group.created_at,\n            modified_at: group.modified_at,\n            presentation: presentationParams(group.presentation)\n          }\n        });\n\n        var data = {\n          notes: notes,\n          groups: groups\n        }\n\n        return makeTextFile(JSON.stringify(data, null, 2 /* pretty print */));\n      }\n\n\n\n\n      /*\n      Merging\n      */\n      this.mergeLocalDataRemotely = function(user, callback) {\n        var request = Restangular.one(\"users\", user.id).one(\"merge\");\n        var groups = user.groups;\n        request.notes = user.notes;\n        request.notes.forEach(function(note){\n          if(note.group_id) {\n            var group = groups.filter(function(group){return group.id == note.group_id})[0];\n            note.group_name = group.name;\n          }\n        })\n        request.post().then(function(response){\n          callback();\n          localStorage.removeItem('user');\n        })\n      }\n\n\n\n\n\n\n      this.staticifyObject = function(object) {\n        return JSON.parse(JSON.stringify(object));\n      }\n\n      this.writeUserToLocalStorage = function(user) {\n        var saveUser = _.cloneDeep(user);\n        saveUser.notes = Note.filterDummyNotes(saveUser.notes);\n        saveUser.groups.forEach(function(group){\n          group.notes = null;\n        }.bind(this))\n        this.writeToLocalStorage('user', saveUser);\n      }\n\n      this.writeToLocalStorage = function(key, value) {\n        localStorage.setItem(key, angular.toJson(value));\n      }\n\n      this.localUser = function() {\n        var user = JSON.parse(localStorage.getItem('user'));\n        if(!user) {\n          user = {notes: [], groups: []};\n        }\n        user.shouldMerge = true;\n        return user;\n      }\n\n      /*\n      Drafts\n      */\n\n      this.saveDraftToDisk = function(draft) {\n        localStorage.setItem(\"draft\", JSON.stringify(draft));\n      }\n\n      this.clearDraft = function() {\n        localStorage.removeItem(\"draft\");\n      }\n\n      this.getDraft = function() {\n        var draftString = localStorage.getItem(\"draft\");\n        if(!draftString || draftString == 'undefined') {\n          return null;\n        }\n        return new Note(JSON.parse(draftString));\n      }\n\n\n      /*\n      Encrpytion\n      */\n\n      this.retrieveGk = function() {\n        if(!this.gk) {\n          this.gk = localStorage.getItem(\"gk\");\n        }\n        return this.gk;\n      }\n\n      this.setGk = function(gk) {\n        localStorage.setItem('gk', gk);\n      }\n\n      this.signout = function() {\n        localStorage.removeItem(\"jwt\");\n        localStorage.removeItem(\"gk\");\n      }\n\n      this.encryptSingleNote = function(note, key) {\n        var ek = null;\n        if(note.loc_eek) {\n          ek = Neeto.crypto.decryptText(note.loc_eek, key);\n        } else {\n          ek = Neeto.crypto.generateRandomEncryptionKey();\n          note.loc_eek = Neeto.crypto.encryptText(ek, key);\n        }\n        note.content = Neeto.crypto.encryptText(JSON.stringify(note.content), ek);\n        note.local_encryption_scheme = \"1.0\";\n      }\n\n      this.encryptNotes = function(notes, key) {\n        notes.forEach(function(note){\n          this.encryptSingleNote(note, key);\n        }.bind(this));\n      }\n\n      this.encryptSingleNoteWithLocalKey = function(note) {\n        this.encryptSingleNote(note, this.retrieveGk());\n      }\n\n      this.encryptNotesWithLocalKey = function(notes) {\n        this.encryptNotes(notes, this.retrieveGk());\n      }\n\n      this.encryptNonPublicNotesWithLocalKey = function(notes) {\n        var nonpublic = notes.filter(function(note){\n          return !note.isPublic() && !note.pending_share;\n        })\n        this.encryptNotes(nonpublic, this.retrieveGk());\n      }\n\n      this.decryptSingleNoteWithLocalKey = function(note) {\n        this.decryptSingleNote(note, this.retrieveGk());\n      }\n\n       this.decryptSingleNote = function(note, key) {\n         var ek = Neeto.crypto.decryptText(note.loc_eek || note.local_eek, key);\n         var content = Neeto.crypto.decryptText(note.content, ek);\n        //  console.log(\"decrypted contnet\", content);\n         note.content = content;\n       }\n\n       this.decryptNotes = function(notes, key) {\n         notes.forEach(function(note){\n          //  console.log(\"is encrypted?\", note);\n           if(note.isEncrypted()) {\n             this.decryptSingleNote(note, key);\n           }\n         }.bind(this));\n       }\n\n       this.decryptNotesWithLocalKey = function(notes) {\n         this.decryptNotes(notes, this.retrieveGk());\n       }\n\n       this.reencryptAllNotesAndSave = function(user, newKey, oldKey, callback) {\n         var notes = user.filteredNotes();\n         notes.forEach(function(note){\n           if(note.isEncrypted()) {\n             // first decrypt eek with old key\n             var ek = Neeto.crypto.decryptText(note.loc_eek, oldKey);\n             // now encrypt ek with new key\n             note.loc_eek = Neeto.crypto.encryptText(ek, newKey);\n           }\n         });\n\n         this.saveBatchNotes(user, notes, function(success) {\n           callback(success);\n         }.bind(this));\n       }\n     }\n});\n;class ItemManager {\n\n  set items(items) {\n    this.items = items;\n    resolveReferences();\n  }\n\n  referencesForItemId(itemId) {\n    return _.find(this.items, {uuid: itemId});\n  }\n\n  resolveReferences() {\n    this.items.forEach(function(item){\n      // build out references\n      _.map(item.references, function(reference){\n        return referencesForItemId(reference.uuid);\n      })\n    });\n  }\n\n  itemsForContentType(contentType) {\n    this.items.filter(function(item){\n      return item.content_type == contentType;\n    });\n  }\n\n  // returns dirty item references that need saving\n  deleteItem(item) {\n    _.remove(this.items, item);\n    item.references.forEach(function(referencedItem){\n      removeReferencesBetweenItems(referencedItem, item);\n    })\n\n    return item.references;\n  }\n\n  removeReferencesBetweenItems(itemOne, itemTwo) {\n    _.remove(itemOne.references, _.find(itemOne.references, {uuid: itemTwo.uuid}));\n    _.remove(itemTwo.references, _.find(itemTwo.references, {uuid: itemOne.uuid}));\n    return [itemOne, itemTwo];\n  }\n\n  createReferencesBetweenItems(itemOne, itemTwo) {\n    itemOne.references.push(itemTwo);\n    itemTwo.references.push(itemOne);\n    return [itemOne, itemTwo];\n  }\n}\n\nexport { ItemManager }\n\nangular\n    .module('app.services', [])\n    .service('itemManager', ItemManager);\n;angular.module('app.services')\n  .service('markdownRenderer', function ($sce) {\n\n    marked.setOptions({\n      breaks: true,\n      sanitize: true\n    });\n\n    this.renderedContentForText = function(text) {\n      if(!text || text.length == 0) {\n        return \"\";\n      }\n      return marked(text);\n    }\n\n    this.renderHtml = function(html_code) {\n      return $sce.trustAsHtml(html_code);\n    };\n\n\n  });\n;class ModelManager extends ItemManager {\n\n  set items(items) {\n    super.items = items;\n\n    this.notes = _.map(this.items.itemsForContentType(\"Note\"), function(json_obj) {\n      return new Note(json_obj);\n    })\n\n    this.groups = _.map(this.items.itemsForContentType(\"Group\"), function(json_obj) {\n      var group = Group(json_obj);\n      group.updateReferencesLocalMapping();\n      return group;\n    })\n  }\n\n  addDirtyItems(items) {\n    if(self.dirtyItems) {\n      self.dirtyItems = [];\n    }\n\n    self.dirtyItems.concat(items);\n  }\n\n  get dirtyItems() {\n    return self.dirtyItems || [];\n  }\n\n  get filteredNotes() {\n    return Note.filterDummyNotes(self.notes);\n  }\n\n  clearDirtyItems() {\n    self.dirtyItems = [];\n  }\n\n  addNote(note) {\n    if(!_.find(self.notes, {uuid: note.uuid})) {\n      self.notes.unshift(note);\n    }\n  }\n\n  addTag(tag) {\n    self.tags.unshift(tag);\n  }\n\n  addTagToNote(tag, note) {\n    var dirty = self.createReferencesBetweenItems(tag, note);\n    self.refreshRelationshipsForTag(tag);\n    self.refreshRelationshipsForNote(note);\n    self.addDirtyItems(dirty);\n  }\n\n  refreshRelationshipsForTag(tag) {\n    tag.notes = tag.referencesMatchingContentType(\"Note\");\n    tag.notes.sort(function(a,b){\n      return new Date(b.created_at) - new Date(a.created_at);\n    });\n  }\n\n  refreshRelationshipsForNote(note) {\n    note.groups = note.referencesMatchingContentType(\"Group\");\n  }\n\n  removeTagFromNote(tag, note) {\n    var dirty = self.removeReferencesBetweenItems(tag, note);\n    self.addDirtyItems(dirty);\n  }\n\n  deleteNote(note) {\n    var dirty = this.deleteItem(note);\n    self.addDirtyItems(dirty);\n  }\n\n  deleteTag(tag) {\n    var dirty = this.deleteItem(tag);\n    self.addDirtyItems(dirty);\n  }\n\n  filteredNotes() {\n    return Note.filterDummyNotes(this.notes);\n  }\n}\n\nexport { ModelManager }\n\nangular\n    .module('app.services', [])\n    .service('modelManager', ModelManager);\n;angular.module('app.services')\n  .service('serverSideValidation', function ($sce) {\n    // Show validation errors in form.\n    this.showErrors = function (formErrors, form) {\n      angular.forEach(formErrors, function (errors, key) {\n        if (typeof form[key] !== 'undefined') {\n          form[key].$setDirty();\n          form[key].$setValidity('server', false);\n          form[key].$error.server = $sce.trustAsHtml(errors.join(', '));\n        }\n      });\n    };\n\n    // Get validation errors from server response and show them in form.\n    this.parseErrors = function (response, form) {\n      if (response.status === 422) {\n        this.showErrors(response.data, form);\n      }\n    };\n});\n;angular\n  .module('app.services')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app.services')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      note: \"=\"\n    },\n    link: function(scope, element) {\n      // this gives us the native JS object\n      var el = element[0];\n\n      el.draggable = true;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('Note', JSON.stringify(scope.note));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          return false;\n        },\n        false\n      );\n    }\n  }\n});\n\nangular\n  .module('app.services')\n  .directive('droppable', function() {\n  return {\n    scope: {\n      drop: '&',\n      bin: '=',\n      group: \"=\"\n    },\n    link: function(scope, element) {\n      // again we need the native object\n      var el = element[0];\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          this.classList.add('over');\n          return false;\n        },\n        false\n      );\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          this.classList.add('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n          // Stops some browsers from redirecting.\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var binId = this.id;\n          var note = new Note(JSON.parse(e.dataTransfer.getData('Note')));\n          scope.$apply(function(scope) {\n            var fn = scope.drop();\n            if ('undefined' !== typeof fn) {\n              fn(e, scope.group, note);\n            }\n          });\n\n          return false;\n        },\n        false\n      );\n    }\n  }\n});\n;angular\n  .module('app.services')\n  .directive('fileChange', function() {\n    return {\n     restrict: 'A',\n     scope: {\n       handler: '&'\n     },\n     link: function (scope, element) {\n      element.on('change', function (event) {\n        scope.$apply(function(){\n          scope.handler({files: event.target.files});\n        });\n      });\n     }\n    };\n});\n;angular\n  .module('app.services')\n  .directive('lowercase', function() {\n    return {\n      require: 'ngModel',\n      link: function(scope, element, attrs, modelCtrl) {\n        var lowercase = function(inputValue) {\n          if (inputValue == undefined) inputValue = '';\n          var lowercased = inputValue.toLowerCase();\n          if (lowercased !== inputValue) {\n            modelCtrl.$setViewValue(lowercased);\n            modelCtrl.$render();\n          }\n          return lowercased;\n        }\n        modelCtrl.$parsers.push(lowercase);\n        lowercase(scope[attrs.ngModel]);\n      }\n    };\n  });\n;angular\n  .module('app.services')\n  .directive('selectOnClick', ['$window', function ($window) {\n    return {\n        restrict: 'A',\n        link: function (scope, element, attrs) {\n            element.on('focus', function () {\n                if (!$window.getSelection().toString()) {\n                    // Required for mobile Safari\n                    this.setSelectionRange(0, this.value.length)\n                }\n            });\n        }\n    };\n}]);\n;angular\n  .module('app.services')\n  .directive('note', function($timeout) {\n    return {\n      restrict: 'E',\n      controller: 'SingleNoteCtrl',\n      templateUrl: \"frontend/directives/note.html\",\n      scope: {\n        note: \"=\"\n      },\n    }\n  })\n  .controller('SingleNoteCtrl', function ($rootScope, $scope, $state, markdownRenderer) {\n    $scope.renderedContent = function() {\n      return markdownRenderer.renderHtml(markdownRenderer.renderedContentForText($scope.note.text));\n    }\n  });\n;/**\n * AngularJS directive that simulates the effect of typing on a text editor - with a blinking cursor.\n * This directive works as an attribute to any HTML element, and it changes the speed/delay of its animation.\n *\n * There's also a simple less file included for basic styling of the dialog, which can be overridden.\n * The config object also lets the user define custom CSS classes for the modal.\n *\n *  How to use:\n *\n *  Just add the desired text to the 'text' attribute of the element and the directive takes care of the rest.\n *  The 'text' attribute can be a single string or an array of string. In case an array is passed, the string\n *  on each index is erased so the next item can be printed. When the last index is reached, that string stays\n *  on the screen. (So if you want to erase the last string, just push an empty string to the end of the array)\n *\n * These are the optional preferences:\n *  - initial delay: set an 'initial-delay' attribute for the element\n *  - type delay: set a 'type-delay' attribute for the element\n *  - erase delay: set a 'erase-delay' attribute for the element\n *  - specify cursor : set a 'cursor' attribute for the element, specifying which cursor to use\n *  - turn off cursor blinking: set the 'blink-cursor' attribute  to \"false\"\n *  - cursor blinking speed: set a 'blink-delay' attribute for the element\n *  - scope callback: pass the desired scope callback as the 'callback-fn' attribute of the element\n *\n * Note:\n * Each time/delay value should be set either on seconds (1s) or milliseconds (1000)\n *\n * Dependencies:\n * The directive needs the css file provided in order to replicate the cursor blinking effect.\n */\n\n\nangular\n    .module('app.services').directive('typewrite', ['$timeout', function ($timeout) {\n        function linkFunction($scope, $element, $attrs) {\n            var timer = null,\n                initialDelay = $attrs.initialDelay ? getTypeDelay($attrs.initialDelay) : 200,\n                typeDelay = $attrs.typeDelay || 200,\n                eraseDelay = $attrs.eraseDelay || typeDelay / 2,\n                blinkDelay = $attrs.blinkDelay ? getAnimationDelay($attrs.blinkDelay) : false,\n                cursor = $attrs.cursor || '|',\n                blinkCursor = typeof $attrs.blinkCursor !== 'undefined' ? $attrs.blinkCursor === 'true' : true,\n                currentText,\n                textArray,\n                running,\n                auxStyle;\n\n\n\n            if ($scope.text) {\n                if ($scope.text instanceof Array) {\n                    textArray = $scope.text;\n                    currentText = textArray[0];\n                } else {\n                    currentText = $scope.text;\n                }\n            }\n            if (typeof $scope.start === 'undefined' || $scope.start) {\n                typewrite();\n            }\n\n            function typewrite() {\n                timer = $timeout(function () {\n                    updateIt($element, 0, 0, currentText);\n                }, initialDelay);\n            }\n\n            function updateIt(element, charIndex, arrIndex, text) {\n                if (charIndex <= text.length) {\n                    updateValue(element, text.substring(0, charIndex) + cursor);\n                    charIndex++;\n                    timer = $timeout(function () {\n                        updateIt(element, charIndex, arrIndex, text);\n                    }, typeDelay);\n                    return;\n                } else {\n                    charIndex--;\n\n                    if($scope.iterationCallback) {\n                      $scope.iterationCallback()(arrIndex);\n                    }\n\n                    // check if it's an array\n                    if (textArray && arrIndex < textArray.length - 1) {\n                        timer = $timeout(function () {\n                            cleanAndRestart(element, charIndex, arrIndex, textArray[arrIndex]);\n                        }, $scope.iterationDelay);\n                    } else {\n                        if ($scope.callbackFn) {\n                            $scope.callbackFn();\n                        }\n                        blinkIt(element, charIndex, currentText);\n                    }\n                }\n            }\n\n            function blinkIt(element, charIndex) {\n                var text = element.text().substring(0, element.text().length - 1);\n                if (blinkCursor) {\n                    if (blinkDelay) {\n                        auxStyle = '-webkit-animation:blink-it steps(1) ' + blinkDelay + ' infinite;-moz-animation:blink-it steps(1) ' + blinkDelay + ' infinite ' +\n                            '-ms-animation:blink-it steps(1) ' + blinkDelay + ' infinite;-o-animation:blink-it steps(1) ' + blinkDelay + ' infinite; ' +\n                            'animation:blink-it steps(1) ' + blinkDelay + ' infinite;';\n                        updateValue(element, text.substring(0, charIndex) + '<span class=\"blink\" style=\"' + auxStyle + '\">' + cursor + '</span>');\n                    } else {\n                        updateValue(element, text.substring(0, charIndex) + '<span class=\"blink\">' + cursor + '</span>');\n                    }\n                } else {\n                    updateValue(element, text.substring(0, charIndex));\n                }\n            }\n\n            function cleanAndRestart(element, charIndex, arrIndex, currentText) {\n              if(charIndex == 0) {\n                if($scope.prebeginFn) {\n                  $scope.prebeginFn()();\n                }\n              }\n                if (charIndex > 0) {\n                    currentText = currentText.slice(0, -1);\n                    // element.html(currentText.substring(0, currentText.length - 1) + cursor);\n                    updateValue(element, currentText + cursor);\n                    charIndex--;\n                    timer = $timeout(function () {\n                        cleanAndRestart(element, charIndex, arrIndex, currentText);\n                    }, eraseDelay);\n                    return;\n                } else {\n                    arrIndex++;\n                    currentText = textArray[arrIndex];\n                    timer = $timeout(function () {\n                        updateIt(element, 0, arrIndex, currentText);\n                    }, typeDelay);\n                }\n            }\n\n            function getTypeDelay(delay) {\n                if (typeof delay === 'string') {\n                    return delay.charAt(delay.length - 1) === 's' ? parseInt(delay.substring(0, delay.length - 1), 10) * 1000 : +delay;\n                } else {\n                    return false;\n                }\n            }\n\n            function getAnimationDelay(delay) {\n                if (typeof delay === 'string') {\n                    return delay.charAt(delay.length - 1) === 's' ? delay : parseInt(delay.substring(0, delay.length - 1), 10) / 1000;\n                }\n            }\n\n            function updateValue(element, value) {\n                if (element.prop('nodeName').toUpperCase() === 'INPUT') {\n                    return element.val(value);\n                }\n                return element.html(value);\n            }\n\n            $scope.$on('$destroy', function () {\n                if (timer) {\n                    $timeout.cancel(timer);\n                }\n            });\n\n            $scope.$watch('start', function (newVal) {\n                if (!running && newVal) {\n                    running = !running;\n                    typewrite();\n                }\n            });\n\n            $scope.$watch('text', function (newVal, oldVal) {\n              if(!(newVal instanceof Array)) {\n                currentText = newVal;\n                typewrite();\n              }\n            });\n        }\n\n        return {\n            restrict: 'A',\n            link: linkFunction,\n            replace: true,\n            scope: {\n                text: '=',\n                callbackFn: '&',\n                iterationCallback: '&',\n                iterationDelay: '=',\n                prebeginFn: '&',\n                start: '='\n            }\n        };\n\n    }]);\n;var Neeto = Neeto || {};\n\nNeeto.crypto = {\n\n   generateRandomKey: function() {\n     return CryptoJS.lib.WordArray.random(256/8).toString();\n   },\n\n   decryptText: function(encrypted_content, key) {\n     return CryptoJS.AES.decrypt(encrypted_content, key).toString(CryptoJS.enc.Utf8);\n   },\n\n   encryptText: function(text, key) {\n     return CryptoJS.AES.encrypt(text, key).toString();\n   },\n\n   generateRandomEncryptionKey: function() {\n     var salt = Neeto.crypto.generateRandomKey();\n     var passphrase = Neeto.crypto.generateRandomKey();\n     return CryptoJS.PBKDF2(passphrase, salt, { keySize: 256/32 }).toString();\n   },\n\n   sha256: function(text) {\n     return CryptoJS.SHA256(text).toString();\n   },\n\n   /** Generates two deterministic 256 bit keys based on one input */\n   generateAsymmetricKeyPair: function(input, salt) {\n     var output = CryptoJS.PBKDF2(input, salt, { keySize: 512/32, hasher: CryptoJS.algo.SHA512, iterations: 3000 });\n     var firstHalf = _.clone(output);\n     var secondHalf = _.clone(output);\n     var sigBytes = output.sigBytes/2;\n     var outputLength = output.words.length;\n     firstHalf.words = output.words.slice(0, outputLength/2);\n     secondHalf.words = output.words.slice(outputLength/2, outputLength);\n     firstHalf.sigBytes = sigBytes;\n     secondHalf.sigBytes = sigBytes;\n     return [firstHalf.toString(), secondHalf.toString()];\n   },\n\n   generateEncryptionKeysForUser: function(password, email) {\n     var keys = Neeto.crypto.generateAsymmetricKeyPair(password, email);\n     var pw = keys[0];\n     var gk = keys[1];\n\n     return {pw: pw, gk: gk};\n   }\n };\n"]}