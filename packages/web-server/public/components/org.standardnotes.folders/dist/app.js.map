{"version":3,"sources":["app.js"],"names":["Object","defineProperty","exports","value","SNTheme","SNSmartTag","SNServerExtension","SNMfa","SNEncryptedStorage","SNTag","SNNote","SNExtension","Action","SNEditor","SNComponent","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","getter","call","_standardFileJs","require","_classCallCheck","instance","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","constructor","setPrototypeOf","__proto__","_SFItem","json_obj","window","_this","componentData","disassociatedItemIds","associatedItemIds","mapContentToLocalProperties","content","hosted_url","legacy_url","url","local_url","offlineOnly","valid_until","Date","name","autoupdateDisabled","package_info","area","permissions","active","handleDeletedContent","structureParams","params","superParams","assign","isEditor","isTheme","content_type","isDefaultEditor","getAppDataItem","setLastSize","size","setAppDataItem","getLastSize","acceptsThemes","getClientDataKey","uuid","hasValidHostedUrl","keysToIgnoreWhenCheckingContentEquality","concat","isAssociative","Component","associativeAreas","includes","associateWithItem","item","push","isExplicitlyEnabledForItem","indexOf","isExplicitlyDisabledForItem","SFItem","_SFItem2","_this2","notes","data","default","systemEditor","referenceParams","references","_","map","note","addItemAsRelationship","find","removeItemAsRelationship","pull","removeAndDirtyAllRelationships","removeReferencesNotPresentIn","uuids","ref","forEach","remove","bind","potentialItemOfInterestHasChangedItsUUID","newItem","oldUUID","newUUID","setData","dataHasChanged","JSON","stringify","dataForKey","json","merge","running","error","lastExecuted","_SFItem3","_this3","actions","action","actionsWithContextForItem","filter","context","description","supported_types","a","omit","_SFItem4","_this4","text","tags","title","setIsBeingReferencedBy","clearSavedTagsString","setIsNoLongerBeingReferencedBy","isBeingRemovedLocally","tag","informReferencesOfUUIDChange","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","Symbol","iterator","_step","next","done","err","return","tagDidFinishSyncing","safeText","safeTitle","savedTagsString","tagsString","arrayToDisplayString","filterDummyNotes","filtered","dummy","_SFItem5","_this5","updateLocalRelationships","slice","_this6","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","didFinishSyncing","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","isSmartTag","sort","b","join","_SFItem6","apply","arguments","storage","_SFItem7","doNotEncrypt","_SFItem8","_SNTag","json_ob","_this10","systemSmartTags","SystemSmartTagIdAllNotes","isSystemTag","isAllTag","predicate","SFPredicate","fromArray","SystemSmartTagIdArchivedNotes","isArchiveTag","SystemSmartTagIdTrashedNotes","isTrashTag","_SNComponent","_this11","isLayerable","layerable","setMobileRules","rules","getMobileRules","constants","hasMobileRules","setNotAvailOnMobile","na","getNotAvailOnMobile","setMobileActive","isMobileActive","e","console","log","angular","module","HomeCtrl","$rootScope","$scope","$timeout","smartTagContentType","componentRelay","ComponentRelay","targetWindow","onReady","platform","delimiter","resolveRawTags","masterTag","sortTags","aTitle","toLowerCase","bTitle","resolved","rawTags","findResolvedTag","pendingDummy","children","c","unshift","comps","split","displayTitle","getParent","depth","parentTitle","tagTitle","index","splice","selectedTag","setSelectedForTag","changeParent","sourceId","targetId","source","needsSave","adjustChildren","child","newTitle","master","saveItems","createTag","startsWith","components","parse","substring","alert","smartTag","keypath","operator","createItem","createdTag","selectOnLoad","selectTag","multiSelect","clearMultipleTagsSelection","multipleTags","smartMaster","clearSelection","createEphemeralSmartTagForMultiTags","selectItem","editing","Math","random","tagNames","toggleCollapse","clientData","collapsed","saveItem","saveTags","selected","streamItems","newTags","allTags","smartTags","smartMasterTag","arrayToUse","existing","tagCandidate","deleted","deleteTag","deleteChain","addChildren","deleteItems","$$ngIsClass","controller","directive","restrict","scope","shouldFocus","link","$element","focus","tagId","drop","isDraggable","isDroppable","element","attrs","el","draggable","counter","addEventListener","dataTransfer","effectAllowed","classList","add","dropEffect","preventDefault","stopPropagation","getData","$apply","TagTree","templateUrl","onSelect","onToggleCollapse","onDrop","onDragOver","event","onDragStart","ctrlKey","metaKey","addChild","$event","addingTag","saveNewTag","removeTag","innerCollapse","saveTagRename","renameChildren","generationForTag","generation","circleClassForTag","gen","circleClass"],"mappings":"AAAA;;;;;;;;AAEAA,OAAOC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,SAAO;AADoC,CAA7C;AAGAD,QAAQE,OAAR,GAAkBF,QAAQG,UAAR,GAAqBH,QAAQI,iBAAR,GAA4BJ,QAAQK,KAAR,GAAgBL,QAAQM,kBAAR,GAA6BN,QAAQO,KAAR,GAAgBP,QAAQQ,MAAR,GAAiBR,QAAQS,WAAR,GAAsBT,QAAQU,MAAR,GAAiBV,QAAQW,QAAR,GAAmBX,QAAQY,WAAR,GAAsBC,SAAjO;;AAEA,IAAIC,eAAe,YAAY;AAAE,WAASC,gBAAT,CAA0BC,MAA1B,EAAkCC,KAAlC,EAAyC;AAAE,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAID,MAAME,MAA1B,EAAkCD,GAAlC,EAAuC;AAAE,UAAIE,aAAaH,MAAMC,CAAN,CAAjB,CAA2BE,WAAWC,UAAX,GAAwBD,WAAWC,UAAX,IAAyB,KAAjD,CAAwDD,WAAWE,YAAX,GAA0B,IAA1B,CAAgC,IAAI,WAAWF,UAAf,EAA2BA,WAAWG,QAAX,GAAsB,IAAtB,CAA4BzB,OAAOC,cAAP,CAAsBiB,MAAtB,EAA8BI,WAAWI,GAAzC,EAA8CJ,UAA9C;AAA4D;AAAE,GAAC,OAAO,UAAUK,WAAV,EAAuBC,UAAvB,EAAmCC,WAAnC,EAAgD;AAAE,QAAID,UAAJ,EAAgBX,iBAAiBU,YAAYG,SAA7B,EAAwCF,UAAxC,EAAqD,IAAIC,WAAJ,EAAiBZ,iBAAiBU,WAAjB,EAA8BE,WAA9B,EAA4C,OAAOF,WAAP;AAAqB,GAAhN;AAAmN,CAA9hB,EAAnB;;AAEA,IAAII,OAAO,SAASC,GAAT,CAAaC,MAAb,EAAqBC,QAArB,EAA+BC,QAA/B,EAAyC;AAAE,MAAIF,WAAW,IAAf,EAAqBA,SAASG,SAASN,SAAlB,CAA6B,IAAIO,OAAOrC,OAAOsC,wBAAP,CAAgCL,MAAhC,EAAwCC,QAAxC,CAAX,CAA8D,IAAIG,SAAStB,SAAb,EAAwB;AAAE,QAAIwB,SAASvC,OAAOwC,cAAP,CAAsBP,MAAtB,CAAb,CAA4C,IAAIM,WAAW,IAAf,EAAqB;AAAE,aAAOxB,SAAP;AAAmB,KAA1C,MAAgD;AAAE,aAAOiB,IAAIO,MAAJ,EAAYL,QAAZ,EAAsBC,QAAtB,CAAP;AAAyC;AAAE,GAAnK,MAAyK,IAAI,WAAWE,IAAf,EAAqB;AAAE,WAAOA,KAAKlC,KAAZ;AAAoB,GAA3C,MAAiD;AAAE,QAAIsC,SAASJ,KAAKL,GAAlB,CAAuB,IAAIS,WAAW1B,SAAf,EAA0B;AAAE,aAAOA,SAAP;AAAmB,KAAC,OAAO0B,OAAOC,IAAP,CAAYP,QAAZ,CAAP;AAA+B;AAAE,CAA1e;;AAEA,IAAIQ,kBAAkBC,QAAQ,kBAAR,CAAtB;;AAEA,SAASC,eAAT,CAAyBC,QAAzB,EAAmCnB,WAAnC,EAAgD;AAAE,MAAI,EAAEmB,oBAAoBnB,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAIoB,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASC,0BAAT,CAAoCC,IAApC,EAA0CP,IAA1C,EAAgD;AAAE,MAAI,CAACO,IAAL,EAAW;AAAE,UAAM,IAAIC,cAAJ,CAAmB,2DAAnB,CAAN;AAAwF,GAAC,OAAOR,SAAS,QAAOA,IAAP,yCAAOA,IAAP,OAAgB,QAAhB,IAA4B,OAAOA,IAAP,KAAgB,UAArD,IAAmEA,IAAnE,GAA0EO,IAAjF;AAAwF;;AAEhP,SAASE,SAAT,CAAmBC,QAAnB,EAA6BC,UAA7B,EAAyC;AAAE,MAAI,OAAOA,UAAP,KAAsB,UAAtB,IAAoCA,eAAe,IAAvD,EAA6D;AAAE,UAAM,IAAIN,SAAJ,CAAc,qEAAoEM,UAApE,yCAAoEA,UAApE,EAAd,CAAN;AAAsG,GAACD,SAAStB,SAAT,GAAqB9B,OAAOsD,MAAP,CAAcD,cAAcA,WAAWvB,SAAvC,EAAkD,EAAEyB,aAAa,EAAEpD,OAAOiD,QAAT,EAAmB7B,YAAY,KAA/B,EAAsCE,UAAU,IAAhD,EAAsDD,cAAc,IAApE,EAAf,EAAlD,CAArB,CAAqK,IAAI6B,UAAJ,EAAgBrD,OAAOwD,cAAP,GAAwBxD,OAAOwD,cAAP,CAAsBJ,QAAtB,EAAgCC,UAAhC,CAAxB,GAAsED,SAASK,SAAT,GAAqBJ,UAA3F;AAAwG;;AAE9e,IAAIvC,cAAcZ,QAAQY,WAAR,GAAsB,UAAU4C,OAAV,EAAmB;AACzDP,YAAUrC,WAAV,EAAuB4C,OAAvB;;AAEA,WAAS5C,WAAT,CAAqB6C,QAArB,EAA+B;AAC7Bd,oBAAgB,IAAhB,EAAsB/B,WAAtB;;AAEA;AACA;AACA6C,aAASC,MAAT,GAAkB,IAAlB;;AAEA,QAAIC,QAAQb,2BAA2B,IAA3B,EAAiC,CAAClC,YAAY2C,SAAZ,IAAyBzD,OAAOwC,cAAP,CAAsB1B,WAAtB,CAA1B,EAA8D4B,IAA9D,CAAmE,IAAnE,EAAyEiB,QAAzE,CAAjC,CAAZ;;AAEA,QAAI,CAACE,MAAMC,aAAX,EAA0B;AACxBD,YAAMC,aAAN,GAAsB,EAAtB;AACD;;AAED,QAAI,CAACD,MAAME,oBAAX,EAAiC;AAC/BF,YAAME,oBAAN,GAA6B,EAA7B;AACD;;AAED,QAAI,CAACF,MAAMG,iBAAX,EAA8B;AAC5BH,YAAMG,iBAAN,GAA0B,EAA1B;AACD;AACD,WAAOH,KAAP;AACD;;AAED7C,eAAaF,WAAb,EAA0B,CAAC;AACzBY,SAAK,6BADoB;AAEzBvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKjB,YAAYgB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB1B,YAAYgB,SAAlC,CAAxC,EAAsF,6BAAtF,EAAqH,IAArH,EAA2HY,IAA3H,CAAgI,IAAhI,EAAsIwB,OAAtI;AACA;AACA;AACA;AACA;AACA,UAAI,CAACA,QAAQC,UAAb,EAAyB;AACvB,aAAKC,UAAL,GAAkBF,QAAQG,GAA1B;AACD;;AAED;AACA,WAAKC,SAAL,GAAiBJ,QAAQI,SAAzB;AACA,WAAKH,UAAL,GAAkBD,QAAQC,UAAR,IAAsBD,QAAQG,GAAhD;AACA,WAAKE,WAAL,GAAmBL,QAAQK,WAA3B;;AAEA,UAAIL,QAAQM,WAAZ,EAAyB;AACvB,aAAKA,WAAL,GAAmB,IAAIC,IAAJ,CAASP,QAAQM,WAAjB,CAAnB;AACD;;AAED,WAAKE,IAAL,GAAYR,QAAQQ,IAApB;AACA,WAAKC,kBAAL,GAA0BT,QAAQS,kBAAlC;;AAEA,WAAKC,YAAL,GAAoBV,QAAQU,YAA5B;;AAEA;AACA,WAAKC,IAAL,GAAYX,QAAQW,IAApB;;AAEA,WAAKC,WAAL,GAAmBZ,QAAQY,WAA3B;AACA,UAAI,CAAC,KAAKA,WAAV,EAAuB;AACrB,aAAKA,WAAL,GAAmB,EAAnB;AACD;;AAED,WAAKC,MAAL,GAAcb,QAAQa,MAAtB;;AAEA;AACA,WAAKjB,aAAL,GAAqBI,QAAQJ,aAAR,IAAyB,EAA9C;;AAEA;AACA,WAAKC,oBAAL,GAA4BG,QAAQH,oBAAR,IAAgC,EAA5D;;AAEA;AACA,WAAKC,iBAAL,GAAyBE,QAAQF,iBAAR,IAA6B,EAAtD;AACD;AA5CwB,GAAD,EA6CvB;AACDtC,SAAK,sBADJ;AAEDvB,WAAO,SAAS6E,oBAAT,GAAgC;AACrCjD,WAAKjB,YAAYgB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB1B,YAAYgB,SAAlC,CAAxC,EAAsF,sBAAtF,EAA8G,IAA9G,EAAoHY,IAApH,CAAyH,IAAzH;;AAEA,WAAKqC,MAAL,GAAc,KAAd;AACD;AANA,GA7CuB,EAoDvB;AACDrD,SAAK,iBADJ;AAEDvB,WAAO,SAAS8E,eAAT,GAA2B;AAChC,UAAIC,SAAS;AACXd,oBAAY,KAAKA,UADN;AAEXD,oBAAY,KAAKA,UAFN;AAGXG,mBAAW,KAAKA,SAHL;AAIXE,qBAAa,KAAKA,WAJP;AAKXD,qBAAa,KAAKA,WALP;AAMXG,cAAM,KAAKA,IANA;AAOXG,cAAM,KAAKA,IAPA;AAQXD,sBAAc,KAAKA,YARR;AASXE,qBAAa,KAAKA,WATP;AAUXC,gBAAQ,KAAKA,MAVF;AAWXJ,4BAAoB,KAAKA,kBAXd;AAYXb,uBAAe,KAAKA,aAZT;AAaXC,8BAAsB,KAAKA,oBAbhB;AAcXC,2BAAmB,KAAKA;AAdb,OAAb;;AAiBA,UAAImB,cAAcpD,KAAKjB,YAAYgB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB1B,YAAYgB,SAAlC,CAAxC,EAAsF,iBAAtF,EAAyG,IAAzG,EAA+GY,IAA/G,CAAoH,IAApH,CAAlB;AACA1C,aAAOoF,MAAP,CAAcD,WAAd,EAA2BD,MAA3B;AACA,aAAOC,WAAP;AACD;AAvBA,GApDuB,EA4EvB;AACDzD,SAAK,UADJ;AAEDvB,WAAO,SAASkF,QAAT,GAAoB;AACzB,aAAO,KAAKR,IAAL,IAAa,eAApB;AACD;AAJA,GA5EuB,EAiFvB;AACDnD,SAAK,SADJ;AAEDvB,WAAO,SAASmF,OAAT,GAAmB;AACxB,aAAO,KAAKC,YAAL,IAAqB,UAArB,IAAmC,KAAKV,IAAL,IAAa,QAAvD;AACD;AAJA,GAjFuB,EAsFvB;AACDnD,SAAK,iBADJ;AAEDvB,WAAO,SAASqF,eAAT,GAA2B;AAChC,aAAO,KAAKC,cAAL,CAAoB,eAApB,KAAwC,IAA/C;AACD;AAJA,GAtFuB,EA2FvB;AACD/D,SAAK,aADJ;AAEDvB,WAAO,SAASuF,WAAT,CAAqBC,IAArB,EAA2B;AAChC,WAAKC,cAAL,CAAoB,UAApB,EAAgCD,IAAhC;AACD;AAJA,GA3FuB,EAgGvB;AACDjE,SAAK,aADJ;AAEDvB,WAAO,SAAS0F,WAAT,GAAuB;AAC5B,aAAO,KAAKJ,cAAL,CAAoB,UAApB,CAAP;AACD;AAJA,GAhGuB,EAqGvB;AACD/D,SAAK,eADJ;AAEDvB,WAAO,SAAS2F,aAAT,GAAyB;AAC9B,UAAI,KAAK5B,OAAL,CAAaU,YAAb,IAA6B,mBAAmB,KAAKV,OAAL,CAAaU,YAAjE,EAA+E;AAC7E,eAAO,KAAKV,OAAL,CAAaU,YAAb,CAA0BkB,aAAjC;AACD;AACD,aAAO,IAAP;AACD;;AAED;;;;;AATC,GArGuB,EAmHvB;AACDpE,SAAK,kBADJ;AAEDvB,WAAO,SAAS4F,gBAAT,GAA4B;AACjC,UAAI,KAAK3B,UAAT,EAAqB;AACnB,eAAO,KAAKA,UAAZ;AACD,OAFD,MAEO;AACL,eAAO,KAAK4B,IAAZ;AACD;AACF;AARA,GAnHuB,EA4HvB;AACDtE,SAAK,mBADJ;AAEDvB,WAAO,SAAS8F,iBAAT,GAA6B;AAClC,aAAO,KAAK9B,UAAL,IAAmB,KAAKC,UAA/B;AACD;AAJA,GA5HuB,EAiIvB;AACD1C,SAAK,yCADJ;AAEDvB,WAAO,SAAS+F,uCAAT,GAAmD;AACxD,aAAO,CAAC,QAAD,EAAW,sBAAX,EAAmC,mBAAnC,EAAwDC,MAAxD,CAA+DpE,KAAKjB,YAAYgB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB1B,YAAYgB,SAAlC,CAAxC,EAAsF,yCAAtF,EAAiI,IAAjI,EAAuIY,IAAvI,CAA4I,IAA5I,CAA/D,CAAP;AACD;;AAED;;;;;AANC,GAjIuB,EA4IvB;AACDhB,SAAK,eADJ;AAEDvB,WAAO,SAASiG,aAAT,GAAyB;AAC9B,aAAOC,UAAUC,gBAAV,GAA6BC,QAA7B,CAAsC,KAAK1B,IAA3C,CAAP;AACD;AAJA,GA5IuB,EAiJvB;AACDnD,SAAK,mBADJ;AAEDvB,WAAO,SAASqG,iBAAT,CAA2BC,IAA3B,EAAiC;AACtC,WAAKzC,iBAAL,CAAuB0C,IAAvB,CAA4BD,KAAKT,IAAjC;AACD;AAJA,GAjJuB,EAsJvB;AACDtE,SAAK,4BADJ;AAEDvB,WAAO,SAASwG,0BAAT,CAAoCF,IAApC,EAA0C;AAC/C,aAAO,KAAKzC,iBAAL,CAAuB4C,OAAvB,CAA+BH,KAAKT,IAApC,MAA8C,CAAC,CAAtD;AACD;AAJA,GAtJuB,EA2JvB;AACDtE,SAAK,6BADJ;AAEDvB,WAAO,SAAS0G,2BAAT,CAAqCJ,IAArC,EAA2C;AAChD,aAAO,KAAK1C,oBAAL,CAA0B6C,OAA1B,CAAkCH,KAAKT,IAAvC,MAAiD,CAAC,CAAzD;AACD;AAJA,GA3JuB,EAgKvB;AACDtE,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,cAAP;AACD;AAJA,GAhKuB,CAA1B,EAqKI,CAAC;AACHN,SAAK,kBADF;AAEHvB,WAAO,SAASmG,gBAAT,GAA4B;AACjC,aAAO,CAAC,eAAD,CAAP;AACD;AAJE,GAAD,CArKJ;;AA4KA,SAAOxF,WAAP;AACD,CAvMuC,CAuMtC6B,gBAAgBmE,MAvMsB,CAAxC;;AAyMA;AACA,IAAIjG,WAAWX,QAAQW,QAAR,GAAmB,UAAUkG,QAAV,EAAoB;AACpD5D,YAAUtC,QAAV,EAAoBkG,QAApB;;AAEA,WAASlG,QAAT,CAAkB8C,QAAlB,EAA4B;AAC1Bd,oBAAgB,IAAhB,EAAsBhC,QAAtB;;AAEA,QAAImG,SAAShE,2BAA2B,IAA3B,EAAiC,CAACnC,SAAS4C,SAAT,IAAsBzD,OAAOwC,cAAP,CAAsB3B,QAAtB,CAAvB,EAAwD6B,IAAxD,CAA6D,IAA7D,EAAmEiB,QAAnE,CAAjC,CAAb;;AAEA,QAAI,CAACqD,OAAOC,KAAZ,EAAmB;AACjBD,aAAOC,KAAP,GAAe,EAAf;AACD;AACD,QAAI,CAACD,OAAOE,IAAZ,EAAkB;AAChBF,aAAOE,IAAP,GAAc,EAAd;AACD;AACD,WAAOF,MAAP;AACD;;AAEDhG,eAAaH,QAAb,EAAuB,CAAC;AACtBa,SAAK,6BADiB;AAEtBvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,6BAAhF,EAA+G,IAA/G,EAAqHY,IAArH,CAA0H,IAA1H,EAAgIwB,OAAhI;AACA,WAAKG,GAAL,GAAWH,QAAQG,GAAnB;AACA,WAAKK,IAAL,GAAYR,QAAQQ,IAApB;AACA,WAAKwC,IAAL,GAAYhD,QAAQgD,IAAR,IAAgB,EAA5B;AACA,WAAKC,OAAL,GAAejD,QAAQiD,OAAvB;AACA,WAAKC,YAAL,GAAoBlD,QAAQkD,YAA5B;AACD;AATqB,GAAD,EAUpB;AACD1F,SAAK,iBADJ;AAEDvB,WAAO,SAAS8E,eAAT,GAA2B;AAChC,UAAIC,SAAS;AACXb,aAAK,KAAKA,GADC;AAEXK,cAAM,KAAKA,IAFA;AAGXwC,cAAM,KAAKA,IAHA;AAIXC,iBAAS,KAAKA,OAJH;AAKXC,sBAAc,KAAKA;AALR,OAAb;;AAQA,UAAIjC,cAAcpD,KAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,iBAAhF,EAAmG,IAAnG,EAAyGY,IAAzG,CAA8G,IAA9G,CAAlB;AACA1C,aAAOoF,MAAP,CAAcD,WAAd,EAA2BD,MAA3B;AACA,aAAOC,WAAP;AACD;AAdA,GAVoB,EAyBpB;AACDzD,SAAK,iBADJ;AAEDvB,WAAO,SAASkH,eAAT,GAA2B;AAChC,UAAIC,aAAaC,EAAEC,GAAF,CAAM,KAAKP,KAAX,EAAkB,UAAUQ,IAAV,EAAgB;AACjD,eAAO,EAAEzB,MAAMyB,KAAKzB,IAAb,EAAmBT,cAAckC,KAAKlC,YAAtC,EAAP;AACD,OAFgB,CAAjB;;AAIA,aAAO+B,UAAP;AACD;AARA,GAzBoB,EAkCpB;AACD5F,SAAK,uBADJ;AAEDvB,WAAO,SAASuH,qBAAT,CAA+BjB,IAA/B,EAAqC;AAC1C,UAAIA,KAAKlB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B,YAAI,CAACgC,EAAEI,IAAF,CAAO,KAAKV,KAAZ,EAAmBR,IAAnB,CAAL,EAA+B;AAC7B,eAAKQ,KAAL,CAAWP,IAAX,CAAgBD,IAAhB;AACD;AACF;AACD1E,WAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,uBAAhF,EAAyG,IAAzG,EAA+GY,IAA/G,CAAoH,IAApH,EAA0H+D,IAA1H;AACD;AATA,GAlCoB,EA4CpB;AACD/E,SAAK,0BADJ;AAEDvB,WAAO,SAASyH,wBAAT,CAAkCnB,IAAlC,EAAwC;AAC7C,UAAIA,KAAKlB,YAAL,IAAqB,MAAzB,EAAiC;AAC/BgC,UAAEM,IAAF,CAAO,KAAKZ,KAAZ,EAAmBR,IAAnB;AACD;AACD1E,WAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,0BAAhF,EAA4G,IAA5G,EAAkHY,IAAlH,CAAuH,IAAvH,EAA6H+D,IAA7H;AACD;AAPA,GA5CoB,EAoDpB;AACD/E,SAAK,gCADJ;AAEDvB,WAAO,SAAS2H,8BAAT,GAA0C;AAC/C/F,WAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,gCAAhF,EAAkH,IAAlH,EAAwHY,IAAxH,CAA6H,IAA7H;AACA,WAAKuE,KAAL,GAAa,EAAb;AACD;AALA,GApDoB,EA0DpB;AACDvF,SAAK,8BADJ;AAEDvB,WAAO,SAAS4H,4BAAT,CAAsCT,UAAtC,EAAkD;AACvDvF,WAAKlB,SAASiB,SAAT,CAAmB2B,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsB3B,SAASiB,SAA/B,CAArC,EAAgF,8BAAhF,EAAgH,IAAhH,EAAsHY,IAAtH,CAA2H,IAA3H,EAAiI4E,UAAjI;;AAEA,UAAIU,QAAQV,WAAWE,GAAX,CAAe,UAAUS,GAAV,EAAe;AACxC,eAAOA,IAAIjC,IAAX;AACD,OAFW,CAAZ;AAGA,WAAKiB,KAAL,CAAWiB,OAAX,CAAmB,UAAUT,IAAV,EAAgB;AACjC,YAAI,CAACO,MAAMzB,QAAN,CAAekB,KAAKzB,IAApB,CAAL,EAAgC;AAC9BuB,YAAEY,MAAF,CAAS,KAAKlB,KAAd,EAAqB,EAAEjB,MAAMyB,KAAKzB,IAAb,EAArB;AACD;AACF,OAJkB,CAIjBoC,IAJiB,CAIZ,IAJY,CAAnB;AAKD;AAbA,GA1DoB,EAwEpB;AACD1G,SAAK,0CADJ;AAEDvB,WAAO,SAASkI,wCAAT,CAAkDC,OAAlD,EAA2DC,OAA3D,EAAoEC,OAApE,EAA6E;AAClF,UAAIF,QAAQ/C,YAAR,KAAyB,MAAzB,IAAmCgC,EAAEI,IAAF,CAAO,KAAKV,KAAZ,EAAmB,EAAEjB,MAAMuC,OAAR,EAAnB,CAAvC,EAA8E;AAC5EhB,UAAEY,MAAF,CAAS,KAAKlB,KAAd,EAAqB,EAAEjB,MAAMuC,OAAR,EAArB;AACA,aAAKtB,KAAL,CAAWP,IAAX,CAAgB4B,OAAhB;AACD;AACF;AAPA,GAxEoB,EAgFpB;AACD5G,SAAK,SADJ;AAEDvB,WAAO,SAASsI,OAAT,CAAiB/G,GAAjB,EAAsBvB,KAAtB,EAA6B;AAClC,UAAIuI,iBAAiBC,KAAKC,SAAL,CAAe,KAAK1B,IAAL,CAAUxF,GAAV,CAAf,MAAmCiH,KAAKC,SAAL,CAAezI,KAAf,CAAxD;AACA,UAAIuI,cAAJ,EAAoB;AAClB,aAAKxB,IAAL,CAAUxF,GAAV,IAAiBvB,KAAjB;AACA,eAAO,IAAP;AACD;AACD,aAAO,KAAP;AACD;AATA,GAhFoB,EA0FpB;AACDuB,SAAK,YADJ;AAEDvB,WAAO,SAAS0I,UAAT,CAAoBnH,GAApB,EAAyB;AAC9B,aAAO,KAAKwF,IAAL,CAAUxF,GAAV,KAAkB,EAAzB;AACD;AAJA,GA1FoB,EA+FpB;AACDA,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,WAAP;AACD;AAJA,GA/FoB,CAAvB;;AAsGA,SAAOnB,QAAP;AACD,CAxHiC,CAwHhC8B,gBAAgBmE,MAxHgB,CAAlC;;AA0HA;AACA,IAAIlG,SAASV,QAAQU,MAAR,GAAiB,SAASA,MAAT,CAAgBkI,IAAhB,EAAsB;AAClDjG,kBAAgB,IAAhB,EAAsBjC,MAAtB;;AAEA2G,IAAEwB,KAAF,CAAQ,IAAR,EAAcD,IAAd;AACA,OAAKE,OAAL,GAAe,KAAf,CAJkD,CAI5B;AACtB,OAAKC,KAAL,GAAa,KAAb;AACA,MAAI,KAAKC,YAAT,EAAuB;AACrB;AACA,SAAKA,YAAL,GAAoB,IAAIzE,IAAJ,CAAS,KAAKyE,YAAd,CAApB;AACD;AACF,CAVD;;AAYA,IAAIvI,cAAcT,QAAQS,WAAR,GAAsB,UAAUwI,QAAV,EAAoB;AAC1DhG,YAAUxC,WAAV,EAAuBwI,QAAvB;;AAEA,WAASxI,WAAT,CAAqBmI,IAArB,EAA2B;AACzBjG,oBAAgB,IAAhB,EAAsBlC,WAAtB;;AAEA,QAAIyI,SAASpG,2BAA2B,IAA3B,EAAiC,CAACrC,YAAY8C,SAAZ,IAAyBzD,OAAOwC,cAAP,CAAsB7B,WAAtB,CAA1B,EAA8D+B,IAA9D,CAAmE,IAAnE,EAAyEoG,IAAzE,CAAjC,CAAb;;AAEA,QAAIA,KAAKO,OAAT,EAAkB;AAChBD,aAAOC,OAAP,GAAiBP,KAAKO,OAAL,CAAa7B,GAAb,CAAiB,UAAU8B,MAAV,EAAkB;AAClD,eAAO,IAAI1I,MAAJ,CAAW0I,MAAX,CAAP;AACD,OAFgB,CAAjB;AAGD;;AAED,QAAI,CAACF,OAAOC,OAAZ,EAAqB;AACnBD,aAAOC,OAAP,GAAiB,EAAjB;AACD;AACD,WAAOD,MAAP;AACD;;AAEDpI,eAAaL,WAAb,EAA0B,CAAC;AACzBe,SAAK,2BADoB;AAEzBvB,WAAO,SAASoJ,yBAAT,CAAmC9C,IAAnC,EAAyC;AAC9C,aAAO,KAAK4C,OAAL,CAAaG,MAAb,CAAoB,UAAUF,MAAV,EAAkB;AAC3C,eAAOA,OAAOG,OAAP,IAAkBhD,KAAKlB,YAAvB,IAAuC+D,OAAOG,OAAP,IAAkB,MAAhE;AACD,OAFM,CAAP;AAGD;AANwB,GAAD,EAOvB;AACD/H,SAAK,6BADJ;AAEDvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKpB,YAAYmB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB7B,YAAYmB,SAAlC,CAAxC,EAAsF,6BAAtF,EAAqH,IAArH,EAA2HY,IAA3H,CAAgI,IAAhI,EAAsIwB,OAAtI;AACA,WAAKwF,WAAL,GAAmBxF,QAAQwF,WAA3B;AACA,WAAKrF,GAAL,GAAWH,QAAQG,GAAnB;AACA,WAAKK,IAAL,GAAYR,QAAQQ,IAApB;AACA,WAAKE,YAAL,GAAoBV,QAAQU,YAA5B;AACA,WAAK+E,eAAL,GAAuBzF,QAAQyF,eAA/B;AACA,UAAIzF,QAAQmF,OAAZ,EAAqB;AACnB,aAAKA,OAAL,GAAenF,QAAQmF,OAAR,CAAgB7B,GAAhB,CAAoB,UAAU8B,MAAV,EAAkB;AACnD,iBAAO,IAAI1I,MAAJ,CAAW0I,MAAX,CAAP;AACD,SAFc,CAAf;AAGD;AACF;AAdA,GAPuB,EAsBvB;AACD5H,SAAK,iBADJ;AAEDvB,WAAO,SAAS8E,eAAT,GAA2B;AAChC,UAAIC,SAAS;AACXR,cAAM,KAAKA,IADA;AAEXL,aAAK,KAAKA,GAFC;AAGXO,sBAAc,KAAKA,YAHR;AAIX8E,qBAAa,KAAKA,WAJP;AAKXL,iBAAS,KAAKA,OAAL,CAAa7B,GAAb,CAAiB,UAAUoC,CAAV,EAAa;AACrC,iBAAOrC,EAAEsC,IAAF,CAAOD,CAAP,EAAU,CAAC,SAAD,EAAY,YAAZ,CAAV,CAAP;AACD,SAFQ,CALE;AAQXD,yBAAiB,KAAKA;AARX,OAAb;;AAWA,UAAIxE,cAAcpD,KAAKpB,YAAYmB,SAAZ,CAAsB2B,SAAtB,IAAmCzD,OAAOwC,cAAP,CAAsB7B,YAAYmB,SAAlC,CAAxC,EAAsF,iBAAtF,EAAyG,IAAzG,EAA+GY,IAA/G,CAAoH,IAApH,CAAlB;AACA1C,aAAOoF,MAAP,CAAcD,WAAd,EAA2BD,MAA3B;AACA,aAAOC,WAAP;AACD;AAjBA,GAtBuB,EAwCvB;AACDzD,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,WAAP;AACD;AAJA,GAxCuB,CAA1B;;AA+CA,SAAOrB,WAAP;AACD,CApEuC,CAoEtCgC,gBAAgBmE,MApEsB,CAAxC;;AAsEA;AACA,IAAIpG,SAASR,QAAQQ,MAAR,GAAiB,UAAUoJ,QAAV,EAAoB;AAChD3G,YAAUzC,MAAV,EAAkBoJ,QAAlB;;AAEA,WAASpJ,MAAT,CAAgBiD,QAAhB,EAA0B;AACxBd,oBAAgB,IAAhB,EAAsBnC,MAAtB;;AAEA,QAAIqJ,SAAS/G,2BAA2B,IAA3B,EAAiC,CAACtC,OAAO+C,SAAP,IAAoBzD,OAAOwC,cAAP,CAAsB9B,MAAtB,CAArB,EAAoDgC,IAApD,CAAyD,IAAzD,EAA+DiB,QAA/D,CAAjC,CAAb;;AAEA,QAAI,CAACoG,OAAOC,IAAZ,EAAkB;AAChB;AACA;AACA;AACAD,aAAOC,IAAP,GAAc,EAAd;AACD;;AAED,QAAI,CAACD,OAAOE,IAAZ,EAAkB;AAChBF,aAAOE,IAAP,GAAc,EAAd;AACD;AACD,WAAOF,MAAP;AACD;;AAED/I,eAAaN,MAAb,EAAqB,CAAC;AACpBgB,SAAK,6BADe;AAEpBvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,6BAA5E,EAA2G,IAA3G,EAAiHY,IAAjH,CAAsH,IAAtH,EAA4HwB,OAA5H;AACA,WAAKgG,KAAL,GAAahG,QAAQgG,KAArB;AACA,WAAKF,IAAL,GAAY9F,QAAQ8F,IAApB;AACD;AANmB,GAAD,EAOlB;AACDtI,SAAK,iBADJ;AAEDvB,WAAO,SAAS8E,eAAT,GAA2B;AAChC,UAAIC,SAAS;AACXgF,eAAO,KAAKA,KADD;AAEXF,cAAM,KAAKA;AAFA,OAAb;;AAKA,UAAI7E,cAAcpD,KAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,iBAA5E,EAA+F,IAA/F,EAAqGY,IAArG,CAA0G,IAA1G,CAAlB;AACA1C,aAAOoF,MAAP,CAAcD,WAAd,EAA2BD,MAA3B;AACA,aAAOC,WAAP;AACD;AAXA,GAPkB,EAmBlB;AACDzD,SAAK,uBADJ;AAEDvB,WAAO,SAASuH,qBAAT,CAA+BjB,IAA/B,EAAqC;AAC1C;;;;;;;AAOA,UAAIA,KAAKlB,YAAL,IAAqB,KAAzB,EAAgC;AAC9BkB,aAAKiB,qBAAL,CAA2B,IAA3B;AACD;AACD3F,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,uBAA5E,EAAqG,IAArG,EAA2GY,IAA3G,CAAgH,IAAhH,EAAsH+D,IAAtH;AACD;AAdA,GAnBkB,EAkClB;AACD/E,SAAK,wBADJ;AAEDvB,WAAO,SAASgK,sBAAT,CAAgC1D,IAAhC,EAAsC;AAC3C1E,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,wBAA5E,EAAsG,IAAtG,EAA4GY,IAA5G,CAAiH,IAAjH,EAAuH+D,IAAvH;AACA,WAAK2D,oBAAL;AACD;AALA,GAlCkB,EAwClB;AACD1I,SAAK,gCADJ;AAEDvB,WAAO,SAASkK,8BAAT,CAAwC5D,IAAxC,EAA8C;AACnD1E,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,gCAA5E,EAA8G,IAA9G,EAAoHY,IAApH,CAAyH,IAAzH,EAA+H+D,IAA/H;AACA,WAAK2D,oBAAL;AACD;AALA,GAxCkB,EA8ClB;AACD1I,SAAK,uBADJ;AAEDvB,WAAO,SAASmK,qBAAT,GAAiC;AACtC,WAAKL,IAAL,CAAU/B,OAAV,CAAkB,UAAUqC,GAAV,EAAe;AAC/BhD,UAAEY,MAAF,CAASoC,IAAItD,KAAb,EAAoB,EAAEjB,MAAM,KAAKA,IAAb,EAApB;AACD,OAFiB,CAEhBoC,IAFgB,CAEX,IAFW,CAAlB;AAGArG,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,uBAA5E,EAAqG,IAArG,EAA2GY,IAA3G,CAAgH,IAAhH;AACD;AAPA,GA9CkB,EAsDlB;AACDhB,SAAK,8BADJ;AAEDvB,WAAO,SAASqK,4BAAT,CAAsCjC,OAAtC,EAA+CC,OAA/C,EAAwD;AAC7DzG,WAAKrB,OAAOoB,SAAP,CAAiB2B,SAAjB,IAA8BzD,OAAOwC,cAAP,CAAsB9B,OAAOoB,SAA7B,CAAnC,EAA4E,8BAA5E,EAA4G,IAA5G,EAAkHY,IAAlH,CAAuH,IAAvH;AACA,UAAI+H,4BAA4B,IAAhC;AACA,UAAIC,oBAAoB,KAAxB;AACA,UAAIC,iBAAiB5J,SAArB;;AAEA,UAAI;AACF,aAAK,IAAI6J,YAAY,KAAKX,IAAL,CAAUY,OAAOC,QAAjB,GAAhB,EAA8CC,KAAnD,EAA0D,EAAEN,4BAA4B,CAACM,QAAQH,UAAUI,IAAV,EAAT,EAA2BC,IAAzD,CAA1D,EAA0HR,4BAA4B,IAAtJ,EAA4J;AAC1J,cAAIF,MAAMQ,MAAM5K,KAAhB;;AAEAoH,YAAEY,MAAF,CAASoC,IAAItD,KAAb,EAAoB,EAAEjB,MAAMuC,OAAR,EAApB;AACAgC,cAAItD,KAAJ,CAAUP,IAAV,CAAe,IAAf;AACD;AACF,OAPD,CAOE,OAAOwE,GAAP,EAAY;AACZR,4BAAoB,IAApB;AACAC,yBAAiBO,GAAjB;AACD,OAVD,SAUU;AACR,YAAI;AACF,cAAI,CAACT,yBAAD,IAA8BG,UAAUO,MAA5C,EAAoD;AAClDP,sBAAUO,MAAV;AACD;AACF,SAJD,SAIU;AACR,cAAIT,iBAAJ,EAAuB;AACrB,kBAAMC,cAAN;AACD;AACF;AACF;AACF;AA7BA,GAtDkB,EAoFlB;AACDjJ,SAAK,qBADJ;AAEDvB,WAAO,SAASiL,mBAAT,CAA6Bb,GAA7B,EAAkC;AACvC,WAAKH,oBAAL;AACD;AAJA,GApFkB,EAyFlB;AACD1I,SAAK,UADJ;AAEDvB,WAAO,SAASkL,QAAT,GAAoB;AACzB,aAAO,KAAKrB,IAAL,IAAa,EAApB;AACD;AAJA,GAzFkB,EA8FlB;AACDtI,SAAK,WADJ;AAEDvB,WAAO,SAASmL,SAAT,GAAqB;AAC1B,aAAO,KAAKpB,KAAL,IAAc,EAArB;AACD;AAJA,GA9FkB,EAmGlB;AACDxI,SAAK,sBADJ;AAEDvB,WAAO,SAASiK,oBAAT,GAAgC;AACrC,WAAKmB,eAAL,GAAuB,IAAvB;AACD;AAJA,GAnGkB,EAwGlB;AACD7J,SAAK,YADJ;AAEDvB,WAAO,SAASqL,UAAT,GAAsB;AAC3B,WAAKD,eAAL,GAAuB9K,MAAMgL,oBAAN,CAA2B,KAAKxB,IAAhC,CAAvB;AACA,aAAO,KAAKsB,eAAZ;AACD;AALA,GAxGkB,EA8GlB;AACD7J,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,MAAP;AACD;AAJA,GA9GkB,EAmHlB;AACDN,SAAK,aADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,MAAP;AACD;AAJA,GAnHkB,CAArB,EAwHI,CAAC;AACHN,SAAK,kBADF;AAEHvB,WAAO,SAASuL,gBAAT,CAA0BzE,KAA1B,EAAiC;AACtC,UAAI0E,WAAW1E,MAAMuC,MAAN,CAAa,UAAU/B,IAAV,EAAgB;AAC1C,eAAOA,KAAKmE,KAAL,IAAc,KAAd,IAAuBnE,KAAKmE,KAAL,IAAc,IAA5C;AACD,OAFc,CAAf;AAGA,aAAOD,QAAP;AACD;AAPE,GAAD,CAxHJ;;AAkIA,SAAOjL,MAAP;AACD,CAxJ6B,CAwJ5BiC,gBAAgBmE,MAxJY,CAA9B;;AA0JA;AACA,IAAIrG,QAAQP,QAAQO,KAAR,GAAgB,UAAUoL,QAAV,EAAoB;AAC9C1I,YAAU1C,KAAV,EAAiBoL,QAAjB;;AAEA,WAASpL,KAAT,CAAekD,QAAf,EAAyB;AACvBd,oBAAgB,IAAhB,EAAsBpC,KAAtB;;AAEA,QAAIqL,SAAS9I,2BAA2B,IAA3B,EAAiC,CAACvC,MAAMgD,SAAN,IAAmBzD,OAAOwC,cAAP,CAAsB/B,KAAtB,CAApB,EAAkDiC,IAAlD,CAAuD,IAAvD,EAA6DiB,QAA7D,CAAjC,CAAb;;AAEA,QAAI,CAACmI,OAAOvG,YAAZ,EAA0B;AACxBuG,aAAOvG,YAAP,GAAsB,KAAtB;AACD;;AAED,QAAI,CAACuG,OAAO7E,KAAZ,EAAmB;AACjB6E,aAAO7E,KAAP,GAAe,EAAf;AACD;AACD,WAAO6E,MAAP;AACD;;AAED9K,eAAaP,KAAb,EAAoB,CAAC;AACnBiB,SAAK,6BADc;AAEnBvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKtB,MAAMqB,SAAN,CAAgB2B,SAAhB,IAA6BzD,OAAOwC,cAAP,CAAsB/B,MAAMqB,SAA5B,CAAlC,EAA0E,6BAA1E,EAAyG,IAAzG,EAA+GY,IAA/G,CAAoH,IAApH,EAA0HwB,OAA1H;AACA,WAAKgG,KAAL,GAAahG,QAAQgG,KAArB;AACD;AALkB,GAAD,EAMjB;AACDxI,SAAK,iBADJ;AAEDvB,WAAO,SAAS8E,eAAT,GAA2B;AAChC,UAAIC,SAAS;AACXgF,eAAO,KAAKA;AADD,OAAb;;AAIA,UAAI/E,cAAcpD,KAAKtB,MAAMqB,SAAN,CAAgB2B,SAAhB,IAA6BzD,OAAOwC,cAAP,CAAsB/B,MAAMqB,SAA5B,CAAlC,EAA0E,iBAA1E,EAA6F,IAA7F,EAAmGY,IAAnG,CAAwG,IAAxG,CAAlB;AACA1C,aAAOoF,MAAP,CAAcD,WAAd,EAA2BD,MAA3B;AACA,aAAOC,WAAP;AACD;AAVA,GANiB,EAiBjB;AACDzD,SAAK,uBADJ;AAEDvB,WAAO,SAASuH,qBAAT,CAA+BjB,IAA/B,EAAqC;AAC1C,UAAIA,KAAKlB,YAAL,IAAqB,MAAzB,EAAiC;AAC/B,YAAI,CAACgC,EAAEI,IAAF,CAAO,KAAKV,KAAZ,EAAmB,EAAEjB,MAAMS,KAAKT,IAAb,EAAnB,CAAL,EAA8C;AAC5C,eAAKiB,KAAL,CAAWP,IAAX,CAAgBD,IAAhB;AACAA,eAAKwD,IAAL,CAAUvD,IAAV,CAAe,IAAf;AACD;AACF;AACD3E,WAAKtB,MAAMqB,SAAN,CAAgB2B,SAAhB,IAA6BzD,OAAOwC,cAAP,CAAsB/B,MAAMqB,SAA5B,CAAlC,EAA0E,uBAA1E,EAAmG,IAAnG,EAAyGY,IAAzG,CAA8G,IAA9G,EAAoH+D,IAApH;AACD;AAVA,GAjBiB,EA4BjB;AACD/E,SAAK,0BADJ;AAEDvB,WAAO,SAASyH,wBAAT,CAAkCnB,IAAlC,EAAwC;AAC7C,UAAIA,KAAKlB,YAAL,IAAqB,MAAzB,EAAiC;AAC/BgC,UAAEY,MAAF,CAAS,KAAKlB,KAAd,EAAqB,EAAEjB,MAAMS,KAAKT,IAAb,EAArB;AACAuB,UAAEY,MAAF,CAAS1B,KAAKwD,IAAd,EAAoB,EAAEjE,MAAM,KAAKA,IAAb,EAApB;AACD;AACDjE,WAAKtB,MAAMqB,SAAN,CAAgB2B,SAAhB,IAA6BzD,OAAOwC,cAAP,CAAsB/B,MAAMqB,SAA5B,CAAlC,EAA0E,0BAA1E,EAAsG,IAAtG,EAA4GY,IAA5G,CAAiH,IAAjH,EAAuH+D,IAAvH;AACD;AARA,GA5BiB,EAqCjB;AACD/E,SAAK,0BADJ;AAEDvB,WAAO,SAAS4L,wBAAT,GAAoC;AACzC,UAAIzE,aAAa,KAAKpD,OAAL,CAAaoD,UAA9B;;AAEA,UAAIU,QAAQV,WAAWE,GAAX,CAAe,UAAUS,GAAV,EAAe;AACxC,eAAOA,IAAIjC,IAAX;AACD,OAFW,CAAZ;AAGA,WAAKiB,KAAL,CAAW+E,KAAX,GAAmB9D,OAAnB,CAA2B,UAAUT,IAAV,EAAgB;AACzC,YAAI,CAACO,MAAMzB,QAAN,CAAekB,KAAKzB,IAApB,CAAL,EAAgC;AAC9BuB,YAAEY,MAAF,CAASV,KAAKwC,IAAd,EAAoB,EAAEjE,MAAM,KAAKA,IAAb,EAApB;AACAuB,YAAEY,MAAF,CAAS,KAAKlB,KAAd,EAAqB,EAAEjB,MAAMyB,KAAKzB,IAAb,EAArB;;AAEAyB,eAAK4C,8BAAL,CAAoC,IAApC;AACD;AACF,OAP0B,CAOzBjC,IAPyB,CAOpB,IAPoB,CAA3B;AAQD;AAhBA,GArCiB,EAsDjB;AACD1G,SAAK,uBADJ;AAEDvB,WAAO,SAASmK,qBAAT,GAAiC;AACtC,UAAI2B,SAAS,IAAb;;AAEA,WAAKhF,KAAL,CAAWiB,OAAX,CAAmB,UAAUT,IAAV,EAAgB;AACjCF,UAAEY,MAAF,CAASV,KAAKwC,IAAd,EAAoB,EAAEjE,MAAMiG,OAAOjG,IAAf,EAApB;AACAyB,aAAK4C,8BAAL,CAAoC4B,MAApC;AACD,OAHD;;AAKA,WAAKhF,KAAL,CAAW5F,MAAX,GAAoB,CAApB;;AAEAU,WAAKtB,MAAMqB,SAAN,CAAgB2B,SAAhB,IAA6BzD,OAAOwC,cAAP,CAAsB/B,MAAMqB,SAA5B,CAAlC,EAA0E,uBAA1E,EAAmG,IAAnG,EAAyGY,IAAzG,CAA8G,IAA9G;AACD;AAbA,GAtDiB,EAoEjB;AACDhB,SAAK,8BADJ;AAEDvB,WAAO,SAASqK,4BAAT,CAAsCjC,OAAtC,EAA+CC,OAA/C,EAAwD;AAC7D,UAAI0D,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkBrL,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAIsL,aAAa,KAAKpF,KAAL,CAAW4D,OAAOC,QAAlB,GAAjB,EAAgDwB,MAArD,EAA6D,EAAEJ,6BAA6B,CAACI,SAASD,WAAWrB,IAAX,EAAV,EAA6BC,IAA5D,CAA7D,EAAgIiB,6BAA6B,IAA7J,EAAmK;AACjK,cAAIzE,OAAO6E,OAAOnM,KAAlB;;AAEAoH,YAAEY,MAAF,CAASV,KAAKwC,IAAd,EAAoB,EAAEjE,MAAMuC,OAAR,EAApB;AACAd,eAAKwC,IAAL,CAAUvD,IAAV,CAAe,IAAf;AACD;AACF,OAPD,CAOE,OAAOwE,GAAP,EAAY;AACZiB,6BAAqB,IAArB;AACAC,0BAAkBlB,GAAlB;AACD,OAVD,SAUU;AACR,YAAI;AACF,cAAI,CAACgB,0BAAD,IAA+BG,WAAWlB,MAA9C,EAAsD;AACpDkB,uBAAWlB,MAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIgB,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA5BA,GApEiB,EAiGjB;AACD1K,SAAK,kBADJ;AAEDvB,WAAO,SAASoM,gBAAT,GAA4B;AACjC,UAAIC,6BAA6B,IAAjC;AACA,UAAIC,qBAAqB,KAAzB;AACA,UAAIC,kBAAkB3L,SAAtB;;AAEA,UAAI;AACF,aAAK,IAAI4L,aAAa,KAAK1F,KAAL,CAAW4D,OAAOC,QAAlB,GAAjB,EAAgD8B,MAArD,EAA6D,EAAEJ,6BAA6B,CAACI,SAASD,WAAW3B,IAAX,EAAV,EAA6BC,IAA5D,CAA7D,EAAgIuB,6BAA6B,IAA7J,EAAmK;AACjK,cAAI/E,OAAOmF,OAAOzM,KAAlB;;AAEAsH,eAAK2D,mBAAL,CAAyB,IAAzB;AACD;AACF,OAND,CAME,OAAOF,GAAP,EAAY;AACZuB,6BAAqB,IAArB;AACAC,0BAAkBxB,GAAlB;AACD,OATD,SASU;AACR,YAAI;AACF,cAAI,CAACsB,0BAAD,IAA+BG,WAAWxB,MAA9C,EAAsD;AACpDwB,uBAAWxB,MAAX;AACD;AACF,SAJD,SAIU;AACR,cAAIsB,kBAAJ,EAAwB;AACtB,kBAAMC,eAAN;AACD;AACF;AACF;AACF;AA3BA,GAjGiB,EA6HjB;AACDhL,SAAK,YADJ;AAEDvB,WAAO,SAAS0M,UAAT,GAAsB;AAC3B,aAAO,KAAKtH,YAAL,IAAqB,aAA5B;AACD;AAJA,GA7HiB,EAkIjB;AACD7D,SAAK,aADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,KAAP;AACD;AAJA,GAlIiB,CAApB,EAuII,CAAC;AACHN,SAAK,sBADF;AAEHvB,WAAO,SAASsL,oBAAT,CAA8BxB,IAA9B,EAAoC;AACzC,aAAOA,KAAK6C,IAAL,CAAU,UAAUlD,CAAV,EAAamD,CAAb,EAAgB;AAC/B,eAAOnD,EAAEM,KAAF,GAAU6C,EAAE7C,KAAnB;AACD,OAFM,EAEJ1C,GAFI,CAEA,UAAU+C,GAAV,EAAenJ,CAAf,EAAkB;AACvB,eAAO,MAAMmJ,IAAIL,KAAjB;AACD,OAJM,EAIJ8C,IAJI,CAIC,GAJD,CAAP;AAKD;AARE,GAAD,CAvIJ;;AAkJA,SAAOvM,KAAP;AACD,CArK2B,CAqK1BkC,gBAAgBmE,MArKU,CAA5B;;AAuKA;AACA,IAAItG,qBAAqBN,QAAQM,kBAAR,GAA6B,UAAUyM,QAAV,EAAoB;AACxE9J,YAAU3C,kBAAV,EAA8ByM,QAA9B;;AAEA,WAASzM,kBAAT,GAA8B;AAC5BqC,oBAAgB,IAAhB,EAAsBrC,kBAAtB;;AAEA,WAAOwC,2BAA2B,IAA3B,EAAiC,CAACxC,mBAAmBiD,SAAnB,IAAgCzD,OAAOwC,cAAP,CAAsBhC,kBAAtB,CAAjC,EAA4E0M,KAA5E,CAAkF,IAAlF,EAAwFC,SAAxF,CAAjC,CAAP;AACD;;AAEDnM,eAAaR,kBAAb,EAAiC,CAAC;AAChCkB,SAAK,6BAD2B;AAEhCvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKvB,mBAAmBsB,SAAnB,CAA6B2B,SAA7B,IAA0CzD,OAAOwC,cAAP,CAAsBhC,mBAAmBsB,SAAzC,CAA/C,EAAoG,6BAApG,EAAmI,IAAnI,EAAyIY,IAAzI,CAA8I,IAA9I,EAAoJwB,OAApJ;AACA,WAAKkJ,OAAL,GAAelJ,QAAQkJ,OAAvB;AACD;AAL+B,GAAD,EAM9B;AACD1L,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,qBAAP;AACD;AAJA,GAN8B,CAAjC;;AAaA,SAAOxB,kBAAP;AACD,CAvBqD,CAuBpDmC,gBAAgBmE,MAvBoC,CAAtD;;AAyBA;AACA,IAAIvG,QAAQL,QAAQK,KAAR,GAAgB,UAAU8M,QAAV,EAAoB;AAC9ClK,YAAU5C,KAAV,EAAiB8M,QAAjB;;AAEA,WAAS9M,KAAT,CAAeoD,QAAf,EAAyB;AACvBd,oBAAgB,IAAhB,EAAsBtC,KAAtB;;AAEA,WAAOyC,2BAA2B,IAA3B,EAAiC,CAACzC,MAAMkD,SAAN,IAAmBzD,OAAOwC,cAAP,CAAsBjC,KAAtB,CAApB,EAAkDmC,IAAlD,CAAuD,IAAvD,EAA6DiB,QAA7D,CAAjC,CAAP;AACD;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA3C,eAAaT,KAAb,EAAoB,CAAC;AACnBmB,SAAK,cADc;AAEnBvB,WAAO,SAASmN,YAAT,GAAwB;AAC7B,aAAO,IAAP;AACD;AAJkB,GAAD,EAKjB;AACD5L,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,QAAP;AACD;AAJA,GALiB,CAApB;;AAYA,SAAOzB,KAAP;AACD,CA/B2B,CA+B1BoC,gBAAgBmE,MA/BU,CAA5B;;AAiCA;AACA,IAAIxG,oBAAoBJ,QAAQI,iBAAR,GAA4B,UAAUiN,QAAV,EAAoB;AACtEpK,YAAU7C,iBAAV,EAA6BiN,QAA7B;;AAEA,WAASjN,iBAAT,GAA6B;AAC3BuC,oBAAgB,IAAhB,EAAsBvC,iBAAtB;;AAEA,WAAO0C,2BAA2B,IAA3B,EAAiC,CAAC1C,kBAAkBmD,SAAlB,IAA+BzD,OAAOwC,cAAP,CAAsBlC,iBAAtB,CAAhC,EAA0E4M,KAA1E,CAAgF,IAAhF,EAAsFC,SAAtF,CAAjC,CAAP;AACD;;AAEDnM,eAAaV,iBAAb,EAAgC,CAAC;AAC/BoB,SAAK,6BAD0B;AAE/BvB,WAAO,SAAS8D,2BAAT,CAAqCC,OAArC,EAA8C;AACnDnC,WAAKzB,kBAAkBwB,SAAlB,CAA4B2B,SAA5B,IAAyCzD,OAAOwC,cAAP,CAAsBlC,kBAAkBwB,SAAxC,CAA9C,EAAkG,6BAAlG,EAAiI,IAAjI,EAAuIY,IAAvI,CAA4I,IAA5I,EAAkJwB,OAAlJ;AACA,WAAKG,GAAL,GAAWH,QAAQG,GAAnB;AACD;AAL8B,GAAD,EAM7B;AACD3C,SAAK,cADJ;AAEDvB,WAAO,SAASmN,YAAT,GAAwB;AAC7B,aAAO,IAAP;AACD;AAJA,GAN6B,EAW7B;AACD5L,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,cAAP;AACD;AAJA,GAX6B,CAAhC;;AAkBA,SAAO1B,iBAAP;AACD,CA5BmD,CA4BlDqC,gBAAgBmE,MA5BkC,CAApD;;AA8BA;AACA,IAAIzG,aAAaH,QAAQG,UAAR,GAAqB,UAAUmN,MAAV,EAAkB;AACtDrK,YAAU9C,UAAV,EAAsBmN,MAAtB;;AAEA,WAASnN,UAAT,CAAoBoN,OAApB,EAA6B;AAC3B5K,oBAAgB,IAAhB,EAAsBxC,UAAtB;;AAEA,QAAIqN,UAAU1K,2BAA2B,IAA3B,EAAiC,CAAC3C,WAAWoD,SAAX,IAAwBzD,OAAOwC,cAAP,CAAsBnC,UAAtB,CAAzB,EAA4DqC,IAA5D,CAAiE,IAAjE,EAAuE+K,OAAvE,CAAjC,CAAd;;AAEAC,YAAQnI,YAAR,GAAuB,aAAvB;AACA,WAAOmI,OAAP;AACD;;AAED1M,eAAaX,UAAb,EAAyB,IAAzB,EAA+B,CAAC;AAC9BqB,SAAK,iBADyB;AAE9BvB,WAAO,SAASwN,eAAT,GAA2B;AAChC,aAAO,CAAC,IAAItN,UAAJ,CAAe;AACrB2F,cAAM3F,WAAWuN,wBADI;AAErB1J,iBAAS;AACPgG,iBAAO,WADA;AAEP2D,uBAAa,IAFN;AAGPC,oBAAU,IAHH;AAIPC,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,cAAD,EAAiB,GAAjB,EAAsB,MAAtB,CAA1B;AAJJ;AAFY,OAAf,CAAD,EAQH,IAAI5N,UAAJ,CAAe;AACjB2F,cAAM3F,WAAW6N,6BADA;AAEjBhK,iBAAS;AACPgG,iBAAO,UADA;AAEP2D,uBAAa,IAFN;AAGPM,wBAAc,IAHP;AAIPJ,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,UAAD,EAAa,GAAb,EAAkB,IAAlB,CAA1B;AAJJ;AAFQ,OAAf,CARG,EAgBH,IAAI5N,UAAJ,CAAe;AACjB2F,cAAM3F,WAAW+N,4BADA;AAEjBlK,iBAAS;AACPgG,iBAAO,OADA;AAEP2D,uBAAa,IAFN;AAGPQ,sBAAY,IAHL;AAIPN,qBAAW,IAAIC,YAAYC,SAAhB,CAA0B,CAAC,iBAAD,EAAoB,GAApB,EAAyB,IAAzB,CAA1B;AAJJ;AAFQ,OAAf,CAhBG,CAAP;AAyBD;AA5B6B,GAAD,CAA/B;;AA+BA,SAAO5N,UAAP;AACD,CA5CqC,CA4CpCI,KA5CoC,CAAtC;;AA8CAJ,WAAWuN,wBAAX,GAAsC,WAAtC;AACAvN,WAAW6N,6BAAX,GAA2C,gBAA3C;AACA7N,WAAW+N,4BAAX,GAA0C,eAA1C;AACA;AACA,IAAIhO,UAAUF,QAAQE,OAAR,GAAkB,UAAUkO,YAAV,EAAwB;AACtDnL,YAAU/C,OAAV,EAAmBkO,YAAnB;;AAEA,WAASlO,OAAT,CAAiBuD,QAAjB,EAA2B;AACzBd,oBAAgB,IAAhB,EAAsBzC,OAAtB;;AAEA,QAAImO,UAAUvL,2BAA2B,IAA3B,EAAiC,CAAC5C,QAAQqD,SAAR,IAAqBzD,OAAOwC,cAAP,CAAsBpC,OAAtB,CAAtB,EAAsDsC,IAAtD,CAA2D,IAA3D,EAAiEiB,QAAjE,CAAjC,CAAd;;AAEA4K,YAAQ1J,IAAR,GAAe,QAAf;AACA,WAAO0J,OAAP;AACD;;AAEDvN,eAAaZ,OAAb,EAAsB,CAAC;AACrBsB,SAAK,aADgB;AAErBvB,WAAO,SAASqO,WAAT,GAAuB;AAC5B,aAAO,KAAK5J,YAAL,IAAqB,KAAKA,YAAL,CAAkB6J,SAA9C;AACD;AAJoB,GAAD,EAKnB;AACD/M,SAAK,gBADJ;AAEDvB,WAAO,SAASuO,cAAT,CAAwBC,KAAxB,EAA+B;AACpC,WAAK/I,cAAL,CAAoB,aAApB,EAAmC+I,KAAnC;AACD;AAJA,GALmB,EAUnB;AACDjN,SAAK,gBADJ;AAEDvB,WAAO,SAASyO,cAAT,GAA0B;AAC/B,aAAO,KAAKnJ,cAAL,CAAoB,aAApB,KAAsC,EAAEoJ,WAAW,EAAb,EAAiBF,OAAO,EAAxB,EAA7C;AACD;;AAED;;AANC,GAVmB,EAkBnB;AACDjN,SAAK,gBADJ;AAEDvB,WAAO,SAAS2O,cAAT,GAA0B;AAC/B,aAAO,KAAKrJ,cAAL,CAAoB,aAApB,CAAP;AACD;AAJA,GAlBmB,EAuBnB;AACD/D,SAAK,qBADJ;AAEDvB,WAAO,SAAS4O,mBAAT,CAA6BC,EAA7B,EAAiC;AACtC,WAAKpJ,cAAL,CAAoB,sBAApB,EAA4CoJ,EAA5C;AACD;AAJA,GAvBmB,EA4BnB;AACDtN,SAAK,qBADJ;AAEDvB,WAAO,SAAS8O,mBAAT,GAA+B;AACpC,aAAO,KAAKxJ,cAAL,CAAoB,sBAApB,CAAP;AACD;;AAED;;AANC,GA5BmB,EAoCnB;AACD/D,SAAK,iBADJ;AAEDvB,WAAO,SAAS+O,eAAT,CAAyBnK,MAAzB,EAAiC;AACtC,WAAKa,cAAL,CAAoB,cAApB,EAAoCb,MAApC;AACD;AAJA,GApCmB,EAyCnB;AACDrD,SAAK,gBADJ;AAEDvB,WAAO,SAASgP,cAAT,GAA0B;AAC/B,aAAO,KAAK1J,cAAL,CAAoB,cAApB,CAAP;AACD;AAJA,GAzCmB,EA8CnB;AACD/D,SAAK,cADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,UAAP;AACD;AAJA,GA9CmB,EAmDnB;AACDN,SAAK,aADJ;AAEDM,SAAK,SAASA,GAAT,GAAe;AAClB,aAAO,OAAP;AACD;AAJA,GAnDmB,CAAtB;;AA0DA,SAAO5B,OAAP;AACD,CAvE+B,CAuE9BU,WAvE8B,CAAhC;;AAyEA;;AAEA,IAAI,OAAO8C,MAAP,KAAkB,WAAlB,IAAiCA,WAAW,IAAhD,EAAsD;AACpD;AACA,MAAI;AACFA,WAAOlD,MAAP,GAAgBA,MAAhB;AACAkD,WAAOnD,KAAP,GAAeA,KAAf;AACAmD,WAAOvD,UAAP,GAAoBA,UAApB;AACAuD,WAAOrD,KAAP,GAAeA,KAAf;AACAqD,WAAOtD,iBAAP,GAA2BA,iBAA3B;AACAsD,WAAO9C,WAAP,GAAqBA,WAArB;AACA8C,WAAO/C,QAAP,GAAkBA,QAAlB;AACA+C,WAAOjD,WAAP,GAAqBA,WAArB;AACAiD,WAAOxD,OAAP,GAAiBA,OAAjB;AACAwD,WAAOpD,kBAAP,GAA4BA,kBAA5B;AACD,GAXD,CAWE,OAAO4O,CAAP,EAAU;AACVC,YAAQC,GAAR,CAAY,sDAAZ,EAAoEF,CAApE;AACD;AACF;AACD;AACA,CAAC;;AAEDG,QAAQC,MAAR,CAAe,KAAf,EAAsB,EAAtB;IAGOC,Q,GACL,kBAAYC,UAAZ,EAAwBC,MAAxB,EAAgCC,QAAhC,EAA0C;AAAA;;AAExC,MAAIC,sBAAsB,aAA1B;;AAEA,MAAIC,iBAAiB,IAAIC,cAAJ,CAAmB;AACtCC,kBAAcpM,MADwB;AAEtCqM,aAAS,mBAAM;AACbP,iBAAWQ,QAAX,GAAsBJ,eAAeI,QAArC;AACD;AAJqC,GAAnB,CAArB;;AAOA,MAAIC,YAAY,GAAhB;;AAEAR,SAAOS,cAAP,GAAwB,UAASC,SAAT,EAAoB;AAC1C,QAAIC,WAAW,SAAXA,QAAW,CAACrG,IAAD,EAAU;AACvB,aAAOA,KAAK6C,IAAL,CAAU,UAAClD,CAAD,EAAImD,CAAJ,EAAU;AACzB,YAAMwD,SAAS3G,EAAE1F,OAAF,CAAUgG,KAAV,CAAgBsG,WAAhB,EAAf;AAAA,YAA8CC,SAAS1D,EAAE7I,OAAF,CAAUgG,KAAV,CAAgBsG,WAAhB,EAAvD;AACA,eAAO,CAACD,SAASE,MAAV,KAAqBF,SAASE,MAA9B,CAAP;AACD,OAHM,CAAP;AAID,KALD;AAMA,QAAIC,WAAWL,UAAUM,OAAV,CAAkB3E,KAAlB,EAAf;;AAEA,QAAI4E,kBAAkB,SAAlBA,eAAkB,CAAS1G,KAAT,EAAgB;AAAA;AAAA;AAAA;;AAAA;AACpC,8BAAemG,UAAUM,OAAzB,mIAAkC;AAAA,cAA1BpG,GAA0B;;AAChC,cAAGA,IAAIrG,OAAJ,CAAYgG,KAAZ,KAAsBA,KAAzB,EAAgC;AAC9B,mBAAOK,GAAP;AACD;AACF;AALmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAMpC,aAAO,IAAP;AACD,KAPD;;AAT0C;AAAA;AAAA;;AAAA;AAkB1C,4BAAe8F,UAAUM,OAAzB,mIAAkC;AAAA,YAA1BpG,GAA0B;;AAChC,YAAIsG,eAAetG,IAAIuG,QAAJ,IAAgBvG,IAAIuG,QAAJ,CAAanJ,IAAb,CAAkB,UAACoJ,CAAD,EAAO;AAAC,iBAAOA,EAAEnF,KAAT;AAAe,SAAzC,CAAnC;AACArB,YAAIuG,QAAJ,GAAe,EAAf;AACAvG,YAAIhI,MAAJ,GAAa,IAAb;;AAEA,YAAGsO,YAAH,EAAiB;AACftG,cAAIuG,QAAJ,CAAaE,OAAb,CAAqBH,YAArB;AACD;AACF;AA1ByC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA0BzC;;AA1ByC;AAAA;AAAA;;AAAA;AA4B1C,4BAAeR,UAAUM,OAAzB,mIAAkC;AAAA,YAA1BpG,GAA0B;;AAChC,YAAI7F,OAAO6F,IAAIrG,OAAJ,CAAYgG,KAAvB;AACA,YAAI+G,QAAQvM,KAAKwM,KAAL,CAAWf,SAAX,CAAZ;AACA5F,YAAI4G,YAAJ,GAAmBF,MAAMA,MAAM5P,MAAN,GAAc,CAApB,CAAnB;AACA,YAAG4P,MAAM5P,MAAN,IAAgB,CAAnB,EAAsB;AACpBkJ,cAAIhI,MAAJ,GAAa8N,SAAb;AACA;AACD;;AAED,YAAIe,YAAY,SAAZA,SAAY,GAAoB;AAAA,cAAXC,KAAW,uEAAH,CAAG;;AAClC,cAAIC,cAAcL,MAAMjF,KAAN,CAAY,CAAZ,EAAeiF,MAAM5P,MAAN,GAAegQ,KAA9B,EAAqCrE,IAArC,CAA0CmD,SAA1C,CAAlB;AACA,cAAGmB,YAAYjQ,MAAZ,IAAsB,CAAzB,EAA4B;AAC1B,mBAAO,IAAP;AACD;AACD,cAAIkB,SAASqO,gBAAgBU,WAAhB,CAAb;;AAEA;AACA;AACA,cAAG,CAAC/O,MAAD,IAAW8O,QAAQJ,MAAM5P,MAAN,GAAe,CAArC,EAAwC;AACtC,mBAAO+P,UAAUC,QAAQ,CAAlB,CAAP;AACD;;AAED;AACA,cAAIE,WAAWhH,IAAIrG,OAAJ,CAAYgG,KAAZ,CAAkB8B,KAAlB,CAAwBsF,YAAYjQ,MAAZ,GAAmB,CAA3C,CAAf;AACAkJ,cAAI4G,YAAJ,GAAmBI,QAAnB;;AAEA,iBAAOhP,MAAP;AACD,SAlBD;;AAoBA,YAAIA,SAAS6O,WAAb;;AAEA;AACA,YAAG,CAAC7O,MAAJ,EAAY;AACVgI,cAAI4G,YAAJ,GAAmB5G,IAAIrG,OAAJ,CAAYgG,KAA/B;AACAK,cAAIhI,MAAJ,GAAa8N,SAAb;AACA;AACD;;AAED9N,eAAOuO,QAAP,CAAgBpK,IAAhB,CAAqB6D,GAArB;AACAhI,eAAOuO,QAAP,GAAkBR,SAAS/N,OAAOuO,QAAhB,CAAlB;AACAvG,YAAIhI,MAAJ,GAAaA,MAAb;;AAEA;AACA,YAAIiP,QAAQd,SAAS9J,OAAT,CAAiB2D,GAAjB,CAAZ;AACAmG,iBAASe,MAAT,CAAgBD,KAAhB,EAAuB,CAAvB;;AAEA,YAAG7B,OAAO+B,WAAP,IAAsB/B,OAAO+B,WAAP,CAAmB1L,IAAnB,IAA2BuE,IAAIvE,IAAxD,EAA8D;AAC5D2J,iBAAO+B,WAAP,GAAqBnH,GAArB;AACAoF,iBAAOgC,iBAAP,CAAyBpH,GAAzB,EAA8B,IAA9B;AACD;AACF;AA9EyC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgF1C,QAAIsG,eAAeR,UAAUS,QAAV,IAAsBT,UAAUS,QAAV,CAAmBnJ,IAAnB,CAAwB,UAACoJ,CAAD,EAAO;AAAC,aAAOA,EAAEnF,KAAT;AAAe,KAA/C,CAAzC;AACAyE,cAAUS,QAAV,GAAqBR,SAASI,QAAT,CAArB;AACA,QAAGG,YAAH,EAAiB;AAAER,gBAAUS,QAAV,CAAmBE,OAAnB,CAA2BH,YAA3B;AAA2C;AAC/D,GAnFD;;AAqFAlB,SAAOiC,YAAP,GAAsB,UAASC,QAAT,EAAmBC,QAAnB,EAA6B;AACjD,QAAIC,SAASpC,OAAOU,SAAP,CAAiBM,OAAjB,CAAyBnH,MAAzB,CAAgC,UAASe,GAAT,EAAa;AACxD,aAAOA,IAAIvE,IAAJ,KAAa6L,QAApB;AACD,KAFY,EAEV,CAFU,CAAb;;AAIA,QAAI3Q,SAAS4Q,aAAa,GAAb,GAAmBnC,OAAOU,SAA1B,GAAsCV,OAAOU,SAAP,CAAiBM,OAAjB,CAAyBnH,MAAzB,CAAgC,UAASe,GAAT,EAAa;AAC9F,aAAOA,IAAIvE,IAAJ,KAAa8L,QAApB;AACD,KAFkD,EAEhD,CAFgD,CAAnD;;AAIA,QAAG5Q,OAAOqB,MAAP,KAAkBwP,MAArB,EAA6B;AAC3B;AACD;;AAED,QAAIC,YAAY,CAACD,MAAD,CAAhB;;AAEA,QAAIE,iBAAiB,SAAjBA,cAAiB,CAASF,MAAT,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACpC,8BAAiBA,OAAOjB,QAAxB,mIAAkC;AAAA,cAA1BoB,KAA0B;;AAChC,cAAIC,WAAWJ,OAAO7N,OAAP,CAAegG,KAAf,GAAuBiG,SAAvB,GAAmC+B,MAAMhO,OAAN,CAAcgG,KAAd,CAAoBgH,KAApB,CAA0Bf,SAA1B,EAAqCnE,KAArC,CAA2C,CAAC,CAA5C,EAA+C,CAA/C,CAAlD;AACAkG,gBAAMhO,OAAN,CAAcgG,KAAd,GAAsBiI,QAAtB;AACAH,oBAAUtL,IAAV,CAAewL,KAAf;AACAD,yBAAeC,KAAf;AACD;AANmC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOrC,KAPD;;AASA,QAAIC,QAAJ;AACA,QAAGjR,OAAOkR,MAAV,EAAkB;AAChBD,iBAAWJ,OAAO7N,OAAP,CAAegG,KAAf,CAAqBgH,KAArB,CAA2Bf,SAA3B,EAAsCnE,KAAtC,CAA4C,CAAC,CAA7C,EAAgD,CAAhD,CAAX;AACD,KAFD,MAEO;AACLmG,iBAAWjR,OAAOgD,OAAP,CAAegG,KAAf,GAAuBiG,SAAvB,GAAmC4B,OAAO7N,OAAP,CAAegG,KAAf,CAAqBgH,KAArB,CAA2Bf,SAA3B,EAAsCnE,KAAtC,CAA4C,CAAC,CAA7C,EAAgD,CAAhD,CAA9C;AACD;AACD+F,WAAO7N,OAAP,CAAegG,KAAf,GAAuBiI,QAAvB;AACAF,mBAAeF,MAAf;AACApC,WAAOS,cAAP,CAAsBT,OAAOU,SAA7B;;AAEAP,mBAAeuC,SAAf,CAAyBL,SAAzB;AACD,GAnCD;;AAqCArC,SAAO2C,SAAP,GAAmB,UAAS/H,GAAT,EAAc;AAC/B,QAAIL,QAAQK,IAAIrG,OAAJ,CAAYgG,KAAxB;AACA,QAAGA,MAAMqI,UAAN,CAAiB,IAAjB,CAAH,EAA2B;AACzB;;;;;;AAMA,UAAI;AACF,YAAIC,aAAa7J,KAAK8J,KAAL,CAAWvI,MAAMwI,SAAN,CAAgB,CAAhB,EAAmBxI,MAAM7I,MAAzB,CAAX,CAAjB;AACD,OAFD,CAEE,OAAO+N,CAAP,EAAU;AACVuD,cAAM,oIAAN;AACA;AACD;AACD,UAAIC,WAAW;AACbrN,sBAAcsK,mBADD;AAEb3L,iBAAS;AACPgG,iBAAOsI,WAAW,CAAX,CADA;AAEPzE,qBAAW;AACT8E,qBAASL,WAAW,CAAX,CADA;AAETM,sBAAUN,WAAW,CAAX,CAFD;AAGTrS,mBAAOqS,WAAW,CAAX;AAHE;AAFJ;AAFI,OAAf;AAWA1C,qBAAeiD,UAAf,CAA0BH,QAA1B,EAAoC,UAACI,UAAD,EAAgB;AAClD;AACA;AACA;AACArD,eAAOsD,YAAP,GAAsBD,UAAtB;AACD,OALD;AAMD,KA9BD,MA8BO;AACLzI,UAAIhF,YAAJ,GAAmB,KAAnB;AACA,UAAI2E,KAAJ;AACA,UAAGK,IAAIhI,MAAJ,CAAW6P,MAAd,EAAsB;AACpBlI,gBAAQK,IAAIrG,OAAJ,CAAYgG,KAApB;AACD,OAFD,MAEO;AACLA,gBAAQK,IAAIhI,MAAJ,CAAW2B,OAAX,CAAmBgG,KAAnB,GAA2BiG,SAA3B,GAAuC5F,IAAIrG,OAAJ,CAAYgG,KAA3D;AACD;AACDK,UAAIrG,OAAJ,CAAYgG,KAAZ,GAAoBA,KAApB;AACAK,UAAIqB,KAAJ,GAAY,KAAZ;AACAkE,qBAAeiD,UAAf,CAA0BxI,GAA1B,EAA+B,UAACyI,UAAD,EAAgB;AAC7CrD,eAAOsD,YAAP,GAAsBD,UAAtB;AACD,OAFD;AAGD;AACF,GA9CD;;AAgDArD,SAAOuD,SAAP,GAAmB,UAAS3I,GAAT,EAAc4I,WAAd,EAA2B;AAC5C,QAAItG,aAAatC,IAAIhF,YAAJ,IAAoBsK,mBAArC;AACA;AACA,QAAGhD,UAAH,EAAe;AACbsG,oBAAc,KAAd;AACD;;AAED,QAAIC,6BAA6B,SAA7BA,0BAA6B,GAAW;AAC1C,UAAGzD,OAAO0D,YAAV,EAAwB;AAAA;AAAA;AAAA;;AAAA;AACtB,gCAAuB1D,OAAO0D,YAA9B,mIAA4C;AAAA,gBAApC3B,WAAoC;;AAC1C/B,mBAAOgC,iBAAP,CAAyBD,WAAzB,EAAsC,KAAtC;AACD;AAHqB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIvB;AACF,KAND;;AAQA,QAAGnH,IAAI6H,MAAJ,IAAc7H,IAAI+I,WAArB,EAAkC;AAChCF;AACAzD,aAAO0D,YAAP,GAAsB,EAAtB;AACAvD,qBAAeyD,cAAf;AACD,KAJD,MAIO;AACL,UAAG,CAAC5D,OAAO0D,YAAX,EAAyB;AAAE1D,eAAO0D,YAAP,GAAsB,EAAtB;AAA2B;AACtD,UAAG,CAACxG,UAAJ,EAAgB;AACd8C,eAAO0D,YAAP,CAAoB3M,IAApB,CAAyB6D,GAAzB;AACD;AACD,UAAG4I,eAAexD,OAAO0D,YAAP,CAAoBhS,MAApB,GAA6B,CAA/C,EAAkD;AAChD,YAAIuR,WAAWjD,OAAO6D,mCAAP,EAAf;AACA1D,uBAAe2D,UAAf,CAA0Bb,QAA1B;AACD,OAHD,MAGO;AACLQ;AACAzD,eAAO0D,YAAP,GAAsBxG,aAAa,EAAb,GAAkB,CAACtC,GAAD,CAAxC;AACAuF,uBAAe2D,UAAf,CAA0BlJ,GAA1B;AACD;AACF;;AAED;AACA;AACA;;AAEA,QAAG,CAAC4I,WAAD,IAAgBxD,OAAO+B,WAAvB,IAAsC/B,OAAO+B,WAAP,IAAsBnH,GAA/D,EAAoE;AAClEoF,aAAOgC,iBAAP,CAAyBhC,OAAO+B,WAAhC,EAA6C,KAA7C;AACA/B,aAAO+B,WAAP,CAAmBgC,OAAnB,GAA6B,KAA7B;AACD,KAHD,MAGO,IAAG/D,OAAO+B,WAAP,CAAmBU,MAAnB,IAA6BzC,OAAO+B,WAAP,CAAmB4B,WAAhD,IAA+D3D,OAAO+B,WAAP,CAAmBnM,YAAnB,IAAmCsK,mBAArG,EAA0H;AAC/HF,aAAOgC,iBAAP,CAAyBhC,OAAO+B,WAAhC,EAA6C,KAA7C;AACD;;AAED,QAAG/B,OAAO+B,WAAP,KAAuBnH,GAAvB,IAA8B,CAACA,IAAI6H,MAAnC,IAA6C,CAAC7H,IAAIrG,OAAJ,CAAY2J,WAA7D,EAA0E;AACxEtD,UAAImJ,OAAJ,GAAc,IAAd;AACD;;AAED/D,WAAO+B,WAAP,GAAqBnH,GAArB;AACAoF,WAAOgC,iBAAP,CAAyBpH,GAAzB,EAA8B,IAA9B;AACD,GAnDD;;AAqDAoF,SAAO6D,mCAAP,GAA6C,YAAW;AACtD,QAAIZ,WAAW;AACb5M,YAAM2N,KAAKC,MAAL,EADO;AAEbrO,oBAAc,aAFD;AAGbrB,eAAS;AACPgG,eAAO;AADA;AAHI,KAAf;;AAQA,QAAI2J,WAAWlE,OAAO0D,YAAP,CAAoB7L,GAApB,CAAwB,UAAC+C,GAAD,EAAS;AAAC,aAAOA,IAAIrG,OAAJ,CAAYgG,KAAnB;AAAyB,KAA3D,CAAf;AACA,QAAI6D,YAAY,CAAC,MAAD,EAAS,UAAT,EAAqB,CAAC,OAAD,EAAU,IAAV,EAAgB8F,QAAhB,CAArB,CAAhB;AACAjB,aAAS1O,OAAT,CAAiB6J,SAAjB,GAA6BA,SAA7B;AACA,WAAO6E,QAAP;AACD,GAbD;;AAeAjD,SAAOmE,cAAP,GAAwB,UAASvJ,GAAT,EAAc;AACpCA,QAAIwJ,UAAJ,CAAeC,SAAf,GAA2B,CAACzJ,IAAIwJ,UAAJ,CAAeC,SAA3C;AACA,QAAG,CAACzJ,IAAI6H,MAAR,EAAgB;AACdtC,qBAAemE,QAAf,CAAwB1J,GAAxB;AACD;AACF,GALD;;AAOAoF,SAAOuE,QAAP,GAAkB,UAASjK,IAAT,EAAe;AAC/B6F,mBAAeuC,SAAf,CAAyBpI,IAAzB;AACD,GAFD;;AAIA0F,SAAOgC,iBAAP,GAA2B,UAASpH,GAAT,EAAc4J,QAAd,EAAwB;AACjD5J,QAAI4J,QAAJ,GAAeA,QAAf;AACD,GAFD;;AAIArE,iBAAesE,WAAf,CAA2B,CAAC,KAAD,EAAQvE,mBAAR,CAA3B,EAAyD,UAACwE,OAAD,EAAa;AACpEzE,aAAS,YAAM;AACb,UAAI0E,UAAU3E,OAAOU,SAAP,GAAmBV,OAAOU,SAAP,CAAiBM,OAApC,GAA8C,EAA5D;AACA,UAAI4D,YAAY5E,OAAO6E,cAAP,GAAwB7E,OAAO6E,cAAP,CAAsB7D,OAA9C,GAAwDtQ,WAAWsN,eAAX,EAAxE;AAFa;AAAA;AAAA;;AAAA;AAGb,8BAAe0G,OAAf,mIAAwB;AAAA,cAAhB9J,GAAgB;;AACtB,cAAIsC,aAAatC,IAAIhF,YAAJ,IAAoBsK,mBAArC;AACA,cAAI4E,aAAa5H,aAAa0H,SAAb,GAAyBD,OAA1C;;AAEA,cAAII,WAAWD,WAAWjL,MAAX,CAAkB,UAACmL,YAAD,EAAkB;AACjD,mBAAOA,aAAa3O,IAAb,KAAsBuE,IAAIvE,IAAjC;AACD,WAFc,EAEZ,CAFY,CAAf;;AAIA,cAAG0O,QAAH,EAAa;AACX1U,mBAAOoF,MAAP,CAAcsP,QAAd,EAAwBnK,GAAxB;AACD,WAFD,MAEO,IAAGA,IAAIrG,OAAJ,CAAYgG,KAAf,EAAsB;AAC3BuK,uBAAW/N,IAAX,CAAgB6D,GAAhB;AACD;;AAED,cAAGA,IAAIqK,OAAP,EAAgB;AACd,gBAAIpD,QAAQiD,WAAW7N,OAAX,CAAmB8N,YAAYnK,GAA/B,CAAZ;AACAkK,uBAAWhD,MAAX,CAAkBD,KAAlB,EAAyB,CAAzB;AACD,WAHD,MAGO;AACL,gBAAG7B,OAAOsD,YAAP,IAAuBtD,OAAOsD,YAAP,CAAoBjN,IAApB,IAA4BuE,IAAIvE,IAA1D,EAAiE;AAC/D2J,qBAAOsD,YAAP,GAAsB,IAAtB;AACAtD,qBAAOuD,SAAP,CAAiB3I,GAAjB;AACD,aAHD,MAGO,IAAGmK,YAAY/E,OAAO+B,WAAnB,IAAkC/B,OAAO+B,WAAP,CAAmB1L,IAAnB,IAA2B0O,SAAS1O,IAAzE,EAA+E;AACpF;AACA2J,qBAAOgC,iBAAP,CAAyB+C,QAAzB,EAAmC,IAAnC;AACD;AACF;AACF;AA7BY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA+Bb,UAAG,CAAC/E,OAAOU,SAAX,EAAsB;AACpBV,eAAOU,SAAP,GAAmB;AACjB+B,kBAAQ,IADS;AAEjBlO,mBAAS;AACPgG,mBAAO;AADA,WAFQ;AAKjBiH,wBAAc,KALG;AAMjBnL,gBAAM,GANW;AAOjB+N,sBAAY;AAPK,SAAnB;AASD;;AAED,UAAG,CAACpE,OAAO6E,cAAX,EAA2B;AACzB7E,eAAO6E,cAAP,GAAwB;AACtBpC,kBAAQ,IADc;AAEtBkB,uBAAa,IAFS;AAGtBpP,mBAAS;AACPgG,mBAAO;AADA,WAHa;AAMtBiH,wBAAc,OANQ;AAOtBnL,gBAAM,GAPgB;AAQtB+N,sBAAY;AARU,SAAxB;AAUD;;AAEDpE,aAAOU,SAAP,CAAiBM,OAAjB,GAA2B2D,OAA3B;AACA3E,aAAO6E,cAAP,CAAsB7D,OAAtB,GAAgC4D,SAAhC;;AAEA,UAAG,CAAC5E,OAAO+B,WAAR,IAAwB/B,OAAO+B,WAAP,IAAsB/B,OAAO+B,WAAP,CAAmBU,MAApE,EAA6E;AAC3E,YAAGzC,OAAO+B,WAAP,IAAsB/B,OAAO+B,WAAP,CAAmB4B,WAA5C,EAAyD;AACvD3D,iBAAO+B,WAAP,GAAqB/B,OAAO6E,cAA5B;AACA7E,iBAAOgC,iBAAP,CAAyBhC,OAAOU,SAAhC,EAA2C,KAA3C;AACD,SAHD,MAGO;AACLV,iBAAO+B,WAAP,GAAqB/B,OAAOU,SAA5B;AACAV,iBAAOgC,iBAAP,CAAyBhC,OAAO6E,cAAhC,EAAgD,KAAhD;AACD;AACD7E,eAAOgC,iBAAP,CAAyBhC,OAAO+B,WAAhC,EAA6C,IAA7C;AACD;;AAED,UAAG/B,OAAO+B,WAAP,CAAmBkD,OAAtB,EAA+B;AAC7BjF,eAAOuD,SAAP,CAAiBvD,OAAOU,SAAxB;AACD;;AAEDV,aAAOS,cAAP,CAAsBT,OAAOU,SAA7B;AACAV,aAAOS,cAAP,CAAsBT,OAAO6E,cAA7B;AACD,KA5ED;AA6ED,GA9ED;;AAgFA7E,SAAOkF,SAAP,GAAmB,UAAStK,GAAT,EAAc;AAC/B,QAAIsC,aAAatC,IAAIhF,YAAJ,IAAoBsK,mBAArC;AACA,QAAI4E,aAAa5H,aAAa8C,OAAO6E,cAAP,CAAsB7D,OAAnC,GAA6ChB,OAAOU,SAAP,CAAiBM,OAA/E;;AAEA,QAAIpG,MAAMkK,WAAWjL,MAAX,CAAkB,UAASmL,YAAT,EAAsB;AAChD,aAAOA,aAAa3O,IAAb,KAAsBuE,IAAIvE,IAAjC;AACD,KAFS,EAEP,CAFO,CAAV;;AAIA,QAAI8O,cAAc,EAAlB;;AAEA,aAASC,WAAT,CAAqBxK,GAArB,EAA0B;AACxBuK,kBAAYpO,IAAZ,CAAiB6D,GAAjB;AACA,UAAGA,IAAIuG,QAAP,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACf,iCAAiBvG,IAAIuG,QAArB,wIAA+B;AAAA,gBAAvBoB,KAAuB;;AAC7B6C,wBAAY7C,KAAZ;AACD;AAHc;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIhB;AACF;;AAED6C,gBAAYxK,GAAZ;;AAEAuF,mBAAekF,WAAf,CAA2BF,WAA3B;AACD,GAtBD;AAuBD,C;;AAGH;;;AACArF,SAASwF,WAAT,GAAuB,IAAvB;;AAEA1F,QAAQC,MAAR,CAAe,KAAf,EAAsB0F,UAAtB,CAAiC,UAAjC,EAA6CzF,QAA7C;AACA,CAACF,QACEC,MADF,CACS,KADT,EAEE2F,SAFF,CAEY,aAFZ,EAE2B,CAAC,UAAD,EAAa,UAASvF,QAAT,EAAmB;AACxD,SAAO;AACLwF,cAAU,GADL;AAELC,WAAO;AACLC,mBAAa;AADR,KAFF;AAKLC,UAAO,cAAS5F,MAAT,EAAiB6F,QAAjB,EAA2B;AAChC5F,eAAS,YAAW;AAClB,YAAGD,OAAO2F,WAAV,EAAuB;AACrBE,mBAAS,CAAT,EAAYC,KAAZ;AACD;AACF,OAJD;AAKD;AAXI,GAAP;AAaD,CAdyB,CAF3B;AAiBD,CAAClG,QACEC,MADF,CACS,KADT,EAEE2F,SAFF,CAEY,WAFZ,EAEyB,YAAW;AACnC,SAAQ;AACNE,WAAO;AACLK,aAAO,GADF;AAELC,YAAM,GAFD;AAGLC,mBAAa,GAHR;AAILC,mBAAa;AAJR,KADD;AAONN,UAAM,cAASF,KAAT,EAAgBS,OAAhB,EAAyBC,KAAzB,EAAgC;AACpC;AACA,UAAIC,KAAKF,QAAQ,CAAR,CAAT;;AAEAE,SAAGC,SAAH,GAAeZ,MAAMO,WAArB;;AAEA,UAAIM,UAAU,CAAd;;AAEAF,SAAGG,gBAAH,CACE,WADF,EAEE,UAAS/G,CAAT,EAAY;AACV8G,kBAAU,CAAV;AACA9G,UAAEgH,YAAF,CAAeC,aAAf,GAA+B,MAA/B;AACAjH,UAAEgH,YAAF,CAAe3N,OAAf,CAAuB,OAAvB,EAAgCE,KAAKC,SAAL,CAAeyM,MAAMK,KAArB,CAAhC;AACA,aAAKY,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AACA,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAP,SAAGG,gBAAH,CACE,SADF,EAEE,UAAS/G,CAAT,EAAY;AACV,aAAKkH,SAAL,CAAenO,MAAf,CAAsB,MAAtB;AACA,aAAKmO,SAAL,CAAenO,MAAf,CAAsB,MAAtB;AACA,eAAO,KAAP;AACD,OANH,EAOE,KAPF;;AAUA6N,SAAGG,gBAAH,CACE,UADF,EAEE,UAAS/G,CAAT,EAAY;AACVA,UAAEgH,YAAF,CAAeI,UAAf,GAA4B,MAA5B;AACA;AACA,YAAIpH,EAAEqH,cAAN,EAAsBrH,EAAEqH,cAAF;AACtB,YAAGpB,MAAMQ,WAAT,EAAsB;AAAE,eAAKS,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AAA6B;AACrD,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYAP,SAAGG,gBAAH,CACE,WADF,EAEE,UAAS/G,CAAT,EAAY;AACV8G;AACA,YAAGb,MAAMQ,WAAT,EAAsB;AAAE,eAAKS,SAAL,CAAeC,GAAf,CAAmB,MAAnB;AAA6B;AACrD,eAAO,KAAP;AACD,OANH,EAOE,KAPF;;AAUAP,SAAGG,gBAAH,CACE,WADF,EAEE,UAAS/G,CAAT,EAAY;AACV8G;AACC,YAAIA,YAAY,CAAhB,EAAmB;AACjB,eAAKI,SAAL,CAAenO,MAAf,CAAsB,MAAtB;AACD;AACF,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYA6N,SAAGG,gBAAH,CACE,UADF,EAEE,UAAS/G,CAAT,EAAY;AACV;AACA;AACG,aAAKkH,SAAL,CAAenO,MAAf,CAAsB,MAAtB;AACH;AACA,eAAO,KAAP;AACD,OARH,EASE,KATF;;AAYA6N,SAAGG,gBAAH,CACE,MADF,EAEE,UAAS/G,CAAT,EAAY;;AAEV;AACA8G,kBAAU,CAAV;AACA,YAAI9G,EAAEsH,eAAN,EAAuBtH,EAAEsH,eAAF;;AAEvB,aAAKJ,SAAL,CAAenO,MAAf,CAAsB,MAAtB;;AAEA,YAAI2J,WAAWnJ,KAAK8J,KAAL,CAAWrD,EAAEgH,YAAF,CAAeO,OAAf,CAAuB,OAAvB,CAAX,CAAf;AACA,YAAG7E,aAAauD,MAAMK,KAAtB,EAA6B;AAC3B;AACD;AACDL,cAAMuB,MAAN,CAAa,UAASvB,KAAT,EAAgB;AAC3BA,gBAAMM,IAAN,GAAa7D,QAAb,EAAuBuD,MAAMK,KAA7B;AACD,SAFD;;AAIA,eAAO,KAAP;AACD,OAnBH,EAoBE,KApBF;AAuBD;AA1GK,GAAR;AA4GD,CA/GA;AAgHD;IAAOmB,O;AAEL,qBAAc;AAAA;;AACZ,SAAKzB,QAAL,GAAgB,GAAhB;AACA,SAAK0B,WAAL,GAAmB,0BAAnB;AACA,SAAKzB,KAAL,GAAa;AACX9K,WAAK,GADM;AAEXqH,oBAAc,GAFH;AAGXmF,gBAAU,GAHC;AAIXzE,iBAAW,GAJA;AAKX4B,gBAAU,GALC;AAMXW,iBAAW,GANA;AAOXmC,wBAAkB;AAPP,KAAb;AASD;;;;+BAEUrH,M,EAAQC,Q,EAAU;AAC3B;;AAEAD,aAAOiG,WAAP,GAAqB,YAAW;AAC9B,eAAO,CAACjG,OAAOpF,GAAP,CAAW6H,MAAZ,IAAsBzC,OAAOpF,GAAP,CAAWhF,YAAX,IAA2B,aAAxD;AACD,OAFD;;AAIAoK,aAAOkG,WAAP,GAAqB,YAAW;AAC9B,eAAO,CAAClG,OAAOpF,GAAP,CAAW+I,WAAZ,IAA2B3D,OAAOpF,GAAP,CAAWhF,YAAX,IAA2B,aAA7D;AACD,OAFD;;AAIAoK,aAAOsH,MAAP,GAAgB,UAASpF,QAAT,EAAmBC,QAAnB,EAA6B;AAC3CnC,eAAOiC,YAAP,GAAsBC,QAAtB,EAAgCC,QAAhC;AACD,OAFD;;AAIAnC,aAAOuH,UAAP,GAAoB,UAASC,KAAT,EAAgB,CAEnC,CAFD;;AAIAxH,aAAOyH,WAAP,GAAqB,UAASD,KAAT,EAAgB,CAEpC,CAFD;;AAIAxH,aAAOuD,SAAP,GAAmB,UAASiE,KAAT,EAAgB;AACjC,YAAIhE,cAAcgE,MAAME,OAAN,IAAiBF,MAAMG,OAAzC;AACA3H,eAAOoH,QAAP,GAAkBpH,OAAOpF,GAAzB,EAA8B4I,WAA9B;AACD,OAHD;;AAKAxD,aAAO4H,QAAP,GAAkB,UAASC,MAAT,EAAiBjV,MAAjB,EAAyB;AACzCiV,eAAOd,eAAP;AACA,YAAIe,YAAY,EAAC7L,OAAO,IAAR,EAAcrJ,QAAQA,MAAtB,EAA8B2B,SAAS,EAACgG,OAAO,EAAR,EAAvC,EAAhB;AACA3H,eAAOuO,QAAP,CAAgBE,OAAhB,CAAwByG,SAAxB;AACD,OAJD;;AAMA9H,aAAO+H,UAAP,GAAoB,UAASnN,GAAT,EAAc;AAChC,YAAGA,IAAIrG,OAAJ,CAAYgG,KAAZ,IAAqBK,IAAIrG,OAAJ,CAAYgG,KAAZ,CAAkB7I,MAAlB,GAA2B,CAAnD,EAAsD;AACpDsO,iBAAO2C,SAAP,GAAmB/H,GAAnB;AACD;AACDA,YAAIhI,MAAJ,CAAWuO,QAAX,CAAoBW,MAApB,CAA2BlH,IAAIhI,MAAJ,CAAWuO,QAAX,CAAoBlK,OAApB,CAA4B2D,GAA5B,CAA3B,EAA6D,CAA7D;AACD,OALD;;AAOAoF,aAAOgI,SAAP,GAAmB,UAASpN,GAAT,EAAc;AAC/BoF,eAAOkF,SAAP,GAAmBtK,GAAnB;AACD,OAFD;;AAIAoF,aAAOiI,aAAP,GAAuB,UAASrN,GAAT,EAAc;AACnC,YAAGoF,OAAOqH,gBAAP,EAAH,EAA8B;AAC5BrH,iBAAOqH,gBAAP,GAA0BzM,GAA1B;AACD;AACF,OAJD;;AAMAoF,aAAOkI,aAAP,GAAuB,UAAStN,GAAT,EAAc;AACnC,YAAG,CAACA,IAAI4G,YAAL,IAAqB5G,IAAI4G,YAAJ,CAAiB9P,MAAjB,IAA2B,CAAnD,EAAsD;AACpD;AACAsO,iBAAOkF,SAAP,GAAmBtK,GAAnB;AACA;AACD;AACD,YAAI4F,YAAY,GAAhB;AACA,YAAIlG,OAAO,CAACM,GAAD,CAAX;AACA,YAAIL,KAAJ;AACA,YAAGK,IAAIhI,MAAJ,CAAW6P,MAAd,EAAsB;AACpBlI,kBAAQK,IAAI4G,YAAZ;AACD,SAFD,MAEO;AACLjH,kBAAQK,IAAIhI,MAAJ,CAAW2B,OAAX,CAAmBgG,KAAnB,GAA2BiG,SAA3B,GAAuC5F,IAAI4G,YAAnD;AACD;;AAED5G,YAAIrG,OAAJ,CAAYgG,KAAZ,GAAoBA,KAApB;;AAEA,iBAAS4N,cAAT,CAAwBvN,GAAxB,EAA6B;AAAA;AAAA;AAAA;;AAAA;AAC3B,mCAAiBA,IAAIuG,QAArB,wIAA+B;AAAA,kBAAvBoB,KAAuB;;AAC7BA,oBAAMhO,OAAN,CAAcgG,KAAd,GAAsBgI,MAAM3P,MAAN,CAAa2B,OAAb,CAAqBgG,KAArB,GAA6BiG,SAA7B,GAAyC+B,MAAMf,YAArE;AACAlH,mBAAKvD,IAAL,CAAUwL,KAAV;AACA4F,6BAAe5F,KAAf;AACD;AAL0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAM5B;;AAED4F,uBAAevN,GAAf;;AAEAA,YAAImJ,OAAJ,GAAc,KAAd;;AAEA/D,eAAOuE,QAAP,GAAkBjK,IAAlB;AACD,OA9BD;;AAgCA0F,aAAOoI,gBAAP,GAA0B,UAASxN,GAAT,EAAc;AACtC,YAAIyN,aAAa,CAAjB;AACA,YAAIzV,SAASgI,IAAIhI,MAAjB;AACA,eAAMA,MAAN,EAAc;AACZyV;AACAzV,mBAASA,OAAOA,MAAhB;AACD;;AAED,eAAOyV,UAAP;AACD,OATD;;AAWArI,aAAOsI,iBAAP,GAA2B,UAAS1N,GAAT,EAAc;AACvC,YAAGA,IAAIhF,YAAJ,IAAoB,aAAvB,EAAsC;AACpC,iBAAO,SAAP;AACD;;AAED;AACA,YAAG,CAACgF,IAAIvE,IAAR,EAAc;AACZ,iBAAO,SAAP;AACD;;AAGD,YAAIkS,MAAMvI,OAAOoI,gBAAP,CAAwBxN,GAAxB,CAAV;AACA,YAAI4N,cAAc;AAChB,aAAG,MADa;AAEhB,aAAG,MAFa;AAGhB,aAAG,SAHa;AAIhB,aAAG,QAJa;AAKhB,aAAG;AALa,UAMhBD,GANgB,CAAlB;;AAQA,YAAG,CAACC,WAAJ,EAAiB;AACfA,wBAAc,SAAd;AACD;;AAED;AACA,YAAG5N,IAAIwJ,UAAJ,IAAkBxJ,IAAIwJ,UAAJ,CAAeC,SAApC,EAA+C;AAC7CmE,yBAAe,QAAf;AACD;;AAED,eAAOA,WAAP;AACD,OA9BD;AAgCD;;;;;;AAGHtB,QAAQ5B,WAAR,GAAsB,IAAtB;;AAEA1F,QAAQC,MAAR,CAAe,KAAf,EAAsB2F,SAAtB,CAAgC,SAAhC,EAA2C;AAAA,SAAM,IAAI0B,OAAJ,EAAN;AAAA,CAA3C","file":"app.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SNTheme = exports.SNSmartTag = exports.SNServerExtension = exports.SNMfa = exports.SNEncryptedStorage = exports.SNTag = exports.SNNote = exports.SNExtension = exports.Action = exports.SNEditor = exports.SNComponent = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _standardFileJs = require(\"standard-file-js\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar SNComponent = exports.SNComponent = function (_SFItem) {\n  _inherits(SNComponent, _SFItem);\n\n  function SNComponent(json_obj) {\n    _classCallCheck(this, SNComponent);\n\n    // If making a copy of an existing component (usually during sign in if you have a component active in the session),\n    // which may have window set, you may get a cross-origin exception since you'll be trying to copy the window. So we clear it here.\n    json_obj.window = null;\n\n    var _this = _possibleConstructorReturn(this, (SNComponent.__proto__ || Object.getPrototypeOf(SNComponent)).call(this, json_obj));\n\n    if (!_this.componentData) {\n      _this.componentData = {};\n    }\n\n    if (!_this.disassociatedItemIds) {\n      _this.disassociatedItemIds = [];\n    }\n\n    if (!_this.associatedItemIds) {\n      _this.associatedItemIds = [];\n    }\n    return _this;\n  }\n\n  _createClass(SNComponent, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      /* Legacy */\n      // We don't want to set the url directly, as we'd like to phase it out.\n      // If the content.url exists, we'll transfer it to legacy_url\n      // We'll only need to set this if content.hosted_url is blank, otherwise, hosted_url is the url replacement.\n      if (!content.hosted_url) {\n        this.legacy_url = content.url;\n      }\n\n      /* New */\n      this.local_url = content.local_url;\n      this.hosted_url = content.hosted_url || content.url;\n      this.offlineOnly = content.offlineOnly;\n\n      if (content.valid_until) {\n        this.valid_until = new Date(content.valid_until);\n      }\n\n      this.name = content.name;\n      this.autoupdateDisabled = content.autoupdateDisabled;\n\n      this.package_info = content.package_info;\n\n      // the location in the view this component is located in. Valid values are currently tags-list, note-tags, and editor-stack`\n      this.area = content.area;\n\n      this.permissions = content.permissions;\n      if (!this.permissions) {\n        this.permissions = [];\n      }\n\n      this.active = content.active;\n\n      // custom data that a component can store in itself\n      this.componentData = content.componentData || {};\n\n      // items that have requested a component to be disabled in its context\n      this.disassociatedItemIds = content.disassociatedItemIds || [];\n\n      // items that have requested a component to be enabled in its context\n      this.associatedItemIds = content.associatedItemIds || [];\n    }\n  }, {\n    key: \"handleDeletedContent\",\n    value: function handleDeletedContent() {\n      _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"handleDeletedContent\", this).call(this);\n\n      this.active = false;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        legacy_url: this.legacy_url,\n        hosted_url: this.hosted_url,\n        local_url: this.local_url,\n        valid_until: this.valid_until,\n        offlineOnly: this.offlineOnly,\n        name: this.name,\n        area: this.area,\n        package_info: this.package_info,\n        permissions: this.permissions,\n        active: this.active,\n        autoupdateDisabled: this.autoupdateDisabled,\n        componentData: this.componentData,\n        disassociatedItemIds: this.disassociatedItemIds,\n        associatedItemIds: this.associatedItemIds\n      };\n\n      var superParams = _get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"isEditor\",\n    value: function isEditor() {\n      return this.area == \"editor-editor\";\n    }\n  }, {\n    key: \"isTheme\",\n    value: function isTheme() {\n      return this.content_type == \"SN|Theme\" || this.area == \"themes\";\n    }\n  }, {\n    key: \"isDefaultEditor\",\n    value: function isDefaultEditor() {\n      return this.getAppDataItem(\"defaultEditor\") == true;\n    }\n  }, {\n    key: \"setLastSize\",\n    value: function setLastSize(size) {\n      this.setAppDataItem(\"lastSize\", size);\n    }\n  }, {\n    key: \"getLastSize\",\n    value: function getLastSize() {\n      return this.getAppDataItem(\"lastSize\");\n    }\n  }, {\n    key: \"acceptsThemes\",\n    value: function acceptsThemes() {\n      if (this.content.package_info && \"acceptsThemes\" in this.content.package_info) {\n        return this.content.package_info.acceptsThemes;\n      }\n      return true;\n    }\n\n    /*\n      The key used to look up data that this component may have saved to an item.\n      This key will be look up on the item, and not on itself.\n     */\n\n  }, {\n    key: \"getClientDataKey\",\n    value: function getClientDataKey() {\n      if (this.legacy_url) {\n        return this.legacy_url;\n      } else {\n        return this.uuid;\n      }\n    }\n  }, {\n    key: \"hasValidHostedUrl\",\n    value: function hasValidHostedUrl() {\n      return this.hosted_url || this.legacy_url;\n    }\n  }, {\n    key: \"keysToIgnoreWhenCheckingContentEquality\",\n    value: function keysToIgnoreWhenCheckingContentEquality() {\n      return [\"active\", \"disassociatedItemIds\", \"associatedItemIds\"].concat(_get(SNComponent.prototype.__proto__ || Object.getPrototypeOf(SNComponent.prototype), \"keysToIgnoreWhenCheckingContentEquality\", this).call(this));\n    }\n\n    /*\n      An associative component depends on being explicitly activated for a given item, compared to a dissaciative component,\n      which is enabled by default in areas unrelated to a certain item.\n     */\n\n  }, {\n    key: \"isAssociative\",\n    value: function isAssociative() {\n      return Component.associativeAreas().includes(this.area);\n    }\n  }, {\n    key: \"associateWithItem\",\n    value: function associateWithItem(item) {\n      this.associatedItemIds.push(item.uuid);\n    }\n  }, {\n    key: \"isExplicitlyEnabledForItem\",\n    value: function isExplicitlyEnabledForItem(item) {\n      return this.associatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"isExplicitlyDisabledForItem\",\n    value: function isExplicitlyDisabledForItem(item) {\n      return this.disassociatedItemIds.indexOf(item.uuid) !== -1;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Component\";\n    }\n  }], [{\n    key: \"associativeAreas\",\n    value: function associativeAreas() {\n      return [\"editor-editor\"];\n    }\n  }]);\n\n  return SNComponent;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEditor = exports.SNEditor = function (_SFItem2) {\n  _inherits(SNEditor, _SFItem2);\n\n  function SNEditor(json_obj) {\n    _classCallCheck(this, SNEditor);\n\n    var _this2 = _possibleConstructorReturn(this, (SNEditor.__proto__ || Object.getPrototypeOf(SNEditor)).call(this, json_obj));\n\n    if (!_this2.notes) {\n      _this2.notes = [];\n    }\n    if (!_this2.data) {\n      _this2.data = {};\n    }\n    return _this2;\n  }\n\n  _createClass(SNEditor, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n      this.name = content.name;\n      this.data = content.data || {};\n      this.default = content.default;\n      this.systemEditor = content.systemEditor;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        url: this.url,\n        name: this.name,\n        data: this.data,\n        default: this.default,\n        systemEditor: this.systemEditor\n      };\n\n      var superParams = _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"referenceParams\",\n    value: function referenceParams() {\n      var references = _.map(this.notes, function (note) {\n        return { uuid: note.uuid, content_type: note.content_type };\n      });\n\n      return references;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, item)) {\n          this.notes.push(item);\n        }\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.pull(this.notes, item);\n      }\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeAndDirtyAllRelationships\",\n    value: function removeAndDirtyAllRelationships() {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeAndDirtyAllRelationships\", this).call(this);\n      this.notes = [];\n    }\n  }, {\n    key: \"removeReferencesNotPresentIn\",\n    value: function removeReferencesNotPresentIn(references) {\n      _get(SNEditor.prototype.__proto__ || Object.getPrototypeOf(SNEditor.prototype), \"removeReferencesNotPresentIn\", this).call(this, references);\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(this.notes, { uuid: note.uuid });\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"potentialItemOfInterestHasChangedItsUUID\",\n    value: function potentialItemOfInterestHasChangedItsUUID(newItem, oldUUID, newUUID) {\n      if (newItem.content_type === \"Note\" && _.find(this.notes, { uuid: oldUUID })) {\n        _.remove(this.notes, { uuid: oldUUID });\n        this.notes.push(newItem);\n      }\n    }\n  }, {\n    key: \"setData\",\n    value: function setData(key, value) {\n      var dataHasChanged = JSON.stringify(this.data[key]) !== JSON.stringify(value);\n      if (dataHasChanged) {\n        this.data[key] = value;\n        return true;\n      }\n      return false;\n    }\n  }, {\n    key: \"dataForKey\",\n    value: function dataForKey(key) {\n      return this.data[key] || {};\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Editor\";\n    }\n  }]);\n\n  return SNEditor;\n}(_standardFileJs.SFItem);\n\n;\nvar Action = exports.Action = function Action(json) {\n  _classCallCheck(this, Action);\n\n  _.merge(this, json);\n  this.running = false; // in case running=true was synced with server since model is uploaded nondiscriminatory\n  this.error = false;\n  if (this.lastExecuted) {\n    // is string\n    this.lastExecuted = new Date(this.lastExecuted);\n  }\n};\n\nvar SNExtension = exports.SNExtension = function (_SFItem3) {\n  _inherits(SNExtension, _SFItem3);\n\n  function SNExtension(json) {\n    _classCallCheck(this, SNExtension);\n\n    var _this3 = _possibleConstructorReturn(this, (SNExtension.__proto__ || Object.getPrototypeOf(SNExtension)).call(this, json));\n\n    if (json.actions) {\n      _this3.actions = json.actions.map(function (action) {\n        return new Action(action);\n      });\n    }\n\n    if (!_this3.actions) {\n      _this3.actions = [];\n    }\n    return _this3;\n  }\n\n  _createClass(SNExtension, [{\n    key: \"actionsWithContextForItem\",\n    value: function actionsWithContextForItem(item) {\n      return this.actions.filter(function (action) {\n        return action.context == item.content_type || action.context == \"Item\";\n      });\n    }\n  }, {\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.description = content.description;\n      this.url = content.url;\n      this.name = content.name;\n      this.package_info = content.package_info;\n      this.supported_types = content.supported_types;\n      if (content.actions) {\n        this.actions = content.actions.map(function (action) {\n          return new Action(action);\n        });\n      }\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        name: this.name,\n        url: this.url,\n        package_info: this.package_info,\n        description: this.description,\n        actions: this.actions.map(function (a) {\n          return _.omit(a, [\"subrows\", \"subactions\"]);\n        }),\n        supported_types: this.supported_types\n      };\n\n      var superParams = _get(SNExtension.prototype.__proto__ || Object.getPrototypeOf(SNExtension.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Extension\";\n    }\n  }]);\n\n  return SNExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNNote = exports.SNNote = function (_SFItem4) {\n  _inherits(SNNote, _SFItem4);\n\n  function SNNote(json_obj) {\n    _classCallCheck(this, SNNote);\n\n    var _this4 = _possibleConstructorReturn(this, (SNNote.__proto__ || Object.getPrototypeOf(SNNote)).call(this, json_obj));\n\n    if (!_this4.text) {\n      // Some external editors can't handle a null value for text.\n      // Notes created on mobile with no text have a null value for it,\n      // so we'll just set a default here.\n      _this4.text = \"\";\n    }\n\n    if (!_this4.tags) {\n      _this4.tags = [];\n    }\n    return _this4;\n  }\n\n  _createClass(SNNote, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n      this.text = content.text;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title,\n        text: this.text\n      };\n\n      var superParams = _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      /*\n      Legacy.\n      Previously, note/tag relationships were bidirectional, however in some cases there\n      may be broken links such that a note has references to a tag and not vice versa.\n      Now, only tags contain references to notes. For old notes that may have references to tags,\n      we want to transfer them over to the tag.\n       */\n      if (item.content_type == \"Tag\") {\n        item.addItemAsRelationship(this);\n      }\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"setIsBeingReferencedBy\",\n    value: function setIsBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"setIsNoLongerBeingReferencedBy\",\n    value: function setIsNoLongerBeingReferencedBy(item) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"setIsNoLongerBeingReferencedBy\", this).call(this, item);\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      this.tags.forEach(function (tag) {\n        _.remove(tag.notes, { uuid: this.uuid });\n      }.bind(this));\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      _get(SNNote.prototype.__proto__ || Object.getPrototypeOf(SNNote.prototype), \"informReferencesOfUUIDChange\", this).call(this);\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = this.tags[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var tag = _step.value;\n\n          _.remove(tag.notes, { uuid: oldUUID });\n          tag.notes.push(this);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"tagDidFinishSyncing\",\n    value: function tagDidFinishSyncing(tag) {\n      this.clearSavedTagsString();\n    }\n  }, {\n    key: \"safeText\",\n    value: function safeText() {\n      return this.text || \"\";\n    }\n  }, {\n    key: \"safeTitle\",\n    value: function safeTitle() {\n      return this.title || \"\";\n    }\n  }, {\n    key: \"clearSavedTagsString\",\n    value: function clearSavedTagsString() {\n      this.savedTagsString = null;\n    }\n  }, {\n    key: \"tagsString\",\n    value: function tagsString() {\n      this.savedTagsString = SNTag.arrayToDisplayString(this.tags);\n      return this.savedTagsString;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"Note\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Note\";\n    }\n  }], [{\n    key: \"filterDummyNotes\",\n    value: function filterDummyNotes(notes) {\n      var filtered = notes.filter(function (note) {\n        return note.dummy == false || note.dummy == null;\n      });\n      return filtered;\n    }\n  }]);\n\n  return SNNote;\n}(_standardFileJs.SFItem);\n\n;\nvar SNTag = exports.SNTag = function (_SFItem5) {\n  _inherits(SNTag, _SFItem5);\n\n  function SNTag(json_obj) {\n    _classCallCheck(this, SNTag);\n\n    var _this5 = _possibleConstructorReturn(this, (SNTag.__proto__ || Object.getPrototypeOf(SNTag)).call(this, json_obj));\n\n    if (!_this5.content_type) {\n      _this5.content_type = \"Tag\";\n    }\n\n    if (!_this5.notes) {\n      _this5.notes = [];\n    }\n    return _this5;\n  }\n\n  _createClass(SNTag, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.title = content.title;\n    }\n  }, {\n    key: \"structureParams\",\n    value: function structureParams() {\n      var params = {\n        title: this.title\n      };\n\n      var superParams = _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"structureParams\", this).call(this);\n      Object.assign(superParams, params);\n      return superParams;\n    }\n  }, {\n    key: \"addItemAsRelationship\",\n    value: function addItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        if (!_.find(this.notes, { uuid: item.uuid })) {\n          this.notes.push(item);\n          item.tags.push(this);\n        }\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"addItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"removeItemAsRelationship\",\n    value: function removeItemAsRelationship(item) {\n      if (item.content_type == \"Note\") {\n        _.remove(this.notes, { uuid: item.uuid });\n        _.remove(item.tags, { uuid: this.uuid });\n      }\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"removeItemAsRelationship\", this).call(this, item);\n    }\n  }, {\n    key: \"updateLocalRelationships\",\n    value: function updateLocalRelationships() {\n      var references = this.content.references;\n\n      var uuids = references.map(function (ref) {\n        return ref.uuid;\n      });\n      this.notes.slice().forEach(function (note) {\n        if (!uuids.includes(note.uuid)) {\n          _.remove(note.tags, { uuid: this.uuid });\n          _.remove(this.notes, { uuid: note.uuid });\n\n          note.setIsNoLongerBeingReferencedBy(this);\n        }\n      }.bind(this));\n    }\n  }, {\n    key: \"isBeingRemovedLocally\",\n    value: function isBeingRemovedLocally() {\n      var _this6 = this;\n\n      this.notes.forEach(function (note) {\n        _.remove(note.tags, { uuid: _this6.uuid });\n        note.setIsNoLongerBeingReferencedBy(_this6);\n      });\n\n      this.notes.length = 0;\n\n      _get(SNTag.prototype.__proto__ || Object.getPrototypeOf(SNTag.prototype), \"isBeingRemovedLocally\", this).call(this);\n    }\n  }, {\n    key: \"informReferencesOfUUIDChange\",\n    value: function informReferencesOfUUIDChange(oldUUID, newUUID) {\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = this.notes[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var note = _step2.value;\n\n          _.remove(note.tags, { uuid: oldUUID });\n          note.tags.push(this);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"didFinishSyncing\",\n    value: function didFinishSyncing() {\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = this.notes[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var note = _step3.value;\n\n          note.tagDidFinishSyncing(this);\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n    }\n  }, {\n    key: \"isSmartTag\",\n    value: function isSmartTag() {\n      return this.content_type == \"SN|SmartTag\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Tag\";\n    }\n  }], [{\n    key: \"arrayToDisplayString\",\n    value: function arrayToDisplayString(tags) {\n      return tags.sort(function (a, b) {\n        return a.title > b.title;\n      }).map(function (tag, i) {\n        return \"#\" + tag.title;\n      }).join(\" \");\n    }\n  }]);\n\n  return SNTag;\n}(_standardFileJs.SFItem);\n\n;\nvar SNEncryptedStorage = exports.SNEncryptedStorage = function (_SFItem6) {\n  _inherits(SNEncryptedStorage, _SFItem6);\n\n  function SNEncryptedStorage() {\n    _classCallCheck(this, SNEncryptedStorage);\n\n    return _possibleConstructorReturn(this, (SNEncryptedStorage.__proto__ || Object.getPrototypeOf(SNEncryptedStorage)).apply(this, arguments));\n  }\n\n  _createClass(SNEncryptedStorage, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNEncryptedStorage.prototype.__proto__ || Object.getPrototypeOf(SNEncryptedStorage.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.storage = content.storage;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|EncryptedStorage\";\n    }\n  }]);\n\n  return SNEncryptedStorage;\n}(_standardFileJs.SFItem);\n\n;\nvar SNMfa = exports.SNMfa = function (_SFItem7) {\n  _inherits(SNMfa, _SFItem7);\n\n  function SNMfa(json_obj) {\n    _classCallCheck(this, SNMfa);\n\n    return _possibleConstructorReturn(this, (SNMfa.__proto__ || Object.getPrototypeOf(SNMfa)).call(this, json_obj));\n  }\n\n  // mapContentToLocalProperties(content) {\n  //   super.mapContentToLocalProperties(content)\n  //   this.serverContent = content;\n  // }\n  //\n  // structureParams() {\n  //   return _.merge(this.serverContent, super.structureParams());\n  // }\n\n  _createClass(SNMfa, [{\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|MFA\";\n    }\n  }]);\n\n  return SNMfa;\n}(_standardFileJs.SFItem);\n\n;\nvar SNServerExtension = exports.SNServerExtension = function (_SFItem8) {\n  _inherits(SNServerExtension, _SFItem8);\n\n  function SNServerExtension() {\n    _classCallCheck(this, SNServerExtension);\n\n    return _possibleConstructorReturn(this, (SNServerExtension.__proto__ || Object.getPrototypeOf(SNServerExtension)).apply(this, arguments));\n  }\n\n  _createClass(SNServerExtension, [{\n    key: \"mapContentToLocalProperties\",\n    value: function mapContentToLocalProperties(content) {\n      _get(SNServerExtension.prototype.__proto__ || Object.getPrototypeOf(SNServerExtension.prototype), \"mapContentToLocalProperties\", this).call(this, content);\n      this.url = content.url;\n    }\n  }, {\n    key: \"doNotEncrypt\",\n    value: function doNotEncrypt() {\n      return true;\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SF|Extension\";\n    }\n  }]);\n\n  return SNServerExtension;\n}(_standardFileJs.SFItem);\n\n;\nvar SNSmartTag = exports.SNSmartTag = function (_SNTag) {\n  _inherits(SNSmartTag, _SNTag);\n\n  function SNSmartTag(json_ob) {\n    _classCallCheck(this, SNSmartTag);\n\n    var _this10 = _possibleConstructorReturn(this, (SNSmartTag.__proto__ || Object.getPrototypeOf(SNSmartTag)).call(this, json_ob));\n\n    _this10.content_type = \"SN|SmartTag\";\n    return _this10;\n  }\n\n  _createClass(SNSmartTag, null, [{\n    key: \"systemSmartTags\",\n    value: function systemSmartTags() {\n      return [new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdAllNotes,\n        content: {\n          title: \"All notes\",\n          isSystemTag: true,\n          isAllTag: true,\n          predicate: new SFPredicate.fromArray([\"content_type\", \"=\", \"Note\"])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdArchivedNotes,\n        content: {\n          title: \"Archived\",\n          isSystemTag: true,\n          isArchiveTag: true,\n          predicate: new SFPredicate.fromArray([\"archived\", \"=\", true])\n        }\n      }), new SNSmartTag({\n        uuid: SNSmartTag.SystemSmartTagIdTrashedNotes,\n        content: {\n          title: \"Trash\",\n          isSystemTag: true,\n          isTrashTag: true,\n          predicate: new SFPredicate.fromArray([\"content.trashed\", \"=\", true])\n        }\n      })];\n    }\n  }]);\n\n  return SNSmartTag;\n}(SNTag);\n\nSNSmartTag.SystemSmartTagIdAllNotes = \"all-notes\";\nSNSmartTag.SystemSmartTagIdArchivedNotes = \"archived-notes\";\nSNSmartTag.SystemSmartTagIdTrashedNotes = \"trashed-notes\";\n;\nvar SNTheme = exports.SNTheme = function (_SNComponent) {\n  _inherits(SNTheme, _SNComponent);\n\n  function SNTheme(json_obj) {\n    _classCallCheck(this, SNTheme);\n\n    var _this11 = _possibleConstructorReturn(this, (SNTheme.__proto__ || Object.getPrototypeOf(SNTheme)).call(this, json_obj));\n\n    _this11.area = \"themes\";\n    return _this11;\n  }\n\n  _createClass(SNTheme, [{\n    key: \"isLayerable\",\n    value: function isLayerable() {\n      return this.package_info && this.package_info.layerable;\n    }\n  }, {\n    key: \"setMobileRules\",\n    value: function setMobileRules(rules) {\n      this.setAppDataItem(\"mobileRules\", rules);\n    }\n  }, {\n    key: \"getMobileRules\",\n    value: function getMobileRules() {\n      return this.getAppDataItem(\"mobileRules\") || { constants: {}, rules: {} };\n    }\n\n    // Same as getMobileRules but without default value\n\n  }, {\n    key: \"hasMobileRules\",\n    value: function hasMobileRules() {\n      return this.getAppDataItem(\"mobileRules\");\n    }\n  }, {\n    key: \"setNotAvailOnMobile\",\n    value: function setNotAvailOnMobile(na) {\n      this.setAppDataItem(\"notAvailableOnMobile\", na);\n    }\n  }, {\n    key: \"getNotAvailOnMobile\",\n    value: function getNotAvailOnMobile() {\n      return this.getAppDataItem(\"notAvailableOnMobile\");\n    }\n\n    /* We must not use .active because if you set that to true, it will also activate that theme on desktop/web */\n\n  }, {\n    key: \"setMobileActive\",\n    value: function setMobileActive(active) {\n      this.setAppDataItem(\"mobileActive\", active);\n    }\n  }, {\n    key: \"isMobileActive\",\n    value: function isMobileActive() {\n      return this.getAppDataItem(\"mobileActive\");\n    }\n  }, {\n    key: \"content_type\",\n    get: function get() {\n      return \"SN|Theme\";\n    }\n  }, {\n    key: \"displayName\",\n    get: function get() {\n      return \"Theme\";\n    }\n  }]);\n\n  return SNTheme;\n}(SNComponent);\n\n;\n\nif (typeof window !== 'undefined' && window !== null) {\n  // window is for some reason defined in React Native, but throws an exception when you try to set to it\n  try {\n    window.SNNote = SNNote;\n    window.SNTag = SNTag;\n    window.SNSmartTag = SNSmartTag;\n    window.SNMfa = SNMfa;\n    window.SNServerExtension = SNServerExtension;\n    window.SNComponent = SNComponent;\n    window.SNEditor = SNEditor;\n    window.SNExtension = SNExtension;\n    window.SNTheme = SNTheme;\n    window.SNEncryptedStorage = SNEncryptedStorage;\n  } catch (e) {\n    console.log(\"Exception while exporting sn-models window variables\", e);\n  }\n}\n//# sourceMappingURL=transpiled.js.map\n;'use strict';\n\nangular.module('app', [\n\n])\n;class HomeCtrl {\n  constructor($rootScope, $scope, $timeout) {\n\n    let smartTagContentType = \"SN|SmartTag\";\n\n    let componentRelay = new ComponentRelay({\n      targetWindow: window,\n      onReady: () => {\n        $rootScope.platform = componentRelay.platform;\n      }\n    });\n\n    let delimiter = \".\";\n\n    $scope.resolveRawTags = function(masterTag) {\n      let sortTags = (tags) => {\n        return tags.sort((a, b) => {\n          const aTitle = a.content.title.toLowerCase(), bTitle = b.content.title.toLowerCase();\n          return (aTitle > bTitle) - (aTitle < bTitle);\n        });\n      }\n      var resolved = masterTag.rawTags.slice();\n\n      var findResolvedTag = function(title) {\n        for(var tag of masterTag.rawTags) {\n          if(tag.content.title === title) {\n            return tag;\n          }\n        }\n        return null;\n      }\n\n      for(var tag of masterTag.rawTags) {\n        var pendingDummy = tag.children && tag.children.find((c) => {return c.dummy});\n        tag.children = [];\n        tag.parent = null;\n\n        if(pendingDummy) {\n          tag.children.unshift(pendingDummy);\n        }\n      };\n\n      for(var tag of masterTag.rawTags) {\n        var name = tag.content.title;\n        var comps = name.split(delimiter);\n        tag.displayTitle = comps[comps.length -1];\n        if(comps.length == 1) {\n          tag.parent = masterTag;\n          continue;\n        }\n\n        var getParent = function(depth = 1) {\n          var parentTitle = comps.slice(0, comps.length - depth).join(delimiter);\n          if(parentTitle.length == 0) {\n            return null;\n          }\n          var parent = findResolvedTag(parentTitle);\n\n          // didn't find parent, try again.\n          // just make sure we're not deeper in search than we can go\n          if(!parent && depth < comps.length - 1) {\n            return getParent(depth + 1);\n          }\n\n          // remove parent from name and keep this full tag name to display\n          var tagTitle = tag.content.title.slice(parentTitle.length+1);\n          tag.displayTitle = tagTitle;\n\n          return parent;\n        };\n\n        var parent = getParent();\n\n        // no parent at all up the tree, fall back to root with full name\n        if(!parent) {\n          tag.displayTitle = tag.content.title;\n          tag.parent = masterTag;\n          continue;\n        }\n\n        parent.children.push(tag);\n        parent.children = sortTags(parent.children);\n        tag.parent = parent;\n\n        // remove chid from master list\n        var index = resolved.indexOf(tag);\n        resolved.splice(index, 1);\n\n        if($scope.selectedTag && $scope.selectedTag.uuid == tag.uuid) {\n          $scope.selectedTag = tag;\n          $scope.setSelectedForTag(tag, true);\n        }\n      }\n\n      var pendingDummy = masterTag.children && masterTag.children.find((c) => {return c.dummy});\n      masterTag.children = sortTags(resolved);\n      if(pendingDummy) { masterTag.children.unshift(pendingDummy); }\n    }\n\n    $scope.changeParent = function(sourceId, targetId) {\n      var source = $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === sourceId;\n      })[0];\n\n      var target = targetId === \"0\" ? $scope.masterTag : $scope.masterTag.rawTags.filter(function(tag){\n        return tag.uuid === targetId;\n      })[0];\n\n      if(target.parent === source) {\n        return;\n      }\n\n      var needsSave = [source];\n\n      var adjustChildren = function(source) {\n        for(var child of source.children) {\n          var newTitle = source.content.title + delimiter + child.content.title.split(delimiter).slice(-1)[0];\n          child.content.title = newTitle;\n          needsSave.push(child);\n          adjustChildren(child);\n        }\n      }\n\n      var newTitle;\n      if(target.master) {\n        newTitle = source.content.title.split(delimiter).slice(-1)[0];\n      } else {\n        newTitle = target.content.title + delimiter + source.content.title.split(delimiter).slice(-1)[0];\n      }\n      source.content.title = newTitle;\n      adjustChildren(source);\n      $scope.resolveRawTags($scope.masterTag);\n\n      componentRelay.saveItems(needsSave);\n    }\n\n    $scope.createTag = function(tag) {\n      var title = tag.content.title;\n      if(title.startsWith(\"![\")) {\n        /*\n        Create smart tag. Examples:\n        ![\"Not Pinned\", \"pinned\", \"=\", false]\n        ![\"Last Day\", \"updated_at\", \">\", \"1.days.ago\"]\n        ![\"Long\", \"text.length\", \">\", 500]\n        */\n        try {\n          var components = JSON.parse(title.substring(1, title.length));\n        } catch (e) {\n          alert(\"There was an error parsing your smart tag syntax. Please ensure the value after the exclamation mark is valid JSON, and try again.\")\n          return;\n        }\n        var smartTag = {\n          content_type: smartTagContentType,\n          content: {\n            title: components[0],\n            predicate: {\n              keypath: components[1],\n              operator: components[2],\n              value: components[3]\n            }\n          }\n        }\n        componentRelay.createItem(smartTag, (createdTag) => {\n          // We don't want to select the tag right away because it hasn't been added yet.\n          // If you do $scope.selectTag(createdTag), an issue occurs where selecting another tag\n          // after that will not dehighlight this one.\n          $scope.selectOnLoad = createdTag;\n        });\n      } else {\n        tag.content_type = \"Tag\";\n        var title;\n        if(tag.parent.master) {\n          title = tag.content.title;\n        } else {\n          title = tag.parent.content.title + delimiter + tag.content.title;\n        }\n        tag.content.title = title;\n        tag.dummy = false;\n        componentRelay.createItem(tag, (createdTag) => {\n          $scope.selectOnLoad = createdTag;\n        });\n      }\n    }\n\n    $scope.selectTag = function(tag, multiSelect) {\n      let isSmartTag = tag.content_type == smartTagContentType;\n      // Multi selection for smart tags is not possible.\n      if(isSmartTag) {\n        multiSelect = false;\n      }\n\n      let clearMultipleTagsSelection = function() {\n        if($scope.multipleTags) {\n          for(var selectedTag of $scope.multipleTags) {\n            $scope.setSelectedForTag(selectedTag, false);\n          }\n        }\n      }\n\n      if(tag.master || tag.smartMaster) {\n        clearMultipleTagsSelection();\n        $scope.multipleTags = [];\n        componentRelay.clearSelection();\n      } else {\n        if(!$scope.multipleTags) { $scope.multipleTags = []; }\n        if(!isSmartTag) {\n          $scope.multipleTags.push(tag);\n        }\n        if(multiSelect && $scope.multipleTags.length > 1) {\n          var smartTag = $scope.createEphemeralSmartTagForMultiTags();\n          componentRelay.selectItem(smartTag);\n        } else {\n          clearMultipleTagsSelection();\n          $scope.multipleTags = isSmartTag ? [] : [tag];\n          componentRelay.selectItem(tag);\n        }\n      }\n\n      // if multiselect, we don't want to clear selected tag. But if master is selected,\n      // and multi select other tag, we do want to clear master. Rather than creating a large if\n      // statement, we'll just an if else.\n\n      if(!multiSelect && $scope.selectedTag && $scope.selectedTag != tag) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n        $scope.selectedTag.editing = false;\n      } else if($scope.selectedTag.master || $scope.selectedTag.smartMaster || $scope.selectedTag.content_type == smartTagContentType) {\n        $scope.setSelectedForTag($scope.selectedTag, false);\n      }\n\n      if($scope.selectedTag === tag && !tag.master && !tag.content.isSystemTag) {\n        tag.editing = true;\n      }\n\n      $scope.selectedTag = tag;\n      $scope.setSelectedForTag(tag, true);\n    }\n\n    $scope.createEphemeralSmartTagForMultiTags = function() {\n      let smartTag = {\n        uuid: Math.random(),\n        content_type: \"SN|SmartTag\",\n        content: {\n          title: \"Multiple tags\"\n        }\n      }\n\n      var tagNames = $scope.multipleTags.map((tag) => {return tag.content.title});\n      var predicate = [\"tags\", \"includes\", [\"title\", \"in\", tagNames]];\n      smartTag.content.predicate = predicate;\n      return smartTag;\n    }\n\n    $scope.toggleCollapse = function(tag) {\n      tag.clientData.collapsed = !tag.clientData.collapsed;\n      if(!tag.master) {\n        componentRelay.saveItem(tag);\n      }\n    }\n\n    $scope.saveTags = function(tags) {\n      componentRelay.saveItems(tags);\n    }\n\n    $scope.setSelectedForTag = function(tag, selected) {\n      tag.selected = selected;\n    }\n\n    componentRelay.streamItems([\"Tag\", smartTagContentType], (newTags) => {\n      $timeout(() => {\n        var allTags = $scope.masterTag ? $scope.masterTag.rawTags : [];\n        var smartTags = $scope.smartMasterTag ? $scope.smartMasterTag.rawTags : SNSmartTag.systemSmartTags();\n        for(var tag of newTags) {\n          var isSmartTag = tag.content_type == smartTagContentType;\n          var arrayToUse = isSmartTag ? smartTags : allTags;\n\n          var existing = arrayToUse.filter((tagCandidate) => {\n            return tagCandidate.uuid === tag.uuid;\n          })[0];\n\n          if(existing) {\n            Object.assign(existing, tag);\n          } else if(tag.content.title) {\n            arrayToUse.push(tag);\n          }\n\n          if(tag.deleted) {\n            var index = arrayToUse.indexOf(existing || tag);\n            arrayToUse.splice(index, 1);\n          } else {\n            if($scope.selectOnLoad && $scope.selectOnLoad.uuid == tag.uuid)  {\n              $scope.selectOnLoad = null;\n              $scope.selectTag(tag);\n            } else if(existing && $scope.selectedTag && $scope.selectedTag.uuid == existing.uuid) {\n              // Don't call $scope.selectTag(existing) as this will double select a tag, which will enable editing for it.\n              $scope.setSelectedForTag(existing, true);\n            }\n          }\n        }\n\n        if(!$scope.masterTag) {\n          $scope.masterTag = {\n            master: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"All\",\n            uuid: \"0\",\n            clientData: {}\n          }\n        }\n\n        if(!$scope.smartMasterTag) {\n          $scope.smartMasterTag = {\n            master: true,\n            smartMaster: true,\n            content: {\n              title: \"\"\n            },\n            displayTitle: \"Views\",\n            uuid: \"1\",\n            clientData: {}\n          }\n        }\n\n        $scope.masterTag.rawTags = allTags;\n        $scope.smartMasterTag.rawTags = smartTags;\n\n        if(!$scope.selectedTag || ($scope.selectedTag && $scope.selectedTag.master)) {\n          if($scope.selectedTag && $scope.selectedTag.smartMaster) {\n            $scope.selectedTag = $scope.smartMasterTag;\n            $scope.setSelectedForTag($scope.masterTag, false);\n          } else {\n            $scope.selectedTag = $scope.masterTag;\n            $scope.setSelectedForTag($scope.smartMasterTag, false);\n          }\n          $scope.setSelectedForTag($scope.selectedTag, true);\n        }\n\n        if($scope.selectedTag.deleted) {\n          $scope.selectTag($scope.masterTag);\n        }\n\n        $scope.resolveRawTags($scope.masterTag);\n        $scope.resolveRawTags($scope.smartMasterTag);\n      })\n    });\n\n    $scope.deleteTag = function(tag) {\n      var isSmartTag = tag.content_type == smartTagContentType;\n      var arrayToUse = isSmartTag ? $scope.smartMasterTag.rawTags : $scope.masterTag.rawTags;\n\n      var tag = arrayToUse.filter(function(tagCandidate){\n        return tagCandidate.uuid === tag.uuid;\n      })[0];\n\n      var deleteChain = [];\n\n      function addChildren(tag) {\n        deleteChain.push(tag);\n        if(tag.children) {\n          for(var child of tag.children) {\n            addChildren(child);\n          }\n        }\n      }\n\n      addChildren(tag);\n\n      componentRelay.deleteItems(deleteChain);\n    }\n  }\n}\n\n// required for firefox\nHomeCtrl.$$ngIsClass = true;\n\nangular.module('app').controller('HomeCtrl', HomeCtrl);\n;angular\n  .module('app')\n  .directive('mbAutofocus', ['$timeout', function($timeout) {\n    return {\n      restrict: 'A',\n      scope: {\n        shouldFocus: \"=\"\n      },\n      link : function($scope, $element) {\n        $timeout(function() {\n          if($scope.shouldFocus) {\n            $element[0].focus();\n          }\n        });\n      }\n    }\n  }]);\n;angular\n  .module('app')\n  .directive('draggable', function() {\n  return  {\n    scope: {\n      tagId: \"=\",\n      drop: '&',\n      isDraggable: \"=\",\n      isDroppable: \"=\"\n    },\n    link: function(scope, element, attrs) {\n      // 'ngInject';\n      var el = element[0];\n\n      el.draggable = scope.isDraggable;\n\n      var counter = 0;\n\n      el.addEventListener(\n        'dragstart',\n        function(e) {\n          counter = 0;\n          e.dataTransfer.effectAllowed = 'move';\n          e.dataTransfer.setData('TagId', JSON.stringify(scope.tagId));\n          this.classList.add('drag');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragend',\n        function(e) {\n          this.classList.remove('drag');\n          this.classList.remove('over');\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragover',\n        function(e) {\n          e.dataTransfer.dropEffect = 'move';\n          // allows us to drop\n          if (e.preventDefault) e.preventDefault();\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragenter',\n        function(e) {\n          counter++;\n          if(scope.isDroppable) { this.classList.add('over'); }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragleave',\n        function(e) {\n          counter--;\n           if (counter === 0) {\n             this.classList.remove('over');\n           }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'dragexit',\n        function(e) {\n          // counter--;\n          //  if (counter === 0) {\n             this.classList.remove('over');\n          //  }\n          return false;\n        },\n        false\n      );\n\n      el.addEventListener(\n        'drop',\n        function(e) {\n\n          // Stops some browsers from redirecting.\n          counter = 0;\n          if (e.stopPropagation) e.stopPropagation();\n\n          this.classList.remove('over');\n\n          var targetId = JSON.parse(e.dataTransfer.getData('TagId'));\n          if(targetId === scope.tagId) {\n            return;\n          }\n          scope.$apply(function(scope) {\n            scope.drop()(targetId, scope.tagId);\n          });\n\n          return false;\n        },\n        false\n      );\n\n    }\n  }\n});\n;class TagTree {\n\n  constructor() {\n    this.restrict = \"C\";\n    this.templateUrl = \"directives/tag_tree.html\";\n    this.scope = {\n      tag: \"=\",\n      changeParent: \"&\",\n      onSelect: \"&\",\n      createTag: \"&\",\n      saveTags: \"&\",\n      deleteTag: \"&\",\n      onToggleCollapse: \"&\"\n    };\n  }\n\n  controller($scope, $timeout) {\n    'ngInject';\n\n    $scope.isDraggable = function() {\n      return !$scope.tag.master && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.isDroppable = function() {\n      return !$scope.tag.smartMaster && $scope.tag.content_type != 'SN|SmartTag';\n    }\n\n    $scope.onDrop = function(sourceId, targetId) {\n      $scope.changeParent()(sourceId, targetId);\n    }\n\n    $scope.onDragOver = function(event) {\n\n    }\n\n    $scope.onDragStart = function(event) {\n\n    }\n\n    $scope.selectTag = function(event) {\n      let multiSelect = event.ctrlKey || event.metaKey;\n      $scope.onSelect()($scope.tag, multiSelect);\n    }\n\n    $scope.addChild = function($event, parent) {\n      $event.stopPropagation();\n      var addingTag = {dummy: true, parent: parent, content: {title: \"\"}};\n      parent.children.unshift(addingTag);\n    }\n\n    $scope.saveNewTag = function(tag) {\n      if(tag.content.title && tag.content.title.length > 0) {\n        $scope.createTag()(tag);\n      }\n      tag.parent.children.splice(tag.parent.children.indexOf(tag), 1);\n    }\n\n    $scope.removeTag = function(tag) {\n      $scope.deleteTag()(tag);\n    }\n\n    $scope.innerCollapse = function(tag) {\n      if($scope.onToggleCollapse()) {\n        $scope.onToggleCollapse()(tag);\n      }\n    }\n\n    $scope.saveTagRename = function(tag) {\n      if(!tag.displayTitle || tag.displayTitle.length == 0) {\n        // Delete\n        $scope.deleteTag()(tag);\n        return;\n      }\n      var delimiter = \".\";\n      var tags = [tag];\n      var title;\n      if(tag.parent.master) {\n        title = tag.displayTitle;\n      } else {\n        title = tag.parent.content.title + delimiter + tag.displayTitle;\n      }\n\n      tag.content.title = title;\n\n      function renameChildren(tag) {\n        for(var child of tag.children) {\n          child.content.title = child.parent.content.title + delimiter + child.displayTitle;\n          tags.push(child);\n          renameChildren(child);\n        }\n      }\n\n      renameChildren(tag);\n\n      tag.editing = false;\n\n      $scope.saveTags()(tags);\n    }\n\n    $scope.generationForTag = function(tag) {\n      var generation = 0;\n      var parent = tag.parent;\n      while(parent) {\n        generation++;\n        parent = parent.parent;\n      }\n\n      return generation;\n    }\n\n    $scope.circleClassForTag = function(tag) {\n      if(tag.content_type == \"SN|SmartTag\") {\n        return \"success\";\n      }\n\n      // is newly creating tag\n      if(!tag.uuid) {\n        return \"neutral\";\n      }\n\n\n      let gen = $scope.generationForTag(tag);\n      var circleClass = {\n        0: \"info\",\n        1: \"info\",\n        2: \"success\",\n        3: \"danger\",\n        4: \"warning\",\n      }[gen];\n\n      if(!circleClass) {\n        circleClass = \"neutral\";\n      }\n\n      // Newly creating tags don't have client data\n      if(tag.clientData && tag.clientData.collapsed) {\n        circleClass += \" no-bg\";\n      }\n\n      return circleClass;\n    }\n\n  }\n}\n\nTagTree.$$ngIsClass = true;\n\nangular.module('app').directive('tagTree', () => new TagTree);\n"]}