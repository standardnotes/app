{"version":3,"file":"app.js","names":["document","addEventListener","event","editor","getElementById","workingNote","componentRelay","ComponentRelay","targetWindow","window","onReady","platform","body","classList","add","streamContextItem","note","isMetadataUpdate","value","content","text","upmath","updateText","setAttribute","JSON","stringify","spellcheck","strip","html","tmp","implementation","createHTMLDocument","innerHTML","textContent","innerText","truncateString","string","limit","length","substring","saveItemWithPresave","getHTML","strippedHtml","preview_plain","preview_html","shiftKey","which","preventDefault","execCommand","start","selectionStart","end","selectionEnd","spaces"],"sources":["app.js"],"sourcesContent":["document.addEventListener('DOMContentLoaded', function (event) {\n  const editor = document.getElementById('editor-source')\n\n  let workingNote\n\n  const componentRelay = new ComponentRelay({\n    targetWindow: window,\n    onReady: () => {\n      const platform = componentRelay.platform\n      if (platform) {\n        document.body.classList.add(platform)\n      }\n    },\n  })\n\n  componentRelay.streamContextItem((note) => {\n    workingNote = note\n\n    // Only update UI on non-metadata updates.\n    if (note.isMetadataUpdate) {\n      return\n    }\n\n    editor.value = note.content.text\n    window.upmath.updateText()\n\n    editor.setAttribute('spellcheck', JSON.stringify(workingNote.content.spellcheck))\n  })\n\n  editor.addEventListener('input', function (event) {\n    const text = editor.value || ''\n\n    function strip(html) {\n      const tmp = document.implementation.createHTMLDocument('New').body\n      tmp.innerHTML = html\n      return tmp.textContent || tmp.innerText || ''\n    }\n\n    function truncateString(string, limit = 90) {\n      if (string.length <= limit) {\n        return string\n      } else {\n        return string.substring(0, limit) + '...'\n      }\n    }\n\n    if (workingNote) {\n      // Be sure to capture this object as a variable, as workingNote may be reassigned in `streamContextItem`, so by the time\n      // you modify it in the presave block, it may not be the same object anymore, so the presave values will not be applied to\n      // the right object, and it will save incorrectly.\n      const note = workingNote\n\n      componentRelay.saveItemWithPresave(note, () => {\n        window.upmath.updateText()\n\n        const html = window.upmath.getHTML()\n        const strippedHtml = truncateString(strip(html))\n\n        note.content.preview_plain = strippedHtml\n        note.content.preview_html = null\n        note.content.text = text\n      })\n    }\n  })\n\n  // Tab handler\n  editor.addEventListener('keydown', function (event) {\n    if (!event.shiftKey && event.which == 9) {\n      event.preventDefault()\n\n      // Using document.execCommand gives us undo support\n      if (!document.execCommand('insertText', false, '\\t')) {\n        // document.execCommand works great on Chrome/Safari but not Firefox\n        const start = this.selectionStart\n        const end = this.selectionEnd\n        const spaces = '    '\n\n        // Insert 4 spaces\n        this.value = this.value.substring(0, start) + spaces + this.value.substring(end)\n\n        // Place cursor 4 spaces away from where\n        // the tab key was pressed\n        this.selectionStart = this.selectionEnd = start + 4\n      }\n    }\n  })\n})\n"],"mappings":"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"}