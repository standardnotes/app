/*! For license information please see main.18531fb0.chunk.js.LICENSE.txt */
(this["webpackJsonp@standardnotes/markdown-visual"]=this["webpackJsonp@standardnotes/markdown-visual"]||[]).push([[0],{112:function(e,t,n){var r,i=n(16),a=n(131).default,o=n(132).default,s=n(135).default,u=n(136).default,c=n(137).default;self,e.exports=(r=n(138),function(){var e,t,n={156:function(e){self,e.exports=function(){"use strict";var e,t,n,r,i,a={d:function(e,t){for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},l={};a.d(l,{default:function(){return M}}),function(e){e.SetSize="set-size",e.StreamItems="stream-items",e.StreamContextItem="stream-context-item",e.SaveItems="save-items",e.SelectItem="select-item",e.AssociateItem="associate-item",e.DeassociateItem="deassociate-item",e.ClearSelection="clear-selection",e.CreateItem="create-item",e.CreateItems="create-items",e.DeleteItems="delete-items",e.SetComponentData="set-component-data",e.InstallLocalComponent="install-local-component",e.ToggleActivateComponent="toggle-activate-component",e.RequestPermissions="request-permissions",e.PresentConflictResolution="present-conflict-resolution",e.DuplicateItem="duplicate-item",e.ComponentRegistered="component-registered",e.ActivateThemes="themes",e.Reply="reply",e.SaveSuccess="save-success",e.SaveError="save-error",e.ThemesActivated="themes-activated",e.KeyDown="key-down",e.KeyUp="key-up",e.Click="click"}(e||(e={})),function(e){e[e.Web=1]="Web",e[e.Desktop=2]="Desktop",e[e.Mobile=3]="Mobile"}(t||(t={})),function(e){e.Any="*",e.Item="SF|Item",e.RootKey="SN|RootKey|NoSync",e.ItemsKey="SN|ItemsKey",e.EncryptedStorage="SN|EncryptedStorage",e.Note="Note",e.Tag="Tag",e.SmartTag="SN|SmartTag",e.Component="SN|Component",e.Editor="SN|Editor",e.ActionsExtension="Extension",e.UserPrefs="SN|UserPreferences",e.HistorySession="SN|HistorySession",e.Theme="SN|Theme",e.Mfa="SF|MFA",e.ServerExtension="SF|Extension",e.FilesafeCredentials="SN|FileSafe|Credentials",e.FilesafeFileMetadata="SN|FileSafe|FileMetadata",e.FilesafeIntegration="SN|FileSafe|Integration",e.ExtensionRepo="SN|ExtensionRepo"}(n||(n={})),function(e){e.Pinned="pinned",e.Archived="archived",e.Locked="locked",e.UserModifiedDate="client_updated_at",e.DefaultEditor="defaultEditor",e.MobileRules="mobileRules",e.NotAvailableOnMobile="notAvailableOnMobile",e.MobileActive="mobileActive",e.LastSize="lastSize",e.PrefersPlainEditor="prefersPlainEditor",e.ComponentInstallError="installError"}(r||(r={}));var f=new Uint8Array(16);function h(){if(!i&&!(i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return i(f)}for(var p=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,d=function(e){return"string"==typeof e&&p.test(e)},v=[],y=0;y<256;++y)v.push((y+256).toString(16).substr(1));var m,g,b,k,w=function(e,t,n){var r=(e=e||{}).random||(e.rng||h)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(var i=0;i<16;++i)t[n+i]=r[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]).toLowerCase();if(!d(n))throw TypeError("Stringified UUID is invalid");return n}(r)},x=function(e){var n,r,i=(c(n={},t.Web,"web"),c(n,t.Desktop,"desktop"),c(n,t.Mobile,"mobile"),n);return null!==(r=i[e])&&void 0!==r?r:i[t.Web]},S=function(e){return null!=e},I=function(){},_=function(){function e(){s(this,e)}return u(e,null,[{key:"isSupported",get:function(){return!(!window.console&&!console)}},{key:"info",get:function(){return e.isSupported&&this.enabled?console.log.bind(console):I}},{key:"error",get:function(){return e.isSupported?console.error.bind(console):I}}]),e}();function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(g="enabled")in(m=_)?Object.defineProperty(m,g,{value:!1,enumerable:!0,configurable:!0,writable:!0}):m[g]=!1,function(e){e.Component="component"}(b||(b={})),function(e){e.Shift="Shift",e.Ctrl="Control",e.Meta="Meta"}(k||(k={}));var M=function(){function r(e){if(s(this,r),D(this,"contentWindow",void 0),D(this,"initialPermissions",void 0),D(this,"onReadyCallback",void 0),D(this,"component",{activeThemes:[],acceptsThemes:!0}),D(this,"sentMessages",[]),D(this,"messageQueue",[]),D(this,"lastStreamedItem",void 0),D(this,"pendingSaveItems",void 0),D(this,"pendingSaveTimeout",void 0),D(this,"pendingSaveParams",void 0),D(this,"coallesedSaving",!0),D(this,"coallesedSavingDelay",250),D(this,"messageHandler",void 0),D(this,"keyDownEventListener",void 0),D(this,"keyUpEventListener",void 0),D(this,"clickEventListener",void 0),D(this,"onThemesChangeCallback",void 0),D(this,"concernTimeouts",[]),!e||!e.targetWindow)throw new Error("contentWindow must be a valid Window object.");this.contentWindow=e.targetWindow,this.processParameters(e),this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}return u(r,[{key:"processParameters",value:function(e){var t,n,r=e.initialPermissions,i=e.options,a=e.onReady,o=e.onThemesChange;r&&r.length>0&&(this.initialPermissions=r),S(null==i?void 0:i.coallesedSaving)&&(this.coallesedSaving=i.coallesedSaving),S(null==i?void 0:i.coallesedSavingDelay)&&(this.coallesedSavingDelay=i.coallesedSavingDelay),S(null==i?void 0:i.acceptsThemes)&&(this.component.acceptsThemes=null===(n=null==i?void 0:i.acceptsThemes)||void 0===n||n),S(a)&&(this.onReadyCallback=a),S(o)&&(this.onThemesChangeCallback=o),_.enabled=null!==(t=null==i?void 0:i.debug)&&void 0!==t&&t}},{key:"deinit",value:function(){this.onReadyCallback=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener("message",this.messageHandler),this.contentWindow.removeEventListener("message",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener("keydown",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener("keyup",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener("click",this.clickEventListener)}},{key:"registerMessageHandler",value:function(){var t=this;this.messageHandler=function(n){if(_.info("Components API Message received:",n.data),!document.referrer||new URL(document.referrer).origin===new URL(n.origin).origin){var r=n.data,i=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e),n=Object.prototype.toString.call(t);return"[object Object]"===n||"[object Array]"===n}catch(e){return!1}}(r)?JSON.parse(r):r;if(i){if(void 0===t.component.origin&&i.action===e.ComponentRegistered)t.component.origin=n.origin;else if(n.origin!==t.component.origin)return;t.handleMessage(i)}else _.error("Invalid data received. Skipping...")}},this.contentWindow.document.addEventListener("message",this.messageHandler,!1),this.contentWindow.addEventListener("message",this.messageHandler,!1),_.info("Waiting for messages...")}},{key:"registerKeyboardEventListeners",value:function(){var e=this;this.keyDownEventListener=function(t){_.info("A key has been pressed: ".concat(t.key)),t.ctrlKey?e.keyDownEvent(k.Ctrl):t.shiftKey?e.keyDownEvent(k.Shift):(t.metaKey||"Meta"===t.key)&&e.keyDownEvent(k.Meta)},this.keyUpEventListener=function(t){_.info("A key has been released: ".concat(t.key)),"Control"===t.key?e.keyUpEvent(k.Ctrl):"Shift"===t.key?e.keyUpEvent(k.Shift):"Meta"===t.key&&e.keyUpEvent(k.Meta)},this.contentWindow.addEventListener("keydown",this.keyDownEventListener,!1),this.contentWindow.addEventListener("keyup",this.keyUpEventListener,!1)}},{key:"registerMouseEventListeners",value:function(){var e=this;this.clickEventListener=function(t){_.info("A click has been performed."),e.mouseClickEvent()},this.contentWindow.addEventListener("click",this.clickEventListener,!1)}},{key:"handleMessage",value:function(t){switch(t.action){case e.ComponentRegistered:this.component.sessionKey=t.sessionKey,t.componentData&&(this.component.data=t.componentData),this.onReady(t.data),_.info("Component successfully registered with payload:",t);break;case e.ActivateThemes:this.activateThemes(t.data.themes);break;default:var n,r;if(!t.original)return;var i=null===(n=this.sentMessages)||void 0===n?void 0:n.filter((function(e){var n;return e.messageId===(null===(n=t.original)||void 0===n?void 0:n.messageId)}))[0];if(!i){var a=this.contentWindow.document.title,o=("The extension '".concat(a,"' is attempting to communicate with Standard Notes, ")+"but an error is preventing it from doing so. Please restart this extension and try again.").replace("  "," ");return void _.info(o)}null==i||null===(r=i.callback)||void 0===r||r.call(i,t.data)}}},{key:"onReady",value:function(t){this.component.environment=t.environment,this.component.platform=t.platform,this.component.uuid=t.uuid,this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);var n,r=o(this.messageQueue);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.postMessage(i.action,i.data,i.callback)}}catch(a){r.e(a)}finally{r.f()}this.messageQueue=[],_.info("Data passed to onReady:",t),this.activateThemes(t.activeThemeUrls||[]),this.postMessage(e.ThemesActivated,{}),this.onReadyCallback&&this.onReadyCallback()}},{key:"getSelfComponentUUID",value:function(){return this.component.uuid}},{key:"isRunningInDesktopApplication",value:function(){return this.component.environment===x(t.Desktop)}},{key:"isRunningInMobileApplication",value:function(){return this.component.environment===x(t.Mobile)}},{key:"getComponentDataValueForKey",value:function(e){if(this.component.data)return this.component.data[e]}},{key:"setComponentDataValueForKey",value:function(t,n){if(!this.component.data)throw new Error("The component has not been initialized.");if(!t||t&&0===t.length)throw new Error("The key for the data value should be a valid string.");this.component.data=C(C({},this.component.data),{},c({},t,n)),this.postMessage(e.SetComponentData,{componentData:this.component.data})}},{key:"clearComponentData",value:function(){this.component.data={},this.postMessage(e.SetComponentData,{componentData:this.component.data})}},{key:"postMessage",value:function(e,t,n){if(this.component.sessionKey){var r,i={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:b.Component},a=JSON.parse(JSON.stringify(i));a.callback=n,this.sentMessages.push(a),r=this.isRunningInMobileApplication()?JSON.stringify(i):i,_.info("Posting message:",r),this.contentWindow.parent.postMessage(r,this.component.origin)}else this.messageQueue.push({action:e,data:t,api:b.Component,callback:n})}},{key:"requestPermissions",value:function(t,n){this.postMessage(e.RequestPermissions,{permissions:t},(function(){n&&n()}))}},{key:"activateThemes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.component.acceptsThemes){_.info("Incoming themes:",e);var t=this.component.activeThemes;if(!t||t.sort().toString()!=e.sort().toString()){var n,r=e,i=[],a=o(t);try{var s=function(){var t=n.value;e.includes(t)?r=r.filter((function(e){return e!==t})):i.push(t)};for(a.s();!(n=a.n()).done;)s()}catch(v){a.e(v)}finally{a.f()}_.info("Deactivating themes:",i),_.info("Activating themes:",r);for(var u=0,c=i;u<c.length;u++){var l=c[u];this.deactivateTheme(l)}this.component.activeThemes=e;var f,h=o(r);try{for(h.s();!(f=h.n()).done;){var p=f.value;if(p){var d=this.contentWindow.document.createElement("link");d.id=btoa(p),d.href=p,d.type="text/css",d.rel="stylesheet",d.media="screen,print",d.className="custom-theme",this.contentWindow.document.getElementsByTagName("head")[0].appendChild(d)}}}catch(v){h.e(v)}finally{h.f()}this.onThemesChangeCallback&&this.onThemesChangeCallback()}}}},{key:"themeElementForUrl",value:function(e){return Array.from(this.contentWindow.document.getElementsByClassName("custom-theme")).slice().find((function(t){return t.id==btoa(e)}))}},{key:"deactivateTheme",value:function(e){var t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute("disabled","true"),t.parentNode.removeChild(t))}},{key:"generateUUID",value:function(){return w()}},{key:"platform",get:function(){return this.component.platform}},{key:"environment",get:function(){return this.component.environment}},{key:"streamItems",value:function(t,n){this.postMessage(e.StreamItems,{content_types:t},(function(e){n(e.items)}))}},{key:"streamContextItem",value:function(t){var n=this;this.postMessage(e.StreamContextItem,{},(function(e){var r=e.item;(!n.lastStreamedItem||n.lastStreamedItem.uuid!==r.uuid)&&n.pendingSaveTimeout&&(clearTimeout(n.pendingSaveTimeout),n.performSavingOfItems(n.pendingSaveParams),n.pendingSaveTimeout=void 0,n.pendingSaveParams=void 0),n.lastStreamedItem=r,t(n.lastStreamedItem)}))}},{key:"selectItem",value:function(t){this.postMessage(e.SelectItem,{item:this.jsonObjectForItem(t)})}},{key:"clearSelection",value:function(){this.postMessage(e.ClearSelection,{content_type:n.Tag})}},{key:"createItem",value:function(t,n){var r=this;this.postMessage(e.CreateItem,{item:this.jsonObjectForItem(t)},(function(e){var t=e.item;!t&&e.items&&e.items.length>0&&(t=e.items[0]),r.associateItem(t),n&&n(t)}))}},{key:"createItems",value:function(t,n){var r=this,i=t.map((function(e){return r.jsonObjectForItem(e)}));this.postMessage(e.CreateItems,{items:i},(function(e){n&&n(e.items)}))}},{key:"associateItem",value:function(t){this.postMessage(e.AssociateItem,{item:this.jsonObjectForItem(t)})}},{key:"deassociateItem",value:function(t){this.postMessage(e.DeassociateItem,{item:this.jsonObjectForItem(t)})}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(t,n){var r=this,i={items:t.map((function(e){return r.jsonObjectForItem(e)}))};this.postMessage(e.DeleteItems,i,(function(e){n&&n(e)}))}},{key:"sendCustomEvent",value:function(e,t,n){this.postMessage(e,t,(function(e){n&&n(e)}))}},{key:"saveItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,n)}},{key:"saveItemWithPresave",value:function(e,t,n){this.saveItemsWithPresave([e],t,n)}},{key:"saveItemsWithPresave",value:function(e,t,n){this.saveItems(e,n,!1,t)}},{key:"performSavingOfItems",value:function(t){var n=this,r=t.items,i=t.presave,a=t.callback,s=setTimeout((function(){n.concernTimeouts.forEach((function(e){return clearTimeout(e)})),alert("This editor is unable to communicate with Standard Notes. Your changes may not be saved. Please backup your changes, then restart the application and try again.")}),5e3);this.concernTimeouts.push(s),i&&i();var u,c=[],l=o(r);try{for(l.s();!(u=l.n()).done;){var f=u.value;c.push(this.jsonObjectForItem(f))}}catch(h){l.e(h)}finally{l.f()}this.postMessage(e.SaveItems,{items:c},(function(){n.concernTimeouts.forEach((function(e){return clearTimeout(e)})),null==a||a()}))}},{key:"saveItems",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.coallesedSaving&&!r){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);var a=e.map((function(e){return e.uuid})),o=this.pendingSaveItems.filter((function(e){return!a.includes(e.uuid)}));this.pendingSaveItems=o.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:i,callback:t},this.pendingSaveTimeout=setTimeout((function(){n.performSavingOfItems(n.pendingSaveParams),n.pendingSaveItems=[],n.pendingSaveTimeout=void 0,n.pendingSaveParams=null}),this.coallesedSavingDelay)}else this.performSavingOfItems({items:e,presave:i,callback:t})}},{key:"setSize",value:function(t,n){this.postMessage(e.SetSize,{type:"container",width:t,height:n})}},{key:"keyDownEvent",value:function(t){this.postMessage(e.KeyDown,{keyboardModifier:t})}},{key:"keyUpEvent",value:function(t){this.postMessage(e.KeyUp,{keyboardModifier:t})}},{key:"mouseClickEvent",value:function(){this.postMessage(e.Click,{})}},{key:"jsonObjectForItem",value:function(e){var t=Object.assign({},e);return t.children=null,t.parent=null,t}},{key:"getItemAppDataValue",value:function(e,t){var n,r;return null==e||null===(n=e.content)||void 0===n||null===(r=n.appData)||void 0===r?void 0:r["org.standardnotes.sn"][t]}}]),r}();return l.default}()},695:function(e){"use strict";e.exports=r}},l={};function f(e){var t=l[e];if(void 0!==t)return t.exports;var r=l[e]={exports:{}};return n[e](r,r.exports,f),r.exports}f.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return f.d(t,{a:t}),t},t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},f.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var i=Object.create(null);f.r(i);var a={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){return a[e]=function(){return n[e]}}));return a.default=function(){return n},f.d(i,a),i},f.d=function(e,t){for(var n in t)f.o(t,n)&&!f.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},f.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},f.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var h={};return function(){"use strict";f.d(h,{default:function(){return g}});var e=f(156),t=f.n(e),n=function(){var e=a(i.mark((function e(t){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,1e3*t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t){s(this,e),this.options=t,r(this,"uuidToFileTempUrlAndTypeMapping",{}),r(this,"currentlyLoadingIds",[]),r(this,"statusElementMapping",{}),r(this,"fileTypeToElementType",{"image/png":"img","image/jpg":"img","image/jpeg":"img","image/gif":"img","image/tiff":"img","image/bmp":"img","video/mp4":"video","audio/mpeg":"audio","audio/mp3":"audio"})}return u(e,[{key:"fileTypeForElementType",value:function(e){return this.fileTypeToElementType[e.toLowerCase()]}},{key:"loadFileSafeElements",value:function(){var e,t=this.options.getElementsBySelector("*[fsplaceholder]"),n=o(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;this.loadFileSafeElement(r)}}catch(i){n.e(i)}finally{n.f()}}},{key:"loadFileSafeElement",value:function(){var e=a(i.mark((function e(t){var r,a,o,s,u,c,l,f,h,p,d,v,y=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.options.fileSafeInstance,o=t.getAttribute("fsid"),s=null!==(r=t.getAttribute("fsName"))&&void 0!==r?r:"",u=s&&"undefined"!=s?s:"file",o){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(c=this.uuidToFileTempUrlAndTypeMapping[o])){e.next=6;break}return e.abrupt("return",(this.insertMediaElement({fsid:o,fsElement:t,url:c.url,fileType:c.fileType,fsName:c.fsName}),!1));case 6:if(!this.currentlyLoadingIds.includes(o)){e.next=8;break}return e.abrupt("return",!1);case 8:if(l=a.findFileDescriptor(o)){e.next=11;break}return e.abrupt("return",(this.setStatus({fsElement:t,fsid:o,status:"Unable to find ".concat(u," ").concat(o,"."),removable:!0}),!1));case 11:if(f='[fsid="'.concat(l.uuid,'"][fscollapsable]'),!(document.querySelectorAll("img".concat(f,", figure").concat(f,", video").concat(f,", audio").concat(f)).length>0)){e.next=14;break}return e.abrupt("return",!1);case 14:return this.currentlyLoadingIds.push(o),this.setStatus({fsElement:t,fsid:o,status:"Downloading ".concat(u,"...")}),e.next=18,n(.05);case 18:return e.next=20,a.downloadFileFromDescriptor(l).catch((function(){y.setStatus({fsElement:t,fsid:o,status:"Unable to download ".concat(u," ").concat(o,".")})}));case 20:if(h=e.sent){e.next=23;break}return e.abrupt("return",!1);case 23:return this.setStatus({fsElement:t,fsid:o,status:"Decrypting ".concat(u,"...")}),e.next=26,n(.05);case 26:return e.next=28,a.decryptFile({fileDescriptor:l,fileItem:h}).catch((function(){y.setStatus({fsElement:t,fsid:o,status:"Unable to decrypt ".concat(u," ").concat(o,".")})}));case 28:if(p=e.sent){e.next=31;break}return e.abrupt("return",!1);case 31:return this.setStatus({fsElement:t,fsid:o}),e.next=34,n(.05);case 34:return d=l.content.fileType,v=a.createTemporaryFileUrl({base64Data:p.decryptedData,dataType:d}),e.abrupt("return",(this.insertMediaElement({fsid:o,fileType:d,fsName:s,fsElement:t,url:v}),y.currentlyLoadingIds.splice(y.currentlyLoadingIds.indexOf(o),1),this.uuidToFileTempUrlAndTypeMapping[o]={fileType:d,url:v,fsName:s},!0));case 36:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"insertMediaElement",value:function(e){var t,n=e.url,r=e.fsid,i=e.fsName,a=e.fileType,o=e.fsElement;switch(this.fileTypeForElementType(a)){case"img":t=this.createImageElement({url:n,fsid:r,fsName:i,fsElement:o});break;case"video":t=this.createVideoElement({url:n,fsid:r,fileType:a,fsName:i,fsElement:o});break;case"audio":t=this.createAudioElement({url:n,fsid:r,fsName:i});break;default:t=this.createDownloadElement({url:n,fsid:r,fsName:i})}this.insertElementNearElement(t,o),o.remove()}},{key:"wrapElementInTag",value:function(e){var t=e.element,n=e.tagName,r=e.fsid,i=e.fsName,a=document.createElement(n);return a.setAttribute("fsid",r),a.setAttribute("fsName",i),a.setAttribute("fscollapsable","true"),a.setAttribute("contenteditable","true"),a.append(t),a}},{key:"createImageElement",value:function(e){var t=e.url,n=e.fsid,r=e.fsName,i=e.fsElement,a=document.createElement("img");a.setAttribute("src",t),a.setAttribute("srcset","".concat(t," 2x")),a.setAttribute("fsid",n),a.setAttribute("fsName",r),a.setAttribute("fscollapsable","true");var o=i.getAttribute("width");o&&a.setAttribute("width",o);var s=i.getAttribute("height");return s&&a.setAttribute("height",s),a}},{key:"createVideoElement",value:function(e){var t=e.url,n=e.fsid,r=e.fileType,i=e.fsName,a=e.fsElement,o=document.createElement("video");o.setAttribute("controls","true"),o.setAttribute("fsid",n),o.setAttribute("fsName",i),o.setAttribute("fscollapsable","true");var s=a.getAttribute("width");s&&o.setAttribute("width",s);var u=a.getAttribute("height");u&&o.setAttribute("height",u);var c=document.createElement("source");return c.setAttribute("src",t),c.setAttribute("type",r),o.append(c),this.wrapElementInTag({fsid:n,fsName:i,element:o,tagName:"p"})}},{key:"createDownloadElement",value:function(e){var t=e.url,n=e.fsid,r=e.fsName,i=document.createElement("a");return i.setAttribute("fsid",n),i.setAttribute("fsName",r),i.setAttribute("ghost","true"),i.setAttribute("fscollapsable","true"),i.setAttribute("href",t),i.textContent="".concat(r),i}},{key:"createAudioElement",value:function(e){var t=e.url,n=e.fsid,r=e.fsName,i=document.createElement("audio");return i.setAttribute("src",t),i.setAttribute("controls","true"),i.setAttribute("fsid",n),i.setAttribute("fsName",r),i.setAttribute("fscollapsable","true"),this.wrapElementInTag({fsid:n,fsName:r,element:i,tagName:"p"})}},{key:"setStatus",value:function(e){var t=e.status,n=e.fsElement,r=e.fsid,i=e.removable,a=void 0!==i&&i;if(r){var o=this.statusElementMapping[r];o&&(o.remove(),delete this.statusElementMapping[r])}if(t){var s=document.createElement("label");return s.setAttribute("id",r),s.setAttribute("ghost","true"),s.setAttribute("contenteditable","false"),s.style.fontWeight="bold",s.textContent=t,a&&(s.style.userSelect="all"),s=this.insertElementNearElement(s,n),r&&(this.statusElementMapping[r]=s),s}}},{key:"insertStatusAtCursor",value:function(e){var t=Math.random().toString(36).substring(7);return this.setStatus({status:e,fsid:t,fsElement:null}),t}},{key:"removeCursorStatus",value:function(e){var t=this.options.getElementsBySelector("#".concat(e));t.length>0&&t[0].remove()}},{key:"insertElementNearElement",value:function(e,t){var n=this.options.preprocessElement(e),r="child";if(t&&"figure"==n.tagName.toLowerCase()){var i=t.closest("p");i&&(t=i,r="afterend")}return this.options.insertElement(n,t,r),n}}]),e}(),l=function(){function e(t){s(this,e),this.options=t}return u(e,[{key:"onKeyUp",value:function(e){var t=e.isEnter,n=e.isPaste,r=e.isSpace;(t||n||r)&&this.searchPatterns({searchPreviousLine:null!=t&&t})}},{key:"searchPatterns",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{searchPreviousLine:!1},n=t.searchPreviousLine?this.options.getPreviousLineText():this.options.getCurrentLineText(),r=o(this.options.patterns);try{for(r.s();!(e=r.n()).done;){var i=e.value,a=i.regex.exec(n);if(a){var s=a[0];if(s){var u=i.callback(s);this.replaceSelection(i.regex,u,t.searchPreviousLine)}}}}catch(c){r.e(c)}finally{r.f()}}},{key:"replaceSelection",value:function(e,t,n){var r,i,a;null!==(r=this.options)&&void 0!==r&&r.beforeExpand&&this.options.beforeExpand(),this.options.replaceText({regex:e,replacement:t,searchPreviousLine:n}),null!==(i=this.options)&&void 0!==i&&i.afterExpand&&(null===(a=this.options)||void 0===a||a.afterExpand())}}]),e}(),p=/(<p>)?\[FileSafe[^\]]*\](<\/p>)?/g,d=function(e){return e.replace(p,(function(e){return y(e)}))},v=function(e){return"[FileSafe:".concat(e.uuid,":").concat(e.content.fileName,"]")},y=function(e){var t=(e=(e=(e=e.replace("<p>","")).replace("</p>","")).replace("[","").replace("]","")).split(":"),n=t[1],r=t[2],i=t[3],a="";if(i){var o=i.split("x");a="width=".concat(o[0]," height=").concat(o[1])}return"<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='".concat(n,"' fsname='").concat(r,"' ").concat(a,"></p>")};function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){function e(t,n){s(this,e),this.delegate=t,this.options=n,m(this,"fileIdsPendingAssociation",[]),m(this,"componentRelay",void 0),m(this,"fileLoader",void 0),m(this,"textExpander",void 0),m(this,"fileSafeLoading",void 0),m(this,"fileSafeClass",void 0),m(this,"fileSafeInstance",void 0),m(this,"note",void 0),m(this,"ignoreNextTextChange",void 0),m(this,"needsFileSafeElementLoad",void 0),m(this,"previousText",void 0),this.connectToBridge(),this.options.supportsFileSafe&&(this.fileSafeLoading=this.importFileSafe())}return u(e,[{key:"connectToBridge",value:function(){var e=this,n=this.options,r=n.coallesedSaving,o=n.coallesedSavingDelay,s=n.mode,u=n.supportsFileSafe;this.componentRelay=new(t())({targetWindow:window,options:{coallesedSaving:r,coallesedSavingDelay:o},onReady:function(){var t=e.componentRelay.platform;t&&document.documentElement.classList.add(t)},onThemesChange:this.delegate.onThemesChange}),this.componentRelay.streamContextItem(function(){var t=a(i.mark((function t(n){var r,a,o,c,l,f,h,p,v,y;return i.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,e.note&&e.note.uuid==n.uuid&&(r=!1),a=e.note,u?(o=e.fileSafeClass.getSFItemClass(),e.note=new o(n),e.fileSafeInstance.setCurrentNote(e.note)):e.note=n,!n.isMetadataUpdate){t.next=6;break}return t.abrupt("return");case 6:if(c=n.content.text,"html"===s&&r&&(/<[a-z][\s\S]*>/i.test(c)||(e.ignoreNextTextChange=!0)),e.previousText=c,u&&(e.needsFileSafeElementLoad=!0,c=d(c)),t.t0=e.delegate.onNoteValueChange,!t.t0){t.next=14;break}return t.next=14,e.delegate.onNoteValueChange(n);case 14:if(e.delegate.setEditorRawText(c),!e.delegate.onNoteLockToggle){t.next=18;break}h=null!==(l=e.componentRelay.getItemAppDataValue(a,"locked"))&&void 0!==l&&l,p=null!==(f=e.componentRelay.getItemAppDataValue(e.note,"locked"))&&void 0!==f&&f,h!==p&&e.delegate.onNoteLockToggle(p);case 18:r&&(null===(v=(y=e.delegate).clearUndoHistory)||void 0===v||v.call(y));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"importFileSafe",value:function(){var e=a(i.mark((function e(){var t=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then(f.t.bind(f,695,23)).then((function(e){return t.fileSafeClass=e.default,t.configureFileSafe(),t.fileSafeInstance})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"configureFileSafe",value:function(){for(var e=this,t=0,n=["getCurrentLineText","getPreviousLineText","replaceText","getElementsBySelector","insertElement","preprocessElement","insertRawText"];t<n.length;t++){var r=n[t];if(!this.delegate[r])throw Error("Missing ".concat(r," delegate function."))}this.fileSafeInstance=new this.fileSafeClass({componentManager:this.componentRelay}),this.fileSafeInstance.addDataChangeObserver((function(){var t=e.fileSafeInstance.getAllFileDescriptors();if(e.note&&e.fileIdsPendingAssociation.length>0){var n,r=!1,i=o(e.fileIdsPendingAssociation.slice());try{var a=function(){var i=n.value,a=t.find((function(e){return e.uuid==i}));if(!a)return"continue";r=!0,e.fileIdsPendingAssociation.splice(e.fileIdsPendingAssociation.indexOf(i),1);var o=v(a);e.delegate.insertRawText(o)};for(i.s();!(n=i.n()).done;)a()}catch(s){i.e(s)}finally{i.f()}r&&e.textExpander.searchPatterns()}t.length>0&&e.fileLoader.loadFileSafeElements()})),this.fileSafeInstance.addNewFileDescriptorHandler((function(t){e.fileIdsPendingAssociation.push(t.uuid)})),this.fileLoader=new c({fileSafeInstance:this.fileSafeInstance,getElementsBySelector:this.delegate.getElementsBySelector,insertElement:this.delegate.insertElement,preprocessElement:this.delegate.preprocessElement}),this.textExpander=new l({afterExpand:function(){return e.fileLoader.loadFileSafeElements()},getCurrentLineText:this.delegate.getCurrentLineText,getPreviousLineText:this.delegate.getPreviousLineText,replaceText:this.delegate.replaceText,patterns:[{regex:p,callback:function(e){return d(e)}}]})}},{key:"getFileSafe",value:function(){var e=a(i.mark((function e(){return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.fileSafeInstance&&this.fileSafeLoading?this.fileSafeLoading:this.importFileSafe());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onEditorKeyUp",value:function(e){var t=e.isSpace,n=e.isEnter;this.textExpander.onKeyUp({isSpace:t,isEnter:n})}},{key:"onEditorPaste",value:function(){this.textExpander.onKeyUp({isPaste:!0})}},{key:"onEditorValueChanged",value:function(e){var t=this,n=this.options,r=n.mode,i=n.supportsFileSafe;if(this.needsFileSafeElementLoad&&(this.needsFileSafeElementLoad=!1,this.fileLoader.loadFileSafeElements()),this.ignoreNextTextChange)this.ignoreNextTextChange=!1;else if((!i||(e=function(e){var t,n=(new DOMParser).parseFromString(e,"text/html"),r=n.querySelectorAll("*[fscollapsable]"),i=o(r);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=a.getAttribute("fsid"),u=a.getAttribute("fsname"),c=a.getAttribute("width"),l=a.getAttribute("height"),f=["FileSafe",s,u];if(c&&l){var h="".concat(c,"x").concat(l);f.push(h)}var p="<p>[".concat(f.join(":"),"]</p>");a.insertAdjacentHTML("afterend",p),a.remove()}}catch(d){i.e(d)}finally{i.f()}return n.querySelectorAll("*[ghost]").forEach((function(e){return e.remove()})),n.body.innerHTML}(e),this.previousText!=e))&&(this.previousText=e,this.note)){var a=this.note;this.componentRelay.saveItemWithPresave(a,(function(){if(a.content.text=e,t.delegate.generateCustomPreview){var n,i=t.delegate.generateCustomPreview(e);a.content.preview_plain=null!==(n=i.plain)&&void 0!==n?n:" ",a.content.preview_html=i.html}else{if("html"===r){var o=e.replace(p,(function(e){return""}));o=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}(function(e){var t=document.implementation.createHTMLDocument().body;return t.innerHTML=e,t.textContent||t.innerText||""}(o)),a.content.preview_plain=o.length>0?o:" "}else a.content.preview_plain=e;a.content.preview_html=null}}))}}},{key:"canUploadFiles",value:function(){var e=this.fileSafeInstance.getAllCredentials(),t=this.fileSafeInstance.getAllIntegrations();return e.length>0&&t.length>0}},{key:"uploadJSFileObject",value:function(){var e=a(i.mark((function e(t){var n,r=this;return i.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.fileLoader.insertStatusAtCursor("Processing file..."),e.abrupt("return",this.fileSafeInstance.encryptAndUploadJavaScriptFileObject(t).then((function(){r.fileLoader.removeCursorStatus(n)})));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"saveItemWithPresave",value:function(e,t){this.componentRelay.saveItemWithPresave(e,t)}},{key:"platform",get:function(){return this.componentRelay.platform}},{key:"environment",get:function(){return this.componentRelay.environment}},{key:"canUseFileSafe",value:function(){return this.fileSafeInstance.hasLegacyAccess()}}]),e}()}(),h.default}())},119:function(e,t,n){},124:function(e,t,n){},127:function(e,t,n){},138:function(e,t,n){var r=n(16);e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){(function(t){e.exports=function e(t,n,r){function i(o,s){if(!n[o]){if(!t[o]){if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[o]={exports:{}};t[o][0].call(c.exports,(function(e){return i(t[o][1][e]||e)}),c,c.exports,e,t,n,r)}return n[o].exports}for(var a=!1,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(e,n,i){(function(e){var t,n,a,o,s,u,c=c||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math);function l(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){y(a,r,i,o,s,"next",e)}function s(e){y(a,r,i,o,s,"throw",e)}o(void 0)}))}}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),e}n=(t=c).lib.WordArray,t.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp(),e=[];for(var i=0;i<n;i+=3)for(var a=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,o=0;4>o&&i+.75*o<n;o++)e.push(r.charAt(a>>>6*(3-o)&63));if(t=r.charAt(64))for(;e.length%4;)e.push(t);return e.join("")},parse:function(e){var t=e.length,r=this._map;(i=r.charAt(64))&&-1!=(i=e.indexOf(i))&&(t=i);for(var i=[],a=0,o=0;o<t;o++)if(o%4){var s=r.indexOf(e.charAt(o-1))<<o%4*2,u=r.indexOf(e.charAt(o))>>>6-o%4*2;i[a>>>2]|=(s|u)<<24-a%4*8,a++}return n.create(i,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){function t(e,t,n,r,i,a,o){return((e=e+(t&n|~t&r)+i+o)<<a|e>>>32-a)+t}function n(e,t,n,r,i,a,o){return((e=e+(t&r|n&~r)+i+o)<<a|e>>>32-a)+t}function r(e,t,n,r,i,a,o){return((e=e+(t^n^r)+i+o)<<a|e>>>32-a)+t}function i(e,t,n,r,i,a,o){return((e=e+(n^(t|~r))+i+o)<<a|e>>>32-a)+t}for(var a=c,o=(u=a.lib).WordArray,s=u.Hasher,u=a.algo,l=[],f=0;64>f;f++)l[f]=4294967296*e.abs(e.sin(f+1))|0;u=u.MD5=s.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,a){for(var o=0;16>o;o++){var s=e[u=a+o];e[u]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8)}o=this._hash.words;var u=e[a+0],c=(s=e[a+1],e[a+2]),f=e[a+3],h=e[a+4],p=e[a+5],d=e[a+6],v=e[a+7],y=e[a+8],m=e[a+9],g=e[a+10],b=e[a+11],k=e[a+12],w=e[a+13],x=e[a+14],S=e[a+15],I=t(I=o[0],C=o[1],A=o[2],_=o[3],u,7,l[0]),_=t(_,I,C,A,s,12,l[1]),A=t(A,_,I,C,c,17,l[2]),C=t(C,A,_,I,f,22,l[3]);I=t(I,C,A,_,h,7,l[4]),_=t(_,I,C,A,p,12,l[5]),A=t(A,_,I,C,d,17,l[6]),C=t(C,A,_,I,v,22,l[7]),I=t(I,C,A,_,y,7,l[8]),_=t(_,I,C,A,m,12,l[9]),A=t(A,_,I,C,g,17,l[10]),C=t(C,A,_,I,b,22,l[11]),I=t(I,C,A,_,k,7,l[12]),_=t(_,I,C,A,w,12,l[13]),A=t(A,_,I,C,x,17,l[14]),I=n(I,C=t(C,A,_,I,S,22,l[15]),A,_,s,5,l[16]),_=n(_,I,C,A,d,9,l[17]),A=n(A,_,I,C,b,14,l[18]),C=n(C,A,_,I,u,20,l[19]),I=n(I,C,A,_,p,5,l[20]),_=n(_,I,C,A,g,9,l[21]),A=n(A,_,I,C,S,14,l[22]),C=n(C,A,_,I,h,20,l[23]),I=n(I,C,A,_,m,5,l[24]),_=n(_,I,C,A,x,9,l[25]),A=n(A,_,I,C,f,14,l[26]),C=n(C,A,_,I,y,20,l[27]),I=n(I,C,A,_,w,5,l[28]),_=n(_,I,C,A,c,9,l[29]),A=n(A,_,I,C,v,14,l[30]),I=r(I,C=n(C,A,_,I,k,20,l[31]),A,_,p,4,l[32]),_=r(_,I,C,A,y,11,l[33]),A=r(A,_,I,C,b,16,l[34]),C=r(C,A,_,I,x,23,l[35]),I=r(I,C,A,_,s,4,l[36]),_=r(_,I,C,A,h,11,l[37]),A=r(A,_,I,C,v,16,l[38]),C=r(C,A,_,I,g,23,l[39]),I=r(I,C,A,_,w,4,l[40]),_=r(_,I,C,A,u,11,l[41]),A=r(A,_,I,C,f,16,l[42]),C=r(C,A,_,I,d,23,l[43]),I=r(I,C,A,_,m,4,l[44]),_=r(_,I,C,A,k,11,l[45]),A=r(A,_,I,C,S,16,l[46]),I=i(I,C=r(C,A,_,I,c,23,l[47]),A,_,u,6,l[48]),_=i(_,I,C,A,v,10,l[49]),A=i(A,_,I,C,x,15,l[50]),C=i(C,A,_,I,p,21,l[51]),I=i(I,C,A,_,k,6,l[52]),_=i(_,I,C,A,f,10,l[53]),A=i(A,_,I,C,g,15,l[54]),C=i(C,A,_,I,s,21,l[55]),I=i(I,C,A,_,y,6,l[56]),_=i(_,I,C,A,S,10,l[57]),A=i(A,_,I,C,d,15,l[58]),C=i(C,A,_,I,w,21,l[59]),I=i(I,C,A,_,h,6,l[60]),_=i(_,I,C,A,b,10,l[61]),A=i(A,_,I,C,c,15,l[62]),C=i(C,A,_,I,m,21,l[63]),o[0]=o[0]+I|0,o[1]=o[1]+C|0,o[2]=o[2]+A|0,o[3]=o[3]+_|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var a=e.floor(r/4294967296);for(n[15+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),n[14+(i+64>>>9<<4)]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),t.sigBytes=4*(n.length+1),this._process(),n=(t=this._hash).words,r=0;4>r;r++)i=n[r],n[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8);return t},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),a.MD5=s._createHelper(u),a.HmacMD5=s._createHmacHelper(u)}(Math),function(){var e,t=c,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=(s=this.cfg).hasher.create(),i=r.create(),a=i.words,o=s.keySize,s=s.iterations;a.length<o;){u&&n.update(u);var u=n.update(e).finalize(t);n.reset();for(var c=1;c<s;c++)u=n.finalize(u),n.reset();i.concat(u)}return i.sigBytes=4*o,i}});t.EvpKDF=function(e,t,n){return i.create(n).compute(e,t)}}(),c.lib.Cipher||function(e){var t=(d=c).lib,n=t.Base,r=t.WordArray,i=t.BufferedBlockAlgorithm,a=d.enc.Base64,o=d.algo.EvpKDF,s=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(e){return{encrypt:function(t,n,r){return("string"==typeof n?v:p).encrypt(e,t,n,r)},decrypt:function(t,n,r){return("string"==typeof n?v:p).decrypt(e,t,n,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var u=d.mode={},l=function(e,t,n){var r=this._iv;r?this._iv=void 0:r=this._prevBlock;for(var i=0;i<n;i++)e[t+i]^=r[i]},f=(t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}})).extend();f.Encryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize;l.call(this,e,t,r),n.encryptBlock(e,t),this._prevBlock=e.slice(t,t+r)}}),f.Decryptor=f.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=e.slice(t,t+r);n.decryptBlock(e,t),l.call(this,e,t,r),this._prevBlock=i}}),u=u.CBC=f,f=(d.pad={}).Pkcs7={pad:function(e,t){for(var n,i=(n=(n=4*t)-e.sigBytes%n)<<24|n<<16|n<<8|n,a=[],o=0;o<n;o+=4)a.push(i);n=r.create(a,n),e.concat(n)},unpad:function(e){e.sigBytes-=255&e.words[e.sigBytes-1>>>2]}},t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:u,padding:f}),reset:function(){s.reset.call(this);var e=(t=this.cfg).iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var n=t.createEncryptor;else n=t.createDecryptor,this._minBufferSize=1;this._mode=n.call(t,this,e&&e.words)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else t=this._process(!0),e.unpad(t);return t},blockSize:4});var h=t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),p=(u=(d.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext;return((e=e.salt)?r.create([1398893684,1701076831]).concat(e).concat(t):t).toString(a)},parse:function(e){var t=(e=a.parse(e)).words;if(1398893684==t[0]&&1701076831==t[1]){var n=r.create(t.slice(2,4));t.splice(0,4),e.sigBytes-=16}return h.create({ciphertext:e,salt:n})}},t.SerializableCipher=n.extend({cfg:n.extend({format:u}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r);return t=i.finalize(t),i=i.cfg,h.create({ciphertext:t,key:n,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}})),d=(d.kdf={}).OpenSSL={execute:function(e,t,n,i){return i||(i=r.random(8)),e=o.create({keySize:t+n}).compute(e,i),n=r.create(e.words.slice(t),4*n),e.sigBytes=4*t,h.create({key:e,iv:n,salt:i})}},v=t.PasswordBasedCipher=p.extend({cfg:p.cfg.extend({kdf:d}),encrypt:function(e,t,n,r){return n=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize),r.iv=n.iv,(e=p.encrypt.call(this,e,t,n.key,r)).mixIn(n),e},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n=r.kdf.execute(n,e.keySize,e.ivSize,t.salt),r.iv=n.iv,p.decrypt.call(this,e,t,n.key,r)}})}(),function(){for(var e=c,t=e.lib.BlockCipher,n=e.algo,r=[],i=[],a=[],o=[],s=[],u=[],l=[],f=[],h=[],p=[],d=[],v=0;256>v;v++)d[v]=128>v?v<<1:v<<1^283;var y=0,m=0;for(v=0;256>v;v++){var g=(g=m^m<<1^m<<2^m<<3^m<<4)>>>8^255&g^99;r[y]=g,i[g]=y;var b=d[y],k=d[b],w=d[k],x=257*d[g]^16843008*g;a[y]=x<<24|x>>>8,o[y]=x<<16|x>>>16,s[y]=x<<8|x>>>24,u[y]=x,x=16843009*w^65537*k^257*b^16843008*y,l[g]=x<<24|x>>>8,f[g]=x<<16|x>>>16,h[g]=x<<8|x>>>24,p[g]=x,y?(y=b^d[d[d[w^b]]],m^=d[d[m]]):y=m=1}var S=[0,1,2,4,8,16,32,64,128,27,54];n=n.AES=t.extend({_doReset:function(){for(var e=(n=this._key).words,t=n.sigBytes/4,n=4*((this._nRounds=t+6)+1),i=this._keySchedule=[],a=0;a<n;a++)if(a<t)i[a]=e[a];else{var o=i[a-1];a%t?6<t&&4==a%t&&(o=r[o>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o]):(o=r[(o=o<<8|o>>>24)>>>24]<<24|r[o>>>16&255]<<16|r[o>>>8&255]<<8|r[255&o],o^=S[a/t|0]<<24),i[a]=i[a-t]^o}for(e=this._invKeySchedule=[],t=0;t<n;t++)a=n-t,o=t%4?i[a]:i[a-4],e[t]=4>t||4>=a?o:l[r[o>>>24]]^f[r[o>>>16&255]]^h[r[o>>>8&255]]^p[r[255&o]]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,o,s,u,r)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,f,h,p,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,a,o,s){for(var u=this._nRounds,c=e[t]^n[0],l=e[t+1]^n[1],f=e[t+2]^n[2],h=e[t+3]^n[3],p=4,d=1;d<u;d++){var v=r[c>>>24]^i[l>>>16&255]^a[f>>>8&255]^o[255&h]^n[p++],y=r[l>>>24]^i[f>>>16&255]^a[h>>>8&255]^o[255&c]^n[p++],m=r[f>>>24]^i[h>>>16&255]^a[c>>>8&255]^o[255&l]^n[p++];h=r[h>>>24]^i[c>>>16&255]^a[l>>>8&255]^o[255&f]^n[p++],c=v,l=y,f=m}v=(s[c>>>24]<<24|s[l>>>16&255]<<16|s[f>>>8&255]<<8|s[255&h])^n[p++],y=(s[l>>>24]<<24|s[f>>>16&255]<<16|s[h>>>8&255]<<8|s[255&c])^n[p++],m=(s[f>>>24]<<24|s[h>>>16&255]<<16|s[c>>>8&255]<<8|s[255&l])^n[p++],h=(s[h>>>24]<<24|s[c>>>16&255]<<16|s[l>>>8&255]<<8|s[255&f])^n[p++],e[t]=v,e[t+1]=y,e[t+2]=m,e[t+3]=h},keySize:8}),e.AES=t._createHelper(n)}(),c=c||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math),function(e){for(var t=c,n=(i=t.lib).WordArray,r=i.Hasher,i=t.algo,a=[],o=[],s=function(e){return 4294967296*(e-(0|e))|0},u=2,l=0;64>l;){var f;e:{f=u;for(var h=e.sqrt(f),p=2;p<=h;p++)if(!(f%p)){f=!1;break e}f=!0}f&&(8>l&&(a[l]=s(e.pow(u,.5))),o[l]=s(e.pow(u,1/3)),l++),u++}var d=[];i=i.SHA256=r.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],a=n[2],s=n[3],u=n[4],c=n[5],l=n[6],f=n[7],h=0;64>h;h++){if(16>h)d[h]=0|e[t+h];else{var p=d[h-15],v=d[h-2];d[h]=((p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3)+d[h-7]+((v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10)+d[h-16]}p=f+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+(u&c^~u&l)+o[h]+d[h],v=((r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22))+(r&i^r&a^i&a),f=l,l=c,c=u,u=s+p|0,s=a,a=i,i=r,r=p+v|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0,n[5]=n[5]+c|0,n[6]=n[6]+l|0,n[7]=n[7]+f|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=r.clone.call(this);return e._hash=this._hash.clone(),e}}),t.SHA256=r._createHelper(i),t.HmacSHA256=r._createHmacHelper(i)}(Math),o=(a=c).enc.Utf8,a.algo.HMAC=a.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),s=i.words,u=a.words,c=0;c<n;c++)s[c]^=1549556828,u[c]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),c=c||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math),function(e){var t,n=(t=c).lib,r=n.Base,i=n.WordArray;(t=t.x64={}).Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),t.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var a=e[r];n.push(a.high),n.push(a.low)}return i.create(n,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),n=t.length,i=0;i<n;i++)t[i]=t[i].clone();return e}})}(),function(){function e(){return r.create.apply(r,arguments)}for(var t=c,n=t.lib.Hasher,r=(a=t.x64).Word,i=a.WordArray,a=t.algo,o=[e(1116352408,3609767458),e(1899447441,602891725),e(3049323471,3964484399),e(3921009573,2173295548),e(961987163,4081628472),e(1508970993,3053834265),e(2453635748,2937671579),e(2870763221,3664609560),e(3624381080,2734883394),e(310598401,1164996542),e(607225278,1323610764),e(1426881987,3590304994),e(1925078388,4068182383),e(2162078206,991336113),e(2614888103,633803317),e(3248222580,3479774868),e(3835390401,2666613458),e(4022224774,944711139),e(264347078,2341262773),e(604807628,2007800933),e(770255983,1495990901),e(1249150122,1856431235),e(1555081692,3175218132),e(1996064986,2198950837),e(2554220882,3999719339),e(2821834349,766784016),e(2952996808,2566594879),e(3210313671,3203337956),e(3336571891,1034457026),e(3584528711,2466948901),e(113926993,3758326383),e(338241895,168717936),e(666307205,1188179964),e(773529912,1546045734),e(1294757372,1522805485),e(1396182291,2643833823),e(1695183700,2343527390),e(1986661051,1014477480),e(2177026350,1206759142),e(2456956037,344077627),e(2730485921,1290863460),e(2820302411,3158454273),e(3259730800,3505952657),e(3345764771,106217008),e(3516065817,3606008344),e(3600352804,1432725776),e(4094571909,1467031594),e(275423344,851169720),e(430227734,3100823752),e(506948616,1363258195),e(659060556,3750685593),e(883997877,3785050280),e(958139571,3318307427),e(1322822218,3812723403),e(1537002063,2003034995),e(1747873779,3602036899),e(1955562222,1575990012),e(2024104815,1125592928),e(2227730452,2716904306),e(2361852424,442776044),e(2428436474,593698344),e(2756734187,3733110249),e(3204031479,2999351573),e(3329325298,3815920427),e(3391569614,3928383900),e(3515267271,566280711),e(3940187606,3454069534),e(4118630271,4000239992),e(116418474,1914138554),e(174292421,2731055270),e(289380356,3203993006),e(460393269,320620315),e(685471733,587496836),e(852142971,1086792851),e(1017036298,365543100),e(1126000580,2618297676),e(1288033470,3409855158),e(1501505948,4234509866),e(1607167915,987167468),e(1816402316,1246189591)],s=[],u=0;80>u;u++)s[u]=e();a=a.SHA512=n.extend({_doReset:function(){this._hash=new i.init([new r.init(1779033703,4089235720),new r.init(3144134277,2227873595),new r.init(1013904242,4271175723),new r.init(2773480762,1595750129),new r.init(1359893119,2917565137),new r.init(2600822924,725511199),new r.init(528734635,4215389547),new r.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=(f=this._hash.words)[0],r=f[1],i=f[2],a=f[3],u=f[4],c=f[5],l=f[6],f=f[7],h=n.high,p=n.low,d=r.high,v=r.low,y=i.high,m=i.low,g=a.high,b=a.low,k=u.high,w=u.low,x=c.high,S=c.low,I=l.high,_=l.low,A=f.high,C=f.low,D=h,M=p,O=d,F=v,E=y,T=m,j=g,P=b,L=k,R=w,B=x,H=S,N=I,U=_,z=A,K=C,W=0;80>W;W++){var J=s[W];if(16>W)var q=J.high=0|e[t+2*W],V=J.low=0|e[t+2*W+1];else{q=((V=(q=s[W-15]).high)>>>1|($=q.low)<<31)^(V>>>8|$<<24)^V>>>7;var $=($>>>1|V<<31)^($>>>8|V<<24)^($>>>7|V<<25),G=((V=(G=s[W-2]).high)>>>19|(Q=G.low)<<13)^(V<<3|Q>>>29)^V>>>6,Q=(Q>>>19|V<<13)^(Q<<3|V>>>29)^(Q>>>6|V<<26),X=(V=s[W-7]).high,Y=(Z=s[W-16]).high,Z=Z.low;q=(q=(q=q+X+((V=$+V.low)>>>0<$>>>0?1:0))+G+((V+=Q)>>>0<Q>>>0?1:0))+Y+((V+=Z)>>>0<Z>>>0?1:0),J.high=q,J.low=V}X=L&B^~L&N,Z=R&H^~R&U,J=D&O^D&E^O&E;var ee=M&F^M&T^F&T,te=($=(D>>>28|M<<4)^(D<<30|M>>>2)^(D<<25|M>>>7),G=(M>>>28|D<<4)^(M<<30|D>>>2)^(M<<25|D>>>7),(Q=o[W]).high),ne=Q.low;Y=z+((L>>>14|R<<18)^(L>>>18|R<<14)^(L<<23|R>>>9))+((Q=K+((R>>>14|L<<18)^(R>>>18|L<<14)^(R<<23|L>>>9)))>>>0<K>>>0?1:0),z=N,K=U,N=B,U=H,B=L,H=R,L=j+(Y=(Y=(Y=Y+X+((Q+=Z)>>>0<Z>>>0?1:0))+te+((Q+=ne)>>>0<ne>>>0?1:0))+q+((Q+=V)>>>0<V>>>0?1:0))+((R=P+Q|0)>>>0<P>>>0?1:0)|0,j=E,P=T,E=O,T=F,O=D,F=M,D=Y+(J=$+J+((V=G+ee)>>>0<G>>>0?1:0))+((M=Q+V|0)>>>0<Q>>>0?1:0)|0}p=n.low=p+M,n.high=h+D+(p>>>0<M>>>0?1:0),v=r.low=v+F,r.high=d+O+(v>>>0<F>>>0?1:0),m=i.low=m+T,i.high=y+E+(m>>>0<T>>>0?1:0),b=a.low=b+P,a.high=g+j+(b>>>0<P>>>0?1:0),w=u.low=w+R,u.high=k+L+(w>>>0<R>>>0?1:0),S=c.low=S+H,c.high=x+B+(S>>>0<H>>>0?1:0),_=l.low=_+U,l.high=I+N+(_>>>0<U>>>0?1:0),C=f.low=C+K,f.high=A+z+(C>>>0<K>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32}),t.SHA512=n._createHelper(a),t.HmacSHA512=n._createHmacHelper(a)}(),u=(s=c).enc.Utf8,s.algo.HMAC=s.lib.Base.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=u.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),o=i.words,s=a.words,c=0;c<n;c++)o[c]^=1549556828,s[c]^=909522486;i.sigBytes=a.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}}),c=c||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math),function(){var e=c,t=(i=e.lib).WordArray,n=i.Hasher,r=[],i=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var l=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=l<<1|l>>>31}l=(i<<5|i>>>27)+u+r[c],l=20>c?l+(1518500249+(a&o|~a&s)):40>c?l+(1859775393+(a^o^s)):60>c?l+((a&o|a&s|o&s)-1894007588):l+((a^o^s)-899497514),u=s,s=o,o=a<<30|a>>>2,a=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+a|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(i),e.HmacSHA1=n._createHmacHelper(i)}(),function(){var e=c,t=e.enc.Utf8;e.algo.HMAC=e.lib.Base.extend({init:function(e,n){e=this._hasher=new e.init,"string"==typeof n&&(n=t.parse(n));var r=e.blockSize,i=4*r;n.sigBytes>i&&(n=e.finalize(n)),n.clamp();for(var a=this._oKey=n.clone(),o=this._iKey=n.clone(),s=a.words,u=o.words,c=0;c<r;c++)s[c]^=1549556828,u[c]^=909522486;a.sigBytes=o.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher;return e=t.finalize(e),t.reset(),t.finalize(this._oKey.clone().concat(e))}})}(),function(){var e,t=c,n=(e=t.lib).Base,r=e.WordArray,i=(e=t.algo).HMAC,a=e.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:e.SHA1,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){var n=this.cfg,a=i.create(n.hasher,e),o=r.create(),s=r.create([1]),u=o.words,c=s.words,l=n.keySize;for(n=n.iterations;u.length<l;){var f=a.update(t).finalize(s);a.reset();for(var h=f.words,p=h.length,d=f,v=1;v<n;v++){d=a.finalize(d),a.reset();for(var y=d.words,m=0;m<p;m++)h[m]^=y[m]}o.concat(f),c[0]++}return o.sigBytes=4*l,o}});t.PBKDF2=function(e,t,n){return a.create(n).compute(e,t)}}(),c=c||function(e,t){var n={},r=n.lib={},i=function(){},a=r.Base={extend:function(e){i.prototype=this;var t=new i;return e&&t.mixIn(e),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=r.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes;if(e=e.sigBytes,this.clamp(),r%4)for(var i=0;i<e;i++)t[r+i>>>2]|=(n[i>>>2]>>>24-i%4*8&255)<<24-(r+i)%4*8;else if(65535<n.length)for(i=0;i<e;i+=4)t[r+i>>>2]=n[i>>>2];else t.push.apply(t,n);return this.sigBytes+=e,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n=[],r=0;r<t;r+=4)n.push(4294967296*e.random()|0);return new o.init(n,t)}}),s=n.enc={},u=s.Hex={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++){var i=t[r>>>2]>>>24-r%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=s.Latin1={stringify:function(e){var t=e.words;e=e.sigBytes;for(var n=[],r=0;r<e;r++)n.push(String.fromCharCode(t[r>>>2]>>>24-r%4*8&255));return n.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=s.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},f=r.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,a=this.blockSize,s=i/(4*a);if(t=(s=t?e.ceil(s):e.max((0|s)-this._minBufferSize,0))*a,i=e.min(4*t,i),t){for(var u=0;u<t;u+=a)this._doProcessBlock(r,u);u=r.splice(0,t),n.sigBytes-=i}return new o.init(u,i)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});r.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new h.HMAC.init(e,n).finalize(t)}}});var h=n.algo={};return n}(Math),function(){var e=c,t=(i=e.lib).WordArray,n=i.Hasher,r=[],i=e.algo.SHA1=n.extend({_doReset:function(){this._hash=new t.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,i=n[0],a=n[1],o=n[2],s=n[3],u=n[4],c=0;80>c;c++){if(16>c)r[c]=0|e[t+c];else{var l=r[c-3]^r[c-8]^r[c-14]^r[c-16];r[c]=l<<1|l>>>31}l=(i<<5|i>>>27)+u+r[c],l=20>c?l+(1518500249+(a&o|~a&s)):40>c?l+(1859775393+(a^o^s)):60>c?l+((a&o|a&s|o&s)-1894007588):l+((a^o^s)-899497514),u=s,s=o,o=a<<30|a>>>2,a=i,i=l}n[0]=n[0]+i|0,n[1]=n[1]+a|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});e.SHA1=n._createHelper(i),e.HmacSHA1=n._createHmacHelper(i)}(),Object.defineProperty(i,"__esModule",{value:!0}),i.StandardFile=i.SFItemTransformer=i.SFCryptoWeb=i.SFCryptoJS=i.SFAbstractCrypto=i.SFItemHistoryEntry=i.SFItemHistory=i.SFHistorySession=i.SFPrivileges=i.SFPredicate=i.SFItemParams=i.SFItem=i.SFSyncManager=i.SFStorageManager=i.SFSingletonManager=i.SFSessionHistoryManager=i.SFPrivilegesManager=i.SFModelManager=i.SFMigrationManager=i.SFHttpManager=i.SFAuthManager=i.SFAlertManager=void 0;var w=function(){function e(){g(this,e)}var t,n;return k(e,[{key:"alert",value:(n=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){window.alert(t.text),e()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"confirm",value:(t=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){window.confirm(t.text)?e():n()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();i.SFAlertManager=w;var x=function(){function e(t,n,r,i){g(this,e),e.DidSignOutEvent="DidSignOutEvent",e.WillSignInEvent="WillSignInEvent",e.DidSignInEvent="DidSignInEvent",this.httpManager=n,this.storageManager=t,this.alertManager=r||new w,this.$timeout=i||setTimeout.bind(window),this.eventHandlers=[]}var t,n,i,a,o,s,u,c,l,f;return k(e,[{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=this.eventHandlers[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)(0,a.value)(e,t||{})}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"saveKeys",value:(f=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._keys=t,e.next=3,this.storageManager.setItem("mk",t.mk);case 3:return e.next=5,this.storageManager.setItem("ak",t.ak);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"signout",value:(l=m(r.mark((function t(n){var i=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._keys=null,this._authParams=null,!n){t.next=6;break}return t.abrupt("return",this.storageManager.clearAllData().then((function(){i.notifyEvent(e.DidSignOutEvent)})));case 6:this.notifyEvent(e.DidSignOutEvent);case 7:case"end":return t.stop()}}),t,this)}))),function(e){return l.apply(this,arguments)})},{key:"keys",value:(c=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._keys){e.next=11;break}return e.next=3,this.storageManager.getItem("mk");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.t0=t,e.next=9,this.storageManager.getItem("ak");case 9:e.t1=e.sent,this._keys={mk:e.t0,ak:e.t1};case 11:return e.abrupt("return",this._keys);case 12:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getAuthParams",value:(u=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._authParams){e.next=5;break}return e.next=3,this.storageManager.getItem("auth_params");case 3:t=e.sent,this._authParams=JSON.parse(t);case 5:if(!this._authParams||this._authParams.version){e.next=9;break}return e.next=8,this.defaultProtocolVersion();case 8:this._authParams.version=e.sent;case 9:return e.abrupt("return",this._authParams);case 10:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"defaultProtocolVersion",value:(s=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keys();case 2:if(!(t=e.sent)||!t.ak){e.next=7;break}return e.abrupt("return","002");case 7:return e.abrupt("return","001");case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"protocolVersion",value:(o=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAuthParams();case 2:if(!(t=e.sent)||!t.version){e.next=5;break}return e.abrupt("return",t.version);case 5:return e.abrupt("return",this.defaultProtocolVersion());case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getAuthParamsForEmail",value:(a=m(r.mark((function e(t,n,i){var a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=_.merge({email:n},i)).api=I.getApiVersion(),e.abrupt("return",new Promise((function(e,n){var r=t+"/auth/params";o.httpManager.getAbsolute(r,a,(function(t){e(t)}),(function(t){console.error("Error getting auth params",t),"object"!==v(t)&&(t={error:{message:"A server error occurred while trying to sign in. Please try again."}}),e(t)}))})));case 3:case"end":return e.stop()}}),e)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}},{key:"isLocked",value:function(){return 1==this.locked}},{key:"unlockAndResolve",value:function(e,t){this.unlock(),e(t)}},{key:"login",value:(i=m(r.mark((function t(n,i,a,o,s){var u=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(){var t=m(r.mark((function t(c,l){var f,h,p,d,y,g,b,k,w,x;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.keys();case 2:if(null==t.sent){t.next=6;break}return c({error:{message:"Cannot log in because already signed in."}}),t.abrupt("return");case 6:if(!u.isLocked()){t.next=9;break}return c({error:{message:"Login already in progress."}}),t.abrupt("return");case 9:return u.lock(),u.notifyEvent(e.WillSignInEvent),t.next=13,u.getAuthParamsForEmail(n,i,s);case 13:if((f=t.sent).identifier=i,!f.error){t.next=18;break}return u.unlockAndResolve(c,f),t.abrupt("return");case 18:if(f&&f.pw_cost){t.next=21;break}return u.unlockAndResolve(c,{error:{message:"Invalid email or password."}}),t.abrupt("return");case 21:if(SFJS.supportedVersions().includes(f.version)){t.next=25;break}return h=SFJS.isVersionNewerThanLibraryVersion(f.version)?"This version of the application does not support your newer account type. Please upgrade to the latest version of Standard Notes to sign in.":"The protocol version associated with your account is outdated and no longer supported by this application. Please visit standardnotes.org/help/security for more information.",u.unlockAndResolve(c,{error:{message:h}}),t.abrupt("return");case 25:if(!SFJS.isProtocolVersionOutdated(f.version)){t.next=32;break}return p="The encryption version for your account, ".concat(f.version,", is outdated and requires upgrade. You may proceed with login, but are advised to perform a security update using the web or desktop application. Please visit standardnotes.org/help/security for more information."),d=!1,t.next=30,u.alertManager.confirm({title:"Update Needed",text:p,confirmButtonText:"Sign In"}).catch((function(){u.unlockAndResolve(c,{error:{}}),d=!0}));case 30:if(!d){t.next=32;break}return t.abrupt("return");case 32:if(SFJS.supportsPasswordDerivationCost(f.pw_cost)){t.next=36;break}return u.unlockAndResolve(c,{error:{message:"Your account was created on a platform with higher security capabilities than this browser supports. If we attempted to generate your login keys here, it would take hours. Please use a browser with more up to date security capabilities, like Google Chrome or Firefox, to log in."}}),t.abrupt("return");case 36:if(y=SFJS.costMinimumForVersion(f.version),!(f.pw_cost<y)){t.next=41;break}return u.unlockAndResolve(c,{error:{message:"Unable to login due to insecure password parameters. Please visit standardnotes.org/help/security for more information."}}),t.abrupt("return");case 41:if(!o){t.next=47;break}if(g=SFJS.version(),f.version===g){t.next=47;break}return b="Strict sign in refused server sign in parameters. The latest security version is ".concat(g,", but your account is reported to have version ").concat(f.version,". If you'd like to proceed with sign in anyway, please disable strict sign in and try again."),u.unlockAndResolve(c,{error:{message:b}}),t.abrupt("return");case 47:return t.next=49,SFJS.crypto.computeEncryptionKeysForUser(a,f);case 49:k=t.sent,w=n+"/auth/sign_in",(x=_.merge({password:k.pw,email:i},s)).api=I.getApiVersion(),u.httpManager.postAbsolute(w,x,function(){var t=m(r.mark((function t(a){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.handleAuthResponse(a,i,n,f,k);case 2:u.notifyEvent(e.DidSignInEvent),u.$timeout((function(){return u.unlockAndResolve(c,a)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(e){console.error("Error logging in",e),"object"!==v(e)&&(e={error:{message:"A server error occurred while trying to sign in. Please try again."}}),u.$timeout((function(){return u.unlockAndResolve(c,e)}))}));case 54:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}}),t)}))),function(e,t,n,r,a){return i.apply(this,arguments)})},{key:"register",value:function(e,t,n){var i=this;return new Promise(function(){var a=m(r.mark((function a(o,s){var u,c,l,f,h,p;return r.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i.isLocked()){a.next=3;break}return o({error:{message:"Register already in progress."}}),a.abrupt("return");case 3:if(!(n.length<8)){a.next=8;break}return u="Your password must be at least ".concat(8," characters in length. For your security, please choose a longer password or, ideally, a passphrase, and try again."),o({error:{message:u}}),a.abrupt("return");case 8:return i.lock(),a.next=11,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(t,n);case 11:c=a.sent,l=c.keys,f=c.authParams,h=e+"/auth",(p=_.merge({password:l.pw,email:t},f)).api=I.getApiVersion(),i.httpManager.postAbsolute(h,p,function(){var n=m(r.mark((function n(a){return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.handleAuthResponse(a,t,e,f,l);case 2:i.unlockAndResolve(o,a);case 3:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),(function(e){console.error("Registration error",e),"object"!==v(e)&&(e={error:{message:"A server error occurred while trying to register. Please try again."}}),i.unlockAndResolve(o,e)}));case 18:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"changePassword",value:(n=m(r.mark((function e(t,n,i,a,o){var s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=m(r.mark((function e(u,c){var l,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.isLocked()){e.next=3;break}return u({error:{message:"Change password already in progress."}}),e.abrupt("return");case 3:s.lock(),l=a.pw,f=t+"/auth/change_pw",(h=_.merge({new_password:l,current_password:i},o)).api=I.getApiVersion(),s.httpManager.postAuthenticatedAbsolute(f,h,function(){var e=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.handleAuthResponse(t,n,null,o,a);case 2:s.unlockAndResolve(u,t);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){"object"!==v(e)&&(e={error:{message:"Something went wrong while changing your password. Your password was not changed. Please try again."}}),s.unlockAndResolve(u,e)}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"handleAuthResponse",value:(t=m(r.mark((function e(t,n,i,a,o){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=3;break}return e.next=3,this.storageManager.setItem("server",i);case 3:return this._authParams=a,e.next=6,this.storageManager.setItem("auth_params",JSON.stringify(a));case 6:return e.next=8,this.storageManager.setItem("jwt",t.token);case 8:return e.abrupt("return",this.saveKeys(o));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,a){return t.apply(this,arguments)})}]),e}();i.SFAuthManager=x;var S="undefined"!=typeof window?window:void 0!==e?e:null,I=function(){function e(t,n){g(this,e),this.$timeout=t||setTimeout.bind(S)}var t,n,i,a,o,s;return k(e,null,[{key:"getApiVersion",value:function(){return"20190520"}}]),k(e,[{key:"setJWTRequestHandler",value:function(e){this.jwtRequestHandler=e}},{key:"setAuthHeadersForRequest",value:(s=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.jwtRequestHandler();case 2:(n=e.sent)&&t.setRequestHeader("Authorization","Bearer "+n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"postAbsolute",value:(o=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,n,i,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return o.apply(this,arguments)})},{key:"postAuthenticatedAbsolute",value:(a=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("post",t,n,i,a,!0));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"patchAbsolute",value:(i=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("patch",t,n,i,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return i.apply(this,arguments)})},{key:"getAbsolute",value:(n=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.httpRequest("get",t,n,i,a));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"httpRequest",value:(t=m(r.mark((function e(t,n,i,a,o){var s,u=this,c=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=c.length>5&&void 0!==c[5]&&c[5],e.abrupt("return",new Promise(function(){var e=m(r.mark((function e(c,l){var f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((f=new XMLHttpRequest).onreadystatechange=function(){if(4==f.readyState){var e=f.responseText;if(e)try{e=JSON.parse(e)}catch(e){}f.status>=200&&f.status<=299?u.$timeout((function(){a(e),c(e)})):(console.error("Request error:",e),u.$timeout((function(){o(e,f.status),l(e)})))}},"get"==t&&Object.keys(i).length>0&&(n=u.urlForUrlAndParams(n,i)),f.open(t,n,!0),f.setRequestHeader("Content-type","application/json"),!s){e.next=8;break}return e.next=8,u.setAuthHeadersForRequest(f);case 8:"post"==t||"patch"==t?f.send(JSON.stringify(i)):f.send();case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}),e)}))),function(e,n,r,i,a){return t.apply(this,arguments)})},{key:"urlForUrlAndParams",value:function(e,t){var n=Object.keys(t).map((function(e){return e+"="+encodeURIComponent(t[e])})).join("&");return e.includes("?")?e+"&"+n:e+"?"+n}}]),e}();i.SFHttpManager=I;var A=function(){function e(t,n,i,a){var o=this;g(this,e),this.modelManager=t,this.syncManager=n,this.storageManager=i,this.completionHandlers=[],this.loadMigrations();var s=!1,u=a.addEventHandler((function(e){e==x.DidSignInEvent&&(s=!0)}));this.receivedLocalDataEvent=n.initialDataLoaded(),this.syncManager.addEventHandler(function(){var e=m(r.mark((function e(t,n){var i,c,l,f,h,p,d,v,y;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c="sync:completed"==t,!(i="local-data-loaded"==t)&&!c){e.next=40;break}if(i?o.receivedLocalDataEvent=!0:c&&(o.receivedSyncCompletedEvent=!0),!o.receivedLocalDataEvent||!o.receivedSyncCompletedEvent){e.next=40;break}if(!s){e.next=39;break}return s=!1,a.removeEventHandler(u),e.next=10,o.getCompletedMigrations();case 10:l=e.sent.slice(),f=!0,h=!1,p=void 0,e.prev=14,d=l[Symbol.iterator]();case 16:if(f=(v=d.next()).done){e.next=25;break}return y=v.value,e.next=20,o.migrationForEncodedName(y);case 20:e.sent.runOnlyOnce||_.pull(o._completed,y);case 22:f=!0,e.next=16;break;case 25:e.next=31;break;case 27:e.prev=27,e.t0=e.catch(14),h=!0,p=e.t0;case 31:e.prev=31,e.prev=32,f||null==d.return||d.return();case 34:if(e.prev=34,!h){e.next=37;break}throw p;case 37:return e.finish(34);case 38:return e.finish(31);case 39:o.runPendingMigrations();case 40:case"end":return e.stop()}}),e,null,[[14,27,31,39],[32,,34,38]])})));return function(t,n){return e.apply(this,arguments)}}())}var t,n,i,a,o,s,u,c;return k(e,[{key:"addCompletionHandler",value:function(e){this.completionHandlers.push(e)}},{key:"removeCompletionHandler",value:function(e){_.pull(this.completionHandlers,e)}},{key:"migrationForEncodedName",value:(c=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.decode(t);case 2:return n=e.sent,e.abrupt("return",this.migrations.find((function(e){return e.name==n})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"loadMigrations",value:function(){this.migrations=this.registeredMigrations()}},{key:"registeredMigrations",value:function(){}},{key:"runPendingMigrations",value:(u=m(r.mark((function e(){var t,n,i,a,o,s,u,c,l,f,h,p,d,v,y,m,g,b,k,w,x,S,I,_,A,C,D,M;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPendingMigrations();case 2:for(t=e.sent,n=!0,i=!1,a=void 0,e.prev=6,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)(u=s.value).items=[];e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),i=!0,a=e.t0;case 14:e.prev=14,e.prev=15,n||null==o.return||o.return();case 17:if(e.prev=17,!i){e.next=20;break}throw a;case 20:return e.finish(17);case 21:return e.finish(14);case 22:c=!0,l=!1,f=void 0,e.prev=25,h=this.modelManager.allNondummyItems[Symbol.iterator]();case 27:if(c=(p=h.next()).done){e.next=51;break}for(d=p.value,v=!0,y=!1,m=void 0,e.prev=32,g=t[Symbol.iterator]();!(v=(b=g.next()).done);v=!0)u=b.value,d.content_type==u.content_type&&u.items.push(d);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),y=!0,m=e.t1;case 40:e.prev=40,e.prev=41,v||null==g.return||g.return();case 43:if(e.prev=43,!y){e.next=46;break}throw m;case 46:return e.finish(43);case 47:return e.finish(40);case 48:c=!0,e.next=27;break;case 51:e.next=57;break;case 53:e.prev=53,e.t2=e.catch(25),l=!0,f=e.t2;case 57:e.prev=57,e.prev=58,c||null==h.return||h.return();case 60:if(e.prev=60,!l){e.next=63;break}throw f;case 63:return e.finish(60);case 64:return e.finish(57);case 65:k=!0,w=!1,x=void 0,e.prev=68,S=t[Symbol.iterator]();case 70:if(k=(I=S.next()).done){e.next=81;break}if(!((u=I.value).items&&u.items.length>0||u.customHandler)){e.next=77;break}return e.next=75,this.runMigration(u,u.items);case 75:e.next=78;break;case 77:this.markMigrationCompleted(u);case 78:k=!0,e.next=70;break;case 81:e.next=87;break;case 83:e.prev=83,e.t3=e.catch(68),w=!0,x=e.t3;case 87:e.prev=87,e.prev=88,k||null==S.return||S.return();case 90:if(e.prev=90,!w){e.next=93;break}throw x;case 93:return e.finish(90);case 94:return e.finish(87);case 95:for(_=!0,A=!1,C=void 0,e.prev=98,D=this.completionHandlers[Symbol.iterator]();!(_=(M=D.next()).done);_=!0)(0,M.value)();e.next=106;break;case 102:e.prev=102,e.t4=e.catch(98),A=!0,C=e.t4;case 106:e.prev=106,e.prev=107,_||null==D.return||D.return();case 109:if(e.prev=109,!A){e.next=112;break}throw C;case 112:return e.finish(109);case 113:return e.finish(106);case 114:case"end":return e.stop()}}),e,this,[[6,10,14,22],[15,,17,21],[25,53,57,65],[32,36,40,48],[41,,43,47],[58,,60,64],[68,83,87,95],[88,,90,94],[98,102,106,114],[107,,109,113]])}))),function(){return u.apply(this,arguments)})},{key:"encode",value:(s=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.btoa(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"decode",value:(o=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.atob(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"getCompletedMigrations",value:(a=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._completed){e.next=5;break}return e.next=3,this.storageManager.getItem("migrations");case 3:t=e.sent,this._completed=t?JSON.parse(t):[];case 5:return e.abrupt("return",this._completed);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getPendingMigrations",value:(i=m(r.mark((function e(){var t,n,i,a,o,s,u,c;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:t=e.sent,n=[],i=!0,a=!1,o=void 0,e.prev=7,s=this.migrations[Symbol.iterator]();case 9:if(i=(u=s.next()).done){e.next=22;break}return c=u.value,e.t0=t,e.next=14,this.encode(c.name);case 14:if(e.t1=e.sent,e.t2=e.t0.indexOf.call(e.t0,e.t1),e.t3=-1,e.t2!=e.t3){e.next=19;break}n.push(c);case 19:i=!0,e.next=9;break;case 22:e.next=28;break;case 24:e.prev=24,e.t4=e.catch(7),a=!0,o=e.t4;case 28:e.prev=28,e.prev=29,i||null==s.return||s.return();case 31:if(e.prev=31,!a){e.next=34;break}throw o;case 34:return e.finish(31);case 35:return e.finish(28);case 36:return e.abrupt("return",n);case 37:case"end":return e.stop()}}),e,this,[[7,24,28,36],[29,,31,35]])}))),function(){return i.apply(this,arguments)})},{key:"markMigrationCompleted",value:(n=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getCompletedMigrations();case 2:return n=e.sent,e.t0=n,e.next=6,this.encode(t.name);case 6:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),this.storageManager.setItem("migrations",JSON.stringify(n)),t.running=!1;case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"runMigration",value:(t=m(r.mark((function e(t,n){var i=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.running){e.next=2;break}return e.abrupt("return");case 2:if(console.log("Running migration:",t.name),t.running=!0,!t.customHandler){e.next=8;break}return e.abrupt("return",t.customHandler().then((function(){i.markMigrationCompleted(t)})));case 8:return e.abrupt("return",t.handler(n).then((function(){i.markMigrationCompleted(t)})));case 9:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFMigrationManager=A;var C=function(){function e(t){g(this,e),e.MappingSourceRemoteRetrieved="MappingSourceRemoteRetrieved",e.MappingSourceRemoteSaved="MappingSourceRemoteSaved",e.MappingSourceLocalSaved="MappingSourceLocalSaved",e.MappingSourceLocalRetrieved="MappingSourceLocalRetrieved",e.MappingSourceLocalDirtied="MappingSourceLocalDirtied",e.MappingSourceComponentRetrieved="MappingSourceComponentRetrieved",e.MappingSourceDesktopInstalled="MappingSourceDesktopInstalled",e.MappingSourceRemoteActionRetrieved="MappingSourceRemoteActionRetrieved",e.MappingSourceFileImport="MappingSourceFileImport",e.isMappingSourceRetrieved=function(t){return[e.MappingSourceRemoteRetrieved,e.MappingSourceComponentRetrieved,e.MappingSourceRemoteActionRetrieved].includes(t)},this.$timeout=t||setTimeout.bind(window),this.itemSyncObservers=[],this.items=[],this.itemsHash={},this.missedReferences={},this.uuidChangeObservers=[]}var t,n,i,a,o,s,u,c,l,f,h,p;return k(e,[{key:"handleSignout",value:function(){this.items.length=0,this.itemsHash={},this.missedReferences={}}},{key:"addModelUuidChangeObserver",value:function(e,t){this.uuidChangeObservers.push({id:e,callback:t})}},{key:"notifyObserversOfUuidChange",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=this.uuidChangeObservers[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;try{s.callback(e,t)}catch(e){console.error("Notify observers of uuid change exception:",e)}}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"alternateUUIDForItem",value:(p=m(r.mark((function t(n){var i,a,o,s,u,c,l;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.createItem(n),t.next=3,SFJS.crypto.generateUUID();case 3:for(i.uuid=t.sent,i.informReferencesOfUUIDChange(n.uuid,i.uuid),this.informModelsOfUUIDChangeForItem(i,n.uuid,i.uuid),a=!0,o=!1,s=void 0,t.prev=9,u=n.referencingObjects[Symbol.iterator]();!(a=(c=u.next()).done);a=!0)(l=c.value).setIsNoLongerBeingReferencedBy(n),n.setIsNoLongerBeingReferencedBy(l),l.addItemAsRelationship(i);t.next=17;break;case 13:t.prev=13,t.t0=t.catch(9),o=!0,s=t.t0;case 17:t.prev=17,t.prev=18,a||null==u.return||u.return();case 20:if(t.prev=20,!o){t.next=23;break}throw s;case 23:return t.finish(20);case 24:return t.finish(17);case 25:return this.setItemsDirty(n.referencingObjects,!0),this.resolveReferencesForItem(i),this.loggingEnabled&&console.log(n.uuid,"--\x3e",i.uuid),n.deleted=!0,n.content.references=[],this.setItemDirty(n,!1,!1,e.MappingSourceLocalSaved),t.next=33,this.mapResponseItemsToLocalModels([n],e.MappingSourceLocalSaved);case 33:return this.addItem(i),this.setItemDirty(i,!0,!0,e.MappingSourceLocalSaved),this.notifyObserversOfUuidChange(n,i),t.abrupt("return",i);case 37:case"end":return t.stop()}}),t,this,[[9,13,17,25],[18,,20,24]])}))),function(e){return p.apply(this,arguments)})},{key:"informModelsOfUUIDChangeForItem",value:function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=this.items[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)o.value.potentialItemOfInterestHasChangedItsUUID(e,t,n)}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"didSyncModelsOffline",value:function(t){this.notifySyncObserversOfModels(t,e.MappingSourceLocalSaved)}},{key:"mapResponseItemsToLocalModels",value:(h=m(r.mark((function e(t,n,i){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,source:n,sourceKey:i}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return h.apply(this,arguments)})},{key:"mapResponseItemsToLocalModelsOmittingFields",value:(f=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.mapResponseItemsToLocalModelsWithOptions({items:t,omitFields:n,source:i,sourceKey:a}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return f.apply(this,arguments)})},{key:"mapResponseItemsToLocalModelsWithOptions",value:(l=m(r.mark((function e(t){var n,i,a,o,s,u,c,l,f,h,p,v,y,m,g,b,k,w,x,S,I,_,A,C,D,M,O,F,E,T,j,P,L,R,B,H,N,U,z;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.items,i=t.omitFields,a=t.source,o=t.sourceKey,t.options,s=[],u=[],c=[],l=!0,f=!1,h=void 0,e.prev=5,p=n[Symbol.iterator]();case 7:if(l=(v=p.next()).done){e.next=58;break}if(y=v.value){e.next=11;break}return e.abrupt("continue",55);case 11:if(m=!y.content&&!y.errorDecrypting,y.content_type&&y.uuid&&!m||y.deleted){e.next=16;break}return console.error("Server response item is corrupt:",y),e.abrupt("continue",55);case 16:if(!Array.isArray(i)){e.next=36;break}for(g=!0,b=!1,k=void 0,e.prev=20,w=i[Symbol.iterator]();!(g=(x=w.next()).done);g=!0)S=x.value,delete y[S];e.next=28;break;case 24:e.prev=24,e.t0=e.catch(20),b=!0,k=e.t0;case 28:e.prev=28,e.prev=29,g||null==w.return||w.return();case 31:if(e.prev=31,!b){e.next=34;break}throw k;case 34:return e.finish(31);case 35:return e.finish(28);case 36:if((I=this.findItem(y.uuid))&&(I.updateFromJSON(y),I.dummy=!1),_=y.content_type||I&&I.content_type,!this.acceptableContentTypes||this.acceptableContentTypes.includes(_)){e.next=42;break}return e.abrupt("continue",55);case 42:if(A=!1,1!=y.deleted){e.next=50;break}if(!y.dirty){e.next=48;break}A=!0,e.next=50;break;case 48:return I&&(s.push(I),c.push(I),this.removeItemLocally(I)),e.abrupt("continue",55);case 50:I||(I=this.createItem(y)),this.addItem(I,A),I.errorDecrypting||c.push(I),s.push(I),u.push(y);case 55:l=!0,e.next=7;break;case 58:e.next=64;break;case 60:e.prev=60,e.t1=e.catch(5),f=!0,h=e.t1;case 64:e.prev=64,e.prev=65,l||null==p.return||p.return();case 67:if(e.prev=67,!f){e.next=70;break}throw h;case 70:return e.finish(67);case 71:return e.finish(64);case 72:for(C=!0,D=!1,M=void 0,e.prev=75,O=u.entries()[Symbol.iterator]();!(C=(F=O.next()).done);C=!0)E=d(F.value,2),T=E[0],j=E[1],P=s[T],j.content&&this.resolveReferencesForItem(P),P.didFinishSyncing();e.next=83;break;case 79:e.prev=79,e.t2=e.catch(75),D=!0,M=e.t2;case 83:e.prev=83,e.prev=84,C||null==O.return||O.return();case 86:if(e.prev=86,!D){e.next=89;break}throw M;case 89:return e.finish(86);case 90:return e.finish(83);case 91:for(L=this.popMissedReferenceStructsForObjects(u),R=!0,B=!1,H=void 0,e.prev=95,N=function(){var e=z.value,t=s.find((function(t){return t.uuid==e.reference_uuid}));t&&e.for_item.addItemAsRelationship(t)},U=L[Symbol.iterator]();!(R=(z=U.next()).done);R=!0)N();e.next=104;break;case 100:e.prev=100,e.t3=e.catch(95),B=!0,H=e.t3;case 104:e.prev=104,e.prev=105,R||null==U.return||U.return();case 107:if(e.prev=107,!B){e.next=110;break}throw H;case 110:return e.finish(107);case 111:return e.finish(104);case 112:return e.next=114,this.notifySyncObserversOfModels(c,a,o);case 114:return e.abrupt("return",s);case 115:case"end":return e.stop()}}),e,this,[[5,60,64,72],[20,24,28,36],[29,,31,35],[65,,67,71],[75,79,83,91],[84,,86,90],[95,100,104,112],[105,,107,111]])}))),function(e){return l.apply(this,arguments)})},{key:"missedReferenceBuildKey",value:function(e,t){return"".concat(e,":").concat(t)}},{key:"popMissedReferenceStructsForObjects",value:function(e){if(!e||0==e.length)return[];for(var t=[],n=[],r=e.map((function(e){return e.uuid})),i=r[0].length,a=0,o=Object.keys(this.missedReferences);a<o.length;a++){var s=o[a];r.includes(s.substring(0,i))&&(t.push(this.missedReferences[s]),n.push(s))}for(var u=0,c=n;u<c.length;u++){var l=c[u];delete this.missedReferences[l]}return t}},{key:"resolveReferencesForItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e.errorDecrypting){var n=e.contentObject;if(e.updateLocalRelationships(),n.references){var r=n.references.slice(),i=r.map((function(e){return e.uuid})),a=!0,o=this.findItems(i,a),s=!0,u=!1,c=void 0;try{for(var l,f=o.entries()[Symbol.iterator]();!(s=(l=f.next()).done);s=!0){var h=d(l.value,2),p=h[0],v=h[1];if(v)e.addItemAsRelationship(v),t&&this.setItemDirty(v,!0);else{var y=i[p],m=this.missedReferenceBuildKey(y,e.uuid);if(!this.missedReferences[m]){var g={reference_uuid:y,for_item:e};this.missedReferences[m]=g}}}}catch(e){u=!0,c=e}finally{try{s||null==f.return||f.return()}finally{if(u)throw c}}}}}},{key:"notifySyncObserversOfModels",value:(c=m(r.mark((function e(t,n,i){var a,o,s,u,c,l,f,h=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.itemSyncObservers.sort((function(e,t){return e.priority<t.priority?-1:1})),o=!0,s=!1,u=void 0,e.prev=4,c=r.mark((function e(){var a,o,s,u,c,l,p,d,v,y;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=f.value,o=a.types.includes("*")?t:t.filter((function(e){return a.types.includes(e.content_type)})),s=[],u=[],c=!0,l=!1,p=void 0,e.prev=6,d=o[Symbol.iterator]();!(c=(v=d.next()).done);c=!0)(y=v.value).deleted?u.push(y):s.push(y);e.next=14;break;case 10:e.prev=10,e.t0=e.catch(6),l=!0,p=e.t0;case 14:e.prev=14,e.prev=15,c||null==d.return||d.return();case 17:if(e.prev=17,!l){e.next=20;break}throw p;case 20:return e.finish(17);case 21:return e.finish(14);case 22:if(!(o.length>0)){e.next=25;break}return e.next=25,h._callSyncObserverCallbackWithTimeout(a,o,s,u,n,i);case 25:case"end":return e.stop()}}),e,null,[[6,10,14,22],[15,,17,21]])})),l=a[Symbol.iterator]();case 7:if(o=(f=l.next()).done){e.next=12;break}return e.delegateYield(c(),"t0",9);case 9:o=!0,e.next=7;break;case 12:e.next=18;break;case 14:e.prev=14,e.t1=e.catch(4),s=!0,u=e.t1;case 18:e.prev=18,e.prev=19,o||null==l.return||l.return();case 21:if(e.prev=21,!s){e.next=24;break}throw u;case 24:return e.finish(21);case 25:return e.finish(18);case 26:case"end":return e.stop()}}),e,this,[[4,14,18,26],[19,,21,25]])}))),function(e,t,n){return c.apply(this,arguments)})},{key:"_callSyncObserverCallbackWithTimeout",value:(u=m(r.mark((function e(t,n,i,a,o,s){var u=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){u.$timeout((function(){try{t.callback(n,i,a,o,s)}catch(e){console.error("Sync observer exception",e)}finally{e()}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,n,r,i,a){return u.apply(this,arguments)})},{key:"setItemDirty",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;this.setItemsDirty([e],t,n,r,i)}},{key:"setItemsDirty",value:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=!0,s=!1,u=void 0;try{for(var c,l=t[Symbol.iterator]();!(o=(c=l.next()).done);o=!0){var f=c.value;f.setDirty(n,r)}}catch(e){s=!0,u=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw u}}this.notifySyncObserversOfModels(t,i||e.MappingSourceLocalDirtied,a)}},{key:"createItem",value:function(t){var n=e.ContentTypeClassMapping&&e.ContentTypeClassMapping[t.content_type];return n||(n=j),new n(t)}},{key:"createDuplicateItemFromResponseItem",value:(s=m(r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("function"!=typeof t.setDirty){e.next=3;break}return console.error("Attempting to create conflicted copy of non-response item."),e.abrupt("return",null);case 3:return n=JSON.parse(JSON.stringify(t)),e.next=6,SFJS.crypto.generateUUID();case 6:return n.uuid=e.sent,i=this.createItem(n),e.abrupt("return",i);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"duplicateItemAndAddAsConflict",value:function(e){return this.duplicateItemWithCustomContentAndAddAsConflict({content:e.content,duplicateOf:e})}},{key:"duplicateItemWithCustomContentAndAddAsConflict",value:function(e){var t=e.content,n=e.duplicateOf,r=this.duplicateItemWithCustomContent({content:t,duplicateOf:n});return this.addDuplicatedItemAsConflict({duplicate:r,duplicateOf:n}),r}},{key:"addDuplicatedItemAsConflict",value:function(e){var t=e.duplicate,n=e.duplicateOf;this.addDuplicatedItem(t,n),t.content.conflict_of=n.uuid}},{key:"duplicateItemWithCustomContent",value:function(e){var t=e.content,n=e.duplicateOf,r=new n.constructor({content:t});return r.created_at=n.created_at,r.content_type||(r.content_type=n.content_type),r}},{key:"duplicateItemAndAdd",value:function(e){var t=this.duplicateItemWithoutAdding(e);return this.addDuplicatedItem(t,e),t}},{key:"duplicateItemWithoutAdding",value:function(e){var t=new e.constructor({content:e.content});return t.created_at=e.created_at,t.content_type||(t.content_type=e.content_type),t}},{key:"addDuplicatedItem",value:function(e,t){this.addItem(e);var n=!0,r=!1,i=void 0;try{for(var a,o=t.referencingObjects[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.addItemAsRelationship(e),this.setItemDirty(s,!0)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.resolveReferencesForItem(e),this.setItemDirty(e,!0)}},{key:"addItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.addItems([e],t)}},{key:"addItems",value:function(e){var t=this;e.forEach((function(e){t.itemsHash[e.uuid]||(t.itemsHash[e.uuid]=e,t.items.push(e))}))}},{key:"addItemSyncObserver",value:function(e,t,n){this.addItemSyncObserverWithPriority({id:e,types:t,callback:n,priority:1})}},{key:"addItemSyncObserverWithPriority",value:function(e){var t=e.id,n=e.priority,r=e.types,i=e.callback;Array.isArray(r)||(r=[r]),this.itemSyncObservers.push({id:t,types:r,priority:n,callback:i})}},{key:"removeItemSyncObserver",value:function(e){_.remove(this.itemSyncObservers,_.find(this.itemSyncObservers,{id:e}))}},{key:"getDirtyItems",value:function(){return this.items.filter((function(e){return 1==e.dirty&&!e.dummy&&(!e.errorDecrypting||e.deleted)}))}},{key:"clearDirtyItems",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0)i.value.setDirty(!1)}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"removeAndDirtyAllRelationshipsForItem",value:function(e){if(!e.errorDecrypting){var t=!0,n=!1,r=void 0;try{for(var i,a=e.content.references[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=this.findItem(o.uuid);s&&(e.removeItemAsRelationship(s),s.hasRelationshipWithItem(e)&&(s.removeItemAsRelationship(e),this.setItemDirty(s,!0)))}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}var u=!0,c=!1,l=void 0;try{for(var f,h=e.referencingObjects[Symbol.iterator]();!(u=(f=h.next()).done);u=!0){var p=f.value;p.removeItemAsRelationship(e),this.setItemDirty(p,!0)}}catch(e){c=!0,l=e}finally{try{u||null==h.return||h.return()}finally{if(c)throw l}}e.referencingObjects=[]}},{key:"setAllItemsDirty",value:function(){var e=this.allItems;this.setItemsDirty(e,!0)}},{key:"setItemToBeDeleted",value:function(e){e.deleted=!0,e.dummy||this.setItemDirty(e,!0),this.removeAndDirtyAllRelationshipsForItem(e)}},{key:"removeItemLocally",value:(o=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_.remove(this.items,{uuid:t.uuid}),delete this.itemsHash[t.uuid],t.isBeingRemovedLocally();case 3:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"allItemsMatchingTypes",value:function(e){return this.allItems.filter((function(t){return(_.includes(e,t.content_type)||_.includes(e,"*"))&&!t.dummy}))}},{key:"invalidItems",value:function(){return this.allItems.filter((function(e){return e.errorDecrypting}))}},{key:"validItemsForContentType",value:function(e){return this.allItems.filter((function(t){return t.content_type==e&&!t.errorDecrypting}))}},{key:"findItem",value:function(e){return this.itemsHash[e]}},{key:"findItems",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value,c=this.itemsHash[u];(c||t)&&n.push(c)}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}},{key:"itemsMatchingPredicate",value:function(e){return this.itemsMatchingPredicates([e])}},{key:"itemsMatchingPredicates",value:function(e){return this.filterItemsWithPredicates(this.allItems,e)}},{key:"filterItemsWithPredicates",value:function(e,t){return e.filter((function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(!e.satisfiesPredicate(s))return!1}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return!0}))}},{key:"importItems",value:(a=m(r.mark((function t(n){var i,a,o,s,u,c,l,f,h,p,d,v,y,m,g,b,k,w,x,S,I,_,A,C,D,M,O;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=[],a={},o=!0,s=!1,u=void 0,t.prev=5,c=n[Symbol.iterator]();case 7:if(o=(l=c.next()).done){t.next=18;break}if(f=l.value,h=this.findItem(f.uuid)){t.next=13;break}return a[f.uuid]={},t.abrupt("continue",15);case 13:p=this.duplicateItemWithoutAdding(h),a[f.uuid]={frozenValue:p,itemRef:h};case 15:o=!0,t.next=7;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t.catch(5),s=!0,u=t.t0;case 24:t.prev=24,t.prev=25,o||null==c.return||c.return();case 27:if(t.prev=27,!s){t.next=30;break}throw u;case 30:return t.finish(27);case 31:return t.finish(24);case 32:d=!0,v=!1,y=void 0,t.prev=35,m=n[Symbol.iterator]();case 37:if(d=(g=m.next()).done){t.next=52;break}if(b=g.value,k=a[b.uuid],w=k.frozenValue,x=k.itemRef,!w||x.errorDecrypting){t.next=47;break}return t.next=43,this.createDuplicateItemFromResponseItem(b);case 43:S=t.sent,b.deleted||w.isItemContentEqualWith(S)||(this.addDuplicatedItemAsConflict({duplicate:S,duplicateOf:x}),i.push(S)),t.next=49;break;case 47:i.push(b),x&&x.errorDecrypting&&(x.errorDecrypting=!1);case 49:d=!0,t.next=37;break;case 52:t.next=58;break;case 54:t.prev=54,t.t1=t.catch(35),v=!0,y=t.t1;case 58:t.prev=58,t.prev=59,d||null==m.return||m.return();case 61:if(t.prev=61,!v){t.next=64;break}throw y;case 64:return t.finish(61);case 65:return t.finish(58);case 66:return t.next=68,this.mapResponseItemsToLocalModels(i,e.MappingSourceFileImport);case 68:for(I=t.sent,_=!0,A=!1,C=void 0,t.prev=72,D=I[Symbol.iterator]();!(_=(M=D.next()).done);_=!0)O=M.value,this.setItemDirty(O,!0,!1),O.deleted=!1;t.next=80;break;case 76:t.prev=76,t.t2=t.catch(72),A=!0,C=t.t2;case 80:t.prev=80,t.prev=81,_||null==D.return||D.return();case 83:if(t.prev=83,!A){t.next=86;break}throw C;case 86:return t.finish(83);case 87:return t.finish(80);case 88:return t.abrupt("return",I);case 89:case"end":return t.stop()}}),t,this,[[5,20,24,32],[25,,27,31],[35,54,58,66],[59,,61,65],[72,76,80,88],[81,,83,87]])}))),function(e){return a.apply(this,arguments)})},{key:"getAllItemsJSONData",value:(i=m(r.mark((function e(t,n,i){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.getJSONDataForItems(this.allItems,t,n,i));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"getJSONDataForItems",value:(n=m(r.mark((function e(t,n,i,a){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t.map((function(e){return new P(e,n,i).paramsForExportFile()}))).then((function(e){if(a&&0==e.length)return null;var t={items:e};return n&&(t.auth_params=i),JSON.stringify(t,null,2)})));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"computeDataIntegrityHash",value:(t=m(r.mark((function e(){var t,n,i,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=this.allNondummyItems.sort((function(e,t){return t.updated_at-e.updated_at})),n=t.map((function(e){return e.updatedAtTimestamp()})),i=n.join(","),e.next=6,SFJS.crypto.sha256(i);case 6:return a=e.sent,e.abrupt("return",a);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error computing data integrity hash",e.t0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return t.apply(this,arguments)})},{key:"allItems",get:function(){return this.items.slice()}},{key:"allNondummyItems",get:function(){return this.items.filter((function(e){return!e.dummy}))}}]),e}();i.SFModelManager=C;var D=function(){function e(t,n,r){g(this,e),this.modelManager=t,this.syncManager=n,this.singletonManager=r,this.loadPrivileges(),e.CredentialAccountPassword="CredentialAccountPassword",e.CredentialLocalPasscode="CredentialLocalPasscode",e.ActionManageExtensions="ActionManageExtensions",e.ActionManageBackups="ActionManageBackups",e.ActionViewProtectedNotes="ActionViewProtectedNotes",e.ActionManagePrivileges="ActionManagePrivileges",e.ActionManagePasscode="ActionManagePasscode",e.ActionDeleteNote="ActionDeleteNote",e.SessionExpiresAtKey="SessionExpiresAtKey",e.SessionLengthKey="SessionLengthKey",e.SessionLengthNone=0,e.SessionLengthFiveMinutes=300,e.SessionLengthOneHour=3600,e.SessionLengthOneWeek=604800,this.availableActions=[e.ActionViewProtectedNotes,e.ActionDeleteNote,e.ActionManagePasscode,e.ActionManageBackups,e.ActionManageExtensions,e.ActionManagePrivileges],this.availableCredentials=[e.CredentialAccountPassword,e.CredentialLocalPasscode],this.sessionLengths=[e.SessionLengthNone,e.SessionLengthFiveMinutes,e.SessionLengthOneHour,e.SessionLengthOneWeek,e.SessionLengthIndefinite]}var t,n,i,a,o,s,u,c,l,f,h,p;return k(e,[{key:"setDelegate",value:function(e){this.delegate=e}},{key:"getAvailableActions",value:function(){return this.availableActions}},{key:"getAvailableCredentials",value:function(){return this.availableCredentials}},{key:"netCredentialsForAction",value:(p=m(r.mark((function t(n){var i,a,o,s,u,c,l,f;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getPrivileges();case 2:t.t0=n,i=t.sent.getCredentialsForAction(t.t0),a=[],o=!0,s=!1,u=void 0,t.prev=8,c=i[Symbol.iterator]();case 10:if(o=(l=c.next()).done){t.next=27;break}if((f=l.value)!=e.CredentialAccountPassword){t.next=19;break}return t.next=15,this.delegate.isOffline();case 15:t.sent||a.push(f),t.next=24;break;case 19:if(f!=e.CredentialLocalPasscode){t.next=24;break}return t.next=22,this.delegate.hasLocalPasscode();case 22:t.sent&&a.push(f);case 24:o=!0,t.next=10;break;case 27:t.next=33;break;case 29:t.prev=29,t.t1=t.catch(8),s=!0,u=t.t1;case 33:t.prev=33,t.prev=34,o||null==c.return||c.return();case 36:if(t.prev=36,!s){t.next=39;break}throw u;case 39:return t.finish(36);case 40:return t.finish(33);case 41:return t.abrupt("return",a);case 42:case"end":return t.stop()}}),t,this,[[8,29,33,41],[34,,36,40]])}))),function(e){return p.apply(this,arguments)})},{key:"loadPrivileges",value:(h=m(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loadPromise){e.next=2;break}return e.abrupt("return",this.loadPromise);case 2:return this.loadPromise=new Promise((function(e,n){var i=R.contentType(),a=new L("content_type","=",i);t.singletonManager.registerSingleton([a],(function(n){t.privileges=n,e(n)}),function(){var n=m(r.mark((function n(a){var o;return r.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(o=new R({content_type:i}),SFJS.crypto.generateUUIDSync){n.next=4;break}return n.next=4,o.initUUID();case 4:t.modelManager.addItem(o),t.modelManager.setItemDirty(o,!0),t.syncManager.sync(),a(o),e(o);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())})),e.abrupt("return",this.loadPromise);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getPrivileges",value:(f=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.privileges){e.next=4;break}return e.abrupt("return",this.privileges);case 4:return e.abrupt("return",this.loadPrivileges());case 5:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"displayInfoForCredential",value:function(t){var n={};return n[e.CredentialAccountPassword]={label:"Account Password",prompt:"Please enter your account password."},n[e.CredentialLocalPasscode]={label:"Local Passcode",prompt:"Please enter your local passcode."},n[t]}},{key:"displayInfoForAction",value:function(t){var n={};return n[e.ActionManageExtensions]={label:"Manage Extensions"},n[e.ActionManageBackups]={label:"Download/Import Backups"},n[e.ActionViewProtectedNotes]={label:"View Protected Notes"},n[e.ActionManagePrivileges]={label:"Manage Privileges"},n[e.ActionManagePasscode]={label:"Manage Passcode"},n[e.ActionDeleteNote]={label:"Delete Notes"},n[t]}},{key:"getSessionLengthOptions",value:function(){return[{value:e.SessionLengthNone,label:"Don't Remember"},{value:e.SessionLengthFiveMinutes,label:"5 Minutes"},{value:e.SessionLengthOneHour,label:"1 Hour"},{value:e.SessionLengthOneWeek,label:"1 Week"}]}},{key:"setSessionLength",value:(l=m(r.mark((function t(n){var i;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n,a=void 0,(a=new Date).setSeconds(a.getSeconds()+r),i=a,t.abrupt("return",Promise.all([this.delegate.saveToStorage(e.SessionExpiresAtKey,JSON.stringify(i)),this.delegate.saveToStorage(e.SessionLengthKey,JSON.stringify(n))]));case 3:case"end":return t.stop()}var r,a}),t,this)}))),function(e){return l.apply(this,arguments)})},{key:"clearSession",value:(c=m(r.mark((function t(){return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.setSessionLength(e.SessionLengthNone));case 1:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"getSelectedSessionLength",value:(u=m(r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionLengthKey);case 2:if(!(n=t.sent)){t.next=7;break}return t.abrupt("return",JSON.parse(n));case 7:return t.abrupt("return",e.SessionLengthNone);case 8:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"getSessionExpirey",value:(s=m(r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.delegate.getFromStorage(e.SessionExpiresAtKey);case 2:if(!(n=t.sent)){t.next=7;break}return t.abrupt("return",new Date(JSON.parse(n)));case 7:return t.abrupt("return",new Date);case 8:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"actionHasPrivilegesConfigured",value:(o=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"actionRequiresPrivilege",value:(a=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionExpirey();case 2:if(!(e.sent>new Date)){e.next=5;break}return e.abrupt("return",!1);case 5:return e.next=7,this.netCredentialsForAction(t);case 7:return n=e.sent,e.abrupt("return",n.length>0);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"savePrivileges",value:(i=m(r.mark((function e(){var t;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getPrivileges();case 2:t=e.sent,this.modelManager.setItemDirty(t,!0),this.syncManager.sync();case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"authenticateAction",value:(n=m(r.mark((function e(t,n){var i,a,o,s,u,c,l,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.netCredentialsForAction(t);case 2:i=e.sent,a=[],o=[],s=!0,u=!1,c=void 0,e.prev=7,l=i[Symbol.iterator]();case 9:if(s=(f=l.next()).done){e.next=18;break}return h=f.value,e.next=13,this._verifyAuthenticationParameters(h,n[h]);case 13:e.sent?a.push(h):o.push(h);case 15:s=!0,e.next=9;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(7),u=!0,c=e.t0;case 24:e.prev=24,e.prev=25,s||null==l.return||l.return();case 27:if(e.prev=27,!u){e.next=30;break}throw c;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.abrupt("return",{success:0==o.length,successfulCredentials:a,failedCredentials:o});case 33:case"end":return e.stop()}}),e,this,[[7,20,24,32],[25,,27,31]])}))),function(e,t){return n.apply(this,arguments)})},{key:"_verifyAuthenticationParameters",value:(t=m(r.mark((function t(n,i){var a,o,s=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=function(){var e=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.delegate.verifyAccountPassword(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o=function(){var e=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.delegate.verifyLocalPasscode(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n!=e.CredentialAccountPassword){t.next=6;break}return t.abrupt("return",a(i));case 6:if(n!=e.CredentialLocalPasscode){t.next=8;break}return t.abrupt("return",o(i));case 8:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFPrivilegesManager=D;var M=function(){function e(t,n,r,i,a){var o=this;g(this,e),this.modelManager=t,this.storageManager=n,this.$timeout=a||setTimeout.bind(window),this.keyRequestHandler=r,this.loadFromDisk().then((function(){o.modelManager.addItemSyncObserver("session-history",i,(function(e,t,n,r,i){if(r!==C.MappingSourceLocalDirtied){var a=!0,s=!1,u=void 0;try{for(var c,l=e[Symbol.iterator]();!(a=(c=l.next()).done);a=!0){var f=c.value;try{o.addHistoryEntryForItem(f)}catch(e){console.log("Caught exception while trying to add item history entry",e)}}}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}}}))}))}var t,n,i,a,o,s,u;return k(e,[{key:"encryptionParams",value:(u=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler());case 1:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{key:"addHistoryEntryForItem",value:function(e){var t=this,n={uuid:e.uuid,content_type:e.content_type,updated_at:e.updated_at,content:e.getContentCopy()},r=this.historySession.addEntryForItem(n);this.autoOptimize&&this.historySession.optimizeHistoryForItem(e),r&&this.diskEnabled&&(this.diskTimeout&&(this.$timeout.hasOwnProperty("cancel")?this.$timeout.cancel(this.diskTimeout):clearTimeout(this.diskTimeout)),this.diskTimeout=this.$timeout((function(){t.saveToDisk()}),2e3))}},{key:"historyForItem",value:function(e){return this.historySession.historyForItem(e)}},{key:"clearHistoryForItem",value:(s=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearItemHistory(t),e.abrupt("return",this.saveToDisk());case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"clearAllHistory",value:(o=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.historySession.clearAllHistory(),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 2:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"toggleDiskSaving",value:(a=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled=!this.diskEnabled,!this.diskEnabled){e.next=6;break}this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!0)),this.saveToDisk(),e.next=8;break;case 6:return this.storageManager.setItem("sessionHistory_persist",JSON.stringify(!1)),e.abrupt("return",this.storageManager.removeItem("sessionHistory_revisions"));case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"saveToDisk",value:(i=m(r.mark((function e(){var t,n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.diskEnabled){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.encryptionParams();case 4:t=e.sent,new P(this.historySession,t.keys,t.auth_params).paramsForSync().then((function(e){n.storageManager.setItem("sessionHistory_revisions",JSON.stringify(e))}));case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadFromDisk",value:(n=m(r.mark((function e(){var t,n,i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("sessionHistory_persist");case 2:return(t=e.sent)&&(this.diskEnabled=JSON.parse(t)),e.next=6,this.storageManager.getItem("sessionHistory_revisions");case 6:if(!(n=e.sent)){e.next=18;break}return n=JSON.parse(n),e.next=11,this.encryptionParams();case 11:return i=e.sent,e.next=14,SFJS.itemTransformer.decryptItem(n,i.keys);case 14:a=new B(n),this.historySession=a,e.next=19;break;case 18:this.historySession=new B;case 19:return e.next=21,this.storageManager.getItem("sessionHistory_autoOptimize");case 21:o=e.sent,this.autoOptimize=!o||JSON.parse(o);case 23:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"toggleAutoOptimize",value:(t=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.autoOptimize=!this.autoOptimize,this.autoOptimize?this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!0)):this.storageManager.setItem("sessionHistory_autoOptimize",JSON.stringify(!1));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();i.SFSessionHistoryManager=M;var O=function(){function e(t,n){var r=this;g(this,e),this.syncManager=n,this.modelManager=t,this.singletonHandlers=[],t.addItemSyncObserverWithPriority({id:"sf-singleton-manager",types:"*",priority:-1,callback:function(e,n,i,a,o){a!==C.MappingSourceLocalDirtied&&r.resolveSingletons(t.allNondummyItems,null,!0)}}),n.addEventHandler((function(e,n){if("local-data-loaded"==e)r.resolveSingletons(t.allNondummyItems,null,!0),r.initialDataLoaded=!0;else if("sync:completed"==e){if(!r.initialDataLoaded)return;r.resolveSingletons(n.retrievedItems,n.savedItems)}})),t.addModelUuidChangeObserver("singleton-manager",(function(e,t){var n=!0,i=!1,a=void 0;try{for(var o,s=r.singletonHandlers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;u.singleton&&L.ItemSatisfiesPredicates(t,u.predicates)&&(u.singleton=null,r.resolveSingletons([t]))}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}))}return k(e,[{key:"registerSingleton",value:function(e,t,n){this.singletonHandlers.push({predicates:e,resolutionCallback:t,createBlock:n})}},{key:"resolveSingletons",value:function(e,t,n){var r=this;e=e||[],t=t||[];var i=!0,a=!1,o=void 0;try{for(var s,u=function(){var i=s.value,a=i.predicates.slice(),o=r.modelManager.filterItemsWithPredicates(e,a),u=function(){i.createBlock&&(i.pendingCreateBlockCallback=!0,i.createBlock((function(e){i.singleton=e,i.pendingCreateBlockCallback=!1,i.resolutionCallback&&i.resolutionCallback(e)})))},c=r.modelManager.filterItemsWithPredicates(t,a).length;if(o.length>0||c>0){var l=r.modelManager.itemsMatchingPredicates(a);if(l.length>=2){var f=l.sort((function(e,t){return e.errorDecrypting?1:t.errorDecrypting||e.created_at<t.created_at?-1:1})),h=f[0],p=f.slice(1,f.length),d=!0,v=!1,y=void 0;try{for(var m,g=p[Symbol.iterator]();!(d=(m=g.next()).done);d=!0){var b=m.value;r.modelManager.setItemToBeDeleted(b)}}catch(e){v=!0,y=e}finally{try{d||null==g.return||g.return()}finally{if(v)throw y}}r.syncManager.sync(),i.singleton=h,i.resolutionCallback&&i.resolutionCallback(h)}else if(1==l.length){var k=l[0];k.errorDecrypting?(r.modelManager.setItemToBeDeleted(k),u()):i.singleton&&i.singleton===k||(i.singleton=k,i.resolutionCallback&&i.resolutionCallback(k))}}else i.singleton||n||i.pendingCreateBlockCallback||u()},c=this.singletonHandlers[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)u()}catch(e){a=!0,o=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}}]),e}();i.SFSingletonManager=O;var F=function(){function e(){g(this,e)}var t,n,i,a,o,s,u,c,l,f;return k(e,[{key:"setItem",value:(f=m(r.mark((function e(t,n){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e,t){return f.apply(this,arguments)})},{key:"getItem",value:(l=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"removeItem",value:(c=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"clear",value:(u=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return u.apply(this,arguments)})},{key:"getAllModels",value:(s=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return s.apply(this,arguments)})},{key:"saveModel",value:(o=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveModels([t]));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"saveModels",value:(a=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"deleteModel",value:(i=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"clearAllModels",value:(n=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"clearAllData",value:(t=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.clear(),this.clearAllModels()]));case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();i.SFStorageManager=F;var E,T=function(){function e(t,n,r,i,a){g(this,e),e.KeyRequestLoadLocal="KeyRequestLoadLocal",e.KeyRequestSaveLocal="KeyRequestSaveLocal",e.KeyRequestLoadSaveAccount="KeyRequestLoadSaveAccount",this.httpManager=r,this.modelManager=t,this.storageManager=n,this.$interval=a||setInterval.bind(window),this.$timeout=i||setTimeout.bind(window),this.syncStatus={},this.syncStatusObservers=[],this.eventHandlers=[],this.PerSyncItemUploadLimit=150,this.ServerItemDownloadLimit=150,this.MajorDataChangeThreshold=15,this.MaxDiscordanceBeforeOutOfSync=5,this.syncDiscordance=0,this.outOfSync=!1}var t,n,i,a,o,s,u,c,l,f,h,p,d,v,y,b,w,x,S,A,D,M,O;return k(e,[{key:"handleServerIntegrityHash",value:(O=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&0!=t.length){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,this.modelManager.computeDataIntegrityHash();case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return",!0);case 7:if(n===t){e.next=13;break}return this.syncDiscordance++,this.syncDiscordance>=this.MaxDiscordanceBeforeOutOfSync&&(this.outOfSync||(this.outOfSync=!0,this.notifyEvent("enter-out-of-sync"))),e.abrupt("return",!1);case 13:return this.outOfSync&&(this.outOfSync=!1,this.notifyEvent("exit-out-of-sync")),this.syncDiscordance=0,e.abrupt("return",!0);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"isOutOfSync",value:function(){return this.outOfSync}},{key:"getServerURL",value:(M=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.storageManager.getItem("server");case 2:if(e.t0=e.sent,e.t0){e.next=5;break}e.t0=window._default_sf_server;case 5:return e.abrupt("return",e.t0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return M.apply(this,arguments)})},{key:"getSyncURL",value:(D=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getServerURL();case 2:return e.t0=e.sent,e.abrupt("return",e.t0+"/items/sync");case 4:case"end":return e.stop()}}),e,this)}))),function(){return D.apply(this,arguments)})},{key:"registerSyncStatusObserver",value:function(e){var t={key:new Date,callback:e};return this.syncStatusObservers.push(t),t}},{key:"removeSyncStatusObserver",value:function(e){_.pull(this.syncStatusObservers,e)}},{key:"syncStatusDidChange",value:function(){var e=this;this.syncStatusObservers.forEach((function(t){t.callback(e.syncStatus)}))}},{key:"addEventHandler",value:function(e){return this.eventHandlers.push(e),e}},{key:"removeEventHandler",value:function(e){_.pull(this.eventHandlers,e)}},{key:"notifyEvent",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=this.eventHandlers[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)(0,a.value)(e,t||{})}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"setKeyRequestHandler",value:function(e){this.keyRequestHandler=e}},{key:"getActiveKeyInfo",value:(A=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.keyRequestHandler(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"initialDataLoaded",value:function(){return!0===this._initialDataLoaded}},{key:"_sortLocalItems",value:function(e){var t=this;return e.sort((function(e,n){var r=new Date(n.updated_at)-new Date(e.updated_at),i=t.contentTypeLoadPriority,a=0,o=0;return i&&(a=i.indexOf(e.content_type),o=i.indexOf(n.content_type),-1==a&&(a=i.length),-1==o&&(o=i.length)),a==o?r:a<o?-1:1}))}},{key:"loadLocalItems",value:(S=m(r.mark((function t(){var n,i,a,o,s,u=this,c=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=c.length>0&&void 0!==c[0]?c[0]:{},i=n.incrementalCallback,a=n.batchSize,!(o=n.options)||!o.simulateHighLatency){t.next=5;break}return s=o.simulatedLatency||1e3,t.next=5,this._awaitSleep(s);case 5:if(!this.loadLocalDataPromise){t.next=7;break}return t.abrupt("return",this.loadLocalDataPromise);case 7:return a||(a=100),this.loadLocalDataPromise=this.storageManager.getAllModels().then((function(t){var n=(t=(t=u._sortLocalItems(t)).filter((function(e){var t=u.modelManager.findItem(e.uuid);return!t||new Date(e.dirtiedDate)>t.dirtiedDate}))).length,o=0,s=[],c=function(){var l=m(r.mark((function l(){var f,h;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return f=t.slice(o,o+a),r.next=3,u.handleItemsResponse(f,null,C.MappingSourceLocalRetrieved,e.KeyRequestLoadLocal);case 3:if(h=r.sent,s.push(h),!((o+=f.length)<n)){r.next=10;break}return r.abrupt("return",new Promise((function(e,t){u.$timeout((function(){u.notifyEvent("local-data-incremental-load"),i&&i(o,n),c().then(e)}))})));case 10:u._initialDataLoaded=!0,u.notifyEvent("local-data-loaded");case 12:case"end":return r.stop()}}),l)})));return function(){return l.apply(this,arguments)}}();return c()})),t.abrupt("return",this.loadLocalDataPromise);case 10:case"end":return t.stop()}}),t,this)}))),function(){return S.apply(this,arguments)})},{key:"writeItemsToLocalStorage",value:(x=m(r.mark((function t(n,i){var a=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!=n.length){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=m(r.mark((function t(o,s){var u,c,l,f,h,p,d,v,y,g;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(u=[],c=[],l=!0,f=!1,h=void 0,t.prev=4,p=n[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)!0!==(v=d.value).deleted||v.dirty?u.push(v):c.push(v);t.next=12;break;case 8:t.prev=8,t.t0=t.catch(4),f=!0,h=t.t0;case 12:t.prev=12,t.prev=13,l||null==p.return||p.return();case 15:if(t.prev=15,!f){t.next=18;break}throw h;case 18:return t.finish(15);case 19:return t.finish(12);case 20:if(!(c.length>0)){t.next=23;break}return t.next=23,Promise.all(c.map(function(){var e=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.storageManager.deleteModel(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 23:return t.next=25,a.getActiveKeyInfo(e.KeyRequestSaveLocal);case 25:if(y=t.sent,!(u.length>0)){t.next=33;break}return t.next=29,Promise.all(u.map(function(){var e=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new P(t,y.keys,y.auth_params),e.next=3,n.paramsForLocalStorage();case 3:return n=e.sent,i&&delete n.dirty,e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).catch((function(e){return s(e)}));case 29:return g=t.sent,t.next=32,a.storageManager.saveModels(g).catch((function(e){console.error("Error writing items",e),a.syncStatus.localError=e,a.syncStatusDidChange(),s()}));case 32:a.syncStatus.localError&&(a.syncStatus.localError=null,a.syncStatusDidChange());case 33:o();case 34:case"end":return t.stop()}}),t,null,[[4,8,12,20],[13,,15,19]])})));return function(e,n){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t)}))),function(e,t){return x.apply(this,arguments)})},{key:"syncOffline",value:(w=m(r.mark((function e(t){var n,i,a,o,s,u=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=!0,i=!1,a=void 0,e.prev=3,o=t[Symbol.iterator]();!(n=(s=o.next()).done);n=!0)s.value.updated_at=new Date;e.next=11;break;case 7:e.prev=7,e.t0=e.catch(3),i=!0,a=e.t0;case 11:e.prev=11,e.prev=12,n||null==o.return||o.return();case 14:if(e.prev=14,!i){e.next=17;break}throw a;case 17:return e.finish(14);case 18:return e.finish(11);case 19:return e.abrupt("return",this.writeItemsToLocalStorage(t,!0).then((function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;s.deleted&&u.modelManager.removeItemLocally(s)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return u.modelManager.clearDirtyItems(t),u.modelManager.didSyncModelsOffline(t),u.notifyEvent("sync:completed",{savedItems:t}),{saved_items:t}})));case 20:case"end":return e.stop()}}),e,this,[[3,7,11,19],[12,,14,18]])}))),function(e){return w.apply(this,arguments)})},{key:"markAllItemsDirtyAndSaveOffline",value:(b=m(r.mark((function e(t){var n,i,a,o,s,u,c,l,f,h,p,d,v;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=28;break}n=this.modelManager.allNondummyItems.filter((function(e){return!e.errorDecrypting})).slice(),i=!0,a=!1,o=void 0,e.prev=5,s=n[Symbol.iterator]();case 7:if(i=(u=s.next()).done){e.next=14;break}return c=u.value,e.next=11,this.modelManager.alternateUUIDForItem(c);case 11:i=!0,e.next=7;break;case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(5),a=!0,o=e.t0;case 20:e.prev=20,e.prev=21,i||null==s.return||s.return();case 23:if(e.prev=23,!a){e.next=26;break}throw o;case 26:return e.finish(23);case 27:return e.finish(20);case 28:for(l=this.modelManager.allNondummyItems,f=!0,h=!1,p=void 0,e.prev=32,d=l[Symbol.iterator]();!(f=(v=d.next()).done);f=!0)v.value.setDirty(!0);e.next=40;break;case 36:e.prev=36,e.t1=e.catch(32),h=!0,p=e.t1;case 40:e.prev=40,e.prev=41,f||null==d.return||d.return();case 43:if(e.prev=43,!h){e.next=46;break}throw p;case 46:return e.finish(43);case 47:return e.finish(40);case 48:return e.abrupt("return",this.writeItemsToLocalStorage(l,!1));case 49:case"end":return e.stop()}}),e,this,[[5,16,20,28],[21,,23,27],[32,36,40,48],[41,,43,47]])}))),function(e){return b.apply(this,arguments)})},{key:"setSyncToken",value:(y=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=t,e.next=3,this.storageManager.setItem("syncToken",t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"getSyncToken",value:(v=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._syncToken){e.next=4;break}return e.next=3,this.storageManager.getItem("syncToken");case 3:this._syncToken=e.sent;case 4:return e.abrupt("return",this._syncToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"setCursorToken",value:(d=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken=t,!t){e.next=6;break}return e.next=4,this.storageManager.setItem("cursorToken",t);case 4:e.next=8;break;case 6:return e.next=8,this.storageManager.removeItem("cursorToken");case 8:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getCursorToken",value:(p=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cursorToken){e.next=4;break}return e.next=3,this.storageManager.getItem("cursorToken");case 3:this._cursorToken=e.sent;case 4:return e.abrupt("return",this._cursorToken);case 5:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"clearQueuedCallbacks",value:function(){this._queuedCallbacks=[]}},{key:"callQueuedCallbacks",value:function(e){var t=this.queuedCallbacks;if(t.length){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)(0,a.value)(e)}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.clearQueuedCallbacks()}}},{key:"beginCheckingIfSyncIsTakingTooLong",value:function(){this.syncStatus.checker&&this.stopCheckingIfSyncIsTakingTooLong(),this.syncStatus.checker=this.$interval(function(){(new Date-this.syncStatus.syncStart)/1e3>5&&(this.notifyEvent("sync:taking-too-long"),this.stopCheckingIfSyncIsTakingTooLong())}.bind(this),500)}},{key:"stopCheckingIfSyncIsTakingTooLong",value:function(){this.$interval.hasOwnProperty("cancel")?this.$interval.cancel(this.syncStatus.checker):clearInterval(this.syncStatus.checker),this.syncStatus.checker=null}},{key:"lockSyncing",value:function(){this.syncLocked=!0}},{key:"unlockSyncing",value:function(){this.syncLocked=!1}},{key:"sync",value:(h=m(r.mark((function t(){var n,i=this,a=arguments;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>0&&void 0!==a[0]?a[0]:{},!this.syncLocked){t.next=4;break}return console.log("Sync Locked, Returning;"),t.abrupt("return");case 4:return t.abrupt("return",new Promise(function(){var t=m(r.mark((function t(a,o){var s,u,c,l,f,h,p,d,v,y,m,g,b,k;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n||(n={}),s=i.modelManager.getDirtyItems(),u=s.filter((function(e){return!i.lastDirtyItemsSave||e.dirtiedDate>i.lastDirtyItemsSave})),t.next=5,i.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 5:if(c=t.sent,l=i.syncStatus.syncOpInProgress,f=i.initialDataLoaded(),!l&&f){t.next=16;break}return i.performSyncAgainOnCompletion=!0,i.lastDirtyItemsSave=new Date,t.next=13,i.writeItemsToLocalStorage(u,!1);case 13:return l&&(i.queuedCallbacks.push(a),i.loggingEnabled&&console.warn("Attempting to sync while existing sync is in progress.")),f||(i.loggingEnabled&&console.warn("(1) Attempting to perform online sync before local data has loaded"),a()),t.abrupt("return");case 16:if(i.syncStatus.syncOpInProgress=!0,!c.offline){t.next=19;break}return t.abrupt("return",i.syncOffline(s).then((function(e){i.syncStatus.syncOpInProgress=!1,a(e)})).catch((function(e){i.notifyEvent("sync-exception",e)})));case 19:if(i.initialDataLoaded()){t.next=22;break}return console.error("Attempting to perform online sync before local data has loaded"),t.abrupt("return");case 22:return i.loggingEnabled&&console.log("Syncing online user."),h=i.syncStatus.needsMoreSync,i.syncStatus.syncStart=new Date,i.beginCheckingIfSyncIsTakingTooLong(),p=i.PerSyncItemUploadLimit,(d=s.slice(0,p)).length<s.length?i.syncStatus.needsMoreSync=!0:i.syncStatus.needsMoreSync=!1,h||(i.syncStatus.total=s.length,i.syncStatus.current=0),i.syncStatus.current>i.syncStatus.total&&(i.syncStatus.total=i.syncStatus.current),i.syncStatusDidChange(),t.next=34,i.writeItemsToLocalStorage(u,!1);case 34:return i.lastDirtyItemsSave=new Date,n.onPreSyncSave&&n.onPreSyncSave(),i.allRetreivedItems||(i.allRetreivedItems=[]),i.allSavedItems||(i.allSavedItems=[]),(v={}).limit=i.ServerItemDownloadLimit,n.performIntegrityCheck&&(v.compute_integrity=!0),t.prev=41,t.next=44,Promise.all(d.map((function(e){var t=new P(e,c.keys,c.auth_params);return t.additionalFields=n.additionalFields,t.paramsForSync()}))).then((function(e){v.items=e}));case 44:t.next=49;break;case 46:t.prev=46,t.t0=t.catch(41),i.notifyEvent("sync-exception",t.t0);case 49:for(y=!0,m=!1,g=void 0,t.prev=52,b=d[Symbol.iterator]();!(y=(k=b.next()).done);y=!0)k.value.dirtyCount=0;t.next=60;break;case 56:t.prev=56,t.t1=t.catch(52),m=!0,g=t.t1;case 60:t.prev=60,t.prev=61,y||null==b.return||b.return();case 63:if(t.prev=63,!m){t.next=66;break}throw g;case 66:return t.finish(63);case 67:return t.finish(60);case 68:return t.next=70,i.getSyncToken();case 70:return v.sync_token=t.sent,t.next=73,i.getCursorToken();case 73:return v.cursor_token=t.sent,v.api=I.getApiVersion(),i.loggingEnabled&&console.log("Syncing with params",v),t.prev=76,t.t2=i.httpManager,t.next=80,i.getSyncURL();case 80:t.t3=t.sent,t.t4=v,t.t5=function(e){i.handleSyncSuccess(d,e,n).then((function(){a(e)})).catch((function(e){console.log("Caught sync success exception:",e),i.handleSyncError(e,null,s).then((function(t){i.notifyEvent("sync-exception",e),a(t)}))}))},t.t6=function(e,t){i.handleSyncError(e,t,s).then((function(e){a(e)}))},t.t2.postAuthenticatedAbsolute.call(t.t2,t.t3,t.t4,t.t5,t.t6),t.next=90;break;case 87:t.prev=87,t.t7=t.catch(76),console.log("Sync exception caught:",t.t7);case 90:case"end":return t.stop()}}),t,null,[[41,46],[52,56,60,68],[61,,63,67],[76,87]])})));return function(e,n){return t.apply(this,arguments)}}()));case 5:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"_awaitSleep",value:(f=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.warn("Simulating high latency sync request",t),e.abrupt("return",new Promise((function(e,n){setTimeout((function(){e()}),t)})));case 2:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"handleSyncSuccess",value:(l=m(r.mark((function t(n,i,a){var o,s,u,c,l,f,h,p,d,v,y,m,g,b,k,w,x=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.simulateHighLatency){t.next=4;break}return o=a.simulatedLatency||1e3,t.next=4,this._awaitSleep(o);case 4:for(this.syncStatus.error=null,this.loggingEnabled&&console.log("Sync response",i),s=this.allSavedItems.map((function(e){return e.uuid})),u=i.saved_items.map((function(e){return e.uuid})),i.retrieved_items=i.retrieved_items.filter((function(e){var t=s.includes(e.uuid),n=u.includes(e.uuid);if(t||n)return!1;var r=x.modelManager.findItem(e.uuid);return!r||!r.dirty})),c=[],l=!0,f=!1,h=void 0,t.prev=13,p=n[Symbol.iterator]();!(l=(d=p.next()).done);l=!0)0==(v=d.value).dirtyCount&&c.push(v);t.next=21;break;case 17:t.prev=17,t.t0=t.catch(13),f=!0,h=t.t0;case 21:t.prev=21,t.prev=22,l||null==p.return||p.return();case 24:if(t.prev=24,!f){t.next=27;break}throw h;case 27:return t.finish(24);case 28:return t.finish(21);case 29:return this.modelManager.clearDirtyItems(c),t.next=32,this.handleItemsResponse(i.retrieved_items,null,C.MappingSourceRemoteRetrieved,e.KeyRequestLoadSaveAccount);case 32:return y=t.sent,this.allRetreivedItems=this.allRetreivedItems.concat(y),this.syncStatus.retrievedCount=this.allRetreivedItems.length,m=["content","auth_hash"],t.next=38,this.handleItemsResponse(i.saved_items,m,C.MappingSourceRemoteSaved,e.KeyRequestLoadSaveAccount);case 38:return g=t.sent,this.allSavedItems=this.allSavedItems.concat(g),b=i.unsaved,t.next=43,this.deprecated_handleUnsavedItemsResponse(b);case 43:return t.next=45,this.handleConflictsResponse(i.conflicts);case 45:if(k=t.sent,w=k&&k.length>0,!k){t.next=50;break}return t.next=50,this.writeItemsToLocalStorage(k,!1);case 50:return t.next=52,this.writeItemsToLocalStorage(g,!1);case 52:return t.next=54,this.writeItemsToLocalStorage(y,!1);case 54:if(!i.integrity_hash||i.cursor_token){t.next=59;break}return t.next=57,this.handleServerIntegrityHash(i.integrity_hash);case 57:t.sent||this.syncDiscordance<this.MaxDiscordanceBeforeOutOfSync&&(this.performSyncAgainOnCompletion=!0);case 59:return this.syncStatus.syncOpInProgress=!1,this.syncStatus.current+=n.length,this.syncStatusDidChange(),this.setSyncToken(i.sync_token),this.setCursorToken(i.cursor_token),this.stopCheckingIfSyncIsTakingTooLong(),t.next=67,this.getCursorToken();case 67:if(!t.sent&&!this.syncStatus.needsMoreSync){t.next=72;break}return t.abrupt("return",new Promise((function(e,t){setTimeout(function(){this.sync(a).then(e)}.bind(x),10)})));case 72:if(!w){t.next=77;break}return this.performSyncAgainOnCompletion=!1,t.abrupt("return",new Promise((function(e,t){setTimeout((function(){x.sync(a).then(e)}),10)})));case 77:return this.syncStatus.retrievedCount=0,this.syncStatus.current=0,this.syncStatus.total=0,this.syncStatusDidChange(),(this.allRetreivedItems.length>=this.majorDataChangeThreshold||g.length>=this.majorDataChangeThreshold||b&&b.length>=this.majorDataChangeThreshold||k&&k.length>=this.majorDataChangeThreshold)&&this.notifyEvent("major-data-change"),this.callQueuedCallbacks(i),this.notifyEvent("sync:completed",{retrievedItems:this.allRetreivedItems,savedItems:this.allSavedItems}),this.allRetreivedItems=[],this.allSavedItems=[],this.performSyncAgainOnCompletion&&(this.performSyncAgainOnCompletion=!1,setTimeout((function(){x.sync(a)}),10)),t.abrupt("return",i);case 88:case"end":return t.stop()}}),t,this,[[13,17,21,29],[22,,24,28]])}))),function(e,t,n){return l.apply(this,arguments)})},{key:"handleSyncError",value:(c=m(r.mark((function e(t,n,i){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sync error: ",t),401==n&&this.notifyEvent("sync-session-invalid"),t?"string"==typeof t&&(t={error:{message:t}}):t={error:{message:"Could not connect to server."}},this.syncStatus.syncOpInProgress=!1,this.syncStatus.error=t.error,this.syncStatusDidChange(),this.writeItemsToLocalStorage(i,!1),this.modelManager.didSyncModelsOffline(i),this.stopCheckingIfSyncIsTakingTooLong(),this.notifyEvent("sync:error",t.error),this.callQueuedCallbacks({error:"Sync error"}),e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return c.apply(this,arguments)})},{key:"handleItemsResponse",value:(u=m(r.mark((function e(t,n,i,a){var o,s,u;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getActiveKeyInfo(a);case 2:return o=e.sent.keys,e.next=5,SFJS.itemTransformer.decryptMultipleItems(t,o);case 5:return e.next=7,this.modelManager.mapResponseItemsToLocalModelsOmittingFields(t,n,i);case 7:return s=e.sent,(u=s.filter((function(e){var t=e.errorDecryptingValueChanged;return e.errorDecryptingValueChanged=!1,t}))).length>0&&this.writeItemsToLocalStorage(u,!1),e.abrupt("return",s);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return u.apply(this,arguments)})},{key:"refreshErroredItems",value:(s=m(r.mark((function t(){var n;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!((n=this.modelManager.allNondummyItems.filter((function(e){return 1==e.errorDecrypting}))).length>0)){t.next=3;break}return t.abrupt("return",this.handleItemsResponse(n,null,C.MappingSourceLocalRetrieved,e.KeyRequestLoadSaveAccount));case 3:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"handleConflictsResponse",value:(o=m(r.mark((function t(n){var i,a,o,s,u,c,l,f,h,p,d,v,y,m,g,b,k,w,x,S,I,_,A,D,M,O,F,E,T,P,L;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!=n.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Conflicted Items:",n),i={},a=!0,o=!1,s=void 0,t.prev=7,u=n[Symbol.iterator]();case 9:if(a=(c=u.next()).done){t.next=21;break}if(l=c.value,f=l.server_item||l.unsaved_item,h=this.modelManager.findItem(f.uuid)){t.next=16;break}return i[f.uuid]={},t.abrupt("continue",18);case 16:p=h.getContentCopy(),i[f.uuid]={frozenContent:p,itemRef:h};case 18:a=!0,t.next=9;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(7),o=!0,s=t.t0;case 27:t.prev=27,t.prev=28,a||null==u.return||u.return();case 30:if(t.prev=30,!o){t.next=33;break}throw s;case 33:return t.finish(30);case 34:return t.finish(27);case 35:d=[],v=!0,y=!1,m=void 0,t.prev=39,g=n[Symbol.iterator]();case 41:if(v=(b=g.next()).done){t.next=91;break}return k=b.value,w=k.server_item||k.unsaved_item,t.t1=SFJS.itemTransformer,t.t2=[w],t.next=48,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 48:return t.t3=t.sent.keys,t.next=51,t.t1.decryptMultipleItems.call(t.t1,t.t2,t.t3);case 51:if(x=i[w.uuid],S=x.frozenContent,I=x.itemRef){t.next=54;break}return t.abrupt("continue",88);case 54:if(d.push(I),"uuid_conflict"!==k.type){t.next=62;break}return t.next=58,this.modelManager.alternateUUIDForItem(I);case 58:_=t.sent,d.push(_),t.next=88;break;case 62:if("sync_conflict"!==k.type){t.next=86;break}return t.next=65,this.modelManager.createDuplicateItemFromResponseItem(w);case 65:if(A=t.sent,D=this.modelManager.duplicateItemWithCustomContent({content:S,duplicateOf:I}),M=!D.isItemContentEqualWith(A),O=!I.isItemContentEqualWith(A),F=!1,E=!1,T=!1,P=!1,w.deleted||I.deleted?P=!0:M?(new Date-I.client_updated_at)/1e3<20?(T=!0,E=!0):(F=!0,P=!0):O?j.AreItemContentsEqual({leftContent:I.content,rightContent:A.content,keysToIgnore:I.keysToIgnoreWhenCheckingContentEquality().concat(["references"]),appDataKeysToIgnore:I.appDataKeysToIgnoreWhenCheckingContentEquality()})?T=!0:(F=!0,P=!0):P=!0,!F){t.next=79;break}return t.next=77,this.modelManager.duplicateItemWithCustomContentAndAddAsConflict({content:S,duplicateOf:I});case 77:L=t.sent,d.push(L);case 79:if(E&&(this.modelManager.addDuplicatedItemAsConflict({duplicate:A,duplicateOf:I}),d.push(A)),!P){t.next=83;break}return t.next=83,this.modelManager.mapResponseItemsToLocalModelsOmittingFields([w],null,C.MappingSourceRemoteRetrieved);case 83:T&&(I.updated_at=A.updated_at,I.setDirty(!0)),t.next=88;break;case 86:return console.error("Unsupported conflict type",k.type),t.abrupt("continue",88);case 88:v=!0,t.next=41;break;case 91:t.next=97;break;case 93:t.prev=93,t.t4=t.catch(39),y=!0,m=t.t4;case 97:t.prev=97,t.prev=98,v||null==g.return||g.return();case 100:if(t.prev=100,!y){t.next=103;break}throw m;case 103:return t.finish(100);case 104:return t.finish(97);case 105:return t.abrupt("return",d);case 106:case"end":return t.stop()}}),t,this,[[7,23,27,35],[28,,30,34],[39,93,97,105],[98,,100,104]])}))),function(e){return o.apply(this,arguments)})},{key:"deprecated_handleUnsavedItemsResponse",value:(a=m(r.mark((function t(n){var i,a,o,s,u,c,l,f,h,p;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&0!=n.length){t.next=2;break}return t.abrupt("return");case 2:this.loggingEnabled&&console.log("Handle Unsaved Items:",n),i=!0,a=!1,o=void 0,t.prev=6,s=n[Symbol.iterator]();case 8:if(i=(u=s.next()).done){t.next=35;break}return c=u.value,l=c.item,t.t0=SFJS.itemTransformer,t.t1=[l],t.next=15,this.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 15:return t.t2=t.sent.keys,t.next=18,t.t0.decryptMultipleItems.call(t.t0,t.t1,t.t2);case 18:if(f=this.modelManager.findItem(l.uuid)){t.next=21;break}return t.abrupt("continue",32);case 21:if("uuid_conflict"!==(h=c.error).tag){t.next=27;break}return t.next=25,this.modelManager.alternateUUIDForItem(f);case 25:t.next=32;break;case 27:if("sync_conflict"!==h.tag){t.next=32;break}return t.next=30,this.modelManager.createDuplicateItemFromResponseItem(l);case 30:p=t.sent,l.deleted||f.isItemContentEqualWith(p)||this.modelManager.addDuplicatedItemAsConflict({duplicate:p,duplicateOf:f});case 32:i=!0,t.next=8;break;case 35:t.next=41;break;case 37:t.prev=37,t.t3=t.catch(6),a=!0,o=t.t3;case 41:t.prev=41,t.prev=42,i||null==s.return||s.return();case 44:if(t.prev=44,!a){t.next=47;break}throw o;case 47:return t.finish(44);case 48:return t.finish(41);case 49:case"end":return t.stop()}}),t,this,[[6,37,41,49],[42,,44,48]])}))),function(e){return a.apply(this,arguments)})},{key:"stateless_downloadAllItems",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(){var i=m(r.mark((function i(a,o){var s;return r.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s={limit:n.limit||500,sync_token:n.syncToken,cursor_token:n.cursorToken,content_type:n.contentType,event:n.event,api:I.getApiVersion()},i.prev=1,i.t0=t.httpManager,i.next=5,t.getSyncURL();case 5:i.t1=i.sent,i.t2=s,i.t3=function(){var i=m(r.mark((function i(o){var s,u;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.retrievedItems||(n.retrievedItems=[]),s=o.retrieved_items,r.next=4,t.getActiveKeyInfo(e.KeyRequestLoadSaveAccount);case 4:return u=r.sent.keys,r.next=7,SFJS.itemTransformer.decryptMultipleItems(s,u);case 7:n.retrievedItems=n.retrievedItems.concat(s.map((function(e){return t.modelManager.createItem(e)}))),n.syncToken=o.sync_token,n.cursorToken=o.cursor_token,n.cursorToken?t.stateless_downloadAllItems(n).then(a):a(n.retrievedItems);case 11:case"end":return r.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}(),i.t4=function(e,t){o(e)},i.t0.postAuthenticatedAbsolute.call(i.t0,i.t1,i.t2,i.t3,i.t4),i.next=16;break;case 12:i.prev=12,i.t5=i.catch(1),console.log("Download all items exception caught:",i.t5),o(i.t5);case 16:case"end":return i.stop()}}),i,null,[[1,12]])})));return function(e,t){return i.apply(this,arguments)}}())}},{key:"resolveOutOfSync",value:(i=m(r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.stateless_downloadAllItems({event:"resolve-out-of-sync"}).then(function(){var e=m(r.mark((function e(n){var i,a,o,s,u,c,l,f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=[],a=!0,o=!1,s=void 0,e.prev=4,u=n[Symbol.iterator]();case 6:if(a=(c=u.next()).done){e.next=18;break}if(l=c.value,!(f=t.modelManager.findItem(l.uuid))){e.next=14;break}if(l.isItemContentEqualWith(f)){e.next=14;break}return e.next=14,t.modelManager.duplicateItemAndAddAsConflict(f);case 14:i.push(l);case 15:a=!0,e.next=6;break;case 18:e.next=24;break;case 20:e.prev=20,e.t0=e.catch(4),o=!0,s=e.t0;case 24:e.prev=24,e.prev=25,a||null==u.return||u.return();case 27:if(e.prev=27,!o){e.next=30;break}throw s;case 30:return e.finish(27);case 31:return e.finish(24);case 32:return e.next=34,t.modelManager.mapResponseItemsToLocalModelsWithOptions({items:i,source:C.MappingSourceRemoteRetrieved});case 34:return e.next=36,t.writeItemsToLocalStorage(t.modelManager.allNondummyItems);case 36:return e.abrupt("return",t.sync({performIntegrityCheck:!0}));case 37:case"end":return e.stop()}}),e,null,[[4,20,24,32],[25,,27,31]])})));return function(t){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handleSignout",value:(n=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.outOfSync=!1,this.loadLocalDataPromise=null,this.performSyncAgainOnCompletion=!1,this.syncStatus.syncOpInProgress=!1,this._queuedCallbacks=[],this.syncStatus={},e.abrupt("return",this.clearSyncToken());case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearSyncToken",value:(t=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._syncToken=null,this._cursorToken=null,e.abrupt("return",this.storageManager.removeItem("syncToken"));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"__setLocalDataNotLoaded",value:function(){this.loadLocalDataPromise=null,this._initialDataLoaded=!1}},{key:"queuedCallbacks",get:function(){return this._queuedCallbacks||(this._queuedCallbacks=[]),this._queuedCallbacks}}]),e}();i.SFSyncManager=T;var j=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g(this,e),this.content={},this.referencingObjects=[],this.updateFromJSON(t),this.uuid||"undefined"!=typeof SFJS&&SFJS.crypto.generateUUIDSync&&(this.uuid=SFJS.crypto.generateUUIDSync()),"object"!==v(this.content)||this.content.references||(this.content.references=[])}var t;return k(e,[{key:"initUUID",value:(t=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uuid){e.next=4;break}return e.next=3,SFJS.crypto.generateUUID();case 3:this.uuid=e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateFromJSON",value:function(t){if(t){this.deleted=t.deleted,this.uuid=t.uuid,this.enc_item_key=t.enc_item_key,this.auth_hash=t.auth_hash,this.auth_params=t.auth_params;for(var n=0,r=["errorDecrypting","dirty","dirtyCount","dirtiedDate","dummy"];n<r.length;n++){var i=r[n];void 0!==t[i]&&(this[i]=t[i])}if(this.dirtiedDate&&"string"==typeof this.dirtiedDate&&(this.dirtiedDate=new Date(this.dirtiedDate)),this.content_type||(this.content_type=t.content_type),t.errorDecrypting)this.content=t.content;else try{var a="string"==typeof t.content?JSON.parse(t.content):t.content;e.deepMerge(this.contentObject,a)}catch(e){console.log("Error while updating item from json",e)}t.created_at&&(this.created_at=t.created_at),t.updated_at&&(this.updated_at=t.updated_at),this.created_at?this.created_at=new Date(this.created_at):this.created_at=new Date,this.updated_at?this.updated_at=new Date(this.updated_at):this.updated_at=new Date(0),this._client_updated_at=null,t.content?this.mapContentToLocalProperties(this.contentObject):1==t.deleted&&this.handleDeletedContent()}}},{key:"mapContentToLocalProperties",value:function(e){}},{key:"createContentJSONFromProperties",value:function(){var t=this.structureParams();return e.deepMerge(this.contentObject,t),t}},{key:"structureParams",value:function(){return this.getContentCopy()}},{key:"handleDeletedContent",value:function(){}},{key:"setDirty",value:function(e,t){this.dirty=e,this.dirtyCount||(this.dirtyCount=0),e?this.dirtyCount++:this.dirtyCount=0,this.dirtiedDate=new Date,e&&t?this.client_updated_at=new Date:this.hasRawClientUpdatedAtValue()||(this.client_updated_at=new Date(this.updated_at))}},{key:"updateLocalRelationships",value:function(){}},{key:"addItemAsRelationship",value:function(e){if(e.setIsBeingReferencedBy(this),!this.hasRelationshipWithItem(e)){var t=this.content.references||[];t.push({uuid:e.uuid,content_type:e.content_type}),this.content.references=t}}},{key:"removeItemAsRelationship",value:function(e){e.setIsNoLongerBeingReferencedBy(this),this.removeReferenceWithUuid(e.uuid)}},{key:"setIsBeingReferencedBy",value:function(e){_.find(this.referencingObjects,{uuid:e.uuid})||this.referencingObjects.push(e)}},{key:"setIsNoLongerBeingReferencedBy",value:function(e){_.remove(this.referencingObjects,{uuid:e.uuid}),this.hasRelationshipWithItem(e)&&(this.removeReferenceWithUuid(e.uuid),this.setDirty(!0))}},{key:"removeReferenceWithUuid",value:function(e){var t=this.content.references||[];t=t.filter((function(t){return t.uuid!=e})),this.content.references=t}},{key:"hasRelationshipWithItem",value:function(e){return null!=this.content.references.find((function(t){return t.uuid==e.uuid}))}},{key:"isBeingRemovedLocally",value:function(){}},{key:"didFinishSyncing",value:function(){}},{key:"informReferencesOfUUIDChange",value:function(e,t){}},{key:"potentialItemOfInterestHasChangedItsUUID",value:function(e,t,n){if(!this.errorDecrypting){var r=!0,i=!1,a=void 0;try{for(var o,s=this.content.references[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;u.uuid==t&&(u.uuid=n,this.setDirty(!0))}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"doNotEncrypt",value:function(){return!1}},{key:"setDomainDataItem",value:function(e,t,n){if(n){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var r=this.content.appData[n];r||(r={}),r[e]=t,this.content.appData[n]=r}}else console.error("SFItem.AppDomain needs to be set.")}},{key:"getDomainDataItem",value:function(e,t){if(t){if(!this.errorDecrypting){this.content.appData||(this.content.appData={});var n=this.content.appData[t];return n?n[e]:null}}else console.error("SFItem.AppDomain needs to be set.")}},{key:"setAppDataItem",value:function(t,n){this.setDomainDataItem(t,n,e.AppDomain)}},{key:"getAppDataItem",value:function(t){return this.getDomainDataItem(t,e.AppDomain)}},{key:"hasRawClientUpdatedAtValue",value:function(){return null!=this.getAppDataItem("client_updated_at")}},{key:"keysToIgnoreWhenCheckingContentEquality",value:function(){return[]}},{key:"appDataKeysToIgnoreWhenCheckingContentEquality",value:function(){return["client_updated_at"]}},{key:"getContentCopy",value:function(){return JSON.parse(JSON.stringify(this.content))}},{key:"isItemContentEqualWith",value:function(t){return e.AreItemContentsEqual({leftContent:this.content,rightContent:t.content,keysToIgnore:this.keysToIgnoreWhenCheckingContentEquality(),appDataKeysToIgnore:this.appDataKeysToIgnoreWhenCheckingContentEquality()})}},{key:"satisfiesPredicate",value:function(e){return L.ItemSatisfiesPredicate(this,e)}},{key:"createdAtString",value:function(){return this.dateToLocalizedString(this.created_at)}},{key:"updatedAtString",value:function(){return this.dateToLocalizedString(this.client_updated_at)}},{key:"updatedAtTimestamp",value:function(){return this.updated_at.getTime()}},{key:"dateToLocalizedString",value:function(e){if("undefined"!=typeof Intl&&Intl.DateTimeFormat){if(!E){var t=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;E=new Intl.DateTimeFormat(t,{year:"numeric",month:"short",day:"2-digit",weekday:"long",hour:"2-digit",minute:"2-digit"})}return E.format(e)}return e.toDateString()+" "+e.toLocaleTimeString()}},{key:"contentObject",get:function(){if(this.errorDecrypting)return this.content;if(!this.content)return this.content={},this.content;if(null!==this.content&&"object"===v(this.content))return this.content;try{var e=JSON.parse(this.content);return this.content=e,this.content}catch(e){return console.log("Error parsing json",e,this),this.content={},this.content}}},{key:"pinned",get:function(){return this.getAppDataItem("pinned")}},{key:"archived",get:function(){return this.getAppDataItem("archived")}},{key:"locked",get:function(){return this.getAppDataItem("locked")}},{key:"displayName",get:function(){return"Item"}},{key:"client_updated_at",get:function(){if(!this._client_updated_at){var e=this.getAppDataItem("client_updated_at");this._client_updated_at=e?new Date(e):new Date(this.updated_at)}return this._client_updated_at},set:function(e){this._client_updated_at=e,this.setAppDataItem("client_updated_at",e)}}],[{key:"deepMerge",value:function(e,t){return _.mergeWith(e,t,(function(e,t){if(_.isArray(e))return t})),e}},{key:"AreItemContentsEqual",value:function(t){var n=t.leftContent,r=t.rightContent,i=t.keysToIgnore,a=t.appDataKeysToIgnore,o=function(e,t){if(!e)return e;var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)delete e[a.value]}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return e};return(n=JSON.parse(JSON.stringify(n))).appData&&o(n.appData[e.AppDomain],a),n=o(n,i),(r=JSON.parse(JSON.stringify(r))).appData&&o(r.appData[e.AppDomain],a),r=o(r,i),JSON.stringify(n)===JSON.stringify(r)}}]),e}();i.SFItem=j;var P=function(){function e(t,n,r){if(g(this,e),this.item=t,this.keys=n,this.auth_params=r,this.keys&&!this.auth_params)throw"SFItemParams.auth_params must be supplied if supplying keys.";if(this.auth_params&&!this.auth_params.version)throw"SFItemParams.auth_params is missing version"}var t,n,i,a,o;return k(e,[{key:"paramsForExportFile",value:(o=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.forExportFile=!0,!t){e.next=5;break}return e.abrupt("return",this.__params());case 5:return e.next=7,this.__params();case 7:return n=e.sent,e.abrupt("return",_.omit(n,["deleted"]));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"paramsForExtension",value:(a=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.paramsForExportFile());case 1:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"paramsForLocalStorage",value:(i=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.additionalFields=["dirty","dirtiedDate","errorDecrypting"],this.forExportFile=!0,e.abrupt("return",this.__params());case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"paramsForSync",value:(n=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.__params());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"__params",value:(t=m(r.mark((function e(){var t,n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={uuid:this.item.uuid,content_type:this.item.content_type,deleted:this.item.deleted,created_at:this.item.created_at,updated_at:this.item.updated_at},this.item.errorDecrypting){e.next=23;break}if(n=this.item.doNotEncrypt()&&!this.forExportFile,!this.keys||n){e.next=11;break}return e.next=6,SFJS.itemTransformer.encryptItem(this.item,this.keys,this.auth_params);case 6:i=e.sent,_.merge(t,i),"001"!==this.auth_params.version&&(t.auth_hash=null),e.next=21;break;case 11:if(!this.forExportFile){e.next=15;break}e.t0=this.item.createContentJSONFromProperties(),e.next=19;break;case 15:return e.next=17,SFJS.crypto.base64(JSON.stringify(this.item.createContentJSONFromProperties()));case 17:e.t1=e.sent,e.t0="000"+e.t1;case 19:t.content=e.t0,this.forExportFile||(t.enc_item_key=null,t.auth_hash=null);case 21:e.next=26;break;case 23:t.content=this.item.content,t.enc_item_key=this.item.enc_item_key,t.auth_hash=this.item.auth_hash;case 26:return this.additionalFields&&_.merge(t,_.pick(this.item,this.additionalFields)),e.abrupt("return",t);case 28:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();i.SFItemParams=P;var L=function(){function e(t,n,r){g(this,e),this.keypath=t,this.operator=n,this.value=r,e.IsRecursiveOperator(this.operator)&&(this.value=this.value.map(e.fromArray))}return k(e,null,[{key:"fromArray",value:function(t){return new e(t[0],t[1],t[2])}},{key:"ObjectSatisfiesPredicate",value:function(t,n){if(Array.isArray(n)&&(n=this.fromArray(n)),e.IsRecursiveOperator(n.operator)){if("and"===n.operator){var r=!0,i=!1,a=void 0;try{for(var o,s=n.value[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var u=o.value;if(!this.ObjectSatisfiesPredicate(t,u))return!1}}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return!0}if("or"===n.operator){var c=!0,l=!1,f=void 0;try{for(var h,p=n.value[Symbol.iterator]();!(c=(h=p.next()).done);c=!0)if(u=h.value,this.ObjectSatisfiesPredicate(t,u))return!0}catch(e){l=!0,f=e}finally{try{c||null==p.return||p.return()}finally{if(l)throw f}}return!1}}var d=n.value;"string"==typeof d&&d.includes(".ago")&&(d=this.DateFromString(d));var v=n.keypath.split(".").reduce((function(e,t){return e&&e[t]}),t),y=[!1,"",null,void 0,NaN];return null==v?"!="==n.operator?!y.includes(n.value):y.includes(n.value):"="==n.operator?Array.isArray(v)?JSON.stringify(v)==JSON.stringify(d):v==d:"!="==n.operator?Array.isArray(v)?JSON.stringify(v)!=JSON.stringify(d):v!==d:"<"==n.operator?v<d:">"==n.operator?v>d:"<="==n.operator?v<=d:">="==n.operator?v>=d:"startsWith"==n.operator?v.startsWith(d):"in"==n.operator?-1!=d.indexOf(v):"includes"==n.operator?this.resolveIncludesPredicate(v,d):"matches"==n.operator&&new RegExp(d).test(v)}},{key:"resolveIncludesPredicate",value:function(t,n){if("string"==typeof n)return t.includes(n);var r;r=Array.isArray(n)?e.fromArray(n):n;var i=!0,a=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var c=s.value;if(this.ObjectSatisfiesPredicate(c,r))return!0}}catch(e){a=!0,o=e}finally{try{i||null==u.return||u.return()}finally{if(a)throw o}}return!1}},{key:"ItemSatisfiesPredicate",value:function(t,n){return Array.isArray(n)&&(n=e.fromArray(n)),this.ObjectSatisfiesPredicate(t,n)}},{key:"ItemSatisfiesPredicates",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(!this.ItemSatisfiesPredicate(e,s))return!1}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return!0}},{key:"DateFromString",value:function(e){var t=e.split("."),n=t[1],r=new Date,i=parseInt(t[0]);return"days"==n?r.setDate(r.getDate()-i):"hours"==n&&r.setHours(r.getHours()-i),r}},{key:"IsRecursiveOperator",value:function(e){return["and","or"].includes(e)}}]),e}();i.SFPredicate=L;var R=function(e){function t(e){var n;return g(this,t),(n=l(this,f(t).call(this,e))).content.desktopPrivileges||(n.content.desktopPrivileges={}),n}return h(t,e),k(t,null,[{key:"contentType",value:function(){return"SN|Privileges"}}]),k(t,[{key:"setCredentialsForAction",value:function(e,t){this.content.desktopPrivileges[e]=t}},{key:"getCredentialsForAction",value:function(e){return this.content.desktopPrivileges[e]||[]}},{key:"toggleCredentialForAction",value:function(e,t){this.isCredentialRequiredForAction(e,t)?this.removeCredentialForAction(e,t):this.addCredentialForAction(e,t)}},{key:"removeCredentialForAction",value:function(e,t){_.pull(this.content.desktopPrivileges[e],t)}},{key:"addCredentialForAction",value:function(e,t){var n=this.getCredentialsForAction(e);n.push(t),this.setCredentialsForAction(e,n)}},{key:"isCredentialRequiredForAction",value:function(e,t){return this.getCredentialsForAction(e).includes(t)}}]),t}(j);i.SFPrivileges=R;var B=function(e){function t(e){var n;return g(this,t),(n=l(this,f(t).call(this,e))).content.itemUUIDToItemHistoryMapping||(n.content.itemUUIDToItemHistoryMapping={}),Object.keys(n.content.itemUUIDToItemHistoryMapping).forEach((function(e){var t=n.content.itemUUIDToItemHistoryMapping[e];n.content.itemUUIDToItemHistoryMapping[e]=new H(t)})),n}return h(t,e),k(t,[{key:"addEntryForItem",value:function(e){return this.historyForItem(e).addHistoryEntryForItem(e)}},{key:"historyForItem",value:function(e){var t=this.content.itemUUIDToItemHistoryMapping[e.uuid];return t||(t=this.content.itemUUIDToItemHistoryMapping[e.uuid]=new H),t}},{key:"clearItemHistory",value:function(e){this.historyForItem(e).clear()}},{key:"clearAllHistory",value:function(){this.content.itemUUIDToItemHistoryMapping={}}},{key:"optimizeHistoryForItem",value:function(e){var n=this.historyForItem(e);n.entries.length>t.LargeItemEntryAmountThreshold&&n.optimize()}}]),t}(j);i.SFHistorySession=B,B.LargeItemEntryAmountThreshold=60;var H=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(g(this,e),this.entries||(this.entries=[]),t.entries){var n=!0,r=!1,i=void 0;try{for(var a,o=t.entries[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=this.createEntryForItem(s.item);u.setPreviousEntry(this.getLastEntry()),this.entries.push(u)}}catch(e){r=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}return k(e,[{key:"createEntryForItem",value:function(t){var n=e.HistoryEntryClassMapping&&e.HistoryEntryClassMapping[t.content_type];return n||(n=N),new n(t)}},{key:"getLastEntry",value:function(){return this.entries[this.entries.length-1]}},{key:"addHistoryEntryForItem",value:function(e){var t=this.createEntryForItem(e),n=this.getLastEntry();if(t.setPreviousEntry(n),!t.isSameAsEntry(n))return this.entries.push(t),t}},{key:"clear",value:function(){this.entries.length=0}},{key:"optimize",value:function(){var t=this,n=[],r=function(t){return t.deltaSize()>e.LargeEntryDeltaThreshold},i=function(e,i,a){if(a?n.push(e):-1!==(i=n.indexOf(e))&&n.splice(i,1),a&&r(e)&&-1==e.operationVector()){var o=t.entries[i-1];o&&n.push(o)}};this.entries.forEach((function(e,n){if(0==n||n==t.entries.length-1)i(e,n,!0);else{var a=r(e);i(e,n,a)}})),this.entries=this.entries.filter((function(e,t){return-1!==n.indexOf(e)}))}}]),e}();i.SFItemHistory=H,H.LargeEntryDeltaThreshold=15;var N=function(){function e(t){g(this,e),this.item=j.deepMerge({},t),this.defaultContentKeyToDiffOn="text",this.textCharDiffLength=0,"string"==typeof this.item.updated_at&&(this.item.updated_at=new Date(this.item.updated_at))}return k(e,[{key:"setPreviousEntry",value:function(e){this.hasPreviousEntry=null!=e,this.item.content[this.defaultContentKeyToDiffOn]&&(this.textCharDiffLength=e?this.item.content[this.defaultContentKeyToDiffOn].length-e.item.content[this.defaultContentKeyToDiffOn].length:this.item.content[this.defaultContentKeyToDiffOn].length)}},{key:"operationVector",value:function(){return null!=this.textCharDiffLength?this.hasPreviousEntry&&0!=this.textCharDiffLength?this.textCharDiffLength<0?-1:1:0:1}},{key:"deltaSize",value:function(){return null!=this.textCharDiffLength?Math.abs(this.textCharDiffLength):1}},{key:"isSameAsEntry",value:function(e){if(!e)return!1;var t=new j(this.item),n=new j(e.item);return t.isItemContentEqualWith(n)}}]),e}();i.SFItemHistoryEntry=N,S="undefined"!=typeof window?window:void 0!==e?e:null;var U=function(){function e(){g(this,e),this.DefaultPBKDF2Length=768}var t,n,i,a,o,s,u,l,f,h,p,d,v,y,b;return k(e,[{key:"generateUUIDSync",value:function(){var e=S.crypto||S.msCrypto;if(e){var t=new Uint32Array(4);e.getRandomValues(t);var n=-1;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){n++;var r=t[n>>3]>>n%8*4&15;return("x"==e?r:3&r|8).toString(16)}))}var r=(new Date).getTime();return S.performance&&"function"==typeof S.performance.now&&(r+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)}))}},{key:"generateUUID",value:(b=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.generateUUIDSync());case 1:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"timingSafeEqual",value:function(e,t){var n=String(e),r=String(t),i=n.length,a=0;i!==r.length&&(r=n,a=1);for(var o=0;o<i;o++)a|=n.charCodeAt(o)^r.charCodeAt(o);return 0===a}},{key:"decryptText",value:(y=m(r.mark((function e(){var t,n,i,a,o,s,u,l,f,h,p,d=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=d.length>0&&void 0!==d[0]?d[0]:{},n=t.ciphertextToAuth,i=t.contentCiphertext,a=t.encryptionKey,o=t.iv,s=t.authHash,u=t.authKey,!(d.length>1?d[1]:void 0)||s){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!s){e.next=12;break}return e.next=8,this.hmac256(n,u);case 8:if(l=e.sent,!1!==this.timingSafeEqual(s,l)){e.next=12;break}return console.error("Auth hash does not match, returning null."),e.abrupt("return",null);case 12:return f=c.enc.Hex.parse(a),h=c.enc.Hex.parse(o||""),p=c.AES.decrypt(i,f,{iv:h,mode:c.mode.CBC,padding:c.pad.Pkcs7}),e.abrupt("return",p.toString(c.enc.Utf8));case 16:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"encryptText",value:(v=m(r.mark((function e(t,n,i){var a,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.enc.Hex.parse(n),o=c.enc.Hex.parse(i||""),s=c.AES.encrypt(t,a,{iv:o,mode:c.mode.CBC,padding:c.pad.Pkcs7}),e.abrupt("return",s.toString());case 4:case"end":return e.stop()}}),e)}))),function(e,t,n){return v.apply(this,arguments)})},{key:"generateRandomKey",value:(d=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.lib.WordArray.random(t/8).toString());case 1:case"end":return e.stop()}}),e)}))),function(e){return d.apply(this,arguments)})},{key:"generateItemEncryptionKey",value:(p=m(r.mark((function e(){var t,n,i,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=512,n=1,e.next=4,this.generateRandomKey(t);case 4:return i=e.sent,e.next=7,this.generateRandomKey(t);case 7:return a=e.sent,e.abrupt("return",this.pbkdf2(a,i,n,t));case 9:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"firstHalfOfKey",value:(h=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(0,t.length/2));case 1:case"end":return e.stop()}}),e)}))),function(e){return h.apply(this,arguments)})},{key:"secondHalfOfKey",value:(f=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.substring(t.length/2,t.length));case 1:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"base64",value:(l=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)}))));case 1:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"base64Decode",value:(u=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",S.atob(t));case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"sha256",value:(s=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",c.SHA256(t).toString());case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"hmac256",value:(o=m(r.mark((function e(t,n){var i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=c.enc.Hex.parse(n),a=c.enc.Utf8.parse(t),o=c.HmacSHA256(a,i).toString(),e.abrupt("return",o);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"generateSalt",value:(a=m(r.mark((function e(t,n,i,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sha256([t,"SF",n,i,a].join(":"));case 2:return o=e.sent,e.abrupt("return",o);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"generateSymmetricKeyPair",value:(i=m(r.mark((function e(){var t,n,i,a,o,s,u,c,l,f,h=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=h.length>0&&void 0!==h[0]?h[0]:{},n=t.password,i=t.pw_salt,a=t.pw_cost,e.next=3,this.pbkdf2(n,i,a,this.DefaultPBKDF2Length);case 3:return o=e.sent,s=o.length,u=s/3,c=o.slice(0,u),l=o.slice(u,2*u),f=o.slice(2*u,3*u),e.abrupt("return",[c,l,f]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"computeEncryptionKeysForUser",value:(n=m(r.mark((function e(t,n){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("003"!=n.version){e.next=9;break}if(n.identifier){e.next=4;break}return console.error("authParams is missing identifier."),e.abrupt("return");case 4:return e.next=6,this.generateSalt(n.identifier,n.version,n.pw_cost,n.pw_nonce);case 6:i=e.sent,e.next=10;break;case 9:i=n.pw_salt;case 10:return e.abrupt("return",this.generateSymmetricKeyPair({password:t,pw_salt:i,pw_cost:n.pw_cost}).then((function(e){return{pw:e[0],mk:e[1],ak:e[2]}})));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"generateInitialKeysAndAuthParamsForUser",value:(t=m(r.mark((function e(t,n){var i,a,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.SFJS.version,a=this.SFJS.defaultPasswordGenerationCost,e.next=4,this.generateRandomKey(256);case 4:return o=e.sent,e.next=7,this.generateSalt(t,i,a,o);case 7:return s=e.sent,e.abrupt("return",this.generateSymmetricKeyPair({password:n,pw_salt:s,pw_cost:a}).then((function(e){var n={pw_nonce:o,pw_cost:a,identifier:t,version:i};return{keys:{pw:e[0],mk:e[1],ak:e[2]},authParams:n}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}();i.SFAbstractCrypto=U;var z=function(e){function t(){return g(this,t),l(this,f(t).apply(this,arguments))}var n;return h(t,e),k(t,[{key:"pbkdf2",value:(n=m(r.mark((function e(t,n,i,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={keySize:a/32,hasher:c.algo.SHA512,iterations:i},e.abrupt("return",c.PBKDF2(t,n,o).toString());case 2:case"end":return e.stop()}}),e)}))),function(e,t,r,i){return n.apply(this,arguments)})}]),t}(U);i.SFCryptoJS=z;var K=(S="undefined"!=typeof window?window:void 0!==e?e:null).crypto?S.crypto.subtle:null,W=function(e){function t(){return g(this,t),l(this,f(t).apply(this,arguments))}var n,i,a,o,s,u,c,p,d,v,y,b,w,x;return h(t,e),k(t,[{key:"pbkdf2",value:(x=m(r.mark((function e(t,n,i,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.webCryptoImportKey(t,"PBKDF2",["deriveBits"]);case 2:if(o=e.sent){e.next=6;break}return console.log("Key is null, unable to continue"),e.abrupt("return",null);case 6:return e.abrupt("return",this.webCryptoDeriveBits(o,n,i,a));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return x.apply(this,arguments)})},{key:"generateRandomKey",value:(w=m(r.mark((function e(t){var n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",K.generateKey({name:"AES-CBC",length:t},!0,["encrypt","decrypt"]).then((function(e){return K.exportKey("raw",e).then(function(){var e=m(r.mark((function e(t){var i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.arrayBufferToHexString(new Uint8Array(t));case 2:return i=e.sent,e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error exporting key",e)}))})).catch((function(e){console.error("Error generating key",e)})));case 2:case"end":return e.stop()}}),e)}))),function(e){return w.apply(this,arguments)})},{key:"generateItemEncryptionKey",value:(b=m(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.generateRandomKey(256),this.generateRandomKey(256)]).then((function(e){return e.join("")})));case 2:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"encryptText",value:(y=m(r.mark((function e(t,n,i){var a,o,s,u,c,l=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=6;break}return e.next=3,this.hexStringToArrayBuffer(i);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=new ArrayBuffer(16);case 7:return a=e.t0,o={name:"AES-CBC",iv:a},e.next=11,this.hexStringToArrayBuffer(n);case 11:return s=e.sent,e.next=14,this.webCryptoImportKey(s,o.name,["encrypt"]);case 14:return u=e.sent,e.next=17,this.stringToArrayBuffer(t);case 17:return c=e.sent,e.abrupt("return",crypto.subtle.encrypt(o,u,c).then(function(){var e=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.arrayBufferToBase64(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return y.apply(this,arguments)})},{key:"decryptText",value:(v=m(r.mark((function e(){var t,n,i,a,o,s,u,c,l,f,h,p,d,v=this,y=arguments;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=y.length>0&&void 0!==y[0]?y[0]:{},n=t.ciphertextToAuth,i=t.contentCiphertext,a=t.encryptionKey,o=t.iv,s=t.authHash,u=t.authKey,!(y.length>1?y[1]:void 0)||s){e.next=5;break}return console.error("Auth hash is required."),e.abrupt("return");case 5:if(!s){e.next=12;break}return e.next=8,this.hmac256(n,u);case 8:if(c=e.sent,!1!==this.timingSafeEqual(s,c)){e.next=12;break}return console.error("Auth hash does not match, returning null. ".concat(s," != ").concat(c)),e.abrupt("return",null);case 12:if(!o){e.next=18;break}return e.next=15,this.hexStringToArrayBuffer(o);case 15:e.t0=e.sent,e.next=19;break;case 18:e.t0=new ArrayBuffer(16);case 19:return l=e.t0,f={name:"AES-CBC",iv:l},e.next=23,this.hexStringToArrayBuffer(a);case 23:return h=e.sent,e.next=26,this.webCryptoImportKey(h,f.name,["decrypt"]);case 26:return p=e.sent,e.next=29,this.base64ToArrayBuffer(i);case 29:return d=e.sent,e.abrupt("return",crypto.subtle.decrypt(f,p,d).then(function(){var e=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.arrayBufferToString(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error decrypting:",e)})));case 31:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"hmac256",value:(d=m(r.mark((function e(t,n){var i,a,o,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.hexStringToArrayBuffer(n);case 2:return i=e.sent,e.next=5,this.webCryptoImportKey(i,"HMAC",["sign"],{name:"SHA-256"});case 5:return a=e.sent,e.next=8,this.stringToArrayBuffer(t);case 8:return o=e.sent,e.abrupt("return",crypto.subtle.sign({name:"HMAC"},a,o).then(function(){var e=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.arrayBufferToHexString(t);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.error("Error computing hmac",e)})));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"webCryptoImportKey",value:(p=m(r.mark((function e(t,n,i,a){var o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=6;break}return e.next=3,this.stringToArrayBuffer(t);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=t;case 7:return o=e.t0,e.abrupt("return",K.importKey("raw",o,{name:n,hash:a},!1,i).then((function(e){return e})).catch((function(e){return console.error(e),null})));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return p.apply(this,arguments)})},{key:"webCryptoDeriveBits",value:(c=m(r.mark((function e(t,n,i,a){var o,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.stringToArrayBuffer(n);case 2:return e.t0=e.sent,e.t1=i,e.t2={name:"SHA-512"},o={name:"PBKDF2",salt:e.t0,iterations:e.t1,hash:e.t2},e.abrupt("return",K.deriveBits(o,t,a).then(function(){var e=m(r.mark((function e(t){var n;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.arrayBufferToHexString(new Uint8Array(t));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return console.error(e),null})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return c.apply(this,arguments)})},{key:"stringToArrayBuffer",value:(u=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsArrayBuffer(r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"arrayBufferToString",value:(s=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Blob([t]),i=new FileReader;i.onload=function(t){e(t.target.result)},i.readAsText(r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"arrayBufferToHexString",value:(o=m(r.mark((function e(t){var n,i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=new Uint8Array(t),i="",o=0;o<n.byteLength;o++)(a=n[o].toString(16)).length<2&&(a="0"+a),i+=a;return e.abrupt("return",i);case 4:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"hexStringToArrayBuffer",value:(a=m(r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],i=0;i<t.length;i+=2)n.push(parseInt(t.substr(i,2),16));return e.abrupt("return",new Uint8Array(n));case 2:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"base64ToArrayBuffer",value:(i=m(r.mark((function e(t){var n,i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.base64Decode(t);case 2:for(n=e.sent,i=n.length,a=new Uint8Array(i),o=0;o<i;o++)a[o]=n.charCodeAt(o);return e.abrupt("return",a.buffer);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"arrayBufferToBase64",value:(n=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new Blob([t],{type:"application/octet-binary"}),i=new FileReader;i.onload=function(t){var n=t.target.result;e(n.substr(n.indexOf(",")+1))},i.readAsDataURL(r)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})}]),t}(U);i.SFCryptoWeb=W;var J=function(){function e(t){g(this,e),this.crypto=t}var t,n,i,a;return k(e,[{key:"_private_encryptString",value:(a=m(r.mark((function e(t,n,i,a,o){var s,u,c,l,f,h;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("001"!==o.version){e.next=7;break}return e.next=3,this.crypto.encryptText(t,n,null);case 3:u=e.sent,s=o.version+u,e.next=21;break;case 7:return e.next=9,this.crypto.generateRandomKey(128);case 9:return c=e.sent,e.next=12,this.crypto.encryptText(t,n,c);case 12:return u=e.sent,l=[o.version,a,c,u].join(":"),e.next=16,this.crypto.hmac256(l,i);case 16:return f=e.sent,e.next=19,this.crypto.base64(JSON.stringify(o));case 19:h=e.sent,s=[o.version,f,a,c,u,h].join(":");case 21:return e.abrupt("return",s);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r,i){return a.apply(this,arguments)})},{key:"encryptItem",value:(i=m(r.mark((function e(t,n,i){var a,o,s,u,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={},e.next=3,this.crypto.generateItemEncryptionKey();case 3:if(o=e.sent,"001"!==i.version){e.next=10;break}return e.next=7,this.crypto.encryptText(o,n.mk,null);case 7:a.enc_item_key=e.sent,e.next=13;break;case 10:return e.next=12,this._private_encryptString(o,n.mk,n.ak,t.uuid,i);case 12:a.enc_item_key=e.sent;case 13:return e.next=15,this.crypto.firstHalfOfKey(o);case 15:return s=e.sent,e.next=18,this.crypto.secondHalfOfKey(o);case 18:return u=e.sent,e.next=21,this._private_encryptString(JSON.stringify(t.createContentJSONFromProperties()),s,u,t.uuid,i);case 21:if(c=e.sent,"001"!==i.version){e.next=27;break}return e.next=25,this.crypto.hmac256(c,u);case 25:l=e.sent,a.auth_hash=l;case 27:return a.content=c,e.abrupt("return",a);case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"encryptionComponentsFromString",value:function(e,t,n){var r=e.substring(0,3);if("001"===r)return{contentCiphertext:e.substring(3,e.length),encryptionVersion:r,ciphertextToAuth:e,iv:null,authHash:null,encryptionKey:t,authKey:n};var i=e.split(":");return{encryptionVersion:i[0],authHash:i[1],uuid:i[2],iv:i[3],contentCiphertext:i[4],authParams:i[5],ciphertextToAuth:[i[0],i[2],i[3],i[4]].join(":"),encryptionKey:t,authKey:n}}},{key:"decryptItem",value:(n=m(r.mark((function e(t,n){var i,a,o,s,u,c,l,f;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t.content){e.next=2;break}return e.abrupt("return");case 2:if(!t.content.startsWith("000")){e.next=14;break}return e.prev=3,e.t0=JSON,e.next=7,this.crypto.base64Decode(t.content.substring(3,t.content.length));case 7:e.t1=e.sent,t.content=e.t0.parse.call(e.t0,e.t1),e.next=13;break;case 11:e.prev=11,e.t2=e.catch(3);case 13:return e.abrupt("return");case 14:if(t.enc_item_key){e.next=17;break}return console.log("Missing item encryption key, skipping decryption."),e.abrupt("return");case 17:if(i=t.enc_item_key,a=!0,i.startsWith("002")||i.startsWith("003")||(i="001"+i,a=!1),!(o=this.encryptionComponentsFromString(i,n.mk,n.ak)).uuid||o.uuid===t.uuid){e.next=26;break}return console.error("Item key params UUID does not match item UUID"),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 26:return e.next=28,this.crypto.decryptText(o,a);case 28:if(s=e.sent){e.next=34;break}return console.log("Error decrypting item",t),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 34:return e.next=36,this.crypto.firstHalfOfKey(s);case 36:return u=e.sent,e.next=39,this.crypto.secondHalfOfKey(s);case 39:return c=e.sent,l=this.encryptionComponentsFromString(t.content,u,c),e.prev=41,e.t3=JSON,e.next=45,this.crypto.base64Decode(l.authParams);case 45:e.t4=e.sent,t.auth_params=e.t3.parse.call(e.t3,e.t4),e.next=51;break;case 49:e.prev=49,e.t5=e.catch(41);case 51:if(!l.uuid||l.uuid===t.uuid){e.next=55;break}return t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,e.abrupt("return");case 55:return l.authHash||(l.authHash=t.auth_hash),e.next=58,this.crypto.decryptText(l,!0);case 58:(f=e.sent)?(1==t.errorDecrypting&&(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!1,t.content=f):(t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0);case 60:case"end":return e.stop()}}),e,this,[[3,11],[41,49]])}))),function(e,t){return n.apply(this,arguments)})},{key:"decryptMultipleItems",value:(t=m(r.mark((function e(t,n,i){var a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(){var e=m(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(1!=t.deleted||null!=t.content){e.next=4;break}return e.abrupt("return");case 4:if(!("string"==typeof t.content||t.content instanceof String)){e.next=19;break}return e.prev=6,e.next=9,o.decryptItem(t,n);case 9:e.next=19;break;case 11:if(e.prev=11,e.t0=e.catch(6),t.errorDecrypting||(t.errorDecryptingValueChanged=!0),t.errorDecrypting=!0,!i){e.next=17;break}throw e.t0;case 17:return console.error("Error decrypting item",t,e.t0),e.abrupt("return");case 19:case"end":return e.stop()}}),e,null,[[6,11]])})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",Promise.all(t.map((function(e){return a(e)}))));case 2:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();i.SFItemTransformer=J,S="undefined"!=typeof window?window:void 0!==e?e:null;var q=function(){function e(t){g(this,e),S&&("undefined"!=typeof document&&document.documentMode||/Edge/.test(navigator.userAgent)||!S.crypto||!S.crypto.subtle?this.crypto=new z:this.crypto=new W),t&&(this.crypto=t),this.itemTransformer=new J(this.crypto),this.crypto.SFJS={version:this.version(),defaultPasswordGenerationCost:this.defaultPasswordGenerationCost()}}return k(e,[{key:"version",value:function(){return"003"}},{key:"supportsPasswordDerivationCost",value:function(e){return!(e>5e3)||this.crypto instanceof W}},{key:"supportedVersions",value:function(){return["001","002","003"]}},{key:"isVersionNewerThanLibraryVersion",value:function(e){var t=this.version();return parseInt(e)>parseInt(t)}},{key:"isProtocolVersionOutdated",value:function(e){var t={"001":Date.parse("2018-01-01"),"002":Date.parse("2020-01-01")}[e];return!!t&&new Date>t}},{key:"costMinimumForVersion",value:function(e){return{"001":3e3,"002":3e3,"003":11e4}[e]}},{key:"defaultPasswordGenerationCost",value:function(){return this.costMinimumForVersion(this.version())}}]),e}();if(i.StandardFile=q,S)try{S.StandardFile=q,S.SFJS=new q,S.SFCryptoWeb=W,S.SFCryptoJS=z,S.SFItemTransformer=J,S.SFModelManager=C,S.SFItem=j,S.SFItemParams=P,S.SFHttpManager=I,S.SFStorageManager=F,S.SFSyncManager=T,S.SFAuthManager=x,S.SFMigrationManager=A,S.SFAlertManager=w,S.SFPredicate=L,S.SFHistorySession=B,S.SFSessionHistoryManager=M,S.SFItemHistory=H,S.SFItemHistoryEntry=N,S.SFPrivilegesManager=D,S.SFPrivileges=R,S.SFSingletonManager=O}catch(e){console.log("Exception while exporting window variables",e)}}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}).call(this,n(2))},function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=v;var l={},f={};f[a]=function(){return this};var h=Object.getPrototypeOf,p=h&&h(h(A([])));p&&p!==n&&r.call(p,a)&&(f=p);var d=b.prototype=m.prototype=Object.create(f);g.prototype=d.constructor=b,b.constructor=g,b[s]=g.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,s in e||(e[s]="GeneratorFunction")),e.prototype=Object.create(d),e},c.awrap=function(e){return{__await:e}},k(w.prototype),w.prototype[o]=function(){return this},c.AsyncIterator=w,c.async=function(e,t,n,r){var i=new w(v(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},k(d),d[s]="Generator",d[a]=function(){return this},d.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=A,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;I(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function v(e,t,n,r){var i=t&&t.prototype instanceof m?t:m,a=Object.create(i.prototype),o=new _(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return{value:void 0,done:!0}}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=y(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),a}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function m(){}function g(){}function b(){}function k(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function w(e){var t;this._invoke=function(n,i){function a(){return new Promise((function(t,a){!function t(n,i,a,o){var s=y(e[n],e,i);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,a,o)}),(function(e){t("throw",e,a,o)})):Promise.resolve(c).then((function(e){u.value=e,a(u)}),o)}o(s.arg)}(n,i,t,a)}))}return t=t?t.then(a,a):a()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){(function(e,r){var i;(function(){function a(e,t){return e.set(t[0],t[1]),e}function o(e,t){return e.add(t),e}function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function u(e,t){for(var n=-1,r=null==e?0:e.length,i=0,a=[];++n<r;){var o=e[n];t(o,n,e)&&(a[i++]=o)}return a}function c(e,t){return!(null==e||!e.length)&&-1<v(e,t,0)}function l(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function f(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function h(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)n=t(n,e[r],r,e);return n}function p(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function d(e,t,n){var r=e.length;for(n+=-1;++n<r;)if(t(e[n],n,e))return n;return-1}function v(e,t,n){if(t==t)e:{--n;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=d(e,y,n);return e}function y(e){return e!=e}function m(e,t){return e.has(t)}function g(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function b(e){var t=Object;return function(n){return e(t(n))}}function k(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function w(){}function x(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function S(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function I(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function _(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new I;++t<n;)this.add(e[t])}function A(e){this.size=(this.__data__=new S(e)).size}function C(e,t){var n,r=xn(e),i=!r&&wn(e),a=!r&&!i&&Sn(e),o=!r&&!i&&!a&&In(e);if(r=r||i||a||o){i=e.length;for(var s=String,u=-1,c=Array(i);++u<i;)c[u]=s(u);i=c}else i=[];for(n in s=i.length,e)!t&&!_t.call(e,n)||r&&("length"==n||a&&("offset"==n||"parent"==n)||o&&("buffer"==n||"byteLength"==n||"byteOffset"==n)||ce(n,s))||i.push(n);return i}function D(e,t,n){(n===$e||we(e[t],n))&&(n!==$e||t in e)||F(e,t,n)}function M(e,t,n){var r=e[t];_t.call(e,t)&&we(r,n)&&(n!==$e||t in e)||F(e,t,n)}function O(e,t){for(var n=e.length;n--;)if(we(e[n][0],t))return n;return-1}function F(e,t,n){"__proto__"==t&&Nt?Nt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function E(e,t,n,r,i,a){var o,s=1&t,u=2&t,c=4&t;if(n&&(o=i?n(e,r,i,a):n(e)),o!==$e)return o;if(!Ae(e))return e;if(r=xn(e)){if(o=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&_t.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!s)return G(e,o)}else{var l=yn(e),f="[object Function]"==l||"[object GeneratorFunction]"==l;if(Sn(e))return q(e,s);if("[object Object]"==l||"[object Arguments]"==l||f&&!i){if(o=u||f?{}:oe(e),!s)return u?function(e,t){return Q(e,vn(e),t)}(e,function(e,t){return e&&Q(t,He(t),e)}(o,e)):function(e,t){return Q(e,dn(e),t)}(e,function(e,t){return e&&Q(t,Be(t),e)}(o,e))}else{if(!lt[l])return i?e:{};o=se(e,l,E,s)}}if(a||(a=new A),i=a.get(e))return i;a.set(e,o),u=c?u?ne:te:u?He:Be;var h=r?$e:u(e);return function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n););}(h||e,(function(r,i){h&&(r=e[i=r]),M(o,i,E(r,t,n,i,e,a))})),o}function T(e,t){var n=[];return ln(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function j(e,t){for(var n=0,r=(t=J(t,e)).length;null!=e&&n<r;)e=e[de(t[n++])];return n&&n==r?e:$e}function P(e,t,n){return t=t(e),xn(e)?t:f(t,n(e))}function L(e){if(null==e)e=e===$e?"[object Undefined]":"[object Null]";else if(Ht&&Ht in Object(e)){var t=_t.call(e,Ht),n=e[Ht];try{e[Ht]=$e;var r=!0}catch(e){}var i=Ct.call(e);r&&(t?e[Ht]=n:delete e[Ht]),e=i}else e=Ct.call(e);return e}function R(e){return Ce(e)&&"[object Arguments]"==L(e)}function B(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!Ce(e)&&!Ce(t))t=e!=e&&t!=t;else e:{var a,o,s=xn(e),u=xn(t),c="[object Object]"==(a="[object Arguments]"==(a=s?"[object Array]":yn(e))?"[object Object]":a);if(u="[object Object]"==(o="[object Arguments]"==(o=u?"[object Array]":yn(t))?"[object Object]":o),(o=a==o)&&Sn(e)){if(!Sn(t)){t=!1;break e}s=!0,c=!1}if(o&&!c)i||(i=new A),t=s||In(e)?Z(e,t,n,r,B,i):function(e,t,n,r,i,a,o){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!a(new Et(e),new Et(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return we(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=g;case"[object Set]":if(s||(s=k),e.size!=t.size&&!(1&r))break;return(n=o.get(e))?n==t:(r|=2,o.set(e,t),t=Z(s(e),s(t),r,i,a,o),o.delete(e),t);case"[object Symbol]":if(sn)return sn.call(e)==sn.call(t)}return!1}(e,t,a,n,r,B,i);else{if(!(1&n)&&(s=c&&_t.call(e,"__wrapped__"),a=u&&_t.call(t,"__wrapped__"),s||a)){e=s?e.value():e,t=a?t.value():t,i||(i=new A),t=B(e,t,n,r,i);break e}if(o)t:if(i||(i=new A),s=1&n,a=te(e),u=a.length,o=te(t).length,u==o||s){for(c=u;c--;){var l=a[c];if(!(s?l in t:_t.call(t,l))){t=!1;break t}}if((o=i.get(e))&&i.get(t))t=o==t;else{o=!0,i.set(e,t),i.set(t,e);for(var f=s;++c<u;){var h=e[l=a[c]],p=t[l];if(r)var d=s?r(p,h,l,t,e,i):r(h,p,l,e,t,i);if(d===$e?h!==p&&!B(h,p,n,r,i):!d){o=!1;break}f||(f="constructor"==l)}o&&!f&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(o=!1),i.delete(e),i.delete(t),t=o}}else t=!1;else t=!1}}return t}function H(e){return"function"==typeof e?e:null==e?ze:"object"==typeof e?xn(e)?function(e,t){return le(e)&&t==t&&!Ae(t)?he(de(e),t):function(n){var r=Le(n,e);return r===$e&&r===t?Re(n,e):B(t,r,3)}}(e[0],e[1]):function(e){var t=function(e){for(var t=Be(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!Ae(i)]}return t}(e);return 1==t.length&&t[0][2]?he(t[0][0],t[0][1]):function(n){return n===e||function(e,t){var n=t.length,r=n;if(null==e)return!r;for(e=Object(e);n--;)if((i=t[n])[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1;for(;++n<r;){var i,a=(i=t[n])[0],o=e[a],s=i[1];if(i[2]){if(o===$e&&!(a in e))return!1}else if(!B(s,o,3,void 0,i=new A))return!1}return!0}(n,t)}}(e):Je(e)}function N(e,t){var n=-1,r=xe(e)?Array(e.length):[];return ln(e,(function(e,i,a){r[++n]=t(e,i,a)})),r}function U(e,t,n,r,i){e!==t&&fn(t,(function(a,o){if(Ae(a)){i||(i=new A);var s=i,u=e[o],c=t[o];if(d=s.get(c))D(e,o,d);else{var l=(d=r?r(u,c,o+"",e,t,s):$e)===$e;if(l){var f=xn(c),h=!f&&Sn(c),p=!f&&!h&&In(c),d=c;f||h||p?xn(u)?d=u:Se(u)?d=G(u):h?(l=!1,d=q(c,!0)):p?(l=!1,d=$(c,!0)):d=[]:De(c)||wn(c)?(d=u,wn(u)?d=je(u):(!Ae(u)||n&&Ie(u))&&(d=oe(c))):l=!1}l&&(s.set(c,d),U(d,c,n,r,s),s.delete(c)),D(e,o,d)}}else(s=r?r(e[o],a,o+"",e,t,i):$e)===$e&&(s=a),D(e,o,s)}),He)}function z(e){return mn(pe(e,void 0,ze),e+"")}function K(e){if("string"==typeof e)return e;if(xn(e))return l(e,K)+"";if(Oe(e))return un?un.call(e):"";var t=e+"";return"0"==t&&1/e==-Ge?"-0":t}function W(e,t){var n;if(2>(t=J(t,e)).length)n=e;else{var r=0,i=-1,a=-1,o=(n=t).length;for(0>r&&(r=-r>o?0:o+r),0>(i=i>o?o:i)&&(i+=o),o=r>i?0:i-r>>>0,r>>>=0,i=Array(o);++a<o;)i[a]=n[a+r];n=j(e,i)}null==(e=n)||delete e[de(ge(t))]}function J(e,t){return xn(e)?e:le(e,t)?[e]:gn(Pe(e))}function q(e,t){if(t)return e.slice();var n=e.length;return n=Tt?Tt(n):new e.constructor(n),e.copy(n),n}function V(e){var t=new e.constructor(e.byteLength);return new Et(t).set(new Et(e)),t}function $(e,t){return new e.constructor(t?V(e.buffer):e.buffer,e.byteOffset,e.length)}function G(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}function Q(e,t,n){var r=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var o=t[i],s=$e;s===$e&&(s=e[o]),r?F(n,o,s):M(n,o,s)}return n}function X(e){return z((function(t,n){var r,i=-1,a=n.length,o=1<a?n[a-1]:$e,s=2<a?n[2]:$e;if(o=3<e.length&&"function"==typeof o?(a--,o):$e,r=s){r=n[0];var u=n[1];if(Ae(s)){var c=typeof u;r=!!("number"==c?xe(s)&&ce(u,s.length):"string"==c&&u in s)&&we(s[u],r)}else r=!1}for(r&&(o=3>a?$e:o,a=1),t=Object(t);++i<a;)(s=n[i])&&e(t,s,i,o);return t}))}function Y(e){return De(e)?$e:e}function Z(e,t,n,r,i,a){var o=1&n,s=e.length;if(s!=(u=t.length)&&!(o&&u>s))return!1;if((u=a.get(e))&&a.get(t))return u==t;var u=-1,c=!0,l=2&n?new _:$e;for(a.set(e,t),a.set(t,e);++u<s;){var f=e[u],h=t[u];if(r)var d=o?r(h,f,u,t,e,a):r(f,h,u,e,t,a);if(d!==$e){if(d)continue;c=!1;break}if(l){if(!p(t,(function(e,t){if(!m(l,t)&&(f===e||i(f,e,n,r,a)))return l.push(t)}))){c=!1;break}}else if(f!==h&&!i(f,h,n,r,a)){c=!1;break}}return a.delete(e),a.delete(t),c}function ee(e){return mn(pe(e,$e,me),e+"")}function te(e){return P(e,Be,dn)}function ne(e){return P(e,He,vn)}function re(){var e=(e=w.iteratee||Ke)===Ke?H:e;return arguments.length?e(arguments[0],arguments[1]):e}function ie(e,t){var n=e.__data__,r=typeof t;return("string"==r||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?n["string"==typeof t?"string":"hash"]:n.map}function ae(e,t){var n=null==e?$e:e[t];return!Ae(n)||At&&At in n||!(Ie(n)?Mt:ot).test(ve(n))?$e:n}function oe(e){return"function"!=typeof e.constructor||fe(e)?{}:cn(jt(e))}function se(e,t,n,r){var i=e.constructor;switch(t){case"[object ArrayBuffer]":return V(e);case"[object Boolean]":case"[object Date]":return new i(+e);case"[object DataView]":return t=r?V(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return $(e,r);case"[object Map]":return h(t=r?n(g(e),1):g(e),a,new e.constructor);case"[object Number]":case"[object String]":return new i(e);case"[object RegExp]":return(t=new e.constructor(e.source,rt.exec(e))).lastIndex=e.lastIndex,t;case"[object Set]":return h(t=r?n(k(e),1):k(e),o,new e.constructor);case"[object Symbol]":return sn?Object(sn.call(e)):{}}}function ue(e){return xn(e)||wn(e)||!!(Bt&&e&&e[Bt])}function ce(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||ut.test(e))&&-1<e&&0==e%1&&e<t}function le(e,t){if(xn(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Oe(e))||Ye.test(e)||!Xe.test(e)||null!=t&&e in Object(t)}function fe(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||xt)}function he(e,t){return function(n){return null!=n&&n[e]===t&&(t!==$e||e in Object(n))}}function pe(e,t,n){return t=Jt(t===$e?e.length-1:t,0),function(){for(var r=arguments,i=-1,a=Jt(r.length-t,0),o=Array(a);++i<a;)o[i]=r[t+i];for(i=-1,a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(o),s(e,this,a)}}function de(e){if("string"==typeof e||Oe(e))return e;var t=e+"";return"0"==t&&1/e==-Ge?"-0":t}function ve(e){if(null!=e){try{return It.call(e)}catch(e){}return e+""}return""}function ye(e,t,n){var r=null==e?0:e.length;return r?(0>(n=null==n?0:Ee(n))&&(n=Jt(r+n,0)),d(e,re(t,3),n)):-1}function me(e){return null!=e&&e.length?function e(t,n,r,i,a){var o=-1,s=t.length;for(r||(r=ue),a||(a=[]);++o<s;){var u=t[o];0<n&&r(u)?1<n?e(u,n-1,r,i,a):f(a,u):i||(a[a.length]=u)}return a}(e,1):[]}function ge(e){var t=null==e?0:e.length;return t?e[t-1]:$e}function be(e,t){var n;if(e&&e.length&&t&&t.length){var r=v,i=-1,a=(n=t).length;for(e===n&&(n=G(n));++i<a;)for(var o=0,s=n[i];-1<(o=r(e,s,o,void 0));)e!=e&&Rt.call(e,o,1),Rt.call(e,o,1);n=e}else n=e;return n}function ke(e,t){function n(){var r=arguments,i=t?t.apply(this,r):r[0],a=n.cache;return a.has(i)?a.get(i):(r=e.apply(this,r),n.cache=a.set(i,r)||a,r)}if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");return n.cache=new(ke.Cache||I),n}function we(e,t){return e===t||e!=e&&t!=t}function xe(e){return null!=e&&_e(e.length)&&!Ie(e)}function Se(e){return Ce(e)&&xe(e)}function Ie(e){return!!Ae(e)&&("[object Function]"==(e=L(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)}function _e(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e}function Ae(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ce(e){return null!=e&&"object"==typeof e}function De(e){return!(!Ce(e)||"[object Object]"!=L(e))&&(null===(e=jt(e))||"function"==typeof(e=_t.call(e,"constructor")&&e.constructor)&&e instanceof e&&It.call(e)==Dt)}function Me(e){return"string"==typeof e||!xn(e)&&Ce(e)&&"[object String]"==L(e)}function Oe(e){return"symbol"==typeof e||Ce(e)&&"[object Symbol]"==L(e)}function Fe(e){return e?(e=Te(e))===Ge||e===-Ge?17976931348623157e292*(0>e?-1:1):e==e?e:0:0===e?e:0}function Ee(e){var t=(e=Fe(e))%1;return e==e?t?e-t:e:0}function Te(e){if("number"==typeof e)return e;if(Oe(e))return Qe;if(Ae(e)&&(e=Ae(e="function"==typeof e.valueOf?e.valueOf():e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;e=e.replace(tt,"");var t=at.test(e);return t||st.test(e)?ht(e.slice(2),t?2:8):it.test(e)?Qe:+e}function je(e){return Q(e,He(e))}function Pe(e){return null==e?"":K(e)}function Le(e,t,n){return(e=null==e?$e:j(e,t))===$e?n:e}function Re(e,t){var n;if(n=null!=e){for(var r,i=-1,a=(r=J(t,n=e)).length,o=!1;++i<a;){var s=de(r[i]);if(!(o=null!=n&&null!=n&&s in Object(n)))break;n=n[s]}n=o||++i!=a?o:!!(a=null==n?0:n.length)&&_e(a)&&ce(s,a)&&(xn(n)||wn(n))}return n}function Be(e){if(xe(e))e=C(e);else if(fe(e)){var t,n=[];for(t in Object(e))_t.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=Wt(e);return e}function He(e){if(xe(e))e=C(e,!0);else if(Ae(e)){var t,n=fe(e),r=[];for(t in e)("constructor"!=t||!n&&_t.call(e,t))&&r.push(t);e=r}else{if(t=[],null!=e)for(n in Object(e))t.push(n);e=t}return e}function Ne(e){return null==e?[]:function(e,t){return l(t,(function(t){return e[t]}))}(e,Be(e))}function Ue(e){return function(){return e}}function ze(e){return e}function Ke(e){return H("function"==typeof e?e:E(e,1))}function We(){}function Je(e){return le(e)?function(e){return function(t){return null==t?$e:t[e]}}(de(e)):function(e){return function(t){return j(t,e)}}(e)}function qe(){return[]}function Ve(){return!1}var $e,Ge=1/0,Qe=NaN,Xe=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ye=/^\w*$/,Ze=/^\./,et=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/^\s+|\s+$/g,nt=/\\(\\)?/g,rt=/\w*$/,it=/^[-+]0x[0-9a-f]+$/i,at=/^0b[01]+$/i,ot=/^\[object .+?Constructor\]$/,st=/^0o[0-7]+$/i,ut=/^(?:0|[1-9]\d*)$/,ct={};ct["[object Float32Array]"]=ct["[object Float64Array]"]=ct["[object Int8Array]"]=ct["[object Int16Array]"]=ct["[object Int32Array]"]=ct["[object Uint8Array]"]=ct["[object Uint8ClampedArray]"]=ct["[object Uint16Array]"]=ct["[object Uint32Array]"]=!0,ct["[object Arguments]"]=ct["[object Array]"]=ct["[object ArrayBuffer]"]=ct["[object Boolean]"]=ct["[object DataView]"]=ct["[object Date]"]=ct["[object Error]"]=ct["[object Function]"]=ct["[object Map]"]=ct["[object Number]"]=ct["[object Object]"]=ct["[object RegExp]"]=ct["[object Set]"]=ct["[object String]"]=ct["[object WeakMap]"]=!1;var lt={};lt["[object Arguments]"]=lt["[object Array]"]=lt["[object ArrayBuffer]"]=lt["[object DataView]"]=lt["[object Boolean]"]=lt["[object Date]"]=lt["[object Float32Array]"]=lt["[object Float64Array]"]=lt["[object Int8Array]"]=lt["[object Int16Array]"]=lt["[object Int32Array]"]=lt["[object Map]"]=lt["[object Number]"]=lt["[object Object]"]=lt["[object RegExp]"]=lt["[object Set]"]=lt["[object String]"]=lt["[object Symbol]"]=lt["[object Uint8Array]"]=lt["[object Uint8ClampedArray]"]=lt["[object Uint16Array]"]=lt["[object Uint32Array]"]=!0,lt["[object Error]"]=lt["[object Function]"]=lt["[object WeakMap]"]=!1;var ft,ht=parseInt,pt="object"==typeof e&&e&&e.Object===Object&&e,dt="object"==typeof self&&self&&self.Object===Object&&self,vt=pt||dt||Function("return this")(),yt=t&&!t.nodeType&&t,mt=yt&&"object"==typeof r&&r&&!r.nodeType&&r,gt=mt&&mt.exports===yt,bt=gt&&pt.process;e:{try{ft=bt&&bt.binding&&bt.binding("util");break e}catch(a){}ft=void 0}var kt=ft&&ft.isTypedArray,wt=Array.prototype,xt=Object.prototype,St=vt["__core-js_shared__"],It=Function.prototype.toString,_t=xt.hasOwnProperty,At=function(){var e=/[^.]+$/.exec(St&&St.keys&&St.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Ct=xt.toString,Dt=It.call(Object),Mt=RegExp("^"+It.call(_t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ot=gt?vt.Buffer:$e,Ft=vt.Symbol,Et=vt.Uint8Array,Tt=Ot?Ot.a:$e,jt=b(Object.getPrototypeOf),Pt=Object.create,Lt=xt.propertyIsEnumerable,Rt=wt.splice,Bt=Ft?Ft.isConcatSpreadable:$e,Ht=Ft?Ft.toStringTag:$e,Nt=function(){try{var e=ae(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Ut=Math.floor,zt=Object.getOwnPropertySymbols,Kt=Ot?Ot.isBuffer:$e,Wt=b(Object.keys),Jt=Math.max,qt=Math.min,Vt=Date.now,$t=ae(vt,"DataView"),Gt=ae(vt,"Map"),Qt=ae(vt,"Promise"),Xt=ae(vt,"Set"),Yt=ae(vt,"WeakMap"),Zt=ae(Object,"create"),en=ve($t),tn=ve(Gt),nn=ve(Qt),rn=ve(Xt),an=ve(Yt),on=Ft?Ft.prototype:$e,sn=on?on.valueOf:$e,un=on?on.toString:$e,cn=function(){function e(){}return function(t){return Ae(t)?Pt?Pt(t):(e.prototype=t,t=new e,e.prototype=$e,t):{}}}();x.prototype.clear=function(){this.__data__=Zt?Zt(null):{},this.size=0},x.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},x.prototype.get=function(e){var t=this.__data__;return Zt?"__lodash_hash_undefined__"===(e=t[e])?$e:e:_t.call(t,e)?t[e]:$e},x.prototype.has=function(e){var t=this.__data__;return Zt?t[e]!==$e:_t.call(t,e)},x.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Zt&&t===$e?"__lodash_hash_undefined__":t,this},S.prototype.clear=function(){this.__data__=[],this.size=0},S.prototype.delete=function(e){var t=this.__data__;return!(0>(e=O(t,e))||(e==t.length-1?t.pop():Rt.call(t,e,1),--this.size,0))},S.prototype.get=function(e){var t=this.__data__;return 0>(e=O(t,e))?$e:t[e][1]},S.prototype.has=function(e){return-1<O(this.__data__,e)},S.prototype.set=function(e,t){var n=this.__data__,r=O(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this},I.prototype.clear=function(){this.size=0,this.__data__={hash:new x,map:new(Gt||S),string:new x}},I.prototype.delete=function(e){return e=ie(this,e).delete(e),this.size-=e?1:0,e},I.prototype.get=function(e){return ie(this,e).get(e)},I.prototype.has=function(e){return ie(this,e).has(e)},I.prototype.set=function(e,t){var n=ie(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},_.prototype.add=_.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},_.prototype.has=function(e){return this.__data__.has(e)},A.prototype.clear=function(){this.__data__=new S,this.size=0},A.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},A.prototype.get=function(e){return this.__data__.get(e)},A.prototype.has=function(e){return this.__data__.has(e)},A.prototype.set=function(e,t){var n=this.__data__;if(n instanceof S){var r=n.__data__;if(!Gt||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new I(r)}return n.set(e,t),this.size=n.size,this};var ln=function(e,t){if(null==e)return e;if(!xe(e))return function(e,t){return e&&fn(e,t,Be)}(e,t);for(var n=e.length,r=-1,i=Object(e);++r<n&&!1!==t(i[r],r,i););return e},fn=function(e,t,n){for(var r=-1,i=Object(e),a=(n=n(e)).length;a--;){var o=n[++r];if(!1===t(i[o],o,i))break}return e},hn=Nt?function(e,t){return Nt(e,"toString",{configurable:!0,enumerable:!1,value:Ue(t),writable:!0})}:ze,pn=Xt&&1/k(new Xt([,-0]))[1]==Ge?function(e){return new Xt(e)}:We,dn=zt?function(e){return null==e?[]:(e=Object(e),u(zt(e),(function(t){return Lt.call(e,t)})))}:qe,vn=zt?function(e){for(var t=[];e;)f(t,dn(e)),e=jt(e);return t}:qe,yn=L;($t&&"[object DataView]"!=yn(new $t(new ArrayBuffer(1)))||Gt&&"[object Map]"!=yn(new Gt)||Qt&&"[object Promise]"!=yn(Qt.resolve())||Xt&&"[object Set]"!=yn(new Xt)||Yt&&"[object WeakMap]"!=yn(new Yt))&&(yn=function(e){var t=L(e);if(e=(e="[object Object]"==t?e.constructor:$e)?ve(e):"")switch(e){case en:return"[object DataView]";case tn:return"[object Map]";case nn:return"[object Promise]";case rn:return"[object Set]";case an:return"[object WeakMap]"}return t});var mn=function(e){var t=0,n=0;return function(){var r=Vt(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply($e,arguments)}}(hn),gn=function(e){var t=(e=ke(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return Ze.test(e)&&t.push(""),e.replace(et,(function(e,n,r,i){t.push(r?i.replace(nt,"$1"):n||e)})),t})),bn=z(be),kn=function(e){return function(t,n,r){var i=Object(t);if(!xe(t)){var a=re(n,3);t=Be(t),n=function(e){return a(i[e],e,i)}}return-1<(n=e(t,n,r))?i[a?t[n]:n]:$e}}(ye);ke.Cache=I;var wn=R(function(){return arguments}())?R:function(e){return Ce(e)&&_t.call(e,"callee")&&!Lt.call(e,"callee")},xn=Array.isArray,Sn=Kt||Ve,In=kt?function(e){return function(t){return e(t)}}(kt):function(e){return Ce(e)&&_e(e.length)&&!!ct[L(e)]},_n=X((function(e,t,n){U(e,t,n)})),An=X((function(e,t,n,r){U(e,t,n,r)})),Cn=ee((function(e,t){var n={};if(null==e)return n;var r=!1;t=l(t,(function(t){return t=J(t,e),r||(r=1<t.length),t})),Q(e,ne(e),n),r&&(n=E(n,7,Y));for(var i=t.length;i--;)W(n,t[i]);return n})),Dn=ee((function(e,t){return null==e?{}:function(e,t){return function(e,t,n){for(var r=-1,i=t.length,a={};++r<i;){var o=t[r],s=j(e,o);if(n(s,o)){var u=a;if(o=J(o,e),Ae(u))for(var c=-1,l=(o=J(o,u)).length,f=l-1;null!=u&&++c<l;){var h=de(o[c]),p=s;if(c!=f){var d=u[h];(p=$e)===$e&&(p=Ae(d)?d:ce(o[c+1])?[]:{})}M(u,h,p),u=u[h]}}}return a}(e,t,(function(t,n){return Re(e,n)}))}(e,t)}));w.constant=Ue,w.filter=function(e,t){return(xn(e)?u:T)(e,re(t,3))},w.flatten=me,w.iteratee=Ke,w.keys=Be,w.keysIn=He,w.map=function(e,t){return(xn(e)?l:N)(e,re(t,3))},w.memoize=ke,w.merge=_n,w.mergeWith=An,w.omit=Cn,w.pick=Dn,w.property=Je,w.pull=bn,w.pullAll=be,w.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],a=e.length;for(t=re(t,3);++r<a;){var o=e[r];t(o,r,e)&&(n.push(o),i.push(r))}for(a=(r=e?i.length:0)-1;r--;)if(o=i[r],r==a||o!==s){var s=o;ce(o)?Rt.call(e,o,1):W(e,o)}return n},w.toPlainObject=je,w.uniq=function(e){if(e&&e.length)e:{var t=-1,n=c,r=e.length,i=!0,a=[],o=a;if(200<=r){if(n=pn(e)){e=k(n);break e}i=!1,n=m,o=new _}else o=a;t:for(;++t<r;){var s=u=e[t],u=0!==u?u:0;if(i&&s==s){for(var l=o.length;l--;)if(o[l]===s)continue t;a.push(u)}else n(o,s,void 0)||(o!==a&&o.push(s),a.push(u))}e=a}else e=[];return e},w.values=Ne,w.cloneDeep=function(e){return E(e,5)},w.eq=we,w.find=kn,w.findIndex=ye,w.get=Le,w.hasIn=Re,w.identity=ze,w.includes=function(e,t,n,r){return e=xe(e)?e:Ne(e),n=n&&!r?Ee(n):0,r=e.length,0>n&&(n=Jt(r+n,0)),Me(e)?n<=r&&-1<e.indexOf(t,n):!!r&&-1<v(e,t,n)},w.isArguments=wn,w.isArray=xn,w.isArrayLike=xe,w.isArrayLikeObject=Se,w.isBuffer=Sn,w.isFunction=Ie,w.isLength=_e,w.isObject=Ae,w.isObjectLike=Ce,w.isPlainObject=De,w.isString=Me,w.isSymbol=Oe,w.isTypedArray=In,w.last=ge,w.stubArray=qe,w.stubFalse=Ve,w.noop=We,w.sortedIndexBy=function(e,t,n){t=(n=re(n,2))(t);for(var r=0,i=null==e?0:e.length,a=t!=t,o=null===t,s=Oe(t),u=t===$e;r<i;){var c=Ut((r+i)/2),l=n(e[c]),f=l!==$e,h=null===l,p=l==l,d=Oe(l);(a?p:u?p&&f:o?p&&f&&!h:s?p&&f&&!h&&!d:!h&&!d&&l<t)?r=c+1:i=c}return qt(i,4294967294)},w.toFinite=Fe,w.toInteger=Ee,w.toNumber=Te,w.toString=Pe,w.VERSION="4.17.4",vt._=w,void 0===(i=function(){return w}.call(t,n,t,r))||(r.exports=i)}).call(this)}).call(this,n(2),n(4)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return N})),n(1),n(3);var i=n(0);function a(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var o=e.apply(t,n);function s(e){a(o,r,i,s,u,"next",e)}function u(e){a(o,r,i,s,u,"throw",e)}s(void 0)}))}}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.componentManager=t,this.updateObservers=[],this.items=[]}var t,n,a,u,l;return t=e,(n=[{key:"getPlatform",value:function(){return this.componentManager.platform}},{key:"getEnvironment",value:function(){return this.componentManager.environment}},{key:"isMobile",value:function(){return"mobile"==this.getEnvironment()}},{key:"addEventHandler",value:function(e){var t={id:Math.random,callback:e};return this.updateObservers.push(t),t}},{key:"removeUpdateObserver",value:function(e){this.updateObservers.splice(this.updateObservers.indexOf(e),1)}},{key:"notifyObserversOfEvent",value:function(e){var t,n=s(this.updateObservers);try{for(n.s();!(t=n.n()).done;)t.value.callback(e)}catch(e){n.e(e)}finally{n.f()}}},{key:"filterItems",value:function(e){return this.items.filter((function(t){return t.content_type==e}))}},{key:"getFileDescriptors",value:function(){return this.filterItems(e.FileDescriptorContentTypeKey)}},{key:"beginStreamingFiles",value:function(){var t=this,n=[e.FileDescriptorContentTypeKey,e.FileSafeCredentialsContentType,e.FileSafeIntegrationContentTypeKey];this.componentManager.streamItems(n,(function(e){t.handleStreamItemsMessage(e)}))}},{key:"handleStreamItemsMessage",value:(l=o(r.mark((function t(n){var a,o,u,c;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=s(n),t.prev=1,a.s();case 3:if((o=a.n()).done){t.next=15;break}if(u=o.value,!(u=new i.SFItem(u)).deleted){t.next=9;break}return this.removeItemFromItems(u),t.abrupt("continue",13);case 9:if(!u.isMetadataUpdate){t.next=11;break}return t.abrupt("continue",13);case 11:(c=this.indexOfItem(u))>=0?this.items[c]=u:this.items.push(u);case 13:t.next=3;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(1),a.e(t.t0);case 20:return t.prev=20,a.f(),t.finish(20);case 23:this.notifyObserversOfEvent(e.BridgeEventReceivedItems);case 24:case"end":return t.stop()}}),t,this,[[1,17,20,23]])}))),function(e){return l.apply(this,arguments)})},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter((function(t){return t.uuid!==e.uuid}))}},{key:"createItem",value:function(e,t){this.createItems([e],t)}},{key:"createItems",value:function(e,t){this.componentManager.createItems(e,(function(e){t&&t(e.map((function(e){return new i.SFItem(e)})))}))}},{key:"saveItem",value:(u=o(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveItems([t]));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"saveItems",value:(a=o(r.mark((function t(n){var i=this;return r.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){i.componentManager.saveItems(n,(function(n){t(n),i.notifyObserversOfEvent(e.BridgeEventSavedItem)}))})));case 1:case"end":return t.stop()}}),t)}))),function(e){return a.apply(this,arguments)})},{key:"indexOfItem",value:function(e){for(var t in this.items)if(this.items[t].uuid==e.uuid)return t;return-1}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(e,t){this.componentManager.deleteItems(e,t)}},{key:"removeItemFromItems",value:function(e){this.items=this.items.filter((function(t){return t.uuid!==e.uuid}))}}])&&c(t.prototype,n),e}();function h(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){h(a,r,i,o,s,"next",e)}function s(e){h(a,r,i,o,s,"throw",e)}o(void 0)}))}}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}l(f,"FileItemContentTypeKey","SN|FileSafe|File"),l(f,"FileSafeCredentialsContentType","SN|FileSafe|Credentials"),l(f,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata"),l(f,"FileSafeIntegrationContentTypeKey","SN|FileSafe|Integration"),l(f,"BridgeEventLoadedCredentials","BridgeEventLoadedCredentials"),l(f,"BridgeEventReceivedItems","BridgeEventReceivedItems"),l(f,"BridgeEventSavedItem","BridgeEventSavedItem");var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.httpManger=new i.SFHttpManager,this.httpManger.setJWTRequestHandler((function(){}))}var t,n,a,o,s;return t=e,(n=[{key:"setCredentials",value:function(e){this.credentials=e}},{key:"uploadFile",value:(s=p(r.mark((function e(t,n,i){var a,o,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(i.content.relayUrl,"/integrations/save-item"),o={file:{name:t,item:n},source:i.content.source,authorization:i.content.authorization},e.abrupt("return",new Promise((function(e,t){s.httpManger.postAbsolute(a,o,(function(t){e(t.metadata)}),(function(e){var n=e.error;n||(n={message:"File upload failed."}),console.log("Upload error response",n),t(n)}))})));case 3:case"end":return e.stop()}}),e)}))),function(e,t,n){return s.apply(this,arguments)})},{key:"downloadFile",value:(o=p(r.mark((function e(t,n){var i,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(n.content.relayUrl,"/integrations/download-item"),a={metadata:t.content.serverMetadata,authorization:n.content.authorization},e.abrupt("return",new Promise((function(e,t){o.httpManger.postAbsolute(i,a,(function(t){e(t)}),(function(e){var n=e.error;console.log("Download error response",e),t(n)}))})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})},{key:"deleteFile",value:(a=p(r.mark((function e(t,n){var i,a,o=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(n.content.relayUrl,"/integrations/delete-item"),a={metadata:t.content.serverMetadata,authorization:n.content.authorization},e.abrupt("return",new Promise((function(e,t){o.httpManger.postAbsolute(i,a,(function(t){e(t)}),(function(e){var n=e.error;console.log("Download error response",e),t(n)}))})));case 3:case"end":return e.stop()}}),e)}))),function(e,t){return a.apply(this,arguments)})}])&&d(t.prototype,n),e}();function y(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var k=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionBridge=t}var t,n,a,o;return t=e,(n=[{key:"integrationForFileDescriptor",value:function(e){return this.integrations.find((function(t){return e.content.serverMetadata&&t.content.source==e.content.serverMetadata.source}))}},{key:"parseIntegrationCode",value:function(e){var t=atob(e),n=JSON.parse(t);return n.rawCode=e,n}},{key:"saveIntegrationFromCode",value:(a=r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseIntegrationCode(t),0==this.integrations.length&&(n.isDefaultUploadSource=!0),i=this.createAndSaveIntegrationObject(n),e.abrupt("return",i);case 4:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var i=a.apply(e,t);function o(e){g(i,n,r,o,s,"next",e)}function s(e){g(i,n,r,o,s,"throw",e)}o(void 0)}))},function(e){return o.apply(this,arguments)})},{key:"createAndSaveIntegrationObject",value:function(e){var t=new i.SFItem({content_type:f.FileSafeIntegrationContentTypeKey,content:e});return this.extensionBridge.createItems([t]),t}},{key:"getDefaultIntegration",value:function(){return this.integrations.find((function(e){return e.content.isDefaultUploadSource}))}},{key:"setIntegrationAsDefault",value:function(e){var t=[e],n=this.getDefaultIntegration();n&&(n.content.isDefaultUploadSource=!1,t.push(n)),e.content.isDefaultUploadSource=!0,this.extensionBridge.saveItems(t)}},{key:"displayStringForIntegration",value:function(e){var t,n,r=e.content.source.split("_"),i="",a=0,o=y(r);try{for(o.s();!(t=o.n()).done;){i+=(n=t.value).charAt(0).toUpperCase()+n.slice(1),a<r.length-1&&(i+=" "),a++}}catch(e){o.e(e)}finally{o.f()}return i}},{key:"deleteIntegration",value:function(e){var t=this,n=e.content.isDefaultUploadSource;this.extensionBridge.deleteItem(e,(function(r){if(r.deleted&&n&&t.integrations.length>0){var i,a=y(t.integrations);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o!=e){t.setIntegrationAsDefault(o);break}}}catch(e){a.e(e)}finally{a.f()}}}))}},{key:"integrations",get:function(){return this.extensionBridge.filterItems(f.FileSafeIntegrationContentTypeKey)}}])&&b(t.prototype,n),e}();function w(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _=function(){function e(t){var n=this,r=t.extensionBridge,i=t.onCredentialLoad;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"getDefaultCredentials",(function(){var e=n.credentials.find((function(e){return e.content.isDefault}));return!e&&n.credentials.length>0&&(e=n.credentials[0]),e})),I(this,"setCredentialAsDefault",(function(e){var t=n.getDefaultCredentials();t&&(t.content.isDefault=!1),e.content.isDefault=!0,n.extensionBridge.saveItems([t,e])})),I(this,"deleteCredential",(function(e){n.extensionBridge.deleteItem(e)})),this.extensionBridge=r,this.onCredentialLoad=i,this.credentials=[],this.extensionBridge.addEventHandler((function(e){e==f.BridgeEventReceivedItems&&n.reloadCredentials()}))}var t,n,a,o;return t=e,(n=[{key:"reloadCredentials",value:function(){var e=this;this.credentials=[];var t=this.extensionBridge.filterItems(f.FileSafeCredentialsContentType);if(0!=t.length){var n,r=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(t);try{var i=function(){var t=n.value;e.credentials.find((function(e){e.uuid,t.uuid}))||e.credentials.push(t)};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}this.onCredentialLoad(),this.credentials.length>0&&this.didLoadCredentials()}}},{key:"createNewCredentials",value:(a=r.mark((function e(){var t,n,a,o,s;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=256,e.next=3,SFJS.crypto.generateRandomKey(t);case 3:return n=e.sent,e.next=6,SFJS.crypto.generateRandomKey(t);case 6:return a=e.sent,e.next=9,SFJS.crypto.generateInitialKeysAndAuthParamsForUser(n,a);case 9:return(o=e.sent).isDefault=0==this.credentials.length,s=new i.SFItem({content_type:f.FileSafeCredentialsContentType,content:o}),this.extensionBridge.saveItem(s),this.didLoadCredentials(),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)})),o=function(){var e=this,t=arguments;return new Promise((function(n,r){var i=a.apply(e,t);function o(e){w(i,n,r,o,s,"next",e)}function s(e){w(i,n,r,o,s,"throw",e)}o(void 0)}))},function(){return o.apply(this,arguments)})},{key:"didLoadCredentials",value:function(){this.extensionBridge.notifyObserversOfEvent(f.BridgeEventLoadedCredentials)}},{key:"credentialForFileDescriptor",value:function(e){return this.credentials.find((function(t){return e.content.references.find((function(e){return e.uuid==t.uuid}))}))}},{key:"getAllCredentials",value:function(){return this.credentials}},{key:"saveCredential",value:function(e){this.extensionBridge.saveItem(e)}}])&&S(t.prototype,n),e}(),A=function(){return new Worker(n.p+"filesafe-js/EncryptionWorker.js")};function C(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function D(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){C(a,r,i,o,s,"next",e)}function s(e){C(a,r,i,o,s,"throw",e)}o(void 0)}))}}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(){function e(t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.extensionBridge=t,this.relayManager=n,this.integrationManager=r,this.credentialManager=i}var t,n,a,o,s,u,c;return t=e,(n=[{key:"getAllFileDescriptors",value:function(){return this.extensionBridge.getFileDescriptors()}},{key:"fileDescriptorsForNote",value:function(e){return e?this.extensionBridge.getFileDescriptors().filter((function(t){return t.hasRelationshipWithItem(e)})):[]}},{key:"findFileDescriptor",value:function(e){return this.extensionBridge.getFileDescriptors().find((function(t){return t.uuid==e}))}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.extensionBridge.getFileDescriptors().filter((function(t){return t.content.references.find((function(t){return t.uuid==e.uuid}))}))}},{key:"deleteFileFromDescriptor",value:(c=D(r.mark((function e(t){var n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n.extensionBridge.deleteItems([t],(function(r){if(r.deleted){var i=n.integrationManager.integrationForFileDescriptor(t);i&&n.relayManager.deleteFile(t,i).then((function(t){e()}))}else e(r)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"uploadFile",value:(u=D(r.mark((function e(t){var n,a,o,s,u,c,l,h=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileItem,a=t.inputFileName,o=t.fileType,s=t.credential,u=t.note,c=this.integrationManager.getDefaultIntegration(),a.split(".")[1],l="".concat(n.uuid,".sf.json"),e.abrupt("return",new Promise((function(e,t){var r=new A;r.addEventListener("message",(function(n){var r=n.data;if(r.error)return console.log("Error uploading file",r.error),void t(r.error);var c=new i.SFItem({content_type:f.FileDescriptorContentTypeKey,content:{serverMetadata:n.data.metadata,fileName:a,fileType:o}});u&&c.addItemAsRelationship(u),c.addItemAsRelationship(s),h.extensionBridge.createItem(c,(function(t){e(t[0])}))}));var p={outputFileName:l,fileItem:n,integration:c,operation:"upload",credentials:h.credentialManager.getDefaultCredentials()};r.postMessage(p)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"downloadFileFromDescriptor",value:(s=D(r.mark((function e(t){var n,i;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.integrationManager.integrationForFileDescriptor(t)){e.next=6;break}throw(i=t.content.serverMetadata)?alert("Unable to find integration named '".concat(i.source,"'.")):alert("Unable to find integration for this file."),"Unable to find integration";case 6:return e.abrupt("return",this.relayManager.downloadFile(t,n).then((function(e){return e.items[0]})));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"encryptFile",value:(o=D(r.mark((function e(t){var n,i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.inputFileName,a=t.fileType,o=t.credential,e.abrupt("return",new Promise((function(e,t){var r=new A;r.addEventListener("message",(function(t){e(t.data.fileItem)})),r.postMessage({operation:"encrypt",keys:o.content.keys,authParams:o.content.authParams,contentType:f.FileItemContentTypeKey,fileData:n,fileName:i,fileType:a})})));case 2:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"decryptFile",value:(a=D(r.mark((function e(t){var n,i,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileDescriptor,i=t.fileItem,(a=t.credential)||(a=this.credentialManager.credentialForFileDescriptor(n)),e.abrupt("return",new Promise((function(e,t){var n=new A;n.addEventListener("message",(function(n){var r=n.data;r.error?t(r.error):e(r)})),n.postMessage({operation:"decrypt",keys:a.content.keys,item:i})})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})}])&&M(t.prototype,n),e}();function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}O(F,"FileItemContentTypeKey","SN|FileSafe|File"),O(F,"FileDescriptorContentTypeKey","SN|FileSafe|FileMetadata");var T=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"base64toBinary",value:function(e){for(var t=atob(e),n=[],r=0;r<t.length;r++)n.push(t.charCodeAt(r));return new Uint8Array(n)}},{key:"downloadData",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=document.createElement("a");a.setAttribute("download",t);var o=this.tempUrlForData(e,n);a.href=o,a.setAttribute("target","_blank"),i?window.location.href=a.href:(document.body.appendChild(a),a.click(),a.remove()),setTimeout((function(){r.revokeTempUrl(o)}),500)}},{key:"tempUrlForData",value:function(e,t){return window.URL.createObjectURL(new Blob([e],{type:t||"text/json"}))}},{key:"revokeTempUrl",value:function(e){window.URL.revokeObjectURL(e)}},{key:"copyTextToClipboard",value:function(e){if(window.clipboardData&&window.clipboardData.setData)return clipboardData.setData("Text",e);var t;if(document.queryCommandSupported&&document.queryCommandSupported("copy"))try{(t=document.createElement("textarea")).setAttribute("readonly",!0),t.setAttribute("contenteditable",!0),t.style.position="fixed",t.value=e,document.body.appendChild(t),t.focus(),t.select();var n=document.createRange();n.selectNodeContents(t);var r=window.getSelection();r.removeAllRanges(),r.addRange(n),t.setSelectionRange(0,t.value.length),document.execCommand("copy")}catch(e){console.error(e)}finally{document.body.removeChild(t)}}}],null&&E(t.prototype,null),n&&E(t,n),e}();function j(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){j(a,r,i,o,s,"next",e)}function s(e){j(a,r,i,o,s,"throw",e)}o(void 0)}))}}function L(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return R(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t,n){return t&&B(e.prototype,t),n&&B(e,n),e}var N=function(){function e(t){var n=this,r=t.componentManager;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dataChangeObservers=[],this.newFileDescriptorHandlers=[],this.extensionBridge=new f(r),this.extensionBridge.addEventHandler((function(e){n.notifyObservers()})),this.relayManager=new v,this.integrationManager=new k(this.extensionBridge),this.credentialManager=new _({extensionBridge:this.extensionBridge,onCredentialLoad:function(){n.relayManager.setCredentials(n.credentialManager.getDefaultCredentials())}}),this.fileManager=new F(this.extensionBridge,this.relayManager,this.integrationManager,this.credentialManager),this.extensionBridge.beginStreamingFiles()}var t,n,a,o,s,u,c,l;return H(e,null,[{key:"getSFItemClass",value:function(){return i.SFItem}}]),H(e,[{key:"addNewFileDescriptorHandler",value:function(e){this.newFileDescriptorHandlers.push(e)}},{key:"notifyObservers",value:function(){var e,t=L(this.dataChangeObservers);try{for(t.s();!(e=t.n()).done;)(0,e.value)()}catch(e){t.e(e)}finally{t.f()}}},{key:"addDataChangeObserver",value:function(e){return this.dataChangeObservers.push(e),e}},{key:"removeDataChangeObserver",value:function(e){this.dataChangeObservers=this.dataChangeObservers.filter((function(e){}))}},{key:"setCurrentNote",value:function(e){this.currentNote=e,this.notifyObservers()}},{key:"getAllFileDescriptors",value:function(){return this.fileManager.getAllFileDescriptors()}},{key:"findFileDescriptor",value:function(e){return this.fileManager.findFileDescriptor(e)}},{key:"fileDescriptorsForCurrentNote",value:function(){return this.fileManager.fileDescriptorsForNote(this.currentNote)}},{key:"fileDescriptorsForNote",value:function(e){return this.fileManager.fileDescriptorsForNote(e)}},{key:"fileDescriptorsEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e)}},{key:"deleteFileFromDescriptor",value:(l=P(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileManager.deleteFileFromDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"uploadFile",value:(c=P(r.mark((function e(t){var n,i,a,o,s,u,c,l;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileItem,i=t.inputFileName,a=t.fileType,o=t.credential,(s=t.note)||(s=this.currentNote),e.next=4,this.fileManager.uploadFile({fileItem:n,inputFileName:i,fileType:a,credential:o,note:s});case 4:if(u=e.sent){c=L(this.newFileDescriptorHandlers);try{for(c.s();!(l=c.n()).done;)(0,l.value)(u)}catch(e){c.e(e)}finally{c.f()}}return e.abrupt("return",u);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"encryptAndUploadJavaScriptFileObject",value:(u=P(r.mark((function e(t){var n=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){var a=new FileReader;a.onload=function(){var i=P(r.mark((function i(a){var o,s,u,c;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return o=a.target.result,s=o,r.next=4,SFJS.crypto.arrayBufferToBase64(s);case 4:return u=r.sent,r.next=7,n.encryptAndUploadData({base64Data:u,inputFileName:t.name,fileType:t.type});case 7:c=r.sent,e(c);case 9:case"end":return r.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}(),a.readAsArrayBuffer(t)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"encryptAndUploadData",value:(s=P(r.mark((function e(t){var n,i,a,o,s=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.base64Data,i=t.inputFileName,a=t.fileType,o=this.getDefaultCredentials(),e.abrupt("return",this.encryptFile({data:n,inputFileName:i,fileType:a,credential:o}).then(function(){var e=P(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s.uploadFile({fileItem:t,inputFileName:i,fileType:a,credential:o}).catch((function(e){console.error("filesafe-js | error uploading file:",e)})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"downloadFileFromDescriptor",value:(o=P(r.mark((function e(t){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.fileManager.downloadFileFromDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"encryptFile",value:(a=P(r.mark((function e(t){var n,i,a,o;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.data,i=t.inputFileName,a=t.fileType,o=t.credential,e.abrupt("return",this.fileManager.encryptFile({data:n,inputFileName:i,fileType:a,credential:o}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"decryptFile",value:(n=P(r.mark((function e(t){var n,i,a;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.fileDescriptor,i=t.fileItem,a=t.credential,e.abrupt("return",this.fileManager.decryptFile({fileDescriptor:n,fileItem:i,credential:a}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"downloadBase64Data",value:function(e){var t=e.base64Data,n=e.fileName,r=e.fileType;T.downloadData(T.base64toBinary(t),n,r)}},{key:"createTemporaryFileUrl",value:function(e){var t=e.base64Data,n=e.dataType;return T.tempUrlForData(T.base64toBinary(t),n)}},{key:"revokeTempUrl",value:function(e){T.revokeTempUrl(e)}},{key:"createNewCredentials",value:(t=P(r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.credentialManager.createNewCredentials());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"numberOfFilesEncryptedWithCredential",value:function(e){return this.fileManager.fileDescriptorsEncryptedWithCredential(e).length}},{key:"credentialForFileDescriptor",value:function(e){return this.credentialManager.credentialForFileDescriptor(e)}},{key:"getAllCredentials",value:function(){return this.credentialManager.getAllCredentials()}},{key:"getDefaultCredentials",value:function(){return this.credentialManager.getDefaultCredentials()}},{key:"setCredentialAsDefault",value:function(e){return this.credentialManager.setCredentialAsDefault(e)}},{key:"deleteCredential",value:function(e){return this.credentialManager.deleteCredential(e)}},{key:"saveCredential",value:function(e){return this.credentialManager.saveCredential(e)}},{key:"getAllIntegrations",value:function(){return this.integrationManager.integrations}},{key:"integrationForFileDescriptor",value:function(e){return this.integrationManager.integrationForFileDescriptor(e)}},{key:"saveIntegrationFromCode",value:function(e){return this.integrationManager.saveIntegrationFromCode(e)}},{key:"getDefaultIntegration",value:function(){return this.integrationManager.getDefaultIntegration()}},{key:"setIntegrationAsDefault",value:function(e){return this.integrationManager.setIntegrationAsDefault(e)}},{key:"deleteIntegration",value:function(e){return this.integrationManager.deleteIntegration(e)}},{key:"displayStringForIntegration",value:function(e){return this.integrationManager.displayStringForIntegration(e)}},{key:"base64toBinary",value:function(e){return T.base64toBinary(e)}},{key:"isMobile",value:function(){return this.extensionBridge.isMobile()}},{key:"getEnvironment",value:function(){return this.extensionBridge.getEnvironment()}},{key:"getPlatform",value:function(){return this.extensionBridge.getPlatform()}},{key:"copyTextToClipboard",value:function(e){return T.copyTextToClipboard(e)}},{key:"hasLegacyAccess",value:function(){var e=Boolean(this.getAllCredentials().length>0&&this.getAllIntegrations().length>0),t=Boolean(this.getAllFileDescriptors().length>0);return e||t}}]),e}()}])},139:function(e,t,n){"use strict";n.r(t);var r,i,a,o,s,u,c=n(11),l=n(28),f=n(1),h=n(2),p=n(17),d=n(18),v=n(16),y=n.n(v),m=(n(119),n(20)),g=n(80),b=n.n(g),k=(n(124),n(99)),w=n(5),x=n(7),S=n(104),I=n(97),_=n(115),A=n(106),C=n(116),D=n(107),M=n(70),O=n(103),F=n(105),E=n(117),T=n(108),j=n(109),P=n(73),L=n(9),R=n(12),B=n(23),H=n(74),N=[[{type:"button",icon:"bulletList",key:B.g,disabled:function(e){var t=e.state;return!Object(P.f)(t.schema.nodes.bullet_list)(t)}},{type:"button",icon:"orderedList",key:B.h,disabled:function(e){var t=e.state;return!Object(P.f)(t.schema.nodes.ordered_list)(t)}},{type:"button",icon:"taskList",key:M.b,disabled:function(e){var t=e.state;return!Object(P.f)(t.schema.nodes.task_list_item)(t)}},{type:"button",icon:"liftList",key:B.c,disabled:function(e){var t=e.state;return!Object(H.a)(t.schema.nodes.list_item)(t)}},{type:"button",icon:"sinkList",key:B.d,disabled:function(e){var t=e.state;return!Object(H.b)(t.schema.nodes.list_item)(t)}}],[{type:"button",icon:"image",key:B.b},{type:"button",icon:"table",key:M.a}],[{type:"button",icon:"quote",key:B.f},{type:"button",icon:"divider",key:B.a}]],U=n(71),z=n(19),K=n(52),W=function(){function e(t,n,r,i,a){var s=this;Object(f.a)(this,e),this.utils=n,this.ctx=r,this.options=a,this.config=void 0,this.config=t.map((function(e){return e.map((function(e){return Object(U.a)(Object(U.a)({},e),{},{$:s.$create(e,i)})}))})).map((function(e,n){if(n===t.length-1)return e;var r={type:"divider",group:e.map((function(e){return e.$}))};return[].concat(Object(c.a)(e),[Object(U.a)(Object(U.a)({},r),{},{$:s.$create(r,i)})])})).flat();var u=function(e,t){var n=e.getStyle((function(e){return e.mixin.scrollbar("y")})),r=e.getStyle((function(e){var t=e.mixin.border(),n=e.mixin.scrollbar("x");return Object(K.a)(o||(o=Object(z.a)(["\n      box-sizing: border-box;\n      width: 100%;\n      display: flex;\n      flex-wrap: nowrap;\n      overflow-x: auto;\n      ",";\n      ",";\n      background: ",";\n\n      -webkit-overflow-scrolling: auto;\n\n      .disabled {\n        display: none;\n      }\n    "])),t,n,e.palette("surface"))})),i=document.createElement("div"),a=document.createElement("div");a.classList.add("milkdown-menu"),i.appendChild(a),i.classList.add("milkdown-menu-wrapper"),r&&r.split(" ").forEach((function(e){return a.classList.add(e)}));var s=t.dom;n&&s.classList.add(n);var u=s.parentElement;if(!u)throw new Error("No parent node found");var c=u.parentElement;if(!c)throw new Error("No root node found");return c.replaceChild(i,u),i.appendChild(u),a}(n,i);this.config.forEach((function(e){return u.appendChild(e.$)}))}return Object(h.a)(e,[{key:"update",value:function(e){var t=this.options.enabled;this.config.forEach((function(n){switch(n.type){case"button":if(n.active)n.active(e)?n.$.classList.add("active"):n.$.classList.remove("active");if(n.alwaysVisible)return void n.$.removeAttribute("disabled");!t||n.disabled&&n.disabled(e)?n.$.setAttribute("disabled","true"):n.$.removeAttribute("disabled");break;case"select":if(n.alwaysVisible)return void n.$.removeAttribute("disabled");!t||n.disabled&&n.disabled(e)?(n.$.classList.add("disabled"),n.$.children[0].setAttribute("disabled","true")):(n.$.classList.remove("disabled"),n.$.children[0].removeAttribute("disabled"));break;case"divider":n.group.every((function(e){return e.getAttribute("disabled")||e.classList.contains("disabled")}))?n.$.classList.add("disabled"):n.$.classList.remove("disabled")}}))}},{key:"$create",value:function(e,t){var n=this.utils,o=this.ctx;switch(e.type){case"button":var s=function(e,t,n,i,a){var o=e.getStyle((function(e){return Object(K.a)(r||(r=Object(z.a)(["\n      border: 0;\n      box-sizing: unset;\n      width: 1.5rem;\n      height: 1.5rem;\n      padding: 0.25rem;\n      margin: 0.5rem;\n      flex-shrink: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background-color: ",";\n      color: ",";\n      transition: all 0.4s ease-in-out;\n      cursor: pointer;\n      &.active,\n      &:hover {\n        background-color: ",";\n        color: ",";\n      }\n      &:disabled {\n        display: none;\n      }\n    "])),e.palette("surface"),e.palette("solid"),e.palette("secondary",.12),e.palette("primary"))})),s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("button"),o&&s.classList.add(o);var u=e.themeTool.slots.label(t.icon);u&&(s.setAttribute("aria-label",u),s.setAttribute("title",u));var c=e.themeTool.slots.icon(t.icon);return s.appendChild(c),s.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.callback&&t.callback(),t.key&&n.get(w.g).call(t.key,t.options)})),t.active&&(t.active()?s.classList.add("active"):s.classList.remove("active")),t.alwaysVisible?(s.removeAttribute("disabled"),s):(!a.enabled||t.disabled&&t.disabled(i)?s.setAttribute("disabled","true"):s.removeAttribute("disabled"),s)}(n,e,o,t,this.options);return s;case"select":var u=function(e,t,n,r,i){var o=e.getStyle((function(e){return Object(K.a)(a||(a=Object(z.a)(["\n      flex-shrink: 0;\n      font-weight: 500;\n      font-size: 0.875rem;\n      ",";\n      ",";\n      .menu-selector {\n        border: 0;\n        box-sizing: unset;\n        cursor: pointer;\n        font: inherit;\n        text-align: left;\n        justify-content: space-between;\n        align-items: center;\n        color: ",";\n        display: flex;\n        padding: 0.25rem 0.5rem;\n        margin: 0.5rem;\n        background: ",";\n        width: 10.375rem;\n        &:disabled {\n          display: none;\n        }\n      }\n      .menu-selector-value {\n        flex: 1;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n      }\n      .menu-selector-list {\n        width: calc(12.375rem);\n        position: absolute;\n        top: 3rem;\n        background: ",";\n        ",";\n        ",";\n        border-bottom-left-radius: ",";\n        border-bottom-right-radius: ",";\n        z-index: 3;\n      }\n      .menu-selector-list-item {\n        background-color: transparent;\n        border: 0;\n        cursor: pointer;\n        display: block;\n        font: inherit;\n        text-align: left;\n        padding: 0.75rem 1rem;\n        line-height: 1.5rem;\n        width: 100%;\n        color: ",";\n        &:hover {\n          background: ",";\n          color: ",";\n        }\n      }\n      &.fold {\n        border-color: transparent;\n        .menu-selector {\n          background: unset;\n        }\n        .menu-selector-list {\n          display: none;\n        }\n      }\n    "])),e.mixin.border("right"),e.mixin.border("left"),e.palette("neutral",.87),e.palette("secondary",.12),e.palette("surface"),e.mixin.border(),e.mixin.shadow(),e.size.radius,e.size.radius,e.palette("neutral",.87),e.palette("secondary",.12),e.palette("primary"))})),s=document.createElement("div");s.classList.add("menu-selector-wrapper","fold");var u=document.createElement("button");u.setAttribute("type","button"),u.classList.add("menu-selector","fold"),u.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation(),s.classList.toggle("fold"),h.style.left="".concat(s.getBoundingClientRect().left-r.dom.getBoundingClientRect().left,"px")})),r.dom.addEventListener("click",(function(){s.classList.add("fold")}));var l=document.createElement("span");l.classList.add("menu-selector-value"),l.textContent=t.text;var f=e.themeTool.slots.icon("downArrow");f.setAttribute("aria-hidden","true"),s.appendChild(u),u.appendChild(l),u.appendChild(f);var h=document.createElement("div");return h.classList.add("menu-selector-list"),t.options.forEach((function(e){var t=document.createElement("button");t.setAttribute("type","button"),t.dataset.id=e.id,t.textContent=e.text,t.classList.add("menu-selector-list-item"),h.appendChild(t)})),h.addEventListener("mousedown",(function(e){var i,a=e.target;a instanceof HTMLButtonElement&&a.dataset.id&&((i=n.get(w.g)).call.apply(i,Object(c.a)(t.onSelect(a.dataset.id,r))),s.classList.add("fold"))})),s.appendChild(h),o&&s.classList.add(o),t.alwaysVisible?(u.removeAttribute("disabled"),s):(!i.enabled||t.disabled&&t.disabled(r)?(u.classList.add("disabled"),u.children[0].setAttribute("disabled","true")):(u.classList.remove("disabled"),u.children[0].removeAttribute("disabled")),s)}(n,e,o,t,this.options);return u;case"divider":var l=function(e,t){var n=e.getStyle((function(e){return Object(K.a)(i||(i=Object(z.a)(["\n      flex-shrink: 0;\n      width: ",";\n      background-color: ",";\n      margin: 0.75rem 1rem;\n    "])),e.size.lineWidth,e.palette("line"))})),r=document.createElement("div");return r.classList.add("divider"),n&&r.classList.add(n),t.group.every((function(e){return e.getAttribute("disabled")||e.classList.contains("disabled")}))?r.classList.add("disabled"):r.classList.remove("disabled"),r}(n,e);return l;default:throw new Error}}}]),e}(),J=Object(R.f)((function(e,t){var n,r,i=null!==(n=null===t||void 0===t?void 0:t.config)&&void 0!==n?n:N,a=null===(r=null===t||void 0===t?void 0:t.enabled)||void 0===r||r,o=Object(w.i)();return{commands:function(){return[Object(w.h)(o,(function(){return P.c}))]},prosePlugins:function(t,n){return[new L.d({key:new L.e("milkdown-advanced-menu"),view:function(t){var r=new W(i,e,n,t,{enabled:a});return{update:function(e){return r.update(e)}}}})]}}})),q=n(31),V=function(e,t){var n=e.onChange,r=e.value,i=e.menuConfig,a=e.editable,o=e.spellcheck,s=Object(m.useRef)(null);Object(m.useImperativeHandle)(t,(function(){return{update:function(e){if(a&&s.current){var t=s.current.get();t&&t.action((function(t){var n=t.get(w.k),r=t.get(w.q)(e);if(r){var i=n.state;n.dispatch(i.tr.replace(0,i.doc.content.size,new x.j(r.content,0,0)).setMeta("addToHistory",!1))}}))}}}}));var u=Object(k.b)((function(e){return function(e){var t=e.root,n=e.onChange,r=e.value,i=e.menuConfig,a=e.editable,o=e.spellcheck;return w.b.make().config((function(e){e.set(w.t,t),e.get(I.b).markdownUpdated((function(e,t){n(t)})),e.set(w.l,{editable:function(){return a}}),null===t||void 0===t||t.setAttribute("spellcheck",JSON.stringify(o)),r&&e.set(w.j,r)})).use(O.a).use(S.a).use(M.c).use(I.a).use(_.a).use(F.a).use(A.a).use(C.a).use(D.a).use(E.a).use(T.a).use(j.a).use(J({config:i,enabled:a}))}({root:e,onChange:n,value:r,menuConfig:i,editable:a,spellcheck:o})}),[r,n,r,i,a,o]);return Object(q.jsx)("div",{className:"milkdown-container",children:Object(q.jsx)(k.a,{ref:s,editor:u})})},$=Object(m.forwardRef)(V),G=n(22),Q=(n(127),n(55)),X=n(114),Y=n(93),Z=function(e,t){var n=e.onChange,r=e.value,i=e.editable,a=e.spellcheck,o=Object(m.useState)(!1),s=Object(G.a)(o,2),u=s[0],c=s[1],l=Object(m.useRef)(null),f=[Q.a,Object(X.a)(),Y.a.lineWrapping,Y.a.updateListener.of((function(e){if(e.focusChanged&&c(e.view.hasFocus),e.docChanged){var t=e.state.doc.toString();n(t)}}))];return Object(m.useImperativeHandle)(t,(function(){return{update:function(e){if(!u&&i&&l.current){var t=l.current.view;if(t){var n=t.state;if(n){var r=n.doc;r&&t.dispatch({changes:{from:0,to:r.toString().length,insert:e}})}}}}}})),Object(q.jsx)("div",{className:"codemirror-container",children:Object(q.jsx)(Y.b,{ref:l,extensions:f,value:r,editable:i,spellCheck:a,indentWithTab:!0})})},ee=Object(m.forwardRef)(Z),te=n(72),ne=n.n(te);!function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(s||(s={})),function(e){e.Row="row",e.Column="column"}(u||(u={}));ne.a.bool.isRequired,ne.a.oneOf([s.Horizontal,s.Vertical]).isRequired,ne.a.arrayOf(ne.a.element).isRequired;var re,ie=function(e){var t=e.children,n=e.split,r=e.direction,i=r===s.Horizontal?u.Column:u.Row;return Object(q.jsxs)("div",{className:"container ".concat(r),children:[Object(q.jsx)("div",{className:"".concat(i," ").concat(n?"half":"full"),children:t[0]}),n&&Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)("div",{className:"separator"}),Object(q.jsx)("div",{className:"".concat(i," half"),children:t[1]})]})]})},ae=Object(m.memo)(ie),oe=n(112),se=n.n(oe),ue=n(113);!function(e){e.Milkdown="milkdown",e.CodeMirror="codemirror"}(re||(re={}));var ce=function(e){Object(p.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(f.a)(this,n),(r=t.call(this,e)).editorKit=void 0,r.prevText="",r.milkdownRef=Object(m.createRef)(),r.codeMirrorRef=Object(m.createRef)(),r.onTextChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.Milkdown;if(r.prevText!==e.trim())switch(r.prevText=e.trim(),r.editorKit.onEditorValueChanged(e),t){case re.CodeMirror:r.updateMilkdownText(r.prevText);break;case re.Milkdown:default:r.updateCodeMirrorText(r.prevText)}},r.toggleSplitView=function(){var e=r.state.splitView;r.setState({splitView:!e})},r.getSplitViewDirection=function(e){return{web:s.Horizontal,desktop:s.Horizontal,mobile:s.Vertical}[e]},r.state={splitView:!1,editable:!0,spellcheck:!0,isLoading:!0},r}return Object(h.a)(n,[{key:"componentDidMount",value:function(){this.configureEditorKit()}},{key:"configureEditorKit",value:function(){var e=this,t={setEditorRawText:function(t){e.prevText=t.trim(),e.updateMilkdownText(e.prevText),e.updateCodeMirrorText(e.prevText),e.setState({isLoading:!1})},generateCustomPreview:function(t){var n=ue.marked.parse(t),r=document.createElement("div");r.innerHTML=n;var i=r.textContent||r.innerText||"";return{plain:e.truncateString(i).trim()}},onNoteValueChange:function(){var t=Object(l.a)(y.a.mark((function t(n){var r,i,a;return y.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=null===(r=!n.content.appData["org.standardnotes.sn"].locked)||void 0===r||r,a=n.content.spellcheck,e.setState({editable:i,spellcheck:a});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onNoteLockToggle:function(t){var n=!t;e.setState({editable:n})}};this.editorKit=new se.a(t,{mode:"markdown",supportsFileSafe:!1})}},{key:"updateMilkdownText",value:function(e){var t=this.milkdownRef.current;t&&t.update(e)}},{key:"updateCodeMirrorText",value:function(e){var t=this.codeMirrorRef.current;t&&t.update(e)}},{key:"truncateString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}},{key:"render",value:function(){var e,t,n=this,r=this.state,i=r.splitView,a=r.editable,o=r.spellcheck;if(r.isLoading)return null;var s=null!==(e=null===(t=this.editorKit)||void 0===t?void 0:t.environment)&&void 0!==e?e:"web",u=this.getSplitViewDirection(s),l=[].concat(Object(c.a)(N),[[{type:"button",icon:"code",active:function(){return i},callback:this.toggleSplitView,alwaysVisible:!0}]]);return Object(q.jsxs)(ae,{split:i,direction:u,children:[Object(q.jsx)($,{ref:this.milkdownRef,onChange:this.onTextChange,value:this.prevText,menuConfig:l,editable:a,spellcheck:o}),Object(q.jsx)(ee,{ref:this.codeMirrorRef,onChange:function(e){return n.onTextChange(e,re.CodeMirror)},value:this.prevText,editable:a,spellcheck:o})]})}}]),n}(m.Component);b.a.render(Object(q.jsx)(m.StrictMode,{children:Object(q.jsx)(ce,{})}),document.getElementById("root"))}},[[139,1,2]]]);
//# sourceMappingURL=main.18531fb0.chunk.js.map