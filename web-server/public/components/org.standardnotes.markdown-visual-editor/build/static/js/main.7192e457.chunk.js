(this["webpackJsonp@standardnotes/markdown-visual"]=this["webpackJsonp@standardnotes/markdown-visual"]||[]).push([[0],{130:function(e,t,n){var i,a=n(15),r=n(193).default,s=n(194).default,o=n(197).default,l=n(198).default,c=n(199).default;self,e.exports=(i=n(200),function(){var e,t,n={156:function(e){self,e.exports=function(){"use strict";var e,t,n,i,a,r={d:function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},u={};r.d(u,{default:function(){return L}}),function(e){e.SetSize="set-size",e.StreamItems="stream-items",e.StreamContextItem="stream-context-item",e.SaveItems="save-items",e.SelectItem="select-item",e.AssociateItem="associate-item",e.DeassociateItem="deassociate-item",e.ClearSelection="clear-selection",e.CreateItem="create-item",e.CreateItems="create-items",e.DeleteItems="delete-items",e.SetComponentData="set-component-data",e.InstallLocalComponent="install-local-component",e.ToggleActivateComponent="toggle-activate-component",e.RequestPermissions="request-permissions",e.PresentConflictResolution="present-conflict-resolution",e.DuplicateItem="duplicate-item",e.ComponentRegistered="component-registered",e.ActivateThemes="themes",e.Reply="reply",e.SaveSuccess="save-success",e.SaveError="save-error",e.ThemesActivated="themes-activated",e.KeyDown="key-down",e.KeyUp="key-up",e.Click="click"}(e||(e={})),function(e){e[e.Web=1]="Web",e[e.Desktop=2]="Desktop",e[e.Mobile=3]="Mobile"}(t||(t={})),function(e){e.Any="*",e.Item="SF|Item",e.RootKey="SN|RootKey|NoSync",e.ItemsKey="SN|ItemsKey",e.EncryptedStorage="SN|EncryptedStorage",e.Note="Note",e.Tag="Tag",e.SmartTag="SN|SmartTag",e.Component="SN|Component",e.Editor="SN|Editor",e.ActionsExtension="Extension",e.UserPrefs="SN|UserPreferences",e.HistorySession="SN|HistorySession",e.Theme="SN|Theme",e.Mfa="SF|MFA",e.ServerExtension="SF|Extension",e.FilesafeCredentials="SN|FileSafe|Credentials",e.FilesafeFileMetadata="SN|FileSafe|FileMetadata",e.FilesafeIntegration="SN|FileSafe|Integration",e.ExtensionRepo="SN|ExtensionRepo"}(n||(n={})),function(e){e.Pinned="pinned",e.Archived="archived",e.Locked="locked",e.UserModifiedDate="client_updated_at",e.DefaultEditor="defaultEditor",e.MobileRules="mobileRules",e.NotAvailableOnMobile="notAvailableOnMobile",e.MobileActive="mobileActive",e.LastSize="lastSize",e.PrefersPlainEditor="prefersPlainEditor",e.ComponentInstallError="installError"}(i||(i={}));var d=new Uint8Array(16);function f(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(d)}for(var m=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,p=function(e){return"string"==typeof e&&m.test(e)},h=[],v=0;v<256;++v)h.push((v+256).toString(16).substr(1));var g,b,y,k,S=function(e,t,n){var i=(e=e||{}).random||(e.rng||f)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t){n=n||0;for(var a=0;a<16;++a)t[n+a]=i[a];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(h[e[t+0]]+h[e[t+1]]+h[e[t+2]]+h[e[t+3]]+"-"+h[e[t+4]]+h[e[t+5]]+"-"+h[e[t+6]]+h[e[t+7]]+"-"+h[e[t+8]]+h[e[t+9]]+"-"+h[e[t+10]]+h[e[t+11]]+h[e[t+12]]+h[e[t+13]]+h[e[t+14]]+h[e[t+15]]).toLowerCase();if(!p(n))throw TypeError("Stringified UUID is invalid");return n}(i)},w=function(e){var n,i,a=(c(n={},t.Web,"web"),c(n,t.Desktop,"desktop"),c(n,t.Mobile,"mobile"),n);return null!==(i=a[e])&&void 0!==i?i:a[t.Web]},E=function(e){return null!=e},x=function(){},T=function(){function e(){o(this,e)}return l(e,null,[{key:"isSupported",get:function(){return!(!window.console&&!console)}},{key:"info",get:function(){return e.isSupported&&this.enabled?console.log.bind(console):x}},{key:"error",get:function(){return e.isSupported?console.error.bind(console):x}}]),e}();function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}(b="enabled")in(g=T)?Object.defineProperty(g,b,{value:!1,enumerable:!0,configurable:!0,writable:!0}):g[b]=!1,function(e){e.Component="component"}(y||(y={})),function(e){e.Shift="Shift",e.Ctrl="Control",e.Meta="Meta"}(k||(k={}));var L=function(){function i(e){if(o(this,i),I(this,"contentWindow",void 0),I(this,"initialPermissions",void 0),I(this,"onReadyCallback",void 0),I(this,"component",{activeThemes:[],acceptsThemes:!0}),I(this,"sentMessages",[]),I(this,"messageQueue",[]),I(this,"lastStreamedItem",void 0),I(this,"pendingSaveItems",void 0),I(this,"pendingSaveTimeout",void 0),I(this,"pendingSaveParams",void 0),I(this,"coallesedSaving",!0),I(this,"coallesedSavingDelay",250),I(this,"messageHandler",void 0),I(this,"keyDownEventListener",void 0),I(this,"keyUpEventListener",void 0),I(this,"clickEventListener",void 0),I(this,"onThemesChangeCallback",void 0),I(this,"concernTimeouts",[]),!e||!e.targetWindow)throw new Error("contentWindow must be a valid Window object.");this.contentWindow=e.targetWindow,this.processParameters(e),this.registerMessageHandler(),this.registerKeyboardEventListeners(),this.registerMouseEventListeners()}return l(i,[{key:"processParameters",value:function(e){var t,n,i=e.initialPermissions,a=e.options,r=e.onReady,s=e.onThemesChange;i&&i.length>0&&(this.initialPermissions=i),E(null==a?void 0:a.coallesedSaving)&&(this.coallesedSaving=a.coallesedSaving),E(null==a?void 0:a.coallesedSavingDelay)&&(this.coallesedSavingDelay=a.coallesedSavingDelay),E(null==a?void 0:a.acceptsThemes)&&(this.component.acceptsThemes=null===(n=null==a?void 0:a.acceptsThemes)||void 0===n||n),E(r)&&(this.onReadyCallback=r),E(s)&&(this.onThemesChangeCallback=s),T.enabled=null!==(t=null==a?void 0:a.debug)&&void 0!==t&&t}},{key:"deinit",value:function(){this.onReadyCallback=void 0,this.component={acceptsThemes:!0,activeThemes:[]},this.messageQueue=[],this.sentMessages=[],this.lastStreamedItem=void 0,this.pendingSaveItems=void 0,this.pendingSaveTimeout=void 0,this.pendingSaveParams=void 0,this.messageHandler&&(this.contentWindow.document.removeEventListener("message",this.messageHandler),this.contentWindow.removeEventListener("message",this.messageHandler)),this.keyDownEventListener&&this.contentWindow.removeEventListener("keydown",this.keyDownEventListener),this.keyUpEventListener&&this.contentWindow.removeEventListener("keyup",this.keyUpEventListener),this.clickEventListener&&this.contentWindow.removeEventListener("click",this.clickEventListener)}},{key:"registerMessageHandler",value:function(){var t=this;this.messageHandler=function(n){if(T.info("Components API Message received:",n.data),!document.referrer||new URL(document.referrer).origin===new URL(n.origin).origin){var i=n.data,a=function(e){if("string"!=typeof e)return!1;try{var t=JSON.parse(e),n=Object.prototype.toString.call(t);return"[object Object]"===n||"[object Array]"===n}catch(e){return!1}}(i)?JSON.parse(i):i;if(a){if(void 0===t.component.origin&&a.action===e.ComponentRegistered)t.component.origin=n.origin;else if(n.origin!==t.component.origin)return;t.handleMessage(a)}else T.error("Invalid data received. Skipping...")}},this.contentWindow.document.addEventListener("message",this.messageHandler,!1),this.contentWindow.addEventListener("message",this.messageHandler,!1),T.info("Waiting for messages...")}},{key:"registerKeyboardEventListeners",value:function(){var e=this;this.keyDownEventListener=function(t){T.info("A key has been pressed: ".concat(t.key)),t.ctrlKey?e.keyDownEvent(k.Ctrl):t.shiftKey?e.keyDownEvent(k.Shift):(t.metaKey||"Meta"===t.key)&&e.keyDownEvent(k.Meta)},this.keyUpEventListener=function(t){T.info("A key has been released: ".concat(t.key)),"Control"===t.key?e.keyUpEvent(k.Ctrl):"Shift"===t.key?e.keyUpEvent(k.Shift):"Meta"===t.key&&e.keyUpEvent(k.Meta)},this.contentWindow.addEventListener("keydown",this.keyDownEventListener,!1),this.contentWindow.addEventListener("keyup",this.keyUpEventListener,!1)}},{key:"registerMouseEventListeners",value:function(){var e=this;this.clickEventListener=function(t){T.info("A click has been performed."),e.mouseClickEvent()},this.contentWindow.addEventListener("click",this.clickEventListener,!1)}},{key:"handleMessage",value:function(t){switch(t.action){case e.ComponentRegistered:this.component.sessionKey=t.sessionKey,t.componentData&&(this.component.data=t.componentData),this.onReady(t.data),T.info("Component successfully registered with payload:",t);break;case e.ActivateThemes:this.activateThemes(t.data.themes);break;default:var n,i;if(!t.original)return;var a=null===(n=this.sentMessages)||void 0===n?void 0:n.filter((function(e){var n;return e.messageId===(null===(n=t.original)||void 0===n?void 0:n.messageId)}))[0];if(!a){var r=this.contentWindow.document.title,s=("The extension '".concat(r,"' is attempting to communicate with Standard Notes, ")+"but an error is preventing it from doing so. Please restart this extension and try again.").replace("  "," ");return void T.info(s)}null==a||null===(i=a.callback)||void 0===i||i.call(a,t.data)}}},{key:"onReady",value:function(t){this.component.environment=t.environment,this.component.platform=t.platform,this.component.uuid=t.uuid,this.initialPermissions&&this.initialPermissions.length>0&&this.requestPermissions(this.initialPermissions);var n,i=s(this.messageQueue);try{for(i.s();!(n=i.n()).done;){var a=n.value;this.postMessage(a.action,a.data,a.callback)}}catch(r){i.e(r)}finally{i.f()}this.messageQueue=[],T.info("Data passed to onReady:",t),this.activateThemes(t.activeThemeUrls||[]),this.postMessage(e.ThemesActivated,{}),this.onReadyCallback&&this.onReadyCallback()}},{key:"getSelfComponentUUID",value:function(){return this.component.uuid}},{key:"isRunningInDesktopApplication",value:function(){return this.component.environment===w(t.Desktop)}},{key:"isRunningInMobileApplication",value:function(){return this.component.environment===w(t.Mobile)}},{key:"getComponentDataValueForKey",value:function(e){if(this.component.data)return this.component.data[e]}},{key:"setComponentDataValueForKey",value:function(t,n){if(!this.component.data)throw new Error("The component has not been initialized.");if(!t||t&&0===t.length)throw new Error("The key for the data value should be a valid string.");this.component.data=j(j({},this.component.data),{},c({},t,n)),this.postMessage(e.SetComponentData,{componentData:this.component.data})}},{key:"clearComponentData",value:function(){this.component.data={},this.postMessage(e.SetComponentData,{componentData:this.component.data})}},{key:"postMessage",value:function(e,t,n){if(this.component.sessionKey){var i,a={action:e,data:t,messageId:this.generateUUID(),sessionKey:this.component.sessionKey,api:y.Component},r=JSON.parse(JSON.stringify(a));r.callback=n,this.sentMessages.push(r),i=this.isRunningInMobileApplication()?JSON.stringify(a):a,T.info("Posting message:",i),this.contentWindow.parent.postMessage(i,this.component.origin)}else this.messageQueue.push({action:e,data:t,api:y.Component,callback:n})}},{key:"requestPermissions",value:function(t,n){this.postMessage(e.RequestPermissions,{permissions:t},(function(){n&&n()}))}},{key:"activateThemes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(this.component.acceptsThemes){T.info("Incoming themes:",e);var t=this.component.activeThemes;if(!t||t.sort().toString()!=e.sort().toString()){var n,i=e,a=[],r=s(t);try{var o=function(){var t=n.value;e.includes(t)?i=i.filter((function(e){return e!==t})):a.push(t)};for(r.s();!(n=r.n()).done;)o()}catch(h){r.e(h)}finally{r.f()}T.info("Deactivating themes:",a),T.info("Activating themes:",i);for(var l=0,c=a;l<c.length;l++){var u=c[l];this.deactivateTheme(u)}this.component.activeThemes=e;var d,f=s(i);try{for(f.s();!(d=f.n()).done;){var m=d.value;if(m){var p=this.contentWindow.document.createElement("link");p.id=btoa(m),p.href=m,p.type="text/css",p.rel="stylesheet",p.media="screen,print",p.className="custom-theme",this.contentWindow.document.getElementsByTagName("head")[0].appendChild(p)}}}catch(h){f.e(h)}finally{f.f()}this.onThemesChangeCallback&&this.onThemesChangeCallback()}}}},{key:"themeElementForUrl",value:function(e){return Array.from(this.contentWindow.document.getElementsByClassName("custom-theme")).slice().find((function(t){return t.id==btoa(e)}))}},{key:"deactivateTheme",value:function(e){var t=this.themeElementForUrl(e);t&&t.parentNode&&(t.setAttribute("disabled","true"),t.parentNode.removeChild(t))}},{key:"generateUUID",value:function(){return S()}},{key:"platform",get:function(){return this.component.platform}},{key:"environment",get:function(){return this.component.environment}},{key:"streamItems",value:function(t,n){this.postMessage(e.StreamItems,{content_types:t},(function(e){n(e.items)}))}},{key:"streamContextItem",value:function(t){var n=this;this.postMessage(e.StreamContextItem,{},(function(e){var i=e.item;(!n.lastStreamedItem||n.lastStreamedItem.uuid!==i.uuid)&&n.pendingSaveTimeout&&(clearTimeout(n.pendingSaveTimeout),n.performSavingOfItems(n.pendingSaveParams),n.pendingSaveTimeout=void 0,n.pendingSaveParams=void 0),n.lastStreamedItem=i,t(n.lastStreamedItem)}))}},{key:"selectItem",value:function(t){this.postMessage(e.SelectItem,{item:this.jsonObjectForItem(t)})}},{key:"clearSelection",value:function(){this.postMessage(e.ClearSelection,{content_type:n.Tag})}},{key:"createItem",value:function(t,n){var i=this;this.postMessage(e.CreateItem,{item:this.jsonObjectForItem(t)},(function(e){var t=e.item;!t&&e.items&&e.items.length>0&&(t=e.items[0]),i.associateItem(t),n&&n(t)}))}},{key:"createItems",value:function(t,n){var i=this,a=t.map((function(e){return i.jsonObjectForItem(e)}));this.postMessage(e.CreateItems,{items:a},(function(e){n&&n(e.items)}))}},{key:"associateItem",value:function(t){this.postMessage(e.AssociateItem,{item:this.jsonObjectForItem(t)})}},{key:"deassociateItem",value:function(t){this.postMessage(e.DeassociateItem,{item:this.jsonObjectForItem(t)})}},{key:"deleteItem",value:function(e,t){this.deleteItems([e],t)}},{key:"deleteItems",value:function(t,n){var i=this,a={items:t.map((function(e){return i.jsonObjectForItem(e)}))};this.postMessage(e.DeleteItems,a,(function(e){n&&n(e)}))}},{key:"sendCustomEvent",value:function(e,t,n){this.postMessage(e,t,(function(e){n&&n(e)}))}},{key:"saveItem",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.saveItems([e],t,n)}},{key:"saveItemWithPresave",value:function(e,t,n){this.saveItemsWithPresave([e],t,n)}},{key:"saveItemsWithPresave",value:function(e,t,n){this.saveItems(e,n,!1,t)}},{key:"performSavingOfItems",value:function(t){var n=this,i=t.items,a=t.presave,r=t.callback,o=setTimeout((function(){n.concernTimeouts.forEach((function(e){return clearTimeout(e)})),alert("This editor is unable to communicate with Standard Notes. Your changes may not be saved. Please backup your changes, then restart the application and try again.")}),5e3);this.concernTimeouts.push(o),a&&a();var l,c=[],u=s(i);try{for(u.s();!(l=u.n()).done;){var d=l.value;c.push(this.jsonObjectForItem(d))}}catch(f){u.e(f)}finally{u.f()}this.postMessage(e.SaveItems,{items:c},(function(){n.concernTimeouts.forEach((function(e){return clearTimeout(e)})),null==r||r()}))}},{key:"saveItems",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3?arguments[3]:void 0;if(this.pendingSaveItems||(this.pendingSaveItems=[]),this.coallesedSaving&&!i){this.pendingSaveTimeout&&clearTimeout(this.pendingSaveTimeout);var r=e.map((function(e){return e.uuid})),s=this.pendingSaveItems.filter((function(e){return!r.includes(e.uuid)}));this.pendingSaveItems=s.concat(e),this.pendingSaveParams={items:this.pendingSaveItems,presave:a,callback:t},this.pendingSaveTimeout=setTimeout((function(){n.performSavingOfItems(n.pendingSaveParams),n.pendingSaveItems=[],n.pendingSaveTimeout=void 0,n.pendingSaveParams=null}),this.coallesedSavingDelay)}else this.performSavingOfItems({items:e,presave:a,callback:t})}},{key:"setSize",value:function(t,n){this.postMessage(e.SetSize,{type:"container",width:t,height:n})}},{key:"keyDownEvent",value:function(t){this.postMessage(e.KeyDown,{keyboardModifier:t})}},{key:"keyUpEvent",value:function(t){this.postMessage(e.KeyUp,{keyboardModifier:t})}},{key:"mouseClickEvent",value:function(){this.postMessage(e.Click,{})}},{key:"jsonObjectForItem",value:function(e){var t=Object.assign({},e);return t.children=null,t.parent=null,t}},{key:"getItemAppDataValue",value:function(e,t){var n,i;return null==e||null===(n=e.content)||void 0===n||null===(i=n.appData)||void 0===i?void 0:i["org.standardnotes.sn"][t]}}]),i}();return u.default}()},695:function(e){"use strict";e.exports=i}},u={};function d(e){var t=u[e];if(void 0!==t)return t.exports;var i=u[e]={exports:{}};return n[e](i,i.exports,d),i.exports}d.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return d.d(t,{a:t}),t},t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__},d.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"==typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"==typeof n.then)return n}var a=Object.create(null);d.r(a);var r={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){return r[e]=function(){return n[e]}}));return r.default=function(){return n},d.d(a,r),a},d.d=function(e,t){for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},d.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var f={};return function(){"use strict";d.d(f,{default:function(){return b}});var e=d(156),t=d.n(e),n=function(){var e=r(a.mark((function e(t){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){return setTimeout(e,1e3*t)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=function(){function e(t){o(this,e),this.options=t,i(this,"uuidToFileTempUrlAndTypeMapping",{}),i(this,"currentlyLoadingIds",[]),i(this,"statusElementMapping",{}),i(this,"fileTypeToElementType",{"image/png":"img","image/jpg":"img","image/jpeg":"img","image/gif":"img","image/tiff":"img","image/bmp":"img","video/mp4":"video","audio/mpeg":"audio","audio/mp3":"audio"})}return l(e,[{key:"fileTypeForElementType",value:function(e){return this.fileTypeToElementType[e.toLowerCase()]}},{key:"loadFileSafeElements",value:function(){var e,t=this.options.getElementsBySelector("*[fsplaceholder]"),n=s(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.loadFileSafeElement(i)}}catch(a){n.e(a)}finally{n.f()}}},{key:"loadFileSafeElement",value:function(){var e=r(a.mark((function e(t){var i,r,s,o,l,c,u,d,f,m,p,h,v=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.options.fileSafeInstance,s=t.getAttribute("fsid"),o=null!==(i=t.getAttribute("fsName"))&&void 0!==i?i:"",l=o&&"undefined"!=o?o:"file",s){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(c=this.uuidToFileTempUrlAndTypeMapping[s])){e.next=6;break}return e.abrupt("return",(this.insertMediaElement({fsid:s,fsElement:t,url:c.url,fileType:c.fileType,fsName:c.fsName}),!1));case 6:if(!this.currentlyLoadingIds.includes(s)){e.next=8;break}return e.abrupt("return",!1);case 8:if(u=r.findFileDescriptor(s)){e.next=11;break}return e.abrupt("return",(this.setStatus({fsElement:t,fsid:s,status:"Unable to find ".concat(l," ").concat(s,"."),removable:!0}),!1));case 11:if(d='[fsid="'.concat(u.uuid,'"][fscollapsable]'),!(document.querySelectorAll("img".concat(d,", figure").concat(d,", video").concat(d,", audio").concat(d)).length>0)){e.next=14;break}return e.abrupt("return",!1);case 14:return this.currentlyLoadingIds.push(s),this.setStatus({fsElement:t,fsid:s,status:"Downloading ".concat(l,"...")}),e.next=18,n(.05);case 18:return e.next=20,r.downloadFileFromDescriptor(u).catch((function(){v.setStatus({fsElement:t,fsid:s,status:"Unable to download ".concat(l," ").concat(s,".")})}));case 20:if(f=e.sent){e.next=23;break}return e.abrupt("return",!1);case 23:return this.setStatus({fsElement:t,fsid:s,status:"Decrypting ".concat(l,"...")}),e.next=26,n(.05);case 26:return e.next=28,r.decryptFile({fileDescriptor:u,fileItem:f}).catch((function(){v.setStatus({fsElement:t,fsid:s,status:"Unable to decrypt ".concat(l," ").concat(s,".")})}));case 28:if(m=e.sent){e.next=31;break}return e.abrupt("return",!1);case 31:return this.setStatus({fsElement:t,fsid:s}),e.next=34,n(.05);case 34:return p=u.content.fileType,h=r.createTemporaryFileUrl({base64Data:m.decryptedData,dataType:p}),e.abrupt("return",(this.insertMediaElement({fsid:s,fileType:p,fsName:o,fsElement:t,url:h}),v.currentlyLoadingIds.splice(v.currentlyLoadingIds.indexOf(s),1),this.uuidToFileTempUrlAndTypeMapping[s]={fileType:p,url:h,fsName:o},!0));case 36:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"insertMediaElement",value:function(e){var t,n=e.url,i=e.fsid,a=e.fsName,r=e.fileType,s=e.fsElement;switch(this.fileTypeForElementType(r)){case"img":t=this.createImageElement({url:n,fsid:i,fsName:a,fsElement:s});break;case"video":t=this.createVideoElement({url:n,fsid:i,fileType:r,fsName:a,fsElement:s});break;case"audio":t=this.createAudioElement({url:n,fsid:i,fsName:a});break;default:t=this.createDownloadElement({url:n,fsid:i,fsName:a})}this.insertElementNearElement(t,s),s.remove()}},{key:"wrapElementInTag",value:function(e){var t=e.element,n=e.tagName,i=e.fsid,a=e.fsName,r=document.createElement(n);return r.setAttribute("fsid",i),r.setAttribute("fsName",a),r.setAttribute("fscollapsable","true"),r.setAttribute("contenteditable","true"),r.append(t),r}},{key:"createImageElement",value:function(e){var t=e.url,n=e.fsid,i=e.fsName,a=e.fsElement,r=document.createElement("img");r.setAttribute("src",t),r.setAttribute("srcset","".concat(t," 2x")),r.setAttribute("fsid",n),r.setAttribute("fsName",i),r.setAttribute("fscollapsable","true");var s=a.getAttribute("width");s&&r.setAttribute("width",s);var o=a.getAttribute("height");return o&&r.setAttribute("height",o),r}},{key:"createVideoElement",value:function(e){var t=e.url,n=e.fsid,i=e.fileType,a=e.fsName,r=e.fsElement,s=document.createElement("video");s.setAttribute("controls","true"),s.setAttribute("fsid",n),s.setAttribute("fsName",a),s.setAttribute("fscollapsable","true");var o=r.getAttribute("width");o&&s.setAttribute("width",o);var l=r.getAttribute("height");l&&s.setAttribute("height",l);var c=document.createElement("source");return c.setAttribute("src",t),c.setAttribute("type",i),s.append(c),this.wrapElementInTag({fsid:n,fsName:a,element:s,tagName:"p"})}},{key:"createDownloadElement",value:function(e){var t=e.url,n=e.fsid,i=e.fsName,a=document.createElement("a");return a.setAttribute("fsid",n),a.setAttribute("fsName",i),a.setAttribute("ghost","true"),a.setAttribute("fscollapsable","true"),a.setAttribute("href",t),a.textContent="".concat(i),a}},{key:"createAudioElement",value:function(e){var t=e.url,n=e.fsid,i=e.fsName,a=document.createElement("audio");return a.setAttribute("src",t),a.setAttribute("controls","true"),a.setAttribute("fsid",n),a.setAttribute("fsName",i),a.setAttribute("fscollapsable","true"),this.wrapElementInTag({fsid:n,fsName:i,element:a,tagName:"p"})}},{key:"setStatus",value:function(e){var t=e.status,n=e.fsElement,i=e.fsid,a=e.removable,r=void 0!==a&&a;if(i){var s=this.statusElementMapping[i];s&&(s.remove(),delete this.statusElementMapping[i])}if(t){var o=document.createElement("label");return o.setAttribute("id",i),o.setAttribute("ghost","true"),o.setAttribute("contenteditable","false"),o.style.fontWeight="bold",o.textContent=t,r&&(o.style.userSelect="all"),o=this.insertElementNearElement(o,n),i&&(this.statusElementMapping[i]=o),o}}},{key:"insertStatusAtCursor",value:function(e){var t=Math.random().toString(36).substring(7);return this.setStatus({status:e,fsid:t,fsElement:null}),t}},{key:"removeCursorStatus",value:function(e){var t=this.options.getElementsBySelector("#".concat(e));t.length>0&&t[0].remove()}},{key:"insertElementNearElement",value:function(e,t){var n=this.options.preprocessElement(e),i="child";if(t&&"figure"==n.tagName.toLowerCase()){var a=t.closest("p");a&&(t=a,i="afterend")}return this.options.insertElement(n,t,i),n}}]),e}(),u=function(){function e(t){o(this,e),this.options=t}return l(e,[{key:"onKeyUp",value:function(e){var t=e.isEnter,n=e.isPaste,i=e.isSpace;(t||n||i)&&this.searchPatterns({searchPreviousLine:null!=t&&t})}},{key:"searchPatterns",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{searchPreviousLine:!1},n=t.searchPreviousLine?this.options.getPreviousLineText():this.options.getCurrentLineText(),i=s(this.options.patterns);try{for(i.s();!(e=i.n()).done;){var a=e.value,r=a.regex.exec(n);if(r){var o=r[0];if(o){var l=a.callback(o);this.replaceSelection(a.regex,l,t.searchPreviousLine)}}}}catch(c){i.e(c)}finally{i.f()}}},{key:"replaceSelection",value:function(e,t,n){var i,a,r;null!==(i=this.options)&&void 0!==i&&i.beforeExpand&&this.options.beforeExpand(),this.options.replaceText({regex:e,replacement:t,searchPreviousLine:n}),null!==(a=this.options)&&void 0!==a&&a.afterExpand&&(null===(r=this.options)||void 0===r||r.afterExpand())}}]),e}(),m=/(<p>)?\[FileSafe[^\]]*\](<\/p>)?/g,p=function(e){return e.replace(m,(function(e){return v(e)}))},h=function(e){return"[FileSafe:".concat(e.uuid,":").concat(e.content.fileName,"]")},v=function(e){var t=(e=(e=(e=e.replace("<p>","")).replace("</p>","")).replace("[","").replace("]","")).split(":"),n=t[1],i=t[2],a=t[3],r="";if(a){var s=a.split("x");r="width=".concat(s[0]," height=").concat(s[1])}return"<p fsplaceholder=true style='display: none;' fscollapsable=true ghost=true fsid='".concat(n,"' fsname='").concat(i,"' ").concat(r,"></p>")};function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){function e(t,n){o(this,e),this.delegate=t,this.options=n,g(this,"fileIdsPendingAssociation",[]),g(this,"componentRelay",void 0),g(this,"fileLoader",void 0),g(this,"textExpander",void 0),g(this,"fileSafeLoading",void 0),g(this,"fileSafeClass",void 0),g(this,"fileSafeInstance",void 0),g(this,"note",void 0),g(this,"ignoreNextTextChange",void 0),g(this,"needsFileSafeElementLoad",void 0),g(this,"previousText",void 0),this.connectToBridge(),this.options.supportsFileSafe&&(this.fileSafeLoading=this.importFileSafe())}return l(e,[{key:"connectToBridge",value:function(){var e=this,n=this.options,i=n.coallesedSaving,s=n.coallesedSavingDelay,o=n.mode,l=n.supportsFileSafe;this.componentRelay=new(t())({targetWindow:window,options:{coallesedSaving:i,coallesedSavingDelay:s},onReady:function(){var t=e.componentRelay.platform;t&&document.documentElement.classList.add(t)},onThemesChange:this.delegate.onThemesChange}),this.componentRelay.streamContextItem(function(){var t=r(a.mark((function t(n){var i,r,s,c,u,d,f,m,h,v;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=!0,e.note&&e.note.uuid==n.uuid&&(i=!1),r=e.note,l?(s=e.fileSafeClass.getSFItemClass(),e.note=new s(n),e.fileSafeInstance.setCurrentNote(e.note)):e.note=n,!n.isMetadataUpdate){t.next=6;break}return t.abrupt("return");case 6:if(c=n.content.text,"html"===o&&i&&(/<[a-z][\s\S]*>/i.test(c)||(e.ignoreNextTextChange=!0)),e.previousText=c,l&&(e.needsFileSafeElementLoad=!0,c=p(c)),t.t0=e.delegate.onNoteValueChange,!t.t0){t.next=14;break}return t.next=14,e.delegate.onNoteValueChange(n);case 14:if(e.delegate.setEditorRawText(c),!e.delegate.onNoteLockToggle){t.next=18;break}f=null!==(u=e.componentRelay.getItemAppDataValue(r,"locked"))&&void 0!==u&&u,m=null!==(d=e.componentRelay.getItemAppDataValue(e.note,"locked"))&&void 0!==d&&d,f!==m&&e.delegate.onNoteLockToggle(m);case 18:i&&(null===(h=(v=e.delegate).clearUndoHistory)||void 0===h||h.call(v));case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"importFileSafe",value:function(){var e=r(a.mark((function e(){var t=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then(d.t.bind(d,695,23)).then((function(e){return t.fileSafeClass=e.default,t.configureFileSafe(),t.fileSafeInstance})));case 1:case"end":return e.stop()}}),e)})));function t(){return e.apply(this,arguments)}return t}()},{key:"configureFileSafe",value:function(){for(var e=this,t=0,n=["getCurrentLineText","getPreviousLineText","replaceText","getElementsBySelector","insertElement","preprocessElement","insertRawText"];t<n.length;t++){var i=n[t];if(!this.delegate[i])throw Error("Missing ".concat(i," delegate function."))}this.fileSafeInstance=new this.fileSafeClass({componentManager:this.componentRelay}),this.fileSafeInstance.addDataChangeObserver((function(){var t=e.fileSafeInstance.getAllFileDescriptors();if(e.note&&e.fileIdsPendingAssociation.length>0){var n,i=!1,a=s(e.fileIdsPendingAssociation.slice());try{var r=function(){var a=n.value,r=t.find((function(e){return e.uuid==a}));if(!r)return"continue";i=!0,e.fileIdsPendingAssociation.splice(e.fileIdsPendingAssociation.indexOf(a),1);var s=h(r);e.delegate.insertRawText(s)};for(a.s();!(n=a.n()).done;)r()}catch(o){a.e(o)}finally{a.f()}i&&e.textExpander.searchPatterns()}t.length>0&&e.fileLoader.loadFileSafeElements()})),this.fileSafeInstance.addNewFileDescriptorHandler((function(t){e.fileIdsPendingAssociation.push(t.uuid)})),this.fileLoader=new c({fileSafeInstance:this.fileSafeInstance,getElementsBySelector:this.delegate.getElementsBySelector,insertElement:this.delegate.insertElement,preprocessElement:this.delegate.preprocessElement}),this.textExpander=new u({afterExpand:function(){return e.fileLoader.loadFileSafeElements()},getCurrentLineText:this.delegate.getCurrentLineText,getPreviousLineText:this.delegate.getPreviousLineText,replaceText:this.delegate.replaceText,patterns:[{regex:m,callback:function(e){return p(e)}}]})}},{key:"getFileSafe",value:function(){var e=r(a.mark((function e(){return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.fileSafeInstance&&this.fileSafeLoading?this.fileSafeLoading:this.importFileSafe());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"onEditorKeyUp",value:function(e){var t=e.isSpace,n=e.isEnter;this.textExpander.onKeyUp({isSpace:t,isEnter:n})}},{key:"onEditorPaste",value:function(){this.textExpander.onKeyUp({isPaste:!0})}},{key:"onEditorValueChanged",value:function(e){var t=this,n=this.options,i=n.mode,a=n.supportsFileSafe;if(this.needsFileSafeElementLoad&&(this.needsFileSafeElementLoad=!1,this.fileLoader.loadFileSafeElements()),this.ignoreNextTextChange)this.ignoreNextTextChange=!1;else if((!a||(e=function(e){var t,n=(new DOMParser).parseFromString(e,"text/html"),i=n.querySelectorAll("*[fscollapsable]"),a=s(i);try{for(a.s();!(t=a.n()).done;){var r=t.value,o=r.getAttribute("fsid"),l=r.getAttribute("fsname"),c=r.getAttribute("width"),u=r.getAttribute("height"),d=["FileSafe",o,l];if(c&&u){var f="".concat(c,"x").concat(u);d.push(f)}var m="<p>[".concat(d.join(":"),"]</p>");r.insertAdjacentHTML("afterend",m),r.remove()}}catch(p){a.e(p)}finally{a.f()}return n.querySelectorAll("*[ghost]").forEach((function(e){return e.remove()})),n.body.innerHTML}(e),this.previousText!=e))&&(this.previousText=e,this.note)){var r=this.note;this.componentRelay.saveItemWithPresave(r,(function(){if(r.content.text=e,t.delegate.generateCustomPreview){var n,a=t.delegate.generateCustomPreview(e);r.content.preview_plain=null!==(n=a.plain)&&void 0!==n?n:" ",r.content.preview_html=a.html}else{if("html"===i){var s=e.replace(m,(function(e){return""}));s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}(function(e){var t=document.implementation.createHTMLDocument().body;return t.innerHTML=e,t.textContent||t.innerText||""}(s)),r.content.preview_plain=s.length>0?s:" "}else r.content.preview_plain=e;r.content.preview_html=null}}))}}},{key:"canUploadFiles",value:function(){var e=this.fileSafeInstance.getAllCredentials(),t=this.fileSafeInstance.getAllIntegrations();return e.length>0&&t.length>0}},{key:"uploadJSFileObject",value:function(){var e=r(a.mark((function e(t){var n,i=this;return a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.fileLoader.insertStatusAtCursor("Processing file..."),e.abrupt("return",this.fileSafeInstance.encryptAndUploadJavaScriptFileObject(t).then((function(){i.fileLoader.removeCursorStatus(n)})));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"saveItemWithPresave",value:function(e,t){this.componentRelay.saveItemWithPresave(e,t)}},{key:"platform",get:function(){return this.componentRelay.platform}},{key:"environment",get:function(){return this.componentRelay.environment}}]),e}()}(),f.default}())},138:function(e,t,n){},143:function(e,t,n){},190:function(e,t,n){},201:function(e,t,n){"use strict";n.r(t);var i,a,r,s,o,l,c=n(10),u=n(28),d=n(1),f=n(2),m=n(18),p=n(19),h=n(15),v=n.n(h),g=(n(138),n(20)),b=n(86),y=n.n(b),k=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,212)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),i(e),a(e),r(e),s(e)}))},S=(n(143),n(106)),w=n(5),E=n(7),x=n(120),T=n(134),C=n(104),j=n(133),I=n(124),L=n(135),O=n(125),A=n(75),M=n(119),P=n(123),N=n(136),D=n(126),F=n(127),R=n(78),U=n(9),W=n(12),V=n(23),K=n(79),H=[[{type:"button",icon:"bulletList",key:V.g,disabled:function(e){var t=e.state;return!Object(R.f)(t.schema.nodes.bullet_list)(t)}},{type:"button",icon:"orderedList",key:V.h,disabled:function(e){var t=e.state;return!Object(R.f)(t.schema.nodes.ordered_list)(t)}},{type:"button",icon:"taskList",key:A.b,disabled:function(e){var t=e.state;return!Object(R.f)(t.schema.nodes.task_list_item)(t)}},{type:"button",icon:"liftList",key:V.c,disabled:function(e){var t=e.state;return!Object(K.a)(t.schema.nodes.list_item)(t)}},{type:"button",icon:"sinkList",key:V.d,disabled:function(e){var t=e.state;return!Object(K.b)(t.schema.nodes.list_item)(t)}}],[{type:"button",icon:"image",key:V.b},{type:"button",icon:"table",key:A.a}],[{type:"button",icon:"quote",key:V.f},{type:"button",icon:"divider",key:V.a}]],_=n(76),z=n(17),$=n(53),B=function(){function e(t,n,i,a,r){var o=this;Object(d.a)(this,e),this.utils=n,this.ctx=i,this.options=r,this.config=void 0,this.config=t.map((function(e){return e.map((function(e){return Object(_.a)(Object(_.a)({},e),{},{$:o.$create(e,a)})}))})).map((function(e,n){if(n===t.length-1)return e;var i={type:"divider",group:e.map((function(e){return e.$}))};return[].concat(Object(c.a)(e),[Object(_.a)(Object(_.a)({},i),{},{$:o.$create(i,a)})])})).flat();var l=function(e,t){var n=e.getStyle((function(e){return e.mixin.scrollbar("y")})),i=e.getStyle((function(e){var t=e.mixin.border(),n=e.mixin.scrollbar("x");return Object($.a)(s||(s=Object(z.a)(["\n      box-sizing: border-box;\n      width: 100%;\n      display: flex;\n      flex-wrap: nowrap;\n      overflow-x: auto;\n      ",";\n      ",";\n      background: ",";\n\n      -webkit-overflow-scrolling: auto;\n\n      .disabled {\n        display: none;\n      }\n    "])),t,n,e.palette("surface"))})),a=document.createElement("div"),r=document.createElement("div");r.classList.add("milkdown-menu"),a.appendChild(r),a.classList.add("milkdown-menu-wrapper"),i&&i.split(" ").forEach((function(e){return r.classList.add(e)}));var o=t.dom;n&&o.classList.add(n);var l=o.parentElement;if(!l)throw new Error("No parent node found");var c=l.parentElement;if(!c)throw new Error("No root node found");return c.replaceChild(a,l),a.appendChild(l),r}(n,a);this.config.forEach((function(e){return l.appendChild(e.$)}))}return Object(f.a)(e,[{key:"update",value:function(e){var t=this.options.enabled;this.config.forEach((function(n){switch(n.type){case"button":if(n.active)n.active(e)?n.$.classList.add("active"):n.$.classList.remove("active");if(n.alwaysVisible)return void n.$.removeAttribute("disabled");!t||n.disabled&&n.disabled(e)?n.$.setAttribute("disabled","true"):n.$.removeAttribute("disabled");break;case"select":if(n.alwaysVisible)return void n.$.removeAttribute("disabled");!t||n.disabled&&n.disabled(e)?(n.$.classList.add("disabled"),n.$.children[0].setAttribute("disabled","true")):(n.$.classList.remove("disabled"),n.$.children[0].removeAttribute("disabled"));break;case"divider":n.group.every((function(e){return e.getAttribute("disabled")||e.classList.contains("disabled")}))?n.$.classList.add("disabled"):n.$.classList.remove("disabled")}}))}},{key:"$create",value:function(e,t){var n=this.utils,s=this.ctx;switch(e.type){case"button":var o=function(e,t,n,a,r){var s=e.getStyle((function(e){return Object($.a)(i||(i=Object(z.a)(["\n      border: 0;\n      box-sizing: unset;\n      width: 1.5rem;\n      height: 1.5rem;\n      padding: 0.25rem;\n      margin: 0.5rem;\n      flex-shrink: 0;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      background-color: ",";\n      color: ",";\n      transition: all 0.4s ease-in-out;\n      cursor: pointer;\n      &.active,\n      &:hover {\n        background-color: ",";\n        color: ",";\n      }\n      &:disabled {\n        display: none;\n      }\n    "])),e.palette("surface"),e.palette("solid"),e.palette("secondary",.12),e.palette("primary"))})),o=document.createElement("button");o.setAttribute("type","button"),o.classList.add("button"),s&&o.classList.add(s);var l=e.themeTool.slots.label(t.icon);l&&(o.setAttribute("aria-label",l),o.setAttribute("title",l));var c=e.themeTool.slots.icon(t.icon);return o.appendChild(c),o.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),t.callback&&t.callback(),t.key&&n.get(w.g).call(t.key,t.options)})),t.active&&(t.active()?o.classList.add("active"):o.classList.remove("active")),t.alwaysVisible?(o.removeAttribute("disabled"),o):(!r.enabled||t.disabled&&t.disabled(a)?o.setAttribute("disabled","true"):o.removeAttribute("disabled"),o)}(n,e,s,t,this.options);return o;case"select":var l=function(e,t,n,i,a){var s=e.getStyle((function(e){return Object($.a)(r||(r=Object(z.a)(["\n      flex-shrink: 0;\n      font-weight: 500;\n      font-size: 0.875rem;\n      ",";\n      ",";\n      .menu-selector {\n        border: 0;\n        box-sizing: unset;\n        cursor: pointer;\n        font: inherit;\n        text-align: left;\n        justify-content: space-between;\n        align-items: center;\n        color: ",";\n        display: flex;\n        padding: 0.25rem 0.5rem;\n        margin: 0.5rem;\n        background: ",";\n        width: 10.375rem;\n        &:disabled {\n          display: none;\n        }\n      }\n      .menu-selector-value {\n        flex: 1;\n        white-space: nowrap;\n        text-overflow: ellipsis;\n      }\n      .menu-selector-list {\n        width: calc(12.375rem);\n        position: absolute;\n        top: 3rem;\n        background: ",";\n        ",";\n        ",";\n        border-bottom-left-radius: ",";\n        border-bottom-right-radius: ",";\n        z-index: 3;\n      }\n      .menu-selector-list-item {\n        background-color: transparent;\n        border: 0;\n        cursor: pointer;\n        display: block;\n        font: inherit;\n        text-align: left;\n        padding: 0.75rem 1rem;\n        line-height: 1.5rem;\n        width: 100%;\n        color: ",";\n        &:hover {\n          background: ",";\n          color: ",";\n        }\n      }\n      &.fold {\n        border-color: transparent;\n        .menu-selector {\n          background: unset;\n        }\n        .menu-selector-list {\n          display: none;\n        }\n      }\n    "])),e.mixin.border("right"),e.mixin.border("left"),e.palette("neutral",.87),e.palette("secondary",.12),e.palette("surface"),e.mixin.border(),e.mixin.shadow(),e.size.radius,e.size.radius,e.palette("neutral",.87),e.palette("secondary",.12),e.palette("primary"))})),o=document.createElement("div");o.classList.add("menu-selector-wrapper","fold");var l=document.createElement("button");l.setAttribute("type","button"),l.classList.add("menu-selector","fold"),l.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopPropagation(),o.classList.toggle("fold"),f.style.left="".concat(o.getBoundingClientRect().left-i.dom.getBoundingClientRect().left,"px")})),i.dom.addEventListener("click",(function(){o.classList.add("fold")}));var u=document.createElement("span");u.classList.add("menu-selector-value"),u.textContent=t.text;var d=e.themeTool.slots.icon("downArrow");d.setAttribute("aria-hidden","true"),o.appendChild(l),l.appendChild(u),l.appendChild(d);var f=document.createElement("div");return f.classList.add("menu-selector-list"),t.options.forEach((function(e){var t=document.createElement("button");t.setAttribute("type","button"),t.dataset.id=e.id,t.textContent=e.text,t.classList.add("menu-selector-list-item"),f.appendChild(t)})),f.addEventListener("mousedown",(function(e){var a,r=e.target;r instanceof HTMLButtonElement&&r.dataset.id&&((a=n.get(w.g)).call.apply(a,Object(c.a)(t.onSelect(r.dataset.id,i))),o.classList.add("fold"))})),o.appendChild(f),s&&o.classList.add(s),t.alwaysVisible?(l.removeAttribute("disabled"),o):(!a.enabled||t.disabled&&t.disabled(i)?(l.classList.add("disabled"),l.children[0].setAttribute("disabled","true")):(l.classList.remove("disabled"),l.children[0].removeAttribute("disabled")),o)}(n,e,s,t,this.options);return l;case"divider":var u=function(e,t){var n=e.getStyle((function(e){return Object($.a)(a||(a=Object(z.a)(["\n      flex-shrink: 0;\n      width: ",";\n      background-color: ",";\n      margin: 0.75rem 1rem;\n    "])),e.size.lineWidth,e.palette("line"))})),i=document.createElement("div");return i.classList.add("divider"),n&&i.classList.add(n),t.group.every((function(e){return e.getAttribute("disabled")||e.classList.contains("disabled")}))?i.classList.add("disabled"):i.classList.remove("disabled"),i}(n,e);return u;default:throw new Error}}}]),e}(),q=Object(W.f)((function(e,t){var n,i,a=null!==(n=null===t||void 0===t?void 0:t.config)&&void 0!==n?n:H,r=null===(i=null===t||void 0===t?void 0:t.enabled)||void 0===i||i,s=Object(w.i)();return{commands:function(){return[Object(w.h)(s,(function(){return R.c}))]},prosePlugins:function(t,n){return[new U.d({key:new U.e("milkdown-advanced-menu"),view:function(t){var i=new B(a,e,n,t,{enabled:r});return{update:function(e){return i.update(e)}}}})]}}})),J=n(31),Q=function(e,t){var n=e.onChange,i=e.value,a=e.menuConfig,r=e.editable,s=e.spellcheck,o=Object(g.useRef)(null);Object(g.useImperativeHandle)(t,(function(){return{update:function(e){if(r&&o.current){var t=o.current.get();t&&t.action((function(t){var n=t.get(w.k),i=t.get(w.q)(e);if(i){var a=n.state;n.dispatch(a.tr.replace(0,a.doc.content.size,new E.j(i.content,0,0)).setMeta("addToHistory",!1))}}))}}}}));var l=Object(S.b)((function(e){return function(e){var t=e.root,n=e.onChange,i=e.value,a=e.menuConfig,r=e.editable,s=e.spellcheck;return w.b.make().config((function(e){e.set(w.t,t),e.get(C.b).markdownUpdated((function(e,t){n(t)})),e.set(w.l,{editable:function(){return r}}),null===t||void 0===t||t.setAttribute("spellcheck",JSON.stringify(s)),i&&e.set(w.j,i)})).use(M.a).use(x.a).use(T.a).use(A.c).use(C.a).use(j.a).use(P.a).use(I.a).use(L.a).use(O.a).use(N.a).use(D.a).use(F.a).use(q({config:a,enabled:r}))}({root:e,onChange:n,value:i,menuConfig:a,editable:r,spellcheck:s})}),[i,n,i,a,r,s]);return Object(J.jsx)("div",{className:"milkdown-container",children:Object(J.jsx)(S.a,{ref:o,editor:l})})},Y=Object(g.forwardRef)(Q),G=n(22),X=(n(190),n(57)),Z=n(132),ee=n(99),te=function(e,t){var n=e.onChange,i=e.value,a=e.editable,r=e.spellcheck,s=Object(g.useState)(!1),o=Object(G.a)(s,2),l=o[0],c=o[1],u=Object(g.useRef)(null),d=[X.a,Object(Z.a)(),ee.a.lineWrapping,ee.a.updateListener.of((function(e){if(e.focusChanged&&c(e.view.hasFocus),e.docChanged){var t=e.state.doc.toString();n(t)}}))];return Object(g.useImperativeHandle)(t,(function(){return{update:function(e){if(!l&&a&&u.current){var t=u.current.view;if(t){var n=t.state;if(n){var i=n.doc;i&&t.dispatch({changes:{from:0,to:i.toString().length,insert:e}})}}}}}})),Object(J.jsx)("div",{className:"codemirror-container",children:Object(J.jsx)(ee.b,{ref:u,extensions:d,value:i,editable:a,spellCheck:r,indentWithTab:!0})})},ne=Object(g.forwardRef)(te),ie=n(77),ae=n.n(ie);!function(e){e.Horizontal="horizontal",e.Vertical="vertical"}(o||(o={})),function(e){e.Row="row",e.Column="column"}(l||(l={}));ae.a.bool.isRequired,ae.a.oneOf([o.Horizontal,o.Vertical]).isRequired,ae.a.arrayOf(ae.a.element).isRequired;var re,se=function(e){var t=e.children,n=e.split,i=e.direction,a=i===o.Horizontal?l.Column:l.Row;return Object(J.jsxs)("div",{className:"container ".concat(i),children:[Object(J.jsx)("div",{className:"".concat(a," ").concat(n?"half":"full"),children:t[0]}),n&&Object(J.jsxs)(J.Fragment,{children:[Object(J.jsx)("div",{className:"separator"}),Object(J.jsx)("div",{className:"".concat(a," half"),children:t[1]})]})]})},oe=Object(g.memo)(se),le=n(130),ce=n.n(le),ue=n(131);!function(e){e.Milkdown="milkdown",e.CodeMirror="codemirror"}(re||(re={}));var de=function(e){Object(m.a)(n,e);var t=Object(p.a)(n);function n(e){var i;return Object(d.a)(this,n),(i=t.call(this,e)).editorKit=void 0,i.prevText="",i.milkdownRef=Object(g.createRef)(),i.codeMirrorRef=Object(g.createRef)(),i.onTextChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.Milkdown;if(i.prevText!==e.trim())switch(i.prevText=e.trim(),i.editorKit.onEditorValueChanged(e),t){case re.CodeMirror:i.updateMilkdownText(i.prevText);break;case re.Milkdown:default:i.updateCodeMirrorText(i.prevText)}},i.toggleSplitView=function(){var e=i.state.splitView;i.setState({splitView:!e})},i.getSplitViewDirection=function(e){return{web:o.Horizontal,desktop:o.Horizontal,mobile:o.Vertical}[e]},i.state={splitView:!1,editable:!0,spellcheck:!0,isLoading:!0},i}return Object(f.a)(n,[{key:"componentDidMount",value:function(){this.configureEditorKit()}},{key:"configureEditorKit",value:function(){var e=this,t={setEditorRawText:function(t){e.prevText=t.trim(),e.updateMilkdownText(e.prevText),e.updateCodeMirrorText(e.prevText),e.setState({isLoading:!1})},generateCustomPreview:function(t){var n=ue.marked.parse(t),i=document.createElement("div");i.innerHTML=n;var a=i.textContent||i.innerText||"";return{plain:e.truncateString(a).trim()}},onNoteValueChange:function(){var t=Object(u.a)(v.a.mark((function t(n){var i,a,r;return v.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=null===(i=!n.content.appData["org.standardnotes.sn"].locked)||void 0===i||i,r=n.content.spellcheck,e.setState({editable:a,spellcheck:r});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),onNoteLockToggle:function(t){var n=!t;e.setState({editable:n})}};this.editorKit=new ce.a(t,{mode:"markdown",supportsFileSafe:!1})}},{key:"updateMilkdownText",value:function(e){var t=this.milkdownRef.current;t&&t.update(e)}},{key:"updateCodeMirrorText",value:function(e){var t=this.codeMirrorRef.current;t&&t.update(e)}},{key:"truncateString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:90;return e.length<=t?e:e.substring(0,t)+"..."}},{key:"render",value:function(){var e,t,n=this,i=this.state,a=i.splitView,r=i.editable,s=i.spellcheck;if(i.isLoading)return null;var o=null!==(e=null===(t=this.editorKit)||void 0===t?void 0:t.environment)&&void 0!==e?e:"web",l=this.getSplitViewDirection(o),u=[].concat(Object(c.a)(H),[[{type:"button",icon:"code",active:function(){return a},callback:this.toggleSplitView,alwaysVisible:!0}]]);return Object(J.jsxs)(oe,{split:a,direction:l,children:[Object(J.jsx)(Y,{ref:this.milkdownRef,onChange:this.onTextChange,value:this.prevText,menuConfig:u,editable:r,spellcheck:s}),Object(J.jsx)(ne,{ref:this.codeMirrorRef,onChange:function(e){return n.onTextChange(e,re.CodeMirror)},value:this.prevText,editable:r,spellcheck:s})]})}}]),n}(g.Component);y.a.render(Object(J.jsx)(g.StrictMode,{children:Object(J.jsx)(de,{})}),document.getElementById("root")),k(console.log)}},[[201,1,2]]]);
//# sourceMappingURL=main.7192e457.chunk.js.map